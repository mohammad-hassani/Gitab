<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ุถููู A</title>
  <meta name="description" content="ุชุฑุฌููโูุง ูุงุฑุณ ฺฉุชุงุจโูุง ูู โ ุณุฑุนุ ูููุงู ู ูุงุจู ุงุชฺฉุง.">
  <link rel="stylesheet" href="/styles/main.css">
<link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<style>
@font-face {
  font-family: 'Vazir';
  src: url('/fonts/Vazir-FD-WOL.ttf') format('truetype');
  font-display: swap;
}
body {
  font-family: 'Vazir', sans-serif;
}
</style>

</head>
<body>
  <!-- ูุฏุฑ ูุดุชุฑฺฉ -->
 <header class="header">
  <div class="container nav-wrap">
    <a href="/" class="brand">
      <img src="/icone/logo.svg" alt="Gitab logo" width="26" height="26">
      <span>Gitab</span>
    </a>

    <nav class="nav">
      <a href="/" aria-current="page">ุฎุงูู</a>
      <a href="/books/list-books">ฺฉุชุงุจโูุง</a>
      <a href="#">ูุชุฑุฌูู</a>
      <a href="#">ููฺฉุงุฑ</a>
      <a href="#">ุฏุฑุจุงุฑู ูุง</a>
    </nav>

    <div class="nav-actions">
     <button id="themeToggle" class="icon-btn theme-btn" data-icon="moon" aria-label="ุชุบุฑ ุชู">
        <img src="/icone/sun.svg" class="icon-sun" alt="ุฑูุดู">
        <img src="/icone/moon.svg" class="icon-moon" alt="ุชุงุฑฺฉ">
      </button>
  <a class="icon-btn" href="https://github.com/hheydarian/Gitab" target="_blank" title="GitHub">
    <img src="/icone/github.svg" alt="GitHub">
  </a>
      <!-- ุฏฺฉูู ููู ุจุฑุง ููุจุงู -->
      <button class="menu-toggle" aria-label=" ููู">
        <img src="/icone/menu.svg" alt="menu">
      </button>
    </div>
  </div> 
  

</header>

 

<main class="site-main book-page ">
  <h1>๐ ุถููู A</h1>
<h1>๐งต ููโุฑููุฏ (Concurrency) โ ุจุฎุด ุฏูู</h1>
<p>โ๏ธ ููุดุชู: <strong>Brett L. Schuchert</strong></p>
<p>ุงู ุถููู ุจู ูุตู ยซููโุฑููุฏยป ุฏุฑ ุตูุญู 177 ฺฉุชุงุจ ๐งผ <em>Clean Code</em> ฺฉูฺฉ ูโฺฉูุฏ ู ุขู ุฑุง ฺฏุณุชุฑุด ูโุฏูุฏ. ุงู ุจุฎุด ุจูโุตูุฑุช ูุฌููุนูโุง ุงุฒ ููุถูุนุงุช ูุณุชูู ููุดุชู ุดุฏู ุงุณุช ู ูุนูููุงู ูโุชูุงู ุขูโูุง ุฑุง ุจู ูุฑ ุชุฑุชุจ ูุทุงูุนู ฺฉุฑุฏ. ุจุฑุง ุงูฺฉู ุงู ููุน ูุทุงูุนู ุงูฺฉุงูโูพุฐุฑ ุจุงุดุฏุ ุฏุฑ ุจุฎุดโูุง ูุฎุชูู ููุฏุงุฑ ุชฺฉุฑุงุฑ ุฏุฏู ูโุดูุฏ.</p>
<hr>
<h2>๐ป ูุซุงู Client/Server (ฺฉุงุฑุจุฑ / ุณุฑูุฑ)</h2>
<p>ูุฑุถ ฺฉูุฏ ฺฉ ุจุฑูุงูู ุณุงุฏูโ <strong>Client/Server</strong> ุฏุงุฑู.<br>
๐ธ ฺฉ <strong>ุณุฑูุฑ (Server)</strong> ุฑู ฺฉ <em>ุณูฺฉุช (Socket)</em> ููุชุธุฑ ูโูุงูุฏ ุชุง ฺฉ <strong>ฺฉูุงูุช (Client)</strong> ุจู ุขู ูุตู ุดูุฏ.<br>
๐ธ ฺฉ <strong>ฺฉูุงูุช</strong> ูุตู ุดุฏู ู ฺฉ ุฏุฑุฎูุงุณุช ุงุฑุณุงู ูโฺฉูุฏ.</p>
<hr>
<h2>๐ฅ๏ธ ุณุฑูุฑ (The Server)</h2>
<p>ุฏุฑ ุงุฏุงูู ูุณุฎูโ ุณุงุฏูโุดุฏูโุง ุงุฒ ฺฉ ุจุฑูุงููโ ุณุฑูุฑ ุฑุง ูโุจูุฏ.<br>
๐ ูุณุฎู ฺฉุงูู ฺฉุฏ ุงู ูุซุงู ุฏุฑ ุตูุญู 343 ุจุง ุนููุงู <strong>Client/Server Nonthreaded</strong> ุขูุฏู ุงุณุช:</p>
<pre class="hljs"><code><span class="hljs-type">ServerSocket</span> <span class="hljs-variable">serverSocket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerSocket</span>(<span class="hljs-number">8009</span>);
<span class="hljs-keyword">while</span> (keepProcessing) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">Socket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> serverSocket.accept();
        process(socket);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        handle(e);
    }
}
</code></pre>
<p>ุงู ุจุฑูุงูู ุณุงุฏู ููุชุธุฑ ฺฉ ุงุชุตุงู ูโูุงูุฏุ ูพุงู ูุฑูุฏ ุฑุง ูพุฑุฏุงุฒุด ูโฺฉูุฏ ู ุณูพุณ ุฏูุจุงุฑู ููุชุธุฑ ุฏุฑุฎูุงุณุช ุจุนุฏ ุงุฒ ฺฉูุงูุช ูโูุดูุฏ.<br>
ุฏุฑ ุงุฏุงููุ ฺฉุฏ ูุฑุจูุท ุจู <strong>ฺฉูุงูุช</strong> ุฑุง ูโุจูุฏ ฺฉู ุจู ุงู ุณุฑูุฑ ูุตู ูโุดูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connectSendReceive</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">Socket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Socket</span>(<span class="hljs-string">&quot;localhost&quot;</span>, PORT);
        MessageUtils.sendMessage(socket, Integer.toString(i));
        MessageUtils.getMessage(socket);
        socket.close();
    } <span class="hljs-keyword">catch</span> (Exception e) {
        e.printStackTrace();
    }
}
</code></pre>
<hr>
<h2>๐ ุจุฑุฑุณ ุนููฺฉุฑุฏ (Performance)</h2>
<p>ุนููฺฉุฑุฏ ุงู ุฌูุช Client/Server ฺุทูุฑ ุงุณุชุ<br>
ฺุทูุฑ ูโุชูุงูู ุงู ุนููฺฉุฑุฏ ุฑุง ุจูโุตูุฑุช ุฑุณู ุชูุตู ฺฉููุ<br>
ุฏุฑ ุงูุฌุง ฺฉ ุชุณุช ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุจุฑุฑุณ ูโฺฉูุฏ ุขุง ุนููฺฉุฑุฏ ุณุณุชู ยซูุงุจู ูุจููยป ุงุณุช ุง ูู:</p>
<pre class="hljs"><code><span class="hljs-meta">@Test(timeout = 10000)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldRunInUnder10Seconds</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
    Thread[] threads = createThreads();
    startAllThreadsw(threads);
    waitForAllThreadsToFinish(threads);
}
</code></pre>
<p>๐ ุชูุธูุงุช ุงููู ุงู ุชุณุช ุจุฑุง ุณุงุฏฺฏ ุญุฐู ุดุฏู ุงุณุช (ุจู ูุงู <strong>ClientTest.java</strong> ุฏุฑ ุตูุญู 344 ูุฑุงุฌุนู ฺฉูุฏ).<br>
ุงู ุชุณุช ุงูุชุธุงุฑ ุฏุงุฑุฏ ฺฉู ุงุฌุฑุง ฺฉู ุนููุงุช ุฏุฑ ฺฉูุชุฑ ุงุฒ <strong>ฑฐูฌฐฐฐ ููโุซุงูู</strong> (ฑฐ ุซุงูู) ุงูุฌุงู ุดูุฏ โฑ๏ธ</p>
<hr>
<h2>๐ ุจุฑุฑุณ ุชูุงู ุนููุงุช (Throughput)</h2>
<p>ุงู ฺฉ ูุซุงู ฺฉูุงุณฺฉ ุงุฒ ุงุนุชุจุงุฑุณูุฌ <strong>Throughput</strong> ุณุณุชู ุงุณุช.<br>
ุฏุฑ ุงู ุณุณุชูุ ุจุงุฏ ูุฌููุนูโุง ุงุฒ ุฏุฑุฎูุงุณุชโูุง ฺฉูุงูุช ุฏุฑ ฑฐ ุซุงูู ุชฺฉูู ุดููุฏ.<br>
ุชุง ุฒูุงู ฺฉู ุณุฑูุฑ ุจุชูุงูุฏ ูุฑ ุฏุฑุฎูุงุณุช ุฑุง ุจูโูููุน ูพุฑุฏุงุฒุด ฺฉูุฏุ ุชุณุช ุจุง ููููุช ูพุงุณ ูโุดูุฏ โ</p>
<p>ุงูุง ุงฺฏุฑ ุชุณุช ุดฺฉุณุช ุจุฎูุฑุฏ ฺูุ ๐ค<br>
ุฏุฑ ุตูุฑุช ฺฉู ููุน <strong>Event Polling Loop</strong> (ุญููู ุจุฑุฑุณ ุฑูุฏุงุฏูุง) ุทุฑุงุญ ูฺฉููุ ุฏุฑ ฺฉ <strong>ุชฺฉโุฑุดุชู (Single Thread)</strong> ฺฉุงุฑ ุฎุงุต ููโุชูุงู ุจุฑุง ุณุฑุนโุชุฑ ฺฉุฑุฏู ุงู ฺฉุฏ ุงูุฌุงู ุฏุงุฏ.</p>
<p>ุขุง ุงุณุชูุงุฏู ุงุฒ ฺูุฏ ุฑุดุชู (Multiple Threads) ูโุชูุงูุฏ ูุดฺฉู ุฑุง ุญู ฺฉูุฏุ<br>
ุดุงุฏุ ุงูุง ุงุจุชุฏุง ุจุงุฏ ุจุฏุงูู ุฒูุงู ุฏููุงู ฺฉุฌุง ุตุฑู ูโุดูุฏ. ุฏู ุญุงูุช ฺฉู ูุฌูุฏ ุฏุงุฑุฏ:</p>
<ul>
<li>๐ <strong>I/O</strong> (ูุฑูุฏ/ุฎุฑูุฌ): ูุซู ุงุณุชูุงุฏู ุงุฒ ุณูฺฉุชุ ุงุชุตุงู ุจู ุฏุชุงุจุณุ ุงูุชุธุงุฑ ุจุฑุง Swap ุดุฏู ุญุงูุธู ูุฌุงุฒ ู ููุงุฑุฏ ูุดุงุจู.</li>
<li>๐งฎ <strong>Processor</strong> (ูพุฑุฏุงุฒูุฏู): ูุซู ุงูุฌุงู ูุญุงุณุจุงุช ุนุฏุฏุ ูพุฑุฏุงุฒุด Regular Expressionูุงุ Garbage Collection ู ููุงุฑุฏ ูุดุงุจู.</li>
</ul>
<p>ุจูโุทูุฑ ูุนููู ุณุณุชูโูุง ููุฏุงุฑ ุงุฒ ูุฑ ุฏู ููุฑุฏ ุฑุง ุฏุงุฑูุฏุ ุงูุง ุฏุฑ ูุฑ ุนููุงุช ฺฉ ุงุฒ ุขูโูุง ุบุงูุจ ุงุณุช.</p>
<p>ุงฺฏุฑ ฺฉุฏ <strong>Processor-bound</strong> ุจุงุดุฏุ ุงูุฒูุฏู ุณุฎุชโุงูุฒุงุฑ ูพุฑุฏุงุฒุด ุจุดุชุฑ ูโุชูุงูุฏ Throughput ุฑุง ุงูุฒุงุด ุฏูุฏ ู ุจุงุนุซ ููููุช ุชุณุช ุดูุฏ.<br>
ุงูุง ฺูู ฺุฑุฎูโูุง CPU ูุญุฏูุฏูุฏุ ุงูุฒูุฏู Thread ุจู ฺฉ ูุณุฆูู Processor-bound ุจุงุนุซ ุงูุฒุงุด ุณุฑุนุช ููโุดูุฏ โ๏ธ</p>
<p>ุงุฒ ุทุฑู ุฏฺฏุฑุ ุงฺฏุฑ ูุฑุขูุฏ <strong>I/O-bound</strong> ุจุงุดุฏุ ุงุณุชูุงุฏู ุงุฒ ููโุฑููุฏ (Concurrency) ูโุชูุงูุฏ ุจุงุฒุฏู ุฑุง ุงูุฒุงุด ุฏูุฏ โ<br>
ุฏุฑ ุงู ุญุงูุชุ ุฒูุงู ฺฉู ฺฉ ุจุฎุด ุงุฒ ุณุณุชู ููุชุธุฑ I/O ุงุณุชุ ุจุฎุด ุฏฺฏุฑ ูโุชูุงูุฏ ุงุฒ ููุงู ุฒูุงู ุจุฑุง ูพุฑุฏุงุฒุด ฺฉุงุฑ ุฏฺฏุฑ ุงุณุชูุงุฏู ฺฉูุฏ ู ุงุฒ CPU ุจูุฑูโูุฑ ุจูุชุฑ ุจฺฏุฑุฏ ๐ก</p>
<hr>
<h2>๐งต ุงูุฒูุฏู ฺูุฏุฑุณูุงู (Adding Threading)</h2>
<p>ูุฑุถ ฺฉูู ุชุณุช ุนููฺฉุฑุฏ ุดฺฉุณุช ุฎูุฑุฏู ุงุณุช.<br>
ฺุทูุฑ ูโุชูุงูู <strong>Throughput</strong> ุฑุง ุจูุจูุฏ ุฏูู ุชุง ุชุณุช ุจุง ููููุช ูพุงุณ ุดูุฏุ</p>
<p>ุงฺฏุฑ ูุชุฏ <code>process</code> ุณุฑูุฑ <strong>I/O-bound</strong> ุจุงุดุฏุ ฺฉ ุฑูุด ุงู ุงุณุช ฺฉู ุณุฑูุฑ ุฑุง ุจู ุดฺฉู ฺูุฏุฑุณูุงู (Threaded) ุชุบุฑ ุฏูู.<br>
ฺฉุงู ุงุณุช ููุท ูุญููโ ูพุฑุฏุงุฒุด ูพุงู ุฑุง ุนูุถ ฺฉูู:</p>
<pre class="hljs"><code><span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Socket socket)</span> {
    <span class="hljs-keyword">if</span> (socket == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span>;
    <span class="hljs-type">Runnable</span> <span class="hljs-variable">clientHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> MessageUtils.getMessage(socket);
                MessageUtils.sendMessage(socket, <span class="hljs-string">&quot;Processed: &quot;</span> + message);
                closeIgnoringException(socket);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                e.printStackTrace();
            }
        }
    };
    <span class="hljs-type">Thread</span> <span class="hljs-variable">clientConnection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(clientHandler);
    clientConnection.start();
}
</code></pre>
<p>ูุฑุถ ฺฉูุฏ ุงู ุชุบุฑ ุจุงุนุซ ุดุฏู ุชุณุช ุนููฺฉุฑุฏ ูพุงุณ ุดูุฏ โ<br>
ฺฉุฏ ฺฉุงูู ุดุฏู ุงุณุชุ ุฏุฑุณุช ุงุณุชุ ๐ค</p>
<h2>๐ ูุดุงูุฏุงุช ูุฑุจูุท ุจู ุณุฑูุฑ (Server Observations) ๐ฅ๏ธ</h2>
<p>ูุณุฎู ุจูโุฑูุฒุดุฏูโ ุณุฑูุฑุ ุชุณุช ุนููฺฉุฑุฏ ุฑุง ุฏุฑ ฺฉู ุจุด ุงุฒ <strong>ฑ ุซุงูู</strong> ุจุง ููููุช ุจู ูพุงุงู ูโุฑุณุงูุฏ โฑ๏ธโ<br>
ุงูุง ูุชุฃุณูุงูู ุงู ุฑุงูโุญู ฺฉู ุณุงุฏูโุงูฺฏุงุฑุงูู ุงุณุช ู ูุดฺฉูุงุช ุฌุฏุฏ ุฑุง ุจู ููุฑุงู ูโุขูุฑุฏ โ๏ธ</p>
<p>โ <strong>ุณุฑูุฑ ูุง ููฺฉู ุงุณุช ฺูุฏ ุชุง Thread ุงุฌุงุฏ ฺฉูุฏุ</strong><br>
ฺฉุฏ ฺฉู ููุดุชู ูฺ ูุญุฏูุฏุช ุจุฑุง ุชุนุฏุงุฏ Threadูุง ุชุนู ูฺฉุฑุฏู ุงุณุช. ุจูุงุจุฑุงู ููฺฉู ุงุณุช ุจู ุณูู ุชุนุฏุงุฏ Threadูุง ุจุฑุณู ฺฉู <strong>JVM (Java Virtual Machine)</strong> ุงุฌุงุฒู ูโุฏูุฏ.<br>
ุจุฑุง ุจุณุงุฑ ุงุฒ ุณุณุชูโูุง ุณุงุฏูุ ุงู ููุฏุงุฑ ฺฉุงู ุงุณุช.<br>
ุงูุง ุงฺฏุฑ ุณุณุชู ูุง ูุฑุงุฑ ุจุงุดุฏ ุงุฒ ฺฉุงุฑุจุฑุงู ุฒุงุฏ ุฏุฑ ุงูุชุฑูุช ุนููู ูพุดุชุจุงู ฺฉูุฏุ ฺูุ ๐<br>
ุงฺฏุฑ ุชุนุฏุงุฏ ุฒุงุฏ ฺฉุงุฑุจุฑ ููโุฒูุงู ูุชุตู ุดููุฏุ ููฺฉู ุงุณุช ุณุณุชู ุนููุงู ุงุฒ ฺฉุงุฑ ุจูุชุฏ ุง ุจู ุดุฏุช ฺฉูุฏ ุดูุฏ ๐ข๐ฅ</p>
<p>ูุนูุงู ูุดฺฉูุงุช ุฑูุชุงุฑ ุฑุง ฺฉูุงุฑ ุจฺฏุฐุงุฑู. ุฑุงูโุญู ุงุฑุงุฆูโุดุฏูุ ุงุฒ ูุธุฑ <strong>ูพุงฺฉ (Cleanliness)</strong> ู <strong>ุณุงุฎุชุงุฑ (Structure)</strong> ูุฒ ูุดฺฉูุงุช ุฏุงุฑุฏ.<br>
โ ฺฉุฏ ุณุฑูุฑ ฺู ุชุนุฏุงุฏ ยซูุณุฆููุชยป ุฏุงุฑุฏุ</p>
<ul>
<li>๐ธ ูุฏุฑุช ุงุชุตุงูโูุง Socket</li>
<li>๐ธ ูพุฑุฏุงุฒุด ฺฉูุงูุช</li>
<li>๐ธ ุณุงุณุช Threading (Threading Policy)</li>
<li>๐ธ ุณุงุณุช ุฎุงููุด ฺฉุฑุฏู ุณุฑูุฑ (Server Shutdown Policy)</li>
</ul>
<p>ูุชุฃุณูุงูู ูููโ ุงู ูุณุฆููุชโูุง ุฏุงุฎู ุชุงุจุน <code>process</code> ูุฑุงุฑ ุฏุงุฑูุฏ.<br>
ุนูุงูู ุจุฑ ุขูุ ุงู ฺฉุฏ ุณุทูุญ ูุฎุชูู ุงุฒ <strong>ุงูุชุฒุงุน (Abstraction)</strong> ุฑุง ุจุง ูู ูุฎููุท ูโฺฉูุฏ.<br>
ุจูุงุจุฑุงู ุจุง ูุฌูุฏ ฺฉูฺฺฉ ุจูุฏู ุชุงุจุน <code>process</code>ุ ูุงุฒู ุงุณุช ุงู ฺฉุฏ ุฏูุจุงุฑู ุณุงุฎุชุงุฑุจูุฏ ุดูุฏ โ๏ธ๐</p>
<blockquote>
<p>๐ (ูโุชูุงูุฏ ุฎูุฏุชุงู ุจุง ุจุฑุฑุณ ฺฉุฏ ูุจู ู ุจุนุฏ ุงุฒ ุชุบุฑ ุงู ููุถูุน ุฑุง ุจุจูุฏ.<br>
ฺฉุฏ ุจุฏูู Thread ุงุฒ ุตูุญู 343 ุดุฑูุน ูโุดูุฏ ู ูุณุฎู Threaded ุงุฒ ุตูุญู 346.)</p>
</blockquote>
<hr>
<h2>๐งญ ุงุตู ุชฺฉโูุณุฆููุช (Single Responsibility Principle)</h2>
<p>ุณุฑูุฑ ุจู ุฏูุงู ูุชุนุฏุฏ ูุงุฒ ุจู ุชุบุฑ ุฏุงุฑุฏุ ุจูุงุจุฑุงู ุงู ฺฉุฏ ุงุตู <strong>Single Responsibility Principle (SRP)</strong> ุฑุง ููุถ ูโฺฉูุฏ โ</p>
<p>ุจุฑุง ุญูุธ ุชูุฒ ุณุณุชูโูุง ููโุฑููุฏ (Concurrent Systems)ุ ูุฏุฑุช Threadูุง ุจุงุฏ ููุท ุฏุฑ ฺูุฏ ูฺฉุงู ูุญุฏูุฏ ู ฺฉุงููุงู ฺฉูุชุฑูโุดุฏู ุงูุฌุงู ุดูุฏ โ<br>
ุนูุงูู ุจุฑ ุงูุ ูุฑ ุจุฎุด ุงุฒ ฺฉุฏ ฺฉู ูุณุฆูู Threadูุงุณุช ุจุงุฏ ููุท ููู ฺฉุงุฑ ุฑุง ุงูุฌุงู ุฏูุฏ ู ูู ูฺ ฺุฒ ุฏฺฏุฑ.</p>
<p>ฺุฑุงุ<br>
ุฒุฑุง ูพุฏุง ฺฉุฑุฏู ู ุฑูุน ูุดฺฉูุงุช ููโุฑููุฏ (Concurrency Bugs) ุจูโุฎูุฏโุฎูุฏ ฺฉุงุฑ ุจุณุงุฑ ุฏุดูุงุฑ ุงุณุช ๐ตโ๐ซ<br>
ุญุงูุง ุชุตูุฑ ฺฉูุฏ ูุฌุจูุฑ ุจุงุดุฏ ููโุฒูุงู ุจุง ุขูุ ูุดฺฉูุงุช ุฏฺฏุฑ ุฑุง ูู ุฑูุน ฺฉูุฏ! ๐ฌ</p>
<hr>
<h2>๐งฑ ุฌุฏุงุณุงุฒ ูุณุฆููุชโูุง</h2>
<p>ุงฺฏุฑ ุจุฑุง ูุฑฺฉุฏุงู ุงุฒ ูุณุฆููุชโูุง ุจุงูุง โ ุงุฒ ุฌููู ูุฏุฑุช Thread โ ฺฉ ฺฉูุงุณ ุฌุฏุงฺฏุงูู ุจุณุงุฒูุ ุขูฺฏุงู ุจุง ุชุบุฑ ุงุณุชุฑุงุชฺ ูุฏุฑุช Threadุ ููุท ุจุฎุด ฺฉูฺฺฉ ุงุฒ ฺฉุฏ ุชุบุฑ ูโฺฉูุฏ ู ูุณุฆููุชโูุง ุฏฺฏุฑ ุขููุฏู ููโุดููุฏ ๐</p>
<p>ุงู ฺฉุงุฑ ุจุงุนุซ ูโุดูุฏ ุขุฒูุงุด (Test) ุจุฎุดโูุง ุฏฺฏุฑ ูุฒ ุณุงุฏูโุชุฑ ุดูุฏ ฺูู ูุงุฒ ุจู ุฏุฑฺฏุฑ ุดุฏู ุจุง Threadูุง ูุฎูุงูุฏ ุจูุฏ ๐งชโจ</p>
<p>ุฏุฑ ุงุฏุงูู ูุณุฎูโ ุจูโุฑูุฒุดุฏูโุง ุงุฒ ุณุฑูุฑ ุฑุง ูโุจูุฏ ฺฉู ุฏููุงู ููู ฺฉุงุฑ ุฑุง ุงูุฌุงู ูโุฏูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
  <span class="hljs-keyword">while</span> (keepProcessing) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-type">ClientConnection</span> <span class="hljs-variable">clientConnection</span> <span class="hljs-operator">=</span> connectionManager.awaitClient();
      <span class="hljs-type">ClientRequestProcessor</span> <span class="hljs-variable">requestProcessor</span> 
        <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientRequestProcessor</span>(clientConnection);
      clientScheduler.schedule(requestProcessor);
    } <span class="hljs-keyword">catch</span> (Exception e) {
      e.printStackTrace();
    }
  }
  connectionManager.shutdown();
}
</code></pre>
<p>ุฏุฑ ุงู ูุณุฎูุ ูููโ ุจุฎุดโูุง ูุฑุจูุท ุจู Thread ุฏุฑ ฺฉ ูฺฉุงู ูุชูุฑฺฉุฒ ุดุฏูโุงูุฏ:<br>
๐ <code>clientScheduler</code><br>
ุงฺฏุฑ ูุดฺฉู ุฏุฑ ููโุฑููุฏ ูพุด ุจุงุฏุ ููุท ููู ููุทู ุฑุง ุจุงุฏ ุจุฑุฑุณ ฺฉูู ๐ต๏ธโโ๏ธ</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ClientScheduler</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">schedule</span><span class="hljs-params">(ClientRequestProcessor requestProcessor)</span>;
}
</code></pre>
<hr>
<h2>๐งญ ุณุงุณุช ูุนู (Current Policy)</h2>
<p>ูพุงุฏูโุณุงุฒ ุณุงุณุช ูุนู ุจุณุงุฑ ุณุงุฏู ุงุณุช:</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPerRequestScheduler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ClientScheduler</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">schedule</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ClientRequestProcessor requestProcessor)</span> {
        <span class="hljs-type">Runnable</span> <span class="hljs-variable">runnable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                requestProcessor.process();
            }
        };
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(runnable);
        thread.start();
    }
}
</code></pre>
<p>ุจุง ุฌุฏุง ฺฉุฑุฏู ฺฉุงูู ูุฏุฑุช Threadูุง ุฏุฑ ฺฉ ูฺฉุงูุ ุชุบุฑ ูุญููโ ฺฉูุชุฑู Threadูุง ุจุณุงุฑ ุขุณุงูโุชุฑ ูโุดูุฏ ๐โจ</p>
<p>ูุซูุงู ุจุฑุง ุงุณุชูุงุฏู ุงุฒ <strong>Java 5 Executor Framework</strong> ููุท ฺฉุงู ุงุณุช ฺฉ ฺฉูุงุณ ุฌุฏุฏ ุจููุณู ู ุขู ุฑุง ุฏุฑ ุณุณุชู ูุฑุงุฑ ุฏูู:</p>
<hr>
<h2>๐ Listing A-1 โ <code>ExecutorClientScheduler.java</code> ๐งต</h2>
<pre class="hljs"><code><span class="hljs-keyword">import</span> java.util.concurrent.Executor;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExecutorClientScheduler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ClientScheduler</span> {
    Executor executor;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ExecutorClientScheduler</span><span class="hljs-params">(<span class="hljs-type">int</span> availableThreads)</span> {
        executor = Executors.newFixedThreadPool(availableThreads);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">schedule</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ClientRequestProcessor requestProcessor)</span> {
        <span class="hljs-type">Runnable</span> <span class="hljs-variable">runnable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                requestProcessor.process();
            }
        };
        executor.execute(runnable);
    }
}
</code></pre>
<hr>
<h2>๐ฉ ูุชุฌูโฺฏุฑ (Conclusion) โ</h2>
<p>ุงูุฒูุฏู ููโุฑููุฏ (Concurrency) ุฏุฑ ุงู ูุซุงู ุฎุงุตุ ุฑูุด ุจุฑุง <strong>ุงูุฒุงุด ุชูุงู ุนููุงุช (Throughput)</strong> ุณุณุชู ุฑุง ูุดุงู ูโุฏูุฏ ู ููฺูู ูุญููโ ุงุนุชุจุงุฑุณูุฌ ุงู ุชูุงู ุนููุงุช ุงุฒ ุทุฑู ุชุณุช ุฑุง ุขููุฒุด ูโุฏูุฏ ๐งช๐</p>
<p>ูุชูุฑฺฉุฒ ฺฉุฑุฏู ุชูุงู ฺฉุฏูุง ููโุฑููุฏ ุฏุฑ ฺูุฏ ฺฉูุงุณ ูุดุฎุตุ ูููููโุง ุงุฒ ุจูโฺฉุงุฑฺฏุฑ ุงุตู <strong>Single Responsibility Principle</strong> ุงุณุช.<br>
ุฏุฑ ุจุฑูุงููโููุณ ููโุฑููุฏุ ุงู ููุถูุน ุงููุช ูฺูโุง ุฏุงุฑุฏ ุฒุฑุง ุงู ููุน ฺฉุฏููุณ ุฐุงุชุงู ูพฺุฏู ุงุณุช ๐งโก</p>
<hr>
<h2>๐งญ ูุณุฑูุง ููฺฉู ุงุฌุฑุง ฺฉุฏ (Possible Paths of Execution)</h2>
<p>ุจุงุฏ ูุชุฏ ุฒุฑ ุฑุง ุจุฑุฑุณ ฺฉูู ๐</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdGenerator</span> {
  <span class="hljs-type">int</span> lastIdUsed;
  <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">incrementValue</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> ++lastIdUsed;
  }
}
</code></pre>
<p>ูุฑุถ ฺฉูุฏ <strong>Overflow ุนุฏุฏ</strong> ุฑุง ูุงุฏุฏู ุจฺฏุฑู ู ููุท ฺฉ Thread ุจู ฺฉ ูููููโ ูุงุญุฏ ุงุฒ <code>IdGenerator</code> ุฏุณุชุฑุณ ุฏุงุฑุฏ.<br>
ุฏุฑ ุงู ุญุงูุช ููุท ฺฉ ูุณุฑ ุงุฌุฑุง ููฺฉู ู ฺฉ ูุชุฌูโ ุชุถููโุดุฏู ูุฌูุฏ ุฏุงุฑุฏ โ</p>
<ul>
<li>ููุฏุงุฑ ุจุฑฺฏุดุช ุจุฑุงุจุฑ ุจุง ููุฏุงุฑ <code>lastIdUsed</code> ุฎูุงูุฏ ุจูุฏ ู ูุฑ ุฏู ููุฏุงุฑ <strong>ฑ ูุงุญุฏ ุจุดุชุฑ ุงุฒ ููุฏุงุฑ ูุจู ุงุฒ ูุฑุงุฎูุงู ูุชุฏ</strong> ูุณุชูุฏ.</li>
</ul>
<hr>
<p>ุงูุง ุงฺฏุฑ ุฏู Thread ุจูโุทูุฑ ููโุฒูุงู ุงุฒ ุงู ูุชุฏ ุงุณุชูุงุฏู ฺฉููุฏ ู ุขู ุฑุง ุชุบุฑ ูุฏูู ฺู ุงุชูุงู ูโุงูุชุฏุ ๐ค<br>
ูุชุงุฌ ููฺฉู ุฏุฑ ุตูุฑุช ฺฉู ูุฑ Thread ููุท ฺฉ ุจุงุฑ <code>incrementValue</code> ุฑุง ุตุฏุง ุจุฒูุฏุ ฺู ุฎูุงููุฏ ุจูุฏุ<br>
(ูุฑุถ ฺฉูุฏ ููุฏุงุฑ ุงูููโ <code>lastIdUsed</code> ุจุฑุงุจุฑ ุจุง <strong>93</strong> ุจุงุดุฏ):</p>
<ul>
<li>๐งต Thread 1 ููุฏุงุฑ <strong>94</strong> ูโฺฏุฑุฏุ Thread 2 ููุฏุงุฑ <strong>95</strong> ูโฺฏุฑุฏุ ู ููุฏุงุฑ ููุง <code>lastIdUsed</code> ุจุฑุงุจุฑ ุจุง <strong>95</strong> ูโุดูุฏ.</li>
<li>๐งต Thread 1 ููุฏุงุฑ <strong>95</strong> ูโฺฏุฑุฏุ Thread 2 ููุฏุงุฑ <strong>94</strong> ูโฺฏุฑุฏุ ู ููุฏุงุฑ ููุง <code>lastIdUsed</code> ุจุฑุงุจุฑ ุจุง <strong>95</strong> ูโุดูุฏ.</li>
<li>๐งต ูุฑ ุฏู Thread ููุฏุงุฑ <strong>94</strong> ุฑุง ูโฺฏุฑูุฏุ ู ููุฏุงุฑ ููุง <code>lastIdUsed</code> ุจุฑุงุจุฑ ุจุง <strong>94</strong> ูโุดูุฏ โ๏ธ</li>
</ul>
<p>ูุชุฌูโ ููุง ููฺฉู ุงุณุช <strong>ุดฺฏูุชโุงูฺฏุฒ</strong> ุจุงุดุฏ ๐ณ ุงูุง ูุงูุนุงู ุงูฺฉุงูโูพุฐุฑ ุงุณุช.<br>
ุจุฑุง ุฏุฑฺฉ ุฏูู ูููุน ุงู ูุชุงุฌ ูุชูุงูุชุ ุจุงุฏ ุชุนุฏุงุฏ ูุณุฑูุง ููฺฉู ุงุฌุฑุง ฺฉุฏ ู ูุญููโ ุงุฌุฑุง ุขู ุชูุณุท <strong>JVM (Java Virtual Machine)</strong> ุฑุง ุฏุฑฺฉ ฺฉูู ๐ง๐<br>
ุนุงู! ุญุงูุง ุชุฑุฌูู ุฏูู ู ุฑูุงู ุจุฎุด ุฌุฏุฏ ุฏุฑุจุงุฑู <strong>ุชุนุฏุงุฏ ูุณุฑูุง ุงุฌุฑุง ููฺฉู</strong> ู ููุงูู Atomic ู Byte-code ุฑุง ุจุฑุงุช ุขูุงุฏู ฺฉุฑุฏู ๐๐</p>
<hr>
<h2>๐ค๏ธ ุชุนุฏุงุฏ ูุณุฑูุง ุงุฌุฑุง ููฺฉู (Number of Paths) ๐</h2>
<p>ุจุฑุง ูุญุงุณุจูโ ุชุนุฏุงุฏ ูุณุฑูุง ููฺฉู ุงุฌุฑุง ฺฉุฏุ ุงุจุชุฏุง ุจุงุฏ <strong>Byte-code ุชููุฏุดุฏู</strong> ุฑุง ุจุฑุฑุณ ฺฉูู ๐ป</p>
<p>ฺฉ ุฎุท ฺฉุฏ ุฌุงูุง:</p>
<pre class="hljs"><code><span class="hljs-keyword">return</span> ++lastIdUsed;
</code></pre>
<p>ุจู <strong>ูุดุช ุฏุณุชูุฑ Byte-code</strong> ุชุจุฏู ูโุดูุฏ.</p>
<p>ุฏู Thread ูโุชูุงููุฏ ุงุฌุฑุง ุงู ูุดุช ุฏุณุชูุฑ ุฑุง ุจูโฺฏูููโุง ุฏุฑ ูู ุขูุฎุชู (Interleave) ฺฉููุฏุ ูุซู ุงูโฺฉู ฺฉ ฺฉุงุฑุชโุฏููุฏู ฺฉุงุฑุชโูุง ุฑุง ููฺฏุงู ุดููู ฺฉุฑุฏู ฺฉุงุฑุชโูุง ุฏุฑ ูู ูโุฑุฒุฏ ๐</p>
<p>ุญุช ุจุง ููุท ูุดุช ุฏุณุชูุฑ ุจุฑุง ูุฑ Threadุ ุชุนุฏุงุฏ ุจุณุงุฑ ุฒุงุฏ ุชุฑุชุจ ูุฎุชูู (Shuffled Outcomes) ููฺฉู ุงุณุช ุฑุฎ ุฏูุฏ ๐ฒ</p>
<hr>
<h3>๐น ุญุงูุช ุณุงุฏู</h3>
<p>ุจุฑุง <strong>N ุฏุณุชูุฑ ูพุดุช ุณุฑ ูู</strong>ุ ุจุฏูู ุญููู ุง ุดุฑุทุ ู <strong>T Thread</strong>ุ ุชุนุฏุงุฏ ฺฉู ูุณุฑูุง ุงุฌุฑุง ููฺฉู ุจู ุตูุฑุช ุฒุฑ ุงุณุช:</p>
<p>[<br>
\text{ุชุนุฏุงุฏ ูุณุฑูุง ููฺฉู} = \frac{(N*T)!}{(N!)^T}<br>
]</p>
<hr>
<h3>๐น ูุญุงุณุจู ุชุฑุชุจโูุง ููฺฉู (Calculating the Possible Orderings)</h3>
<p>ุงู ุชูุถุญ ุงุฒ ุงูู Uncle Bob ุจู Brett ุขูุฏู ุงุณุช ๐ง:</p>
<ul>
<li>ุจุง <strong>N ูุฑุญูู ู T Thread</strong>ุ ูุฌููุน ูุฑุงุญู ุจุฑุงุจุฑ ุจุง (T \times N) ุงุณุช.</li>
<li>ูุจู ุงุฒ ูุฑ ูุฑุญูู ฺฉ <strong>Context Switch</strong> ุฑุฎ ูโุฏูุฏ ฺฉู ุจู Threadูุง ุงูุชุฎุงุจ ูโฺฉูุฏ.</li>
<li>ุจูุงุจุฑุงู ูุฑ ูุณุฑ ุฑุง ูโุชูุงู ุจู ุตูุฑุช ุฑุดุชูโุง ุงุฒ ุงุนุฏุงุฏ ูุดุงู ุฏุงุฏ ฺฉู <strong>ููุงุงูฺฏุฑ Context Switchูุง</strong> ุงุณุช.</li>
</ul>
<h4>ูุซุงู ุจุง ุฏู ูุฑุญูู (A ู B) ู ุฏู Thread (1 ู 2)</h4>
<p>ุดุด ูุณุฑ ููฺฉู:</p>
<pre class="hljs"><code>1122, 1212, 1221, 2112, 2121, 2211
</code></pre>
<p>ุง ุจู ุดฺฉู ูุฑุงุญู:</p>
<pre class="hljs"><code>A1B1A2B2, A1A2B1B2, A1A2B2B1, A2A1B1B2, A2A1B2B1, A2B2A1B1
</code></pre>
<p>ุจุฑุง <strong>ุณู Thread</strong>ุ ุชุฑุชุจโูุง ูุดุงุจู ุฒุฑ ูุณุชูุฏ:</p>
<pre class="hljs"><code>112233, 112323, 113223, ...
</code></pre>
<p>โ๏ธ ูฺฉุชู: ุฏุฑ ุงู ุฑุดุชูโูุงุ ููุดู ุจุงุฏ N ููููู ุงุฒ ูุฑ Thread ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ.<br>
ุจุฑุง ูุซุงูุ ุฑุดุชู <code>111111</code> <strong>ุบุฑูุนุชุจุฑ</strong> ุงุณุช ุฒุฑุง ูฺ ูููููโุง ุงุฒ Threadูุง 2 ู 3 ูุฏุงุฑุฏ.</p>
<blockquote>
<p>โ๏ธ ุงู ูุฏู ฺฉู ุณุงุฏูโุณุงุฒ ุดุฏู ุงุณุชุ ุงูุง ุจุฑุง ููู ููุถูุน ฺฉุงู ุงุณุช.</p>
</blockquote>
<hr>
<h3>๐น ุชุนุฏุงุฏ ูุณุฑูุง ุบุฑุชฺฉุฑุงุฑ</h3>
<p>ุจุฑุง ูุซุงู ุฏู ูุฑุญูู ู ุฏู Thread:</p>
<ul>
<li>ุฑุดุชูโูุง ฺูุงุฑ ุฑูู ุฏุงุฑู: ุฏู 1 ู ุฏู 2</li>
<li>ูโุชูุงู 1ูุง ุง 2ูุง ุฑุง ุจุฏูู ุชุบุฑ ูุนูุง ุจุง ูู ุฌุงุจุฌุง ฺฉุฑุฏ</li>
<li>ุจูุงุจุฑุงู <strong>ฺูุงุฑ ุงุฒูููุฑู (Isomorph)</strong> ุจุฑุง ูุฑ ุฑุดุชู ุฏุงุฑูุ ุนู ุณู ูุณุฑ ุชฺฉุฑุงุฑ ู ฺฉ ูุณุฑ ุบุฑุชฺฉุฑุงุฑ</li>
</ul>
<p>[<br>
4! \times 0.25 = 6<br>
]</p>
<p>ููู ููุทู ุฏุฑ ุญุงูุชโูุง ุฏฺฏุฑ ูู ุตุงุฏู ุงุณุช.</p>
<h4>ูุฑููู ฺฉู</h4>
<p>[<br>
\text{ุชุนุฏุงุฏ ูุณุฑูุง ููฺฉู} = \frac{(T*N)!}{(N!)^T}<br>
]</p>
<ul>
<li>ุจุฑุง (T = 2, N = 2) ุฏุงุฑู (6 = 24/4)</li>
<li>ุจุฑุง (T = 3, N = 2) ุฏุงุฑู (90 = 720/8)</li>
<li>ุจุฑุง (T = 3, N = 3) ุฏุงุฑู (1680 = 9!/6^3)</li>
</ul>
<p>ุจุฑุง ูุซุงู ูุง (ฺฉ ุฎุท ุฌุงูุง = ธ ุฎุท Byte-code ู ุฏู Thread)ุ <strong>ุชุนุฏุงุฏ ฺฉู ูุณุฑูุง ููฺฉู = 12,870</strong><br>
ุงฺฏุฑ ููุน <code>lastIdUsed</code> <strong>long</strong> ุจุงุดุฏุ ูุฑ Read/Write ุจู ุฏู ุนููุงุช ุชุจุฏู ูโุดูุฏ ู ุชุนุฏุงุฏ ูุณุฑูุง ุจู <strong>2,704,156</strong> ูโุฑุณุฏ.</p>
<hr>
<h3>๐น ุงูุฒูุฏู <code>synchronized</code></h3>
<p>ุงฺฏุฑ ูุชุฏ ุฑุง ุงูโุทูุฑ ุชุบุฑ ุฏูู:</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">incrementValue</span><span class="hljs-params">()</span> {
    ++lastIdUsed;
}
</code></pre>
<ul>
<li>ุชุนุฏุงุฏ ูุณุฑูุง ููฺฉู ุจุฑุง ุฏู Thread ุจู <strong>ฒ</strong> ฺฉุงูุด ูโุงุจุฏ</li>
<li>ุฏุฑ ุญุงูุช ฺฉู ุจุฑุงุจุฑ ุจุง (N!) ุฎูุงูุฏ ุจูุฏ โ</li>
</ul>
<hr>
<h2>๐ ุจุฑุฑุณ ุฏููโุชุฑ (Digging Deeper)</h2>
<p>ฺุฑุง ุฏู Thread ูโุชูุงูุณุชูุฏ ูุจู ุงุฒ ุงูุฒูุฏู <code>synchronized</code> ููุงู ููุฏุงุฑ ุฑุง ุฏุฑุงูุช ฺฉููุฏุ ๐ค<br>
ุงุจุชุฏุง ุจุงุฏ ุจุง ููููู <strong>ุนููุงุช ุงุชูฺฉ (Atomic Operation)</strong> ุขุดูุง ุดูู.</p>
<h3>๐น ุนููุงุช ุงุชูฺฉ (Atomic Operation)</h3>
<p>ฺฉ ุนููุงุช ุงุชูฺฉุ ุนููุงุช ุงุณุช ฺฉู <strong>ูุงุจู ูุทุน ุดุฏู ูุณุช</strong> ๐ซโ๏ธ</p>
<p>ูุซุงู:</p>
<pre class="hljs"><code><span class="hljs-number">01</span>: <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
<span class="hljs-number">02</span>:    <span class="hljs-type">int</span> lastId;
<span class="hljs-number">03</span>:
<span class="hljs-number">04</span>:    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resetId</span><span class="hljs-params">()</span> {
<span class="hljs-number">05</span>:        value = <span class="hljs-number">0</span>;  <span class="hljs-comment">// ุงู ุฎุท ุงุชูฺฉ ุงุณุช</span>
<span class="hljs-number">06</span>:    }
<span class="hljs-number">07</span>:
08:    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getNextId</span><span class="hljs-params">()</span> {
09:        ++value;    <span class="hljs-comment">// ุงู ุฎุท ุงุชูฺฉ ูุณุช</span>
<span class="hljs-number">10</span>:    }
<span class="hljs-number">11</span>:}
</code></pre>
<ul>
<li>ุฏุฑ ุฎุท ตุ ููุฏุงุฑ ฐ ุจู <code>lastId</code> ุงุฎุชุตุงุต ุฏุงุฏู ูโุดูุฏ</li>
<li>ุทุจู <strong>Java Memory Model</strong>ุ ุงุฎุชุตุงุต ููุฏุงุฑ ุจู ฺฉ ูุชุบุฑ ณฒ ุจุช <strong>ุงุชูฺฉ ุงุณุช</strong> โ</li>
</ul>
<p>โ ุงฺฏุฑ ููุน <code>lastId</code> ุฑุง ุจู <code>long</code> ุชุบุฑ ุฏููุ ุฎุท ต ุฏฺฏุฑ ุงุชูฺฉ ูุฎูุงูุฏ ุจูุฏ.</p>
<ul>
<li>ุทุจู JVMุ ุงุฎุชุตุงุต ุจู ฺฉ ููุฏุงุฑ ถด ุจุช ูุงุฒ ุจู <strong>ุฏู ุนููุงุช ณฒ ุจุช</strong> ุฏุงุฑุฏ</li>
<li>ุฏุฑ ุงู ูุงุตููุ ููฺฉู ุงุณุช Thread ุฏฺฏุฑ ูุงุฑุฏ ุดุฏู ู ฺฉ ุงุฒ ููุงุฏุฑ ุฑุง ุชุบุฑ ุฏูุฏ โ๏ธ</li>
</ul>
<hr>
<h3>๐น ุนููฺฏุฑ ูพุดโุงูุฒุงุด <code>++</code> (Pre-increment)</h3>
<ul>
<li>ุงู ุนููฺฏุฑ <strong>ูุงุจู ูุทุน ุดุฏู ุงุณุช</strong></li>
<li>ุจูุงุจุฑุงู ุงุชูฺฉ ูุณุช</li>
<li>ุจุฑุง ุฏุฑฺฉ ุฏููุ ุจุงุฏ <strong>Byte-code</strong> ุชููุฏุดุฏู ุฑุง ุจุฑุฑุณ ฺฉูู ๐</li>
</ul>
<hr>
<h3>๐น ุชุนุงุฑู ููู ูุจู ุงุฒ ุงุฏุงูู</h3>
<ol>
<li>
<p><strong>Frame</strong> โ ูุฑ ูุฑุงุฎูุงู ูุชุฏ ฺฉ Frame ูุงุฒ ุฏุงุฑุฏ.</p>
<ul>
<li>ุดุงูู ุขุฏุฑุณ ุจุฑฺฏุดุช (Return Address)ุ ูพุงุฑุงูุชุฑูุง ู ูุชุบุฑูุง ูุญู ุงุณุช.</li>
<li>ุงู ุชฺฉูฺฉ ุจุฑุง ุชุนุฑู <strong>Call Stack</strong> ุงุณุชูุงุฏู ูโุดูุฏ ู ุฏุฑ ุฒุจุงูโูุง ูุฏุฑู ุจุฑุง ูุฑุงุฎูุงู ุชุงุจุน ู ุจุงุฒฺฏุดุช ุถุฑูุฑ ุงุณุช.</li>
</ul>
</li>
<li>
<p><strong>Local Variable</strong> โ ูุฑ ูุชุบุฑ ฺฉู ุฏุฑ ุฏุงููู ูุชุฏ ุชุนุฑู ุดุฏู ุงุณุช.</p>
<ul>
<li>ุชูุงู ูุชุฏูุง ุบุฑ ุงุณุชุงุชฺฉ ุญุฏุงูู ฺฉ ูุชุบุฑ <code>this</code> ุฏุงุฑูุฏ ฺฉู ุจู <strong>ุดุก ุฌุงุฑ</strong> ุงุดุงุฑู ูโฺฉูุฏุ ุดุฆ ฺฉู ูพุงู ุงุฎุฑ ุฑุง ุฏุฑุงูุช ฺฉุฑุฏู ู ุจุงุนุซ ูุฑุงุฎูุงู ูุชุฏ ุดุฏู ุงุณุช.</li>
</ul>
</li>
<li>
<p><strong>Operand Stack</strong> โ ุจุดุชุฑ ุฏุณุชูุฑูุง ุฏุฑ JVM ูพุงุฑุงูุชุฑ ูโฺฏุฑูุฏ.</p>
<ul>
<li>Operand Stack ุฌุง ุงุณุช ฺฉู ุงู ูพุงุฑุงูุชุฑูุง ูุฑุงุฑ ูโฺฏุฑูุฏ.</li>
<li>ุณุงุฎุชุงุฑ LIFO (Last-In, First-Out) ุฏุงุฑุฏ.</li>
</ul>
</li>
</ol>
<h2>๐งฉ Byte-code ูุชุฏ resetId() ู ุฑูุชุงุฑ ุงุชูฺฉ ุขู ๐น</h2>
<h3>Byte-code ุชููุฏุดุฏู ุจุฑุง <code>resetId()</code></h3>
<table>
<thead>
<tr>
<th>Mnemonic</th>
<th>Description</th>
<th>Operand Stack After</th>
</tr>
</thead>
<tbody>
<tr>
<td>ALOAD 0</td>
<td>ุจุงุฑฺฏุฐุงุฑ ูุชุบุฑ ฐ ุฑู Operand Stack. ูุชุบุฑ ฐ ููุงู <code>this</code> ุงุณุชุ ุดุก ุฌุงุฑ ฺฉู ูพุงู ุฑุง ุฏุฑุงูุช ฺฉุฑุฏู.</td>
<td>this</td>
</tr>
<tr>
<td>ICONST_0</td>
<td>ูุฑุงุฑ ุฏุงุฏู ููุฏุงุฑ ุซุงุจุช ฐ ุฑู Operand Stack</td>
<td>this, 0</td>
</tr>
<tr>
<td>PUTFIELD lastId</td>
<td>ุฐุฎุฑู ููุฏุงุฑ ุจุงูุง Stack (ฐ) ุฏุฑ ููุฏ lastId ุดุก ุฌุงุฑ (<code>this</code>)</td>
<td><empty></td>
</tr>
</tbody>
</table>
<p>โก ุงู ุณู ุฏุณุชูุฑ <strong>ุงุชูฺฉ ูุณุชูุฏ</strong>ุ ุนู ุญุช ุงฺฏุฑ Thread ููฺฏุงู ุงุฌุฑุง ูุฑ ฺฉุฏุงู ูุชููู ุดูุฏุ ุฏุงุฏูโูุง ููุฑุฏ ูุงุฒ PUTFIELD ุชูุณุท Thread ุฏฺฏุฑ ูุงุจู ุฏุณุชุฑุณ ูุณุชูุฏ.</p>
<ul>
<li>ูุชุฌู: ููุฏุงุฑ ฐ ุจู ุทูุฑ ูุทูุฆู ุฏุฑ ููุฏ ุฐุฎุฑู ูโุดูุฏ โ</li>
<li>ููู ุฏุงุฏูโูุง ูุญู ูุณุชูุฏุ ุจูุงุจุฑุงู <strong>ุชุฏุงุฎู ุจู Threadูุง ูุฌูุฏ ูุฏุงุฑุฏ</strong>.</li>
</ul>
<p>๐ก ุงฺฏุฑ ุงู ุณู ุฏุณุชูุฑ ุชูุณุท ุฏู Thread ููุฒูุงู ุงุฌุฑุง ุดูุฏุ ุชุนุฏุงุฏ ุชุฑุชุจโูุง ููฺฉู <strong>4.38679733629e+24</strong> ุฎูุงูุฏ ุจูุฏุ ุงูุง <strong>ุชููุง ฺฉ ูุชุฌู ููุง</strong> ูุฌูุฏ ุฏุงุฑุฏ.</p>
<ul>
<li>ุญุช ุงฺฏุฑ ููุน <code>lastId</code> ุงุฒ int ุจู long ุชุบุฑ ฺฉูุฏุ ูุชุฌู ููุงู ุฎูุงูุฏ ุจูุฏ ุฒุฑุง ููู Threadูุง ููุฏุงุฑ ุซุงุจุช ุฑุง ุงุฎุชุตุงุต ูโุฏููุฏ.</li>
</ul>
<hr>
<h2>โ๏ธ ูุดฺฉู <code>++</code> ุฏุฑ getNextId()</h2>
<p>Byte-code ูุชุฏ <code>getNextId()</code> (ูุฑุถ ููุฏุงุฑ ุงููู <code>lastId = 42</code>):</p>
<table>
<thead>
<tr>
<th>Mnemonic</th>
<th>Description</th>
<th>Operand Stack After</th>
</tr>
</thead>
<tbody>
<tr>
<td>ALOAD 0</td>
<td>ุจุงุฑฺฏุฐุงุฑ <code>this</code> ุฑู Operand Stack</td>
<td>this</td>
</tr>
<tr>
<td>DUP</td>
<td>ฺฉูพ ุจุงูุง Stack</td>
<td>this, this</td>
</tr>
<tr>
<td>GETFIELD lastId</td>
<td>ฺฏุฑูุชู ููุฏุงุฑ lastId ู ูุฑุงุฑ ุฏุงุฏู ุฑู Stack</td>
<td>this, 42</td>
</tr>
<tr>
<td>ICONST_1</td>
<td>ูุฑุงุฑุฏุงุฏู ฑ ุฑู Stack</td>
<td>this, 42, 1</td>
</tr>
<tr>
<td>IADD</td>
<td>ุฌูุน ุฏู ููุฏุงุฑ ุจุงูุง Stack</td>
<td>this, 43</td>
</tr>
<tr>
<td>DUP_X1</td>
<td>ฺฉูพ ู ูุฑุงุฑ ุฏุงุฏู ูุจู ุงุฒ this</td>
<td>43, this, 43</td>
</tr>
<tr>
<td>PUTFIELD value</td>
<td>ุฐุฎุฑู ููุฏุงุฑ 43 ุฏุฑ ููุฏ value ุดุก ุฌุงุฑ</td>
<td>43</td>
</tr>
<tr>
<td>IRETURN</td>
<td>ุจุงุฒฺฏุฑุฏุงูุฏู ููุฏุงุฑ ุจุงูุง Stack</td>
<td><empty></td>
</tr>
</tbody>
</table>
<p>โ๏ธ ูุซุงู ุชุฏุงุฎู Threadูุง:</p>
<ul>
<li>Thread ุงูู ุจุนุฏ ุงุฒ GETFIELD ูุชููู ูโุดูุฏ (<code>lastId = 42</code>)</li>
<li>Thread ุฏูู ฺฉู ูุชุฏ ุฑุง ุงุฌุฑุง ฺฉุฑุฏู ู ููุฏุงุฑ ุฑุง ุจู 43 ูโุฑุณุงูุฏ</li>
<li>Thread ุงูู ุงุฏุงูู ูโุฏูุฏ ู ููุฏุงุฑ 42 ุฑู Stack ุฑุง +1 ูโฺฉูุฏ โ ุฏูุจุงุฑู 43 ูโุดูุฏ</li>
<li>ูุชุฌู: <strong>ฺฉ ุงูุฒุงุด ุงุฒ ุฏุณุช ูโุฑูุฏ</strong> โ</li>
</ul>
<p>๐ก ุจุง ุงูุฒูุฏู <code>synchronized</code> ุจู ูุชุฏ <code>getNextId()</code>, ุงู ูุดฺฉู ุฑูุน ูโุดูุฏ.</p>
<hr>
<h2>๐น ูุชุฌูโฺฏุฑ ุฏุฑุจุงุฑู Byte-code ู Atomic</h2>
<ul>
<li>ูุงุฒ ุจู ุฏุฑฺฉ ฺฉุงูู Byte-code ูุณุช</li>
<li>ฺฉุงู ุงุณุช ุจุฏุงูู <strong>Threadูุง ูโุชูุงููุฏ ุฑู ูู ุชุงุซุฑ ุจฺฏุฐุงุฑูุฏ</strong></li>
<li>ูฺฉุชู ููู: ++ <strong>ุงุชูฺฉ ูุณุช</strong></li>
</ul>
<p>ุจุฑุง ุจุฑูุงููโููุณ ููุฒูุงู ุจุงุฏ ุจุฏุงูู:</p>
<ol>
<li>ฺฉุฌุงูุง ุงุดุงุก ุง ููุงุฏุฑ ูุดุชุฑฺฉ ูุณุชูุฏ</li>
<li>ฺฉุฏูุง ฺฉู ููฺฉู ุงุณุช ุจุงุนุซ <strong>ุฎูุงูุฏู/ููุดุชู ููุฒูุงู</strong> ุดููุฏ</li>
<li>ฺฺฏููู ุงุฒ ุจุฑูุฒ ูุดฺฉูุงุช ููุฒูุงู ุฌููฺฏุฑ ฺฉูู โก</li>
</ol>
<hr>
<h2>๐๏ธ ุขุดูุง ุจุง ฺฉุชุงุจุฎุงููโูุง (Knowing Your Library)</h2>
<h3>Executor Framework</h3>
<ul>
<li>ุงุฒ Java 5 ุจู ุจุนุฏุ <strong>Executor Framework</strong> ุจุฑุง ูุฏุฑุช ูพุดุฑูุชู Threadูุง ุงุฑุงุฆู ุดุฏ</li>
<li>ุจุณุชู <code>java.util.concurrent</code> ุดุงูู ุงู ฺฉูุงุณโูุงุณุช</li>
<li>ุงุณุชูุงุฏู ุงุฒ <strong>Thread Pool</strong> ุฏุฑ ุงู Framework ุจุงุนุซ <strong>ฺฉุฏ ุชูุฒุชุฑุ ฺฉูฺฺฉโุชุฑ ู ูุงุจู ูุฏุฑุชโุชุฑ</strong> ูโุดูุฏ</li>
</ul>
<p>โ ูฺฺฏโูุง:</p>
<ul>
<li>ูุฏุฑุช Threadูุง</li>
<li>ุชุบุฑ ุงูุฏุงุฒู ุฎูุฏฺฉุงุฑ</li>
<li>ุจุงุฒุณุงุฒ Thread ุฏุฑ ุตูุฑุช ูุงุฒ</li>
<li>ูพุดุชุจุงู ุงุฒ <strong>Futures</strong> ุจุฑุง ูพุฑุฏุงุฒุด ููุฒูุงู</li>
</ul>
<hr>
<h3>ูุซุงู ุงุณุชูุงุฏู ุงุฒ Future</h3>
<pre class="hljs"><code><span class="hljs-keyword">public</span> String <span class="hljs-title function_">processRequest</span><span class="hljs-params">(String message)</span> <span class="hljs-keyword">throws</span> Exception {
    Callable&lt;String&gt; makeExternalCall = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callable</span>&lt;String&gt;() {
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
            <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;
            <span class="hljs-comment">// ุงุฑุณุงู ุฏุฑุฎูุงุณุช ุฎุงุฑุฌ</span>
            <span class="hljs-keyword">return</span> result;
        }
    };
    Future&lt;String&gt; result = executorService.submit(makeExternalCall);
    <span class="hljs-type">String</span> <span class="hljs-variable">partialResult</span> <span class="hljs-operator">=</span> doSomeLocalProcessing();
    <span class="hljs-keyword">return</span> result.get() + partialResult;
}
</code></pre>
<ul>
<li><code>makeExternalCall</code> ุงุฌุฑุง ูโุดูุฏ</li>
<li>ูพุฑุฏุงุฒุด ูุญู ุงุฏุงูู ูโุงุจุฏ</li>
<li><code>result.get()</code> <strong>ููุชุธุฑ ุชฺฉูู Future</strong> ูโูุงูุฏ โณ</li>
</ul>
<hr>
<h2>โก ุฑุงูฺฉุงุฑูุง Nonblocking</h2>
<h3>ูุซุงู ูุฏู ุจุง <code>synchronized</code></h3>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectWithValue</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> value;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">incrementValue</span><span class="hljs-params">()</span> { ++value; }
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> value; }
}
</code></pre>
<h3>ูุณุฎู ุฌุฏุฏ Nonblocking ุจุง AtomicInteger</h3>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectWithValue</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">incrementValue</span><span class="hljs-params">()</span> {
        value.incrementAndGet();
    }
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> value.get();
    }
}
</code></pre>
<ul>
<li>ุจุง ุงุณุชูุงุฏู ุงุฒ <strong>Compare-And-Swap (CAS)</strong></li>
<li>ุนููฺฉุฑุฏ ูุนูููุงู <strong>ุจูุชุฑ ุงุฒ ูุณุฎู ูุฏู</strong> ุงุณุช</li>
<li>ูุฑุถ ูโฺฉูุฏ <strong>ฺูุฏ Thread ุจู ูุฏุฑุช ููุฏุงุฑ ูุดุชุฑฺฉ ุฑุง ุชุบุฑ ูโุฏููุฏ</strong></li>
<li>ุงฺฏุฑ ููุฏุงุฑ ุชุบุฑ ูฺฉุฑุฏู ุจุงุดุฏุ ุชุบุฑ ุงูุฌุงู ูโุดูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ุฏูุจุงุฑู ุชูุงุด ูโฺฉูุฏ ๐</li>
</ul>
<h3>ุดุจูโุณุงุฒ CAS</h3>
<pre class="hljs"><code><span class="hljs-type">int</span> variableBeingSet;
<span class="hljs-keyword">void</span> <span class="hljs-title function_">simulateNonBlockingSet</span><span class="hljs-params">(<span class="hljs-type">int</span> newValue)</span> {
    <span class="hljs-type">int</span> currentValue;
    <span class="hljs-keyword">do</span> {
        currentValue = variableBeingSet;
    } <span class="hljs-keyword">while</span>(currentValue != compareAndSwap(currentValue, newValue));
}
<span class="hljs-type">int</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-title function_">compareAndSwap</span><span class="hljs-params">(<span class="hljs-type">int</span> currentValue, <span class="hljs-type">int</span> newValue)</span> {
    <span class="hljs-keyword">if</span>(variableBeingSet == currentValue) {
        variableBeingSet = newValue;
        <span class="hljs-keyword">return</span> currentValue;
    }
    <span class="hljs-keyword">return</span> variableBeingSet;    
}
</code></pre>
<ul>
<li>CAS <strong>ุงุชูฺฉ ุงุณุช</strong></li>
<li>ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ููุฏุงุฑ ูููุฒ ููุงู ููุฏุงุฑ ูุจู ุงุณุช</li>
<li>ุงฺฏุฑ ุจูู โ ุชุบุฑ ุงูุฌุงู ูโุดูุฏ</li>
<li>ุงฺฏุฑ ูู โ ุฏูุจุงุฑู ุชูุงุด ูโฺฉูุฏ ุชุง ูููู ุดูุฏ</li>
</ul>
<h2>โ๏ธ ฺฉูุงุณโูุง ุบุฑููุฒูุงู (Nonthread-Safe Classes) ๐น</h2>
<p>ุจุฑุฎ ฺฉูุงุณโูุง ุฐุงุชุงู <strong>thread-safe ูุณุชูุฏ</strong>. ูุซุงูโูุง:</p>
<ul>
<li><code>SimpleDateFormat</code></li>
<li>ุงุฑุชุจุงุท ุจุง ุฏุชุงุจุณ (Database Connections)</li>
<li>Containers ุฏุฑ <code>java.util</code></li>
<li><code>Servlets</code></li>
</ul>
<p>๐ ุจุฑุฎ Collectionูุง ูุชุฏูุง thread-safe ุฏุงุฑูุฏุ ุงูุง ูุฑ ุนููุงุช ฺฉู <strong>ฺูุฏ ูุชุฏ ุฑุง ูพุดุช ุณุฑ ูู ูุฑุงุฎูุงู ฺฉูุฏ</strong> ุงูู ูุณุช.<br>
ูุซุงู:</p>
<pre class="hljs"><code><span class="hljs-keyword">if</span>(!hashTable.containsKey(someKey)) {
    hashTable.put(someKey, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeValue</span>());
}
</code></pre>
<ul>
<li>ูุฑ ูุชุฏ ุจู ุชููุง thread-safe ุงุณุช โ</li>
<li>ุงูุง Thread ุฏฺฏุฑ ููฺฉู ุงุณุช <strong>ุจู containsKey ู put</strong> ููุฏุงุฑ ุงุถุงูู ฺฉูุฏ โ๏ธ</li>
</ul>
<hr>
<h2>๐ ุฑูุดโูุง ุญู ูุดฺฉู ููุฒูุงู ุฏุฑ Collectionูุง</h2>
<h3>ฑ. ููู ฺฉุฑุฏู ุงุฒ ุณูุช ฺฉูุงูุช (Client-based Locking)</h3>
<pre class="hljs"><code><span class="hljs-keyword">synchronized</span>(map) {
    <span class="hljs-keyword">if</span>(!map.containsKey(key))
        map.put(key,value);
}
</code></pre>
<ul>
<li>ููู ฺฉุงุฑุจุฑุงู ุจุงุฏ ููู ุงูฺฏู ุฑุง ุฑุนุงุช ฺฉููุฏ</li>
<li>ูุฑ Thread ูุจู ุงุฒ ุงุณุชูุงุฏู ุงุฒ Map ุจุงุฏ ุขู ุฑุง ููู ฺฉูุฏ ู ุจุนุฏ ุขุฒุงุฏ ฺฉูุฏ</li>
</ul>
<h3>ฒ. ุงุณุชูุงุฏู ุงุฒ Wrapper ู Adapter (Server-based Locking)</h3>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WrappedHashtable</span>&lt;K, V&gt; {
    <span class="hljs-keyword">private</span> Map&lt;K, V&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>&lt;K, V&gt;();
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putIfAbsent</span><span class="hljs-params">(K key, V value)</span> {
        <span class="hljs-keyword">if</span> (!map.containsKey(key))
            map.put(key, value);
    }
}
</code></pre>
<h3>ณ. ุงุณุชูุงุฏู ุงุฒ Collectionูุง thread-safe</h3>
<pre class="hljs"><code>ConcurrentHashMap&lt;Integer, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
map.putIfAbsent(key, value);
</code></pre>
<ul>
<li>ฺฉูุงุณโูุง <code>java.util.concurrent</code> ูุชุฏูุง ูุงููุฏ <code>putIfAbsent()</code> ุงุฑุงุฆู ูโุฏููุฏ ๐น</li>
</ul>
<hr>
<h2>๐ ูุงุจุณุชฺฏ ุจู ูุชุฏูุง ู ูุดฺฉูุงุช ููุฒูุงู</h2>
<p>ูุซุงู ุณุงุฏู: ฺฉ <code>IntegerIterator</code> ฺฉู ูุชุฏูุง <code>hasNext()</code>, <code>next()</code>, <code>getNextValue()</code> ุฏุงุฑุฏ.</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IntegerIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span>&lt;Integer&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">nextValue</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> nextValue &lt; <span class="hljs-number">100000</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> Integer <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (nextValue == <span class="hljs-number">100000</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IteratorPastEndException</span>();
        <span class="hljs-keyword">return</span> nextValue++;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> Integer <span class="hljs-title function_">getNextValue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> nextValue;
    }
}
</code></pre>
<ul>
<li>
<p>ุงฺฏุฑ <strong>ฺฉ Thread</strong> ุงู Iterator ุฑุง ุงุฌุฑุง ฺฉูุฏุ ูุดฺฉู ูุณุช</p>
</li>
<li>
<p>ุงูุง ุงฺฏุฑ <strong>ุฏู Thread ูุดุชุฑฺฉ ุฏุงุดุชู ุจุงุดูุฏ</strong>ุ ุงุญุชูุงู ุฑุฎ ุฏุงุฏู <strong>ุงุณุชุซูุง ุฏุฑ ุขุฎุฑู ุนูุตุฑ</strong> ูุฌูุฏ ุฏุงุฑุฏ</p>
</li>
<li>
<p>ูุดฺฉู: Thread1 ูุฑุงุฎูุงู <code>hasNext()</code> ฺฉุฑุฏู ู ูุจู ุงุฒ <code>next()</code> ูุชููู ูโุดูุฏ</p>
<ul>
<li>Thread2 ููุงู ูุชุฏูุง ุฑุง ุงุฌุฑุง ูโฺฉูุฏ ู ูุถุนุช ุชุบุฑ ูโฺฉูุฏ</li>
<li>Thread1 ุฏูุจุงุฑู ุงุฏุงูู ูโุฏูุฏ ู <strong>ููฺฉู ุงุณุช ุงุฒ ุงูุชูุง Iterator ุนุจูุฑ ฺฉูุฏ</strong> โ๏ธ</li>
</ul>
</li>
</ul>
<hr>
<h2>๐ ุณู ุฑุงูโุญู ุจุฑุง ุงู ูุดฺฉู</h2>
<h3>ฑ. ุชุญูู ุฎุทุง (Tolerate the Failure)</h3>
<ul>
<li>ููฺฉู ุงุณุช ุฎุทุง <strong>ุขุณุจ ูุฑุณุงูุฏ</strong></li>
<li>ูุซู ูุซุงูุ ฺฉูุงูุช ูโุชูุงูุฏ Exception ุฑุง ฺฏุฑูุชู ู ูพุงฺฉุณุงุฒ ฺฉูุฏ</li>
<li>โ๏ธ ุงู ุฑูุด <strong>ฺฉู ุดูุฎุชู ุงุณุช</strong>ุ ุดุจู ูพุงฺฉ ฺฉุฑุฏู Memory Leak ุจุง ุฑุณุชุงุฑุช ุดุจุงูู</li>
</ul>
<hr>
<h3>ฒ. ููู ฺฏุฐุงุฑ ุงุฒ ุณูุช ฺฉูุงูุช (Client-Based Locking)</h3>
<pre class="hljs"><code><span class="hljs-type">IntegerIterator</span> <span class="hljs-variable">iterator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntegerIterator</span>();
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-type">int</span> nextValue;
    <span class="hljs-keyword">synchronized</span> (iterator) {
        <span class="hljs-keyword">if</span> (!iterator.hasNext())
            <span class="hljs-keyword">break</span>;
        nextValue = iterator.next();
    }
    doSomethingWith(nextValue);
}
</code></pre>
<ul>
<li>ูุฑ ฺฉูุงูุช ุจุง <code>synchronized</code> ููู ุงุฌุงุฏ ูโฺฉูุฏ</li>
<li>ุงู ฺฉุงุฑ <strong>ุชฺฉุฑุงุฑ ฺฉุฏ</strong> ุงุณุช ู <strong>ุงุตู DRY ุฑุง ููุถ ูโฺฉูุฏ</strong></li>
<li>ุงูุง ุจุฑุง ุงุจุฒุงุฑูุง ุบุฑ thread-safe ุดุฎุต ุซุงูุซ ุถุฑูุฑ ุงุณุช โ๏ธ</li>
</ul>
<p>๐ก ุฎุทุฑ: ููู ุจุฑูุงููโููุณุงู ุจุงุฏ ุจู <strong>ูููโฺฏุฐุงุฑ ุตุญุญ</strong> ุฏูุช ฺฉููุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ูุดฺฉูุงุช ูพููุงู ู ุฏุดูุงุฑ ุจุฑุง ุฑุฏุงุจ ุงุฌุงุฏ ูโุดูุฏ.</p>
<hr>
<h3>ณ. ูููโฺฏุฐุงุฑ ุงุฒ ุณูุช ุณุฑูุฑ (Server-Based Locking)</h3>
<ul>
<li>ุณุฑูุฑ ูุณุฆูู ูุฏุฑุช ุฏุณุชุฑุณ ููุฒูุงู ุงุณุช</li>
<li>ฺฉูุงูุชโูุง ุจุฏูู ุชุบุฑ ฺฉุฏ ุงุตู ูโุชูุงููุฏ ุงุฒ ููุงุจุน ุจู ุตูุฑุช ุงูู ุงุณุชูุงุฏู ฺฉููุฏ</li>
<li><strong>ุฑุงูฺฉุงุฑ ุจูุชุฑ ู ูุทูุฆูโุชุฑ ูุณุจุช ุจู ูููโฺฏุฐุงุฑ ุงุฒ ุณูุช ฺฉูุงูุช</strong></li>
</ul>
<hr>
<h3>๐ ุฏุงุณุชุงู ูุงูุน ุงุฒ ูููโฺฏุฐุงุฑ ุณูุช ฺฉูุงูุช</h3>
<ul>
<li>ุณุณุชู <strong>Multi-terminal Time-Sharing</strong> ุจุฑุง ุญุณุงุจุฏุงุฑ ฺฉ ุงุชุญุงุฏู</li>
<li>ุงุณุชูุงุฏู ุงุฒ <strong>Client-based Locking</strong> ุจุฑุง ููุงุจุน ูุดุชุฑฺฉ</li>
<li>ฺฉ ุจุฑูุงููโููุณ ูุฑุงููุด ูโฺฉูุฏ ูููโฺฏุฐุงุฑ ฺฉูุฏ</li>
<li>ูุชุฌู: ฺฉ ุงุฒ ุชุฑููุงูโูุง ฺฏุงู โlock upโ ูโฺฉูุฏ</li>
<li>ูุดฺฉู: <strong>Ring-buffer counter</strong> ุงุฒ ููุงููฺฏ ุจุง pointer ุฎุงุฑุฌ ุดุฏู ุจูุฏ</li>
<li>ุฑุงูโุญู: ฺฉ <strong>hack</strong> ุจุฑุง ุฑุณุช ุฎูุฏฺฉุงุฑ buffer</li>
<li>ุชุฌุฑุจู: <strong>Client-based Locking ูโุชูุงูุฏ ุจุณุงุฑ ุฎุทุฑูุงฺฉ ุจุงุดุฏ</strong> โ</li>
<li>ุฏุฑุณ ููู: ููุดู ุชุง ุญุฏ ุงูฺฉุงู <strong>ูุฏุฑุช ููุฒูุงู ุฑุง ุจู ุณุฑูุฑ ุจุณูพุงุฑุฏ</strong></li>
</ul>
<h2>ูููโฺฏุฐุงุฑ ุณูุช ุณุฑูุฑ (Server-Based Locking) ๐</h2>
<p>ุชฺฉุฑุงุฑ ฺฉุฏ ุฑุง ูโุชูุงู ุจุง ุงุนูุงู ุชุบุฑุงุช ุฒุฑ ุฑู <code>IntegerIterator</code> ุญุฐู ฺฉุฑุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IntegerIteratorServerLocked</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">nextValue</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> Integer <span class="hljs-title function_">getNextOrNull</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (nextValue &lt; <span class="hljs-number">100000</span>)
            <span class="hljs-keyword">return</span> nextValue++;
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p>ู ฺฉุฏ ฺฉูุงูุช ูู ุชุบุฑ ูโฺฉูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-type">Integer</span> <span class="hljs-variable">nextValue</span> <span class="hljs-operator">=</span> iterator.getNextOrNull();
    <span class="hljs-keyword">if</span> (nextValue == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">break</span>;
    <span class="hljs-comment">// do something with nextValue</span>
}
</code></pre>
<p>ุฏุฑ ุงู ุญุงูุชุ ูุง <strong>API ฺฉูุงุณ ุฎูุฏ ุฑุง ุจุฑุง ุขฺฏุงู ุงุฒ ฺูุฏ Thread ุจูุฏู ุชุบุฑ ุฏุงุฏูโุงู</strong>. ฺฉูุงูุช ุจุงุฏ ุจุฑุฑุณ ฺฉูุฏ ฺฉู ููุฏุงุฑ null ูุณุชุ ุจู ุฌุง ฺฺฉ ฺฉุฑุฏู <code>hasNext()</code>.</p>
<p>ุจู ุทูุฑ ฺฉูุ ุจุงุฏ <strong>ูููโฺฏุฐุงุฑ ุณูุช ุณุฑูุฑ</strong> ุฑุง ุชุฑุฌุญ ุฏูุฏ ุจู ุฏูุงู ุฒุฑ:</p>
<ul>
<li>ฺฉุงูุด ฺฉุฏ ุชฺฉุฑุงุฑโูููโฺฏุฐุงุฑ ุณูุช ฺฉูุงูุช ูุฑ ฺฉูุงูุช ุฑุง ูุฌุจูุฑ ูโฺฉูุฏ ุชุง ุณุฑูุฑ ุฑุง ุฏุฑุณุช ููู ฺฉูุฏ. ุจุง ูุฑุงุฑ ุฏุงุฏู ฺฉุฏ ููู ุฏุฑ ุณุฑูุฑุ ฺฉูุงูุชโูุง ุขุฒุงุฏ ูุณุชูุฏ ุชุง ุงุฒ ุดุก ุงุณุชูุงุฏู ฺฉููุฏ ุจุฏูู ูฺฏุฑุงู ุงุฒ ููุดุชู ฺฉุฏ ููู ุงุถุงู.</li>
<li>ุงูุฒุงุด ฺฉุงุฑุงโูโุชูุงู ฺฉ ุณุฑูุฑ thread-safe ุฑุง ุจุง ฺฉ ุณุฑูุฑ ุบุฑ thread-safe ุฏุฑ ุญุงูุช single-threaded ุฌุงฺฏุฒู ฺฉุฑุฏ ู ุชูุงู overhead ุงุถุงู ุฑุง ุญุฐู ฺฉุฑุฏ.</li>
<li>ฺฉุงูุด ุงุญุชูุงู ุฎุทุงโููุท ฺฉุงู ุงุณุช ฺฉ ุจุฑูุงููโููุณ ููู ุฑุง ูุฑุงููุด ฺฉูุฏ.</li>
<li>ุงุนูุงู ฺฉ ุณุงุณุช ูุงุญุฏโุณุงุณุช ุฏุฑ ฺฉ ูฺฉุงู ุงุณุชุ ุณุฑูุฑุ ุจู ุฌุง ุงูฺฉู ุฏุฑ ฺูุฏ ูฺฉุงู ูุฎุชููุ ูุฑ ฺฉูุงูุชุ ุจุงุดุฏ.</li>
<li>ฺฉุงูุด ุฏุงููู ูุชุบุฑูุง ูุดุชุฑฺฉโฺฉูุงูุช ุงุฒ ุขููุง ู ูุญูู ููู ุดุฏู ุขููุง ุขฺฏุงู ูุณุช. ููู ฺุฒ ุฏุฑ ุณุฑูุฑ ูพููุงู ุงุณุช. ููุช ูุดฺฉู ูพุด ูโุขุฏุ ุชุนุฏุงุฏ ูฺฉุงูโูุง ุจุฑุฑุณ ฺฉูุชุฑ ุงุณุช.</li>
</ul>
<p>ุงฺฏุฑ ฺฉุฏ ุณุฑูุฑ ุฑุง ุฏุฑ ุงุฎุชุงุฑ ูุฏุงุฑุฏ:</p>
<ul>
<li>ุงุฒ <strong>ADAPTER</strong> ุจุฑุง ุชุบุฑ API ู ุงุถุงูู ฺฉุฑุฏู ููู ุงุณุชูุงุฏู ฺฉูุฏ:</li>
</ul>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeIntegerIterator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">IntegerIterator</span> <span class="hljs-variable">iterator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntegerIterator</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> Integer <span class="hljs-title function_">getNextOrNull</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span>(iterator.hasNext())
            <span class="hljs-keyword">return</span> iterator.next();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<ul>
<li>ุง ุจูุชุฑ ุงุณุชุ ุงุฒ <strong>Collectionโูุง thread-safe ุจุง ุงูุชุฑูุณโูุง ฺฏุณุชุฑุด ุงูุชู</strong> ุงุณุชูุงุฏู ฺฉูุฏ.</li>
</ul>
<hr>
<h2>ุงูุฒุงุด Throughput โก</h2>
<p>ูุฑุถ ฺฉูุฏ ูโุฎูุงูู ุจู ุงูุชุฑูุช ุจุฑูู ู ูุญุชูุง ูุฌููุนูโุง ุงุฒ ุตูุญุงุช ุฑุง ุงุฒ ูุณุช ุงุฒ URLูุง ุจุฎูุงูู. ุจุง ูุฑ ุตูุญู ุฎูุงูุฏู ุดุฏูุ ุขู ุฑุง ูพุฑุฏุงุฒุด ูโฺฉูู ุชุง ุขูุงุฑ ุฌูุนโุขูุฑ ุดูุฏ. ุจุนุฏ ุงุฒ ุฎูุงูุฏู ููู ุตูุญุงุชุ ฺฉ ฺฏุฒุงุฑุด ุฎูุงุตู ฺุงูพ ูโฺฉูู.</p>
<p>ฺฉูุงุณ ุฒุฑ ูุญุชูุง ฺฉ ุตูุญู ุฑุง ุจุง ุชูุฌู ุจู URL ุจุงุฒูโฺฏุฑุฏุงูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageReader</span> {
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPageFor</span><span class="hljs-params">(String url)</span> {
        <span class="hljs-type">HttpMethod</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GetMethod</span>(url);
        <span class="hljs-keyword">try</span> {
            httpClient.executeMethod(method);
            <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> method.getResponseBodyAsString();
            <span class="hljs-keyword">return</span> response;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            handle(e);
        } <span class="hljs-keyword">finally</span> {
            method.releaseConnection();
        }
    }
}
</code></pre>
<p>ฺฉูุงุณ ุจุนุฏุ Iterator ุงุณุช ฺฉู ูุญุชูุง ุตูุญุงุช ุฑุง ุจุฑ ุงุณุงุณ Iterator ุงุฒ URLูุง ูุฑุงูู ูโฺฉูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageIterator</span> {
    <span class="hljs-keyword">private</span> PageReader reader;
    <span class="hljs-keyword">private</span> URLIterator urls;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PageIterator</span><span class="hljs-params">(PageReader reader, URLIterator urls)</span> {
        <span class="hljs-built_in">this</span>.urls = urls;
        <span class="hljs-built_in">this</span>.reader = reader;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> String <span class="hljs-title function_">getNextPageOrNull</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (urls.hasNext())
            <span class="hljs-keyword">return</span> getPageFor(urls.next());
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPageFor</span><span class="hljs-params">(String url)</span> {
        <span class="hljs-keyword">return</span> reader.getPageFor(url);
    }
}
</code></pre>
<p>ฺฉ ููููู ุงุฒ <code>PageIterator</code> ูโุชูุงูุฏ ุจู ฺูุฏ Thread ูุฎุชูู ุจู ุงุดุชุฑุงฺฉ ฺฏุฐุงุดุชู ุดูุฏุ ูุฑ Thread ุงุฒ ููููู ุฎูุฏุด ุงุฒ <code>PageReader</code> ุจุฑุง ุฎูุงูุฏู ู ูพุฑุฏุงุฒุด ุตูุญุงุช ุงุณุชูุงุฏู ูโฺฉูุฏ.</p>
<p>ุชูุฌู ฺฉูุฏ ฺฉู <strong>ุจููฺฉ synchronized ุจุณุงุฑ ฺฉูฺฺฉ ูฺฏู ุฏุงุดุชู ุดุฏู</strong>. ููุท ุจุฎุด ุญุงุช ุฏุงุฎู <code>PageIterator</code> ุงุณุช. ููุดู ุจูุชุฑ ุงุณุช <strong>ฺฉูุชุฑู ูุณูุช ููฺฉู ุฑุง ููฺฏุงูโุณุงุฒ ฺฉูุฏ</strong> ุชุง ุจุดุชุฑู ูุณูุช ุฑุง.</p>
<hr>
<h3>ูุญุงุณุจู Throughput ุจุง Single-Thread</h3>
<p>ูุฑุถ ฺฉูุฏ ููุงุฏุฑ ุฒุฑ ุจุฑุง ูุญุงุณุจุงุช ุณุงุฏู ุงุนูุงู ุดูุฏ:</p>
<ul>
<li>ุฒูุงู I/O ุจุฑุง ุฏุฑุงูุช ฺฉ ุตูุญู (ูุงูฺฏู): ฑ ุซุงูู</li>
<li>ุฒูุงู ูพุฑุฏุงุฒุด ุจุฑุง ุชุฌุฒู ุตูุญู (ูุงูฺฏู): ฐ.ต ุซุงูู</li>
<li>I/O ูฺ CPU ูุตุฑู ููโฺฉูุฏุ ูพุฑุฏุงุฒุด ฑฐฐูช CPU ูุงุฒ ุฏุงุฑุฏ.</li>
</ul>
<p>ุจุฑุง <strong>N ุตูุญู ฺฉู ุชูุณุท ฺฉ Thread ูพุฑุฏุงุฒุด ูโุดููุฏ</strong>ุ ุฒูุงู ฺฉู ุงุฌุฑุง ุจุฑุงุจุฑ ุงุณุช ุจุง:</p>
<pre class="hljs"><code>1.5 ุซุงูู * N
</code></pre>
<p>ุดฺฉู A-1 ฺฉ ููููู ุงุฒ ฑณ ุตูุญู ุฑุง ูุดุงู ูโุฏูุฏ ฺฉู ุญุฏูุฏ ฑน.ต ุซุงูู ุทูู ูโฺฉุดุฏ.</p>
<p align="center">
  <img src=../../../assets/image/Appendix_A/img-A.1.jpeg/>
</p>
<h2>ูุญุงุณุจู Throughput ุจุง ฺูุฏ Thread ๐งตโก</h2>
<p>ุงฺฏุฑ ุงูฺฉุงู ุฏุงุฑุฏ ุตูุญุงุช ุฑุง ุจู ูุฑ ุชุฑุชุจ ุฏุฑุงูุช ฺฉูู ู ูพุฑุฏุงุฒุด ุตูุญุงุช ูุณุชูู ุงุฒ ูู ุจุงุดุฏุ ูโุชูุงู ุงุฒ <strong>ฺูุฏ Thread</strong> ุจุฑุง ุงูุฒุงุด throughput ุงุณุชูุงุฏู ฺฉุฑุฏ.</p>
<p>ฺู ุงุชูุงู ูโุงูุชุฏ ุงฺฏุฑ ุงุฒ <strong>ุณู Thread</strong> ุงุณุชูุงุฏู ฺฉููุ ฺูุฏ ุตูุญู ูโุชูุงูู ุฏุฑ ููุงู ุฒูุงู ุฏุฑุงูุช ฺฉููุ</p>
<p>ููุงูโุทูุฑ ฺฉู ุฏุฑ ุดฺฉู A-2 ูุดุงูุฏู ูโฺฉูุฏุ <strong>ุฑุงูโุญู ฺูุฏ Threadู</strong> ุงุฌุงุฒู ูโุฏูุฏ ฺฉู ูพุฑุฏุงุฒุด ุตูุญุงุช ฺฉู ูุงุจุณุชู ุจู CPU ุงุณุชุ ุจุง ุฎูุงูุฏู ุตูุญุงุช ฺฉู ูุงุจุณุชู ุจู I/O ุงุณุช ููโูพูุดุงู ุฏุงุดุชู ุจุงุดุฏ.</p>
<p>ุฏุฑ ฺฉ ุฏูุง ุงุฏูโุขูุ ุงู ุนู <strong>ูพุฑุฏุงุฒูุฏู ุจู ุทูุฑ ฺฉุงูู ููุฑุฏ ุงุณุชูุงุฏู ูุฑุงุฑ ูโฺฏุฑุฏ</strong>. ูุฑ ุฎูุงูุฏู ฺฉโุซุงููโุง ุตูุญู ุจุง ุฏู ูพุฑุฏุงุฒุด ููโูพูุดุงู ุฏุงุฑุฏ. ุจูุงุจุฑุงู ูโุชูุงูู <strong>ุฏู ุตูุญู ุฏุฑ ุซุงูู ูพุฑุฏุงุฒุด ฺฉูู</strong>ุ ฺฉู <strong>ุณู ุจุฑุงุจุฑ throughput ุฑุงูโุญู ุชฺฉโThreadู</strong> ุงุณุช.</p>
<p align="center">
  <img src=../../../assets/image/Appendix_A/img-A.2.jpeg/>
</p>
<h2>ุจูโุจุณุช (Deadlock) โ๏ธ๐</h2>
<p>ุชุตูุฑ ฺฉูุฏ ฺฉ <strong>ูุจโุงูพูฺฉุดู</strong> ุจุง ุฏู <strong>ููุจุน ูุดุชุฑฺฉ ูุญุฏูุฏ</strong> ุฏุงุฑู:</p>
<ul>
<li>ฺฉ <strong>ูพูู ุงุฒ ุงุชุตุงูโูุง ุฏุชุงุจุณ</strong> ุจุฑุง ุฐุฎุฑูโุณุงุฒ ฺฉุงุฑ ุฏุฑ ุญุงู ุงูุฌุงู ูุญู</li>
<li>ฺฉ <strong>ูพูู ุงุฒ ุงุชุตุงูโูุง MQ</strong> ุจู ูุฎุฒู ุงุตู</li>
</ul>
<p>ูุฑุถ ฺฉูุฏ ุฏู ุนููุงุช ุฏุฑ ุงู ุงูพูฺฉุดู ูุฌูุฏ ุฏุงุฑุฏ: <strong>Create</strong> ู <strong>Update</strong></p>
<ul>
<li><strong>Create</strong> โ ุงุจุชุฏุง ุงุชุตุงู ุจู ูุฎุฒู ุงุตู ู ุฏุชุงุจุณ ฺฏุฑูุชู ูโุดูุฏุ ุณูพุณ ุจุง ุณุฑูุณ ูุฎุฒู ุงุตู ุตุญุจุช ูโฺฉูุฏ ู ุจุนุฏ ฺฉุงุฑ ุฑุง ุฏุฑ ุฏุชุงุจุณ ูุญู ุฐุฎุฑู ูโฺฉูุฏ.</li>
<li><strong>Update</strong> โ ุงุจุชุฏุง ุงุชุตุงู ุจู ุฏุชุงุจุณ ู ุณูพุณ ุจู ูุฎุฒู ุงุตู ฺฏุฑูุชู ูโุดูุฏุ ุฏุงุฏูโูุง ุงุฒ ุฏุชุงุจุณ ูุญู ุฎูุงูุฏู ุดุฏู ู ุจู ูุฎุฒู ุงุตู ุงุฑุณุงู ูโุดููุฏ.</li>
</ul>
<p>ุญุงูุง ฺู ุงุชูุงู ูโุงูุชุฏ ููุช ุชุนุฏุงุฏ ฺฉุงุฑุจุฑุงู ุจุดุชุฑ ุงุฒ ุงูุฏุงุฒู ูุฑ <strong>ูพูู</strong> ุจุงุดุฏุ ูุฑุถ ฺฉูุฏ ูุฑ ูพูู ุงูุฏุงุฒูโุงุด ุฏู ุงุณุช:</p>
<ol>
<li>ุฏู ฺฉุงุฑุจุฑ ุนููุงุช <strong>Create</strong> ุฑุง ุงุฌุฑุง ูโฺฉููุฏุ ุจูุงุจุฑุงู <strong>ุชูุงู ฑฐ ุงุชุตุงู ุฏุชุงุจุณ ฺฏุฑูุชู ูโุดูุฏ</strong> ู ูุฑ Thread ุจุนุฏ ุงุฒ ฺฏุฑูุชู ุงุชุตุงู ุฏุชุงุจุณ ุงูุง ูุจู ุงุฒ ฺฏุฑูุชู ุงุชุตุงู ุจู ูุฎุฒู ุงุตู ูุชููู ูโุดูุฏ.</li>
<li>ุฏู ฺฉุงุฑุจุฑ ุนููุงุช <strong>Update</strong> ุฑุง ุงุฌุฑุง ูโฺฉููุฏุ ุจูุงุจุฑุงู <strong>ุชูุงู ฑฐ ุงุชุตุงู ูุฎุฒู ุงุตู ฺฏุฑูุชู ูโุดูุฏ</strong> ู ูุฑ Thread ุจุนุฏ ุงุฒ ฺฏุฑูุชู ุงุชุตุงู ูุฎุฒู ุงุตู ุงูุง ูุจู ุงุฒ ฺฏุฑูุชู ุงุชุตุงู ุฏุชุงุจุณ ูุชููู ูโุดูุฏ.</li>
<li>ุญุงูุง ุฏู Thread ูุฑุจูุท ุจู <strong>Create</strong> ุจุงุฏ ููุชุธุฑ ุงุชุตุงู ุจู ูุฎุฒู ุงุตู ุจูุงููุฏุ ู ุฏู Thread ูุฑุจูุท ุจู <strong>Update</strong> ุจุงุฏ ููุชุธุฑ ุงุชุตุงู ุฏุชุงุจุณ ุจุงุดูุฏ.</li>
<li><strong>ุจูโุจุณุช!</strong> ุณุณุชู ุฏฺฏุฑ ูุฑฺฏุฒ ุจุงุฒุงุจ ููโุดูุฏ.</li>
</ol>
<p>ููฺฉู ุงุณุช ุงู ุณูุงุฑู ุบุฑูุงูุน ุจู ูุธุฑ ุจุฑุณุฏุ ุงูุง ฺู ฺฉุณ ุณุณุชู ุฑุง ูโุฎูุงูุฏ ฺฉู ูุฑ ููุชู ฺฉโุจุงุฑ ฺฉุงููุงู ููู ุดูุฏุ ฺู ฺฉุณ ูโุฎูุงูุฏ ุณุณุชู ุฑุง ุจุง ุนูุงุฆู ุบุฑูุงุจู ุจุงุฒุชููุฏ ุงุดฺฉุงูโุฒุฏุง ฺฉูุฏุ ฺูู ูุดฺฉูุงุช ุฏุฑ ูุญุท ูุงูุน ุงุชูุงู ูโุงูุชูุฏ ู ููุชูโูุง ุทูู ูโฺฉุดุฏ ุชุง ุญู ุดููุฏ.</p>
<p>ฺฉ ยซุฑุงูโุญูยป ูุนูููุ ุงุถุงูู ฺฉุฑุฏู ุฏุณุชูุฑุงุช <strong>debugging</strong> ุงุณุช ุชุง ุจูููู ฺู ุงุชูุงู ูโุงูุชุฏ. ุงูุจุชูุ ฺฉุฏ debug ุขููุฏุฑ ุณุณุชู ุฑุง ุชุบุฑ ูโุฏูุฏ ฺฉู ุจูโุจุณุช ุฏุฑ ุดุฑุงุท ุฏฺฏุฑ ุฑุฎ ุฏูุฏ ู ูุงูโูุง ุจุนุฏ ุฏูุจุงุฑู ุงุชูุงู ุจูุชุฏ.</p>
<h3>ุดุฑุงุท ูุงุฒู ุจุฑุง ูููุน ุจูโุจุณุช</h3>
<p>ฑ. <strong>ุงูุญุตุงุฑ ูุชูุงุจู (Mutual Exclusion)</strong><br>
ุฒูุงู ฺฉู ฺูุฏ Thread ูุงุฒ ุฏุงุฑูุฏ ุงุฒ ฺฉ ููุจุน ูุดุชุฑฺฉ ุงุณุชูุงุฏู ฺฉููุฏ ู ุงู ููุงุจุน:</p>
<ul>
<li>ููโุชูุงููุฏ ููุฒูุงู ุชูุณุท ฺูุฏ Thread ุงุณุชูุงุฏู ุดููุฏ</li>
<li>ุชุนุฏุงุฏุดุงู ูุญุฏูุฏ ุงุณุช<br>
ูุซุงู ูุนููู: ุงุชุตุงู ุฏุชุงุจุณุ ูุงู ุจุงุฒ ุจุฑุง ููุดุชูุ ููู ุฑฺฉูุฑุฏ ุง Semaphore</li>
</ul>
<p>ฒ. <strong>ููู ู ุงูุชุธุงุฑ (Lock &amp; Wait)</strong><br>
ููุช ฺฉ Thread ููุจุน ุฑุง ฺฏุฑูุชุ ุขู ุฑุง ุขุฒุงุฏ ููโฺฉูุฏ ุชุง ุชูุงู ููุงุจุน ุฏฺฏุฑ ููุฑุฏ ูุงุฒุด ุฑุง ูฺฏุฑูุชู ู ฺฉุงุฑุด ุฑุง ฺฉุงูู ูฺฉุฑุฏู ุจุงุดุฏ.</p>
<p>ณ. <strong>ุนุฏู ูพุดโุฏุณุช (No Preemption)</strong><br>
ฺฉ Thread ููโุชูุงูุฏ ููุงุจุน Thread ุฏฺฏุฑ ุฑุง ุจฺฏุฑุฏ. ุชููุง ุฑุงู ุฏุณุชุฑุณ Thread ุฏฺฏุฑุ ุขุฒุงุฏ ฺฉุฑุฏู ููุจุน ุชูุณุท Thread ูุนู ุงุณุช.</p>
<p>ด. <strong>ุงูุชุธุงุฑ ุฏุงุฑูโุง (Circular Wait)</strong><br>
ุงู ูุถุนุช ุจู ยซุฏุฑ ุขุบูุด ูุฑฺฏยป ูู ูุนุฑูู ุงุณุช.<br>
ุชุตูุฑ ฺฉูุฏ ุฏู Threadุ <strong>T1 ู T2</strong> ู ุฏู ููุจุน <strong>R1 ู R2</strong> ุฏุงุฑู.</p>
<ul>
<li>T1ุ R1 ุฑุง ุฏุงุฑุฏ</li>
<li>T2ุ R2 ุฑุง ุฏุงุฑุฏ</li>
<li>T1 ููฺูู ุจู R2 ูุงุฒ ุฏุงุฑุฏ</li>
<li>T2 ููฺูู ุจู R1 ูุงุฒ ุฏุงุฑุฏ</li>
</ul>
<p>ุงู ูุถุนุช ุดุจู ุดฺฉู <strong>A-3</strong> ุงุณุช:</p>
<p align="center">
  <img src=../../../assets/image/Appendix_A/img-A.3.jpeg/>
</p>
<p>ุชูุงู ุงู ฺูุงุฑ ุดุฑุท ุจุงุฏ ุจุฑูุฑุงุฑ ุจุงุดูุฏ ุชุง ุจูโุจุณุช ุงุชูุงู ุจูุชุฏ. ุงฺฏุฑ ุญุช ฺฉ ุงุฒ ุงู ุดุฑุงุท ุดฺฉุณุชู ุดูุฏุ ุจูโุจุณุช ุบุฑููฺฉู ุงุณุช.</p>
<h3>ุดฺฉุณุชู ุดุฑุท Mutual Exclusion</h3>
<p>ฺฉ ุงุฒ ุฑุงูโูุง ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุจูโุจุณุชุ ุฏูุฑ ุฒุฏู ุดุฑุท <strong>ุงูุญุตุงุฑ ูุชูุงุจู</strong> ุงุณุช. ูโุชูุงู ุงู ฺฉุงุฑ ุฑุง ุจุง:</p>
<ul>
<li>ุงุณุชูุงุฏู ุงุฒ ููุงุจุน ฺฉู ุงุฌุงุฒู ุงุณุชูุงุฏู ููุฒูุงู ูโุฏููุฏุ ูุซู <strong>AtomicInteger</strong></li>
<li>ุงูุฒุงุด ุชุนุฏุงุฏ ููุงุจุน ุชุง ุจุฑุงุจุฑ ุง ุจุดุชุฑ ุงุฒ ุชุนุฏุงุฏ Threadูุง ุฑูุงุจุช ุดูุฏ</li>
<li>ุจุฑุฑุณ ุงูฺฉู ุชูุงู ููุงุจุน ุขุฒุงุฏ ูุณุชูุฏ ูุจู ุงุฒ ฺฏุฑูุชู ูุฑ ฺฉุฏุงู</li>
</ul>
<p>ูุชุฃุณูุงูู ุงฺฉุซุฑ ููุงุจุน ูุญุฏูุฏ ูุณุชูุฏ ู ุงุฌุงุฒู ุงุณุชูุงุฏู ููุฒูุงู ููโุฏููุฏ. ฺฏุงู ูู ููุช ุฏููู ููุจุน ุจู ูุชุฌู ุนููุงุช ุฑู ููุจุน ุงูู ุจุณุชฺฏ ุฏุงุฑุฏ.</p>
<h3>ุดฺฉุณุชู ุดุฑุท Lock &amp; Wait</h3>
<p>ุฑุงู ุฏฺฏุฑ ุงู ุงุณุช ฺฉู ุงุฒ ุงูุชุธุงุฑ ุฎูุฏุฏุงุฑ ฺฉูู. ูุจู ุงุฒ ฺฏุฑูุชู ูุฑ ููุจุน ุขู ุฑุง ุจุฑุฑุณ ฺฉุฑุฏู ู ุงฺฏุฑ ูุดุบูู ุจูุฏุ ุชูุงู ููุงุจุน ฺฏุฑูุชู ุดุฏู ุฑุง ุขุฒุงุฏ ฺฉุฑุฏู ู ุฏูุจุงุฑู ุดุฑูุน ฺฉูู.</p>
<p>ุงู ุฑูุด ูุดฺฉูุงุช ุฏุงุฑุฏ:</p>
<ul>
<li><strong>Starvation</strong> โ ฺฉ Thread ููฺฉู ุงุณุช ููุดู ูุชูุงูุฏ ููุงุจุน ููุฑุฏ ูุงุฒุด ุฑุง ุจฺฏุฑุฏ.</li>
<li><strong>Livelock</strong> โ ฺูุฏ Thread ููฺฉู ุงุณุช ููุฒูุงู ฺฉ ููุจุน ุฑุง ุจฺฏุฑูุฏ ู ุขุฒุงุฏ ฺฉููุฏุ ุจุงุฑูุง ู ุจุงุฑูุงุ ูุฎุตูุตุงู ุจุง ุงูฺฏูุฑุชูโูุง ุณุงุฏู ุฒูุงูโุจูุฏ CPU.</li>
</ul>
<p>ุงฺฏุฑฺู ุงู ุฑูุด ูุงฺฉุงุฑุขูุฏ ุจู ูุธุฑ ูโุฑุณุฏุ ุจูุชุฑ ุงุฒ ูฺ ุงุณุช ู ุชูุฑุจุงู ููุดู ูุงุจู ูพุงุฏูโุณุงุฒ ุงุณุช.</p>
<h3>ุดฺฉุณุชู ุดุฑุท No Preemption</h3>
<p>ุฑุงู ุฏฺฏุฑุ ุงุฌุงุฒู ุฏุงุฏู ุจู Threadูุง ุจุฑุง ฺฏุฑูุชู ููุงุจุน ุงุฒ Threadูุง ุฏฺฏุฑ ุงุณุช. ูุนูููุงู ุงุฒ ฺฉ ูฺฉุงูุฒู ุฏุฑุฎูุงุณุช ุณุงุฏู ุงุณุชูุงุฏู ูโุดูุฏ. ููุช ฺฉ Thread ูโุจูุฏ ููุจุน ูุดุบูู ุงุณุชุ ุงุฒ ูุงูฺฉ ุขู ูโุฎูุงูุฏ ุขุฒุงุฏุด ฺฉูุฏ. ุงฺฏุฑ ูุงูฺฉ ูู ููุชุธุฑ ููุจุน ุฏฺฏุฑ ุจุงุดุฏุ ููู ููุงุจุน ุฑุง ุขุฒุงุฏ ฺฉุฑุฏู ู ุฏูุจุงุฑู ุดุฑูุน ูโฺฉูุฏ.</p>
<p>ุงู ูุดุงุจู ุฑูุด ูุจู ุงุณุช ุงูุง ูุฒุช ุฏุงุฑุฏ ฺฉู Thread ูโุชูุงูุฏ ุจุฑุง ููุจุน ุตุจุฑ ฺฉูุฏ ู ุชุนุฏุงุฏ ุดุฑูุน ูุฌุฏุฏูุง ฺฉูุชุฑ ูโุดูุฏ.</p>
<h3>ุดฺฉุณุชู ุดุฑุท Circular Wait</h3>
<p>ุงู ุฑุงุฌโุชุฑู ุฑูุด ุฌููฺฏุฑ ุงุฒ ุจูโุจุณุช ุงุณุช. ุงุบูุจ ุณุณุชูโูุง ุจุง ฺฉ <strong>ูุฑุงุฑุฏุงุฏ ุณุงุฏู</strong> ุจู ููู Threadูุง ฺฉุงุฑ ูโฺฉููุฏ.</p>
<p>ูุซูุงู ุฏุฑ ูุซุงู Thread1 ู Thread2 ู ููุงุจุน R1 ู R2ุ ุงฺฏุฑ ููู Threadูุง ููุงุจุน ุฑุง ุจู ููุงู ุชุฑุชุจ ุชุฎุตุต ุฏููุฏุ ุงูุชุธุงุฑ ุฏุงุฑูโุง ุบุฑููฺฉู ูโุดูุฏ.</p>
<p>ุงูุง ูุดฺฉูุงุช ูู ุฏุงุฑุฏ:</p>
<ul>
<li>ุชุฑุชุจ ฺฏุฑูุชู ููุงุจุน ููฺฉู ุงุณุช ุจุง ุชุฑุชุจ ุงุณุชูุงุฏู ุงุฒ ุขูโูุง ููโุฎูุงู ูุฏุงุดุชู ุจุงุดุฏุ ุจูุงุจุฑุงู ููุงุจุน ููฺฉู ุงุณุช ุทููุงูโุชุฑ ุงุฒ ูุงุฒ ููู ุดููุฏ.</li>
<li>ฺฏุงู ููโุชูุงู ุชุฑุชุจ ููุงุจุน ุฑุง ุงุนูุงู ฺฉุฑุฏุ ูุซูุงู ููุช ID ููุจุน ุฏูู ุงุฒ ูุชุฌู ููุจุน ุงูู ุจุฏุณุช ูโุขุฏ.</li>
</ul>
<h3>ูฺฉุชู</h3>
<p>ุฑุงูโูุง ุฒุงุฏ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุจูโุจุณุช ูุฌูุฏ ุฏุงุฑุฏุ ุจุนุถ ุจุงุนุซ <strong>starvation</strong> ู ุจุนุถ ูุตุฑู ุจุงูุง CPU ู ฺฉุงูุด ูพุงุณุฎฺฏู ูโุดููุฏ.</p>
<p>ุงุฒููู ฺฉุฑุฏู ุจุฎุด Threadูุง ุจุฑุง <strong>ุชูุธู ู ุขุฒูุงุด</strong> ุฑุงู ูุฏุฑุชููุฏ ุจุฑุง ูพุฏุง ฺฉุฑุฏู ุจูุชุฑู ุงุณุชุฑุงุชฺ ุงุณุช.</p>
<hr>
<h3>ุชุณุช ฺฉุฏ ฺูุฏูุฎ</h3>
<p>ฺฺฏููู ูโุชูุงู ุชุณุช ููุดุช ุชุง ูุดุงู ุฏูุฏ ฺฉุฏ ุฒุฑ ุฎุฑุงุจ ุงุณุชุ</p>
<pre class="hljs"><code><span class="hljs-number">01</span>: <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassWithThreadingProblem</span> { 
<span class="hljs-number">02</span>:    <span class="hljs-type">int</span> nextId; 
<span class="hljs-number">03</span>: 
<span class="hljs-number">04</span>:    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">takeNextId</span><span class="hljs-params">()</span> { 
<span class="hljs-number">05</span>:        <span class="hljs-keyword">return</span> nextId++; 
<span class="hljs-number">06</span>:    } 
<span class="hljs-number">07</span>:} 
</code></pre>
<p>ุดุฑุญ ุชุณุช:</p>
<ul>
<li>ููุฏุงุฑ ูุนู <code>nextId</code> ุฑุง ุงุฏุฏุงุดุช ฺฉูุฏ.</li>
<li>ุฏู Thread ุงุฌุงุฏ ฺฉูุฏ ฺฉู ูุฑฺฉุฏุงู <code>takeNextId()</code> ุฑุง ฺฉ ุจุงุฑ ุตุฏุง ุจุฒููุฏ.</li>
<li>ุจุฑุฑุณ ฺฉูุฏ ฺฉู <code>nextId</code> ุฏู ูุงุญุฏ ุจุดุชุฑ ุงุฒ ููุฏุงุฑ ุงููู ุจุงุดุฏ.</li>
<li>ุงู ฺฉุงุฑ ุฑุง ุชฺฉุฑุงุฑ ฺฉูุฏ ุชุง ุจุจูุฏ <code>nextId</code> ุชููุง ฺฉ ูุงุญุฏ ุงูุฒุงุด ุงูุชู ุงุณุช.</li>
</ul>
<h3>ููููู ุชุณุช (JUnit)</h3>
<pre class="hljs"><code><span class="hljs-number">01</span>: <span class="hljs-keyword">package</span> example;
<span class="hljs-number">02</span>:
<span class="hljs-number">03</span>: <span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.Assert.fail;
<span class="hljs-number">04</span>:
<span class="hljs-number">05</span>: <span class="hljs-keyword">import</span> org.junit.Test;
<span class="hljs-number">06</span>:
<span class="hljs-number">07</span>: <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassWithThreadingProblemTest</span> {
08:     <span class="hljs-meta">@Test</span>
09:     <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">twoThreadsShouldFailEventually</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
<span class="hljs-number">10</span>:         <span class="hljs-keyword">final</span> <span class="hljs-type">ClassWithThreadingProblem</span> <span class="hljs-variable">classWithThreadingProblem</span>
                <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassWithThreadingProblem</span>();
<span class="hljs-number">11</span>:
<span class="hljs-number">12</span>:         <span class="hljs-type">Runnable</span> <span class="hljs-variable">runnable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
<span class="hljs-number">13</span>:             <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
<span class="hljs-number">14</span>:                 classWithThreadingProblem.takeNextId();
<span class="hljs-number">15</span>:             }
<span class="hljs-number">16</span>:         };
<span class="hljs-number">17</span>:
<span class="hljs-number">18</span>:         <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50000</span>; ++i) {
<span class="hljs-number">19</span>:             <span class="hljs-type">int</span> <span class="hljs-variable">startingId</span> <span class="hljs-operator">=</span> classWithThreadingProblem.lastId;
<span class="hljs-number">20</span>:             <span class="hljs-type">int</span> <span class="hljs-variable">expectedResult</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> + startingId;
<span class="hljs-number">21</span>:
<span class="hljs-number">22</span>:             <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(runnable);
<span class="hljs-number">23</span>:             <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(runnable);
<span class="hljs-number">24</span>:             t1.start();
<span class="hljs-number">25</span>:             t2.start();
<span class="hljs-number">26</span>:             t1.join();
<span class="hljs-number">27</span>:             t2.join();
<span class="hljs-number">28</span>:
<span class="hljs-number">29</span>:             <span class="hljs-type">int</span> <span class="hljs-variable">endingId</span> <span class="hljs-operator">=</span> classWithThreadingProblem.lastId;
<span class="hljs-number">30</span>:
<span class="hljs-number">31</span>:             <span class="hljs-keyword">if</span> (endingId != expectedResult)
<span class="hljs-number">32</span>:                 <span class="hljs-keyword">return</span>;
<span class="hljs-number">33</span>:         }
<span class="hljs-number">34</span>:
<span class="hljs-number">35</span>:         fail(<span class="hljs-string">&quot;Should have exposed a threading issue but it did not.&quot;</span>);
<span class="hljs-number">36</span>:     }
<span class="hljs-number">37</span>: }
</code></pre>
<table>
<thead>
<tr>
<th>Line</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>10</td>
<td>ุงุฌุงุฏ ฺฉ ููููู ุงุฒ ฺฉูุงุณ <strong>ClassWithThreadingProblem</strong>. ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุจุงุฏ ุงุฒ ฺฉูุฏูุงฺู <code>final</code> ุงุณุชูุงุฏู ฺฉูู ุฒุฑุง ุฏุฑ ุงุฏุงูู ุฏุฑ ฺฉ ฺฉูุงุณ ุฏุงุฎู ูุงุดูุงุณ ุงุณุชูุงุฏู ูโุดูุฏ.</td>
</tr>
<tr>
<td>12โ16</td>
<td>ุงุฌุงุฏ ฺฉ ฺฉูุงุณ ุฏุงุฎู ูุงุดูุงุณ ฺฉู ุงุฒ ููุงู ููููู ุงุณุชูุงุฏู ูโฺฉูุฏ.</td>
</tr>
<tr>
<td>18</td>
<td>ุงู ฺฉุฏ ุฑุง ยซุจู ุงูุฏุงุฒู ฺฉุงูยป ุงุฌุฑุง ูโฺฉูู ุชุง ูุดุงู ุฏูุฏ ฺฉุฏ ุฎุฑุงุจ ุงุณุชุ ุงูุง ูู ุขูโูุฏุฑ ุฒุงุฏ ฺฉู ุชุณุช ุทููุงู ุดูุฏ. ุงู ฺฉ ุชุนุงุฏู ุงุณุชุ ููโุฎูุงูู ุฒูุงู ุฒุงุฏ ููุชุธุฑ ุดฺฉุณุช ุจุงุดู. ุงูุชุฎุงุจ ุงู ุนุฏุฏ ุณุฎุช ุงุณุชโุงฺฏุฑฺู ุจุนุฏุงู ูโุจูู ูโุชูุงูู ุขู ุฑุง ุจู ุทูุฑ ูุงุจู ุชูุฌู ฺฉุงูุด ุฏูู.</td>
</tr>
<tr>
<td>19</td>
<td>ููุฏุงุฑ ุดุฑูุน ุฑุง ุจู ุฎุงุทุฑ ุจุณูพุงุฑุฏ. ุงู ุชุณุช ูุตุฏ ุฏุงุฑุฏ ุซุงุจุช ฺฉูุฏ ฺฉุฏ ุฏุฑ <strong>ClassWithThreadingProblem</strong> ุฎุฑุงุจ ุงุณุช. ุงฺฏุฑ ุชุณุช ูููู ุดูุฏุ ุซุงุจุช ูโฺฉูุฏ ฺฉุฏ ุฎุฑุงุจ ุงุณุช. ุงฺฏุฑ ุชุณุช ุดฺฉุณุช ุจุฎูุฑุฏุ ุชุณุช ูุชูุงูุณุช ุซุงุจุช ฺฉูุฏ ฺฉุฏ ุฎุฑุงุจ ุงุณุช.</td>
</tr>
<tr>
<td>20</td>
<td>ุงูุชุธุงุฑ ุฏุงุฑู ููุฏุงุฑ ููุง ุฏู ูุงุญุฏ ุจุดุชุฑ ุงุฒ ููุฏุงุฑ ูุนู ุจุงุดุฏ.</td>
</tr>
<tr>
<td>22โ23</td>
<td>ุงุฌุงุฏ ุฏู Thread ฺฉู ูุฑ ุฏู ุงุฒ ููููู ุงุฌุงุฏ ุดุฏู ุฏุฑ ุฎุทูุท 12โ16 ุงุณุชูุงุฏู ูโฺฉููุฏ. ุงู ุงูฺฉุงู ุฑุง ูโุฏูุฏ ฺฉู ุฏู Thread ุณุน ฺฉููุฏ ุงุฒ ููุงู ููููู ุงุณุชูุงุฏู ฺฉุฑุฏู ู ุจุง ูู ุชุฏุงุฎู ุฏุงุดุชู ุจุงุดูุฏ.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Line</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>24โ25</td>
<td>ุงุฌุงุฒู ูโุฏูู ุฏู Thread ูุง ุขูุงุฏู ุงุฌุฑุง ุดููุฏ.</td>
</tr>
<tr>
<td>26โ27</td>
<td>ููุชุธุฑ ูโูุงูู ุชุง ูุฑ ุฏู Thread ูุจู ุงุฒ ุจุฑุฑุณ ูุชุงุฌ ุจู ูพุงุงู ุจุฑุณูุฏ.</td>
</tr>
<tr>
<td>29</td>
<td>ููุฏุงุฑ ููุง ูุงูุน ุฑุง ุซุจุช ูโฺฉูู.</td>
</tr>
<tr>
<td>31โ32</td>
<td>ุขุง ููุฏุงุฑ <code>endingId</code> ุจุง ฺุฒ ฺฉู ุงูุชุธุงุฑ ุฏุงุดุชู ูุชูุงูุช ุจูุฏุ ุงฺฏุฑ ุจููุ ุชุณุช ุฑุง ูพุงุงู ูโุฏููโูุง ุซุงุจุช ฺฉุฑุฏู ฺฉุฏ ุฎุฑุงุจ ุงุณุช. ุงฺฏุฑ ููุ ุฏูุจุงุฑู ุชูุงุด ูโฺฉูู.</td>
</tr>
<tr>
<td>35</td>
<td>ุงฺฏุฑ ุจู ุงูุฌุง ุฑุณุฏูุ ุชุณุช ูุชูุงูุณุช ุซุงุจุช ฺฉูุฏ ฺฉุฏ ุชููุฏ ุฏุฑ ยซุฒูุงู ูุนูููยป ุฎุฑุงุจ ุงุณุชุ ุชุณุช ุดฺฉุณุช ุฎูุฑุฏู ุงุณุช. ุง ฺฉุฏ ุฎุฑุงุจ ูุณุช ุง ุชุนุฏุงุฏ ุชฺฉุฑุงุฑูุง ุจุฑุง ุฑุฎ ุฏุงุฏู ุดุฑุงุท ุฎุทุง ฺฉุงู ูุจูุฏู ุงุณุช.</td>
</tr>
</tbody>
</table>
<p>ุงู ุชุณุช ูุทุนุงู ุดุฑุงุท ูุงุฒู ุจุฑุง ฺฉ ูุดฺฉู ุจูโุฑูุฒุฑุณุงู ููโุฒูุงู ุฑุง ูุฑุงูู ูโฺฉูุฏ. ุจุง ุงู ุญุงูุ ูุดฺฉู ุขูโูุฏุฑ ุจู ูุฏุฑุช ุฑุฎ ูโุฏูุฏ ฺฉู ุฏุฑ ุงฺฉุซุฑ ููุงูุน ุงู ุชุณุช ุขู ุฑุง ุชุดุฎุต ููโุฏูุฏ. ุฏุฑ ูุงูุนุ ุจุฑุง ุดูุงุณุง ูุงูุน ูุดฺฉูุ ุจุงุฏ ุชุนุฏุงุฏ ุชฺฉุฑุงุฑูุง ุฑุง ุจุด ุงุฒ ฺฉ ูููู ูุฑุงุฑ ุฏูู. ุญุช ุฏุฑ ุงู ุตูุฑุชุ ุฏุฑ ุฏู ุงุฌุฑุง ูุฎุชูู ุจุง ุดูุงุฑุด ุญููู ฑุฐฐฐุฐฐฐุ ูุดฺฉู ุชููุง ฺฉ ุจุงุฑ ุฑุฎ ุฏุงุฏ. ุงู ุนู ุงุญุชูุงูุงู ุจุงุฏ ุชุนุฏุงุฏ ุชฺฉุฑุงุฑูุง ุฑุง ุจู ุตุฏ ูููู ุง ุจุดุชุฑ ุงูุฒุงุด ุฏูู ุชุง ุดฺฉุณุช ูุงุจู ุงุนุชูุงุฏ ุจู ุฏุณุช ุขูุฑู. ฺูุฏุฑ ุญุงุถุฑ ูุณุชู ุตุจุฑ ฺฉููุ</p>
<p>ุญุช ุงฺฏุฑ ุชุณุช ุฑุง ุทูุฑ ุชูุธู ฺฉูู ฺฉู ุดฺฉุณุช ูุงุจู ุงุนุชูุงุฏ ุฑู ฺฉ ูุงุดู ุญุงุตู ุดูุฏุ ุงุญุชูุงูุงู ุจุงุฏ ุชุณุช ุฑุง ุจุง ููุงุฏุฑ ูุชูุงูุช ุฏูุจุงุฑู ุชูุธู ฺฉูู ุชุง ุดฺฉุณุช ุฑุง ุฑู ูุงุดูุ ุณุณุชูโุนุงูู ุง ูุณุฎู ุฏฺฏุฑ ุงุฒ JVM ูุดุงู ุฏูู.</p>
<p>ู ุงู ฺฉ ูุดฺฉู ุณุงุฏู ุงุณุช. ุงฺฏุฑ ูุชูุงูู ฺฉุฏ ุฎุฑุงุจ ุฑุง ุจู ุฑุงุญุช ุจุง ุงู ูุดฺฉู ูุดุงู ุฏููุ ฺฺฏููู ูโุชูุงูู ูุดฺฉูุงุช ูพฺุฏู ูุงูุน ุฑุง ุชุดุฎุต ุฏููุ</p>
<p>ูพุณ ฺู ุฑูฺฉุฑุฏูุง ูโุชูุงูู ุจุฑุง ูุดุงู ุฏุงุฏู ุงู ุดฺฉุณุช ุณุงุฏู ุงุชุฎุงุฐ ฺฉููุ ู ูููโุชุฑ ุงุฒ ุขูุ ฺฺฏููู ูโุชูุงูู ุชุณุชโูุง ุจููุณู ฺฉู ุดฺฉุณุชโูุง ุฑุง ุฏุฑ ฺฉุฏ ูพฺุฏูโุชุฑ ูุดุงู ุฏููุฏุ ฺฺฏููู ูโุชูุงูู ุจูููู ฺฉุฏ ูุง ุฏุงุฑุง ุฎุทุง ุงุณุช ููุช ููโุฏุงูู ฺฉุฌุง ุจู ุฏูุจุงู ุขู ุจฺฏุฑุฏูุ</p>
<p>ฺูุฏ ุงุฏู ูุฌูุฏ ุฏุงุฑุฏ:</p>
<ul>
<li><strong>ุชุณุช ูููุช ฺฉุงุฑูู (Monte Carlo Testing):</strong> ุชุณุชโูุง ุฑุง ุงูุนุทุงูโูพุฐุฑ ุทุฑุงุญ ฺฉูุฏ ุชุง ูุงุจู ุชูุธู ุจุงุดูุฏ. ุณูพุณ ุชุณุช ุฑุง ุจุงุฑูุง ุงุฌุฑุง ฺฉูุฏโูุซูุงู ุฑู ฺฉ ุณุฑูุฑ ุชุณุชโุจุง ุชุบุฑ ุชุตุงุฏู ููุงุฏุฑ ุชูุธู ุดุฏู. ุงฺฏุฑ ุชุณุชโูุง ุดฺฉุณุช ุฎูุฑุฏูุฏุ ฺฉุฏ ุฎุฑุงุจ ุงุณุช. ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู ููุดุชู ุงู ุชุณุชโูุง ุฑุง ุฒูุฏ ุดุฑูุน ฺฉูุฏ ุชุง ฺฉ ุณุฑูุฑ ุงุฏุบุงู ูุฏุงูู ุขููุง ุฑุง ุจู ุฒูุฏ ุงุฌุฑุง ฺฉูุฏ. ููฺููุ ุดุฑุงุท ฺฉู ุชุณุช ุฏุฑ ุขู ุดฺฉุณุช ุฎูุฑุฏู ุฑุง ุจุง ุฏูุช ุซุจุช ฺฉูุฏ.</li>
<li>ุชุณุช ุฑุง ุฑู <strong>ุชูุงู ูพูุชูุฑูโูุง ูุฏู</strong> ุงุฌุฑุง ฺฉูุฏ. ุจูโุทูุฑ ูุฏุงูู. ูุฑฺู ุชุณุชโูุง ูุฏุช ุทููุงูโุชุฑ ุจุฏูู ุดฺฉุณุช ุงุฌุฑุง ุดููุฏุ ุงุญุชูุงู ุจุดุชุฑ ุฏุงุฑุฏ ฺฉูโฺฉุฏ ุชููุฏ ุฏุฑุณุช ุงุณุช ุงโุชุณุชโูุง ุจุฑุง ุขุดฺฉุงุฑ ฺฉุฑุฏู ูุดฺฉูุงุช ฺฉุงู ูุณุชูุฏ.</li>
<li>ุชุณุชโูุง ุฑุง ุฑู ูุงุดู ุจุง <strong>ุจุงุฑูุง ูุฎุชูู</strong> ุงุฌุฑุง ฺฉูุฏ. ุงฺฏุฑ ูโุชูุงูุฏ ุจุงุฑูุง ูุฒุฏฺฉ ุจู ูุญุท ุชููุฏ ุดุจูโุณุงุฒ ฺฉูุฏุ ุงูุฌุงู ุฏูุฏ.</li>
</ul>
<p>ุจุง ุงู ุญุงูุ ุญุช ุงฺฏุฑ ููู ุงู ฺฉุงุฑูุง ุฑุง ุงูุฌุงู ุฏูุฏุ ูููุฒ ุดุงูุณ ุฒุงุฏ ุจุฑุง ูพุฏุง ฺฉุฑุฏู ูุดฺฉูุงุช ููโุฒูุงู ุฏุฑ ฺฉุฏ ุฎูุฏ ูุฏุงุฑุฏ. ูพฺุฏูโุชุฑู ูุดฺฉูุงุชุ ุขูโูุง ูุณุชูุฏ ฺฉู ฺูุงู ูุงุฏุฑูุฏ ฺฉู ุชููุง ฺฉ ุจุงุฑ ุฏุฑ ูุฑ ููุงุฑุฏ ูุฑุตุช ุฑุฎ ูโุฏููุฏ. ุงู ูุดฺฉูุงุชุ ูุญุดุช ุณุณุชูโูุง ูพฺุฏู ูุณุชูุฏ.</p>
<h3>ูพุดุชุจุงู ุงุจุฒุงุฑ ุจุฑุง ุชุณุช ฺฉุฏ ูุจุชู ุจุฑ Thread</h3>
<p>ุดุฑฺฉุช IBM ุงุจุฒุงุฑ ุจู ูุงู <strong>ConTest</strong> ุณุงุฎุชู ุงุณุช. ุงู ุงุจุฒุงุฑ ฺฉูุงุณโูุง ุฑุง ุงุจุฒุงุฑุฏู ูโฺฉูุฏ ุชุง ุงุญุชูุงู ุดฺฉุณุช ฺฉุฏ ุบุฑ ููโุฒูุงู ุงูุฒุงุด ุงุจุฏ.</p>
<p>ูุง ูฺ ุฑุงุจุทู ูุณุชูู ุจุง IBM ุง ุชู ุชูุณุนูโุฏููุฏู ConTest ูุฏุงุฑู. ฺฉ ุงุฒ ููฺฉุงุฑุงู ูุง ุจู ุขู ุงุดุงุฑู ฺฉุฑุฏ ู ูุง ูพุณ ุงุฒ ฺูุฏ ุฏููู ุงุณุชูุงุฏูุ ุจูุจูุฏ ูุงุจู ุชูุฌู ุฏุฑ ุชูุงูุง ุงูุชู ูุดฺฉูุงุช ููโุฒูุงู ูุดุงูุฏู ฺฉุฑุฏู.</p>
<p>ุฑุงูููุง ุงุณุชูุงุฏู ุงุฒ ConTest:</p>
<ul>
<li>ุชุณุชโูุง ู ฺฉุฏ ุชููุฏ ุฑุง ุจููุณุฏุ ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู ุชุณุชโูุง ุจูโุทูุฑ ุฎุงุต ุจุฑุง ุดุจูโุณุงุฒ ฺฉุงุฑุจุฑุงู ูุชุนุฏุฏ ุจุง ุจุงุฑูุง ูุชุบุฑ ุทุฑุงุญ ุดุฏูโุงูุฏ.</li>
<li>ุชุณุช ู ฺฉุฏ ุชููุฏ ุฑุง ุจุง ConTest ุงุจุฒุงุฑุฏู ฺฉูุฏ.</li>
<li>ุชุณุชโูุง ุฑุง ุงุฌุฑุง ฺฉูุฏ.</li>
</ul>
<p>ููุช ฺฉุฏ ุฑุง ุจุง ConTest ุงุจุฒุงุฑุฏู ฺฉุฑุฏูุ ูุฑุฎ ููููุช ูุง ุงุฒ ุชูุฑุจุงู ฺฉ ุดฺฉุณุช ุฏุฑ ุฏู ูููู ุชฺฉุฑุงุฑ ุจู ุชูุฑุจุงู ฺฉ ุดฺฉุณุช ุฏุฑ ุณ ุชฺฉุฑุงุฑ ุฑุณุฏ. ููุงุฏุฑ ุญููู ุจุฑุง ฺูุฏ ุงุฌุฑุง ุชุณุช ูพุณ ุงุฒ ุงุจุฒุงุฑุฏู: ฑณุ ฒณุ ฐุ ตดุ ฑถุ ฑดุ ถุ ถนุ ฑฐทุ ดนุ ฒ. ุจูุงุจุฑุงู ูุงุถุญ ุงุณุช ฺฉู ฺฉูุงุณโูุง ุงุจุฒุงุฑุฏู ุดุฏู ุฎู ุฒูุฏุชุฑ ู ุจุง ูุงุจูุช ุงุทููุงู ุจุดุชุฑ ุดฺฉุณุช ุฎูุฑุฏูุฏ.</p>
<h3>ูุชุฌูโฺฏุฑ</h3>
<p>ุงู ูุตู ฺฉ ุณูุฑ ุจุณุงุฑ ฺฉูุชุงู ุฏุฑ ูููุฑู ุจุฒุฑฺฏ ู ุฎุทุฑูุงฺฉ ุจุฑูุงููโููุณ ููโุฒูุงู ุจูุฏ. ูุง ููุท ุณุทุญ ุขู ุฑุง ููุณ ฺฉุฑุฏู. ุชูุฑฺฉุฒ ูุง ุจุฑ ุฑู ุงุตูู ุจูุฏ ฺฉู ฺฉูฺฉ ูโฺฉูุฏ ฺฉุฏ ููโุฒูุงู ูพุงฺฉ ุจูุงูุฏุ ุงูุง ฺุฒูุง ุจุดุชุฑ ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุจุงุฏ ุงุฏ ุจฺฏุฑุฏ ุงฺฏุฑ ูโุฎูุงูุฏ ุณุณุชูโูุง ููโุฒูุงู ุจููุณุฏ. ูุง ุชูุตู ูโฺฉูู ุจุง ฺฉุชุงุจ ูููโุงูุนุงุฏู <strong>Doug Lea ุจุง ุนููุงู Concurrent Programming in Java: Design Principles and Patterns</strong> ุดุฑูุน ฺฉูุฏ.</p>
<p>ุฏุฑ ุงู ูุตู ุฏุฑุจุงุฑู ุจูโุฑูุฒุฑุณุงู ููโุฒูุงูุ ุงุตูู ููฺฏุงูโุณุงุฒ ู ูููโฺฏุฐุงุฑ ุชูุฒ ฺฉู ูโุชูุงูุฏ ุงุฒ ุขู ุฌููฺฏุฑ ฺฉูุฏ ุตุญุจุช ฺฉุฑุฏู. ุฏุฑุจุงุฑู ุงูฺฉู ฺฺฏููู Threadูุง ูโุชูุงููุฏ ุชูุงู ุนููุงุช ุณุณุชูโูุง I/O ูุญูุฑ ุฑุง ุงูุฒุงุด ุฏููุฏ ู ุชฺฉูฺฉโูุง ุชูุฒ ุจุฑุง ุฏุณุชุงุจ ุจู ุงู ุจูุจูุฏูุง ุตุญุจุช ฺฉุฑุฏู. ุฏุฑุจุงุฑู ุจูโุจุณุช ู ุงุตูู ูพุดฺฏุฑ ุงุฒ ุขู ุจู ุฑูุด ุชูุฒ ุจุญุซ ฺฉุฑุฏู. ุฏุฑ ููุงุชุ ุฏุฑุจุงุฑู ุงุณุชุฑุงุชฺโูุง ุขุดฺฉุงุฑ ฺฉุฑุฏู ูุดฺฉูุงุช ููโุฒูุงู ุจุง ุงุจุฒุงุฑุฏู ฺฉุฏ ุตุญุจุช ฺฉุฑุฏู.</p>
<hr>
<h3>ุขููุฒุด: ูุซุงูโูุง ฺฉุงูู ฺฉุฏ</h3>
<h4>ฺฉูุงูุช/ุณุฑูุฑ ุบุฑููโุฒูุงู (Nonthreaded)</h4>
<p><strong>ูุณุช A-3 โ Server.java</strong></p>
<pre class="hljs"><code><span class="hljs-keyword">package</span> com.objectmentor.clientserver.nonthreaded;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.net.ServerSocket;
<span class="hljs-keyword">import</span> java.net.Socket;
<span class="hljs-keyword">import</span> java.net.SocketException;
<span class="hljs-keyword">import</span> common.MessageUtils;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Server</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    ServerSocket serverSocket;
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">keepProcessing</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Server</span><span class="hljs-params">(<span class="hljs-type">int</span> port, <span class="hljs-type">int</span> millisecondsTimeout)</span> <span class="hljs-keyword">throws</span> IOException {
        serverSocket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerSocket</span>(port);
        serverSocket.setSoTimeout(millisecondsTimeout);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.printf(<span class="hljs-string">&quot;Server Starting\n&quot;</span>);
        <span class="hljs-keyword">while</span> (keepProcessing) {
            <span class="hljs-keyword">try</span> {
                System.out.printf(<span class="hljs-string">&quot;accepting client\n&quot;</span>);
                <span class="hljs-type">Socket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> serverSocket.accept();
                System.out.printf(<span class="hljs-string">&quot;got client\n&quot;</span>);
                process(socket);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                handle(e);
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Exception e)</span> {
        <span class="hljs-keyword">if</span> (!(e <span class="hljs-keyword">instanceof</span> SocketException)) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stopProcessing</span><span class="hljs-params">()</span> {
        keepProcessing = <span class="hljs-literal">false</span>;
        closeIgnoringException(serverSocket);
    }

    <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Socket socket)</span> {
        <span class="hljs-keyword">if</span> (socket == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">try</span> {
            System.out.printf(<span class="hljs-string">&quot;Server: getting message\n&quot;</span>);
            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> MessageUtils.getMessage(socket);
            System.out.printf(<span class="hljs-string">&quot;Server: got message: %s\n&quot;</span>, message);
            Thread.sleep(<span class="hljs-number">1000</span>);
            System.out.printf(<span class="hljs-string">&quot;Server: sending reply: %s\n&quot;</span>, message);
            MessageUtils.sendMessage(socket, <span class="hljs-string">&quot;Processed: &quot;</span> + message);
            System.out.printf(<span class="hljs-string">&quot;Server: sent\n&quot;</span>);
            closeIgnoringException(socket);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">closeIgnoringException</span><span class="hljs-params">(Socket socket)</span> {
        <span class="hljs-keyword">if</span> (socket != <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">try</span> {
                socket.close();
            } <span class="hljs-keyword">catch</span> (IOException ignore) {
            }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">closeIgnoringException</span><span class="hljs-params">(ServerSocket serverSocket)</span> {
        <span class="hljs-keyword">if</span> (serverSocket != <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">try</span> {
                serverSocket.close();
            } <span class="hljs-keyword">catch</span> (IOException ignore) {
            }
    }
}
</code></pre>
<hr>
<p><strong>ูุณุช A-4 โ ClientTest.java</strong><br>
(ุชูุถุญ: ฺฉุฏ ClientTest ุนููุงู ูุดุงุจู Server.java ุงุณุช ู ููุงู ุณุงุฎุชุงุฑ ุฑุง ุฏุงุฑุฏ.)</p>
<pre class="hljs"><code><span class="hljs-keyword">package</span> com.objectmentor.clientserver.nonthreaded;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.net.ServerSocket;
<span class="hljs-keyword">import</span> java.net.Socket;
<span class="hljs-keyword">import</span> java.net.SocketException;
<span class="hljs-keyword">import</span> common.MessageUtils;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Server</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    ServerSocket serverSocket;
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">keepProcessing</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Server</span><span class="hljs-params">(<span class="hljs-type">int</span> port, <span class="hljs-type">int</span> millisecondsTimeout)</span> <span class="hljs-keyword">throws</span> IOException {
        serverSocket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerSocket</span>(port);
        serverSocket.setSoTimeout(millisecondsTimeout);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.printf(<span class="hljs-string">&quot;Server Starting\n&quot;</span>);
        <span class="hljs-keyword">while</span> (keepProcessing) {
            <span class="hljs-keyword">try</span> {
                System.out.printf(<span class="hljs-string">&quot;accepting client\n&quot;</span>);
                <span class="hljs-type">Socket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> serverSocket.accept();
                System.out.printf(<span class="hljs-string">&quot;got client\n&quot;</span>);
                process(socket);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                handle(e);
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Exception e)</span> {
        <span class="hljs-keyword">if</span> (!(e <span class="hljs-keyword">instanceof</span> SocketException)) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stopProcessing</span><span class="hljs-params">()</span> {
        keepProcessing = <span class="hljs-literal">false</span>;
        closeIgnoringException(serverSocket);
    }

    <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Socket socket)</span> {
        <span class="hljs-keyword">if</span> (socket == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">try</span> {
            System.out.printf(<span class="hljs-string">&quot;Server: getting message\n&quot;</span>);
            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> MessageUtils.getMessage(socket);
            System.out.printf(<span class="hljs-string">&quot;Server: got message: %s\n&quot;</span>, message);
            Thread.sleep(<span class="hljs-number">1000</span>);
            System.out.printf(<span class="hljs-string">&quot;Server: sending reply: %s\n&quot;</span>, message);
            MessageUtils.sendMessage(socket, <span class="hljs-string">&quot;Processed: &quot;</span> + message);
            System.out.printf(<span class="hljs-string">&quot;Server: sent\n&quot;</span>);
            closeIgnoringException(socket);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">closeIgnoringException</span><span class="hljs-params">(Socket socket)</span> {
        <span class="hljs-keyword">if</span> (socket != <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">try</span> {
                socket.close();
            } <span class="hljs-keyword">catch</span> (IOException ignore) {
            }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">closeIgnoringException</span><span class="hljs-params">(ServerSocket serverSocket)</span> {
        <span class="hljs-keyword">if</span> (serverSocket != <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">try</span> {
                serverSocket.close();
            } <span class="hljs-keyword">catch</span> (IOException ignore) {
            }
    }
}
</code></pre>
<hr>
<p><strong>ูุณุช A-5 โ MessageUtils.java</strong></p>
<pre class="hljs"><code><span class="hljs-keyword">package</span> common;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.io.ObjectInputStream;
<span class="hljs-keyword">import</span> java.io.ObjectOutputStream;
<span class="hljs-keyword">import</span> java.io.OutputStream;
<span class="hljs-keyword">import</span> java.net.Socket;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageUtils</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(Socket socket, String message)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">OutputStream</span> <span class="hljs-variable">stream</span> <span class="hljs-operator">=</span> socket.getOutputStream();
        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(stream);
        oos.writeUTF(message);
        oos.flush();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getMessage</span><span class="hljs-params">(Socket socket)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">InputStream</span> <span class="hljs-variable">stream</span> <span class="hljs-operator">=</span> socket.getInputStream();
        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(stream);
        <span class="hljs-keyword">return</span> ois.readUTF();
    }
}
</code></pre>
<hr>
<h3>ฺฉูุงูุช/ุณุฑูุฑ ุจุง ุงุณุชูุงุฏู ุงุฒ Threads</h3>
<p>ุชุบุฑ ุณุฑูุฑ ุจุฑุง ุงุณุชูุงุฏู ุงุฒ threads ููุท ูุงุฒููุฏ ุชุบุฑ ุฏุฑ ูุชุฏ <strong>process</strong> ูพุงู ุงุณุช (ุฎุทูุท ุฌุฏุฏ ุจุฑุฌุณุชู ุดุฏูโุงูุฏ):</p>
<pre class="hljs"><code><span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Socket socket)</span> {
    <span class="hljs-keyword">if</span> (socket == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span>;

    <span class="hljs-type">Runnable</span> <span class="hljs-variable">clientHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">try</span> {
                System.out.printf(<span class="hljs-string">&quot;Server: getting message\n&quot;</span>);
                <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> MessageUtils.getMessage(socket);
                System.out.printf(<span class="hljs-string">&quot;Server: got message: %s\n&quot;</span>, message);
                Thread.sleep(<span class="hljs-number">1000</span>);
                System.out.printf(<span class="hljs-string">&quot;Server: sending reply: %s\n&quot;</span>, message);
                MessageUtils.sendMessage(socket, <span class="hljs-string">&quot;Processed: &quot;</span> + message);
                System.out.printf(<span class="hljs-string">&quot;Server: sent\n&quot;</span>);
                closeIgnoringException(socket);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                e.printStackTrace();
            }
        }
    };

    <span class="hljs-type">Thread</span> <span class="hljs-variable">clientConnection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(clientHandler);
    clientConnection.start();
}
</code></pre>
<p>ุฏุฑ ุงู ูุณุฎูุ ูุฑ ุงุชุตุงู ฺฉูุงูุช ุฏุฑ ฺฉ <strong>Thread ุฌุฏุงฺฏุงูู</strong> ุงุฌุฑุง ูโุดูุฏ ุชุง ุณุฑูุฑ ุจุชูุงูุฏ ููุฒูุงู ุจุง ฺูุฏู ฺฉูุงูุช ฺฉุงุฑ ฺฉูุฏ.</p>

</main>


 

  <!-- ููุชุฑ ูุดุชุฑฺฉ -->
  <footer class="footer">
    <div class="container">
      <p>
        <img src="/icone/copyright.svg" alt="ฺฉูพโุฑุงุช" width="14" height="14"
             style="vertical-align:middle;margin-inline:4px">
        <span id="y"></span> Gitab โ ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู
      </p>
    </div>
  </footer>

  <!-- ุณุงู + ุงุณฺฉุฑูพุช ุชู -->
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    (() => {
      const root = document.documentElement;
      const btn = document.getElementById('themeToggle');
      const KEY = 'gitab-theme';
      const media = window.matchMedia('(prefers-color-scheme: dark)');
      const getEffective = s => s === 'auto' ? (media.matches ? 'dark' : 'light') : s;
      function updateTheme(s) {
        root.setAttribute('data-theme', s);
        const mode = getEffective(s);
        root.dataset.colorMode = mode;
        btn.dataset.icon = mode === 'dark' ? 'moon' : 'sun';
      }
      const saved = localStorage.getItem(KEY) || 'auto';
      updateTheme(saved);
      btn.addEventListener('click', () => {
        const curr = localStorage.getItem(KEY) || 'auto';
        const next = curr === 'auto' ? 'dark' : curr === 'dark' ? 'light' : 'auto';
        localStorage.setItem(KEY, next);
        updateTheme(next);
      });
      media.addEventListener('change', () => {
        if ((localStorage.getItem(KEY) || 'auto') === 'auto') updateTheme('auto');
      });
      window.addEventListener('DOMContentLoaded', () => updateTheme(saved));
    })();
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<script>
document.querySelectorAll('pre code').forEach(block => {
  const btn = document.createElement('button');
  btn.className = 'copy-btn';

  const icon = document.createElement('img');
  icon.src = '/icone/copy.svg';
  icon.alt = 'Copy';
  btn.appendChild(icon);

  block.parentNode.insertBefore(btn, block);

  btn.addEventListener('click', async () => {
    await navigator.clipboard.writeText(block.textContent);
    btn.classList.add('copied');
    setTimeout(() => btn.classList.remove('copied'), 1500);
  });
});
</script>
<script>
  document.body.dataset.page = window.location.pathname;
</script>
<script>
  // ุจุงุฒ ู ุจุณุชู ฺฉุฑุฏู ููู ููุจุงู
  const menuBtn = document.querySelector(".menu-toggle");
  const nav = document.querySelector(".nav");

  if (menuBtn && nav) {
    // ุจุงุฒ ู ุจุณุชู ุดุฏู ุจุง ุฏฺฉูู
    menuBtn.addEventListener("click", (e) => {
      e.stopPropagation(); // ูุฐุงุฑู ฺฉูฺฉ ุฑู ุฎูุฏ ุฏฺฉูู ุจุงุนุซ ุจุณุชู ุดุฏู ุจุดู
      nav.classList.toggle("show");
    });

    // ุจุณุชู ููู ุจุง ฺฉูฺฉ ุจุฑูู
    document.addEventListener("click", (e) => {
      const clickedInsideNav = nav.contains(e.target);
      const clickedMenuButton = menuBtn.contains(e.target);
      if (!clickedInsideNav && !clickedMenuButton) {
        nav.classList.remove("show");
      }
    });
  }
</script>



</body>

</html>
