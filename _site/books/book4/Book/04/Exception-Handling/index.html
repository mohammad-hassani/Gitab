<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Exception Handling</title>
  <meta name="description" content="ุชุฑุฌููโูุง ูุงุฑุณ ฺฉุชุงุจโูุง ูู โ ุณุฑุนุ ูููุงู ู ูุงุจู ุงุชฺฉุง.">
  <link rel="stylesheet" href="/styles/main.css">
<link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<style>
@font-face {
  font-family: 'Vazir';
  src: url('/fonts/Vazir-FD-WOL.ttf') format('truetype');
  font-display: swap;
}
body {
  font-family: 'Vazir', sans-serif;
}
</style>

</head>
<body>
  <!-- ูุฏุฑ ูุดุชุฑฺฉ -->
 <header class="header">
  <div class="container nav-wrap">
    <a href="/" class="brand">
      <img src="/icone/logo.svg" alt="Gitab logo" width="26" height="26">
      <span>Gitab</span>
    </a>

    <nav class="nav">
      <a href="/" aria-current="page">ุฎุงูู</a>
      <a href="/books/list-books">ฺฉุชุงุจโูุง</a>
      <a href="#">ูุชุฑุฌูู</a>
      <a href="#">ููฺฉุงุฑ</a>
      <a href="#">ุฏุฑุจุงุฑู ูุง</a>
    </nav>

    <div class="nav-actions">
     <button id="themeToggle" class="icon-btn theme-btn" data-icon="moon" aria-label="ุชุบุฑ ุชู">
        <img src="/icone/sun.svg" class="icon-sun" alt="ุฑูุดู">
        <img src="/icone/moon.svg" class="icon-moon" alt="ุชุงุฑฺฉ">
      </button>
  <a class="icon-btn" href="https://github.com/hheydarian/Gitab" target="_blank" title="GitHub">
    <img src="/icone/github.svg" alt="GitHub">
  </a>
      <!-- ุฏฺฉูู ููู ุจุฑุง ููุจุงู -->
      <button class="menu-toggle" aria-label=" ููู">
        <img src="/icone/menu.svg" alt="menu">
      </button>
    </div>
  </div> 
  

</header>

 

<main class="site-main book-page ">
  <h1>ูุตู ฺูุงุฑู: ูุฏุฑุช ุงุณุชุซูุงูุง (Exception Handling) โ๏ธ</h1>
<p>ุชุนุฌุจ ูุฏุงุฑุฏ ฺฉู ูุธุงู (tasks) ููฺฉู ุงุณุช ุจุง <strong>ุงุณุชุซูุงูุง (exceptions)</strong> ููุงุฌู ุดููุฏ. ููฺูู ุฏุฑุณุช ุงุณุช ฺฉู <strong>ูุธุงู ูุฎุชูู ููฺฉู ุงุณุช ุงุณุชุซูุงูุง ูุชูุงูุช</strong> ุงุฌุงุฏ ฺฉููุฏ. ุฏุฑ ฺฉ ูุญุท <strong>ฺูุฏูุฎ (multithreaded)</strong>ุ ูุฏุฑุช ุงู ุงุณุชุซูุงูุง ูู ูโุชูุงูุฏ <strong>ูพฺุฏู ู ฺุงูุดโุจุฑุงูฺฏุฒ</strong> ุจุงุดุฏ.</p>
<p>ุจุฑูุงูู ุดูุง ุจุงุฏ ุจู ุขูโูุง ุจูโุทูุฑ <strong>ููุงู ู ฺฉูุชุฑูโุดุฏู</strong> ูพุงุณุฎ ุฏูุฏ ุชุง ุงุฒ <strong>ฺฉุฑุดโูุง ูุงุฎูุงุณุชู</strong> ุฌููฺฏุฑ ฺฉุฑุฏู ู <strong>ูพุงุฏุงุฑ</strong> ุฎูุฏ ุฑุง ุญูุธ ฺฉูุฏ. ุจู ููู ุฏููุ <strong>ูุฏุฑุช ุงุณุชุซูุงูุง ุจุฑุง ุณุงุฎุช ุจุฑูุงููโูุง ูุงุจู ุงุนุชูุงุฏ ู ููุงูู ุถุฑูุฑ ุงุณุช</strong>. ุงู ูุตู ุจุฑ ุฑู ุงู ููุถูุน ุชูุฑฺฉุฒ ุฏุงุฑุฏ.</p>
<hr>
<h3>ุฏุฑฺฉ ฺุงูุด ๐งฉ</h3>
<p>ุงุฒ ุขูุฌุง ฺฉู ุดูุง ุฏุฑ ุญุงู ูุทุงูุนู ููุงูู ูพุดุฑูุชู ุจุฑูุงููโููุณ ูุณุชุฏุ ูุฑุถ ูโฺฉูู ุจุง <strong>ูุจุงู ุงุณุชุซูุงูุง ู ูุญูู ูุฏุฑุช ุขูโูุง ุฏุฑ ุจุฑูุงููโูุง C#</strong> ุขุดูุง ูุณุชุฏ. ุจูุงุจุฑุงูุ ุฏุฑ ุงู ฺฉุชุงุจ ุจู <strong>ูุจุงุญุซ ูพุงูโุง ูพุฑุฏุงุฎุชู ููโุดูุฏ</strong>. ุชูุฑฺฉุฒ ูุง ุจุฑ ุฑู <strong>ุณูุงุฑููุง ุงุณุชุซูุง ุงุญุชูุงู</strong> ุงุณุช ฺฉู ููฺฏุงู ุจุฑูุงููโููุณ ูุธููโุง ุฏุฑ ูุญุท ฺูุฏูุฎ ููฺฉู ุงุณุช ุฑุฎ ุฏูุฏ.</p>
<hr>
<h3>ุจุฑูุงููโุง ฺฉู ุงุณุชุซูุง ุฑุง ูุดุงู ููโุฏูุฏ ๐ซ</h3>
<p>ุงฺฏุฑ ุนูุงุฆู ูุงุถุญ ุจุงุดูุฏุ ูพุฒุดฺฉ ูโุชูุงูุฏ <strong>ูุดฺฉู ุจูุงุฑ ุฑุง ุจู ุฑุงุญุช ุชุดุฎุต ุฏูุฏ</strong>. ุงูุง ูุดฺฉูุงุช <strong>ูุดุงูุฏูโูุดุฏู</strong> ุจู ุณุฎุช ุดูุงุณุง ูโุดููุฏ.</p>
<p>ููู ููุถูุน ุฏุฑ ุจุฑูุงููโููุณ ูุฒ ุตุงุฏู ุงุณุช: <strong>ฺฉ ุงุณุชุซูุง ูุดุงูุฏูโูุดุฏู ูโุชูุงูุฏ ูุดฺฉูุงุช ุฒุงุฏ ุงุฌุงุฏ ฺฉูุฏ</strong>.</p>
<p>ุจุฑุง ูุซุงูุ ุจุฑูุงูู ุฒุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ ฺฉู <strong>ูุฎ ุงุตู (main thread)</strong> ฺฉ ูุธูู ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู <strong>ุงุณุชุซูุง ุงุฌุงุฏ ูโฺฉูุฏุ ุงูุง ุฏุฑ ุฎุฑูุฌ ููุงุด ุฏุงุฏู ููโุดูุฏ</strong>.</p>
<p>๐ ุชูุฌู: ุจุณุชู ุจู ุชูุธูุงุช <strong>Visual Studio</strong> ุดูุงุ ููฺฉู ุงุณุช ุฎุท ฺฉู ุงุณุชุซูุง ุงุฌุงุฏ ูโฺฉูุฏุ <strong>ูุงูุงุช ุดูุฏ</strong>. ุจุง ุงู ุญุงูุ ุงฺฏุฑ ุงุฏุงูู ุงุฌุฑุง ุจุฑูุงูู ุฑุง ุจุง <strong>F5 ุง ุฏฺฉูู Continue</strong> ุงูุฌุงู ุฏูุฏุ ูฺ ุงุทูุงุนุงุช ุฏุฑุจุงุฑู ุงู ุงุณุชุซูุง ุฏุฑ ุฎุฑูุฌ ูุดุงูุฏู ูุฎูุงูุฏ ฺฉุฑุฏ.</p>
<div align="center">
<p><img src="../../../assets/image/04/Table%204-1.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>ุงฺฏุฑ ุดูุง ฺฉุงุฑุจุฑ <strong>Visual Studio</strong> ูุณุชุฏ ู ุจุฑูุงููโูุง ูโููุณุฏ ฺฉู ุจุง <strong>ฺูุฏู ุฏุฑุฎูุงุณุช ูุบู (cancellation)</strong> ุณุฑ ู ฺฉุงุฑ ุฏุงุฑูุฏุ ูุงุฒู ุงุณุช ูฺฉุชู ุฒุฑ ุงุฒ ูุงฺฉุฑูุณุงูุช ุฑุง ุจู ุงุฏ ุฏุงุดุชู ุจุงุดุฏ (ููุจุน: <a href="https://learn.microsoft.com/en-us/dotnet/standard/threading/how-to-listen-for-multiple-cancellation-requests">Microsoft Docs</a>):</p>
<blockquote>
<p>ุฒูุงู ฺฉู ฺฏุฒูู <strong>โJust My Codeโ</strong> ูุนุงู ุงุณุชุ ุฏุฑ ุจุฑุฎ ููุงุฑุฏ Visual Studio ุฑู ุฎุท ฺฉู <strong>ุงุณุชุซูุง ุงุฌุงุฏ ูโฺฉูุฏ</strong> ูุชููู ูโุดูุฏ ู ูพุบุงู ุฎุทุง ููุงุด ูโุฏูุฏ ฺฉู ูโฺฏูุฏ:<br>
โexception not handled by user code.โ<br>
ุงู ุฎุทุง <strong>ุถุฑุฑ ูุฏุงุฑุฏ</strong> ู ูโุชูุงูุฏ ุจุง ูุดุฑุฏู <strong>F5</strong> ุงุฏุงูู ุฏูุฏ.<br>
ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชููู Visual Studio ุฑู ุงููู ุฎุทุงุ ฺฉุงู ุงุณุช ฺฏุฒูู <strong>โJust My Codeโ</strong> ุฑุง ุงุฒ ูุณุฑ <strong>Tools โ Options โ Debugging โ General</strong> ุบุฑูุนุงู ฺฉูุฏ.</p>
</blockquote>
<hr>
<h3>ูุซุงู ุนูู ฑ ๐ฅ๏ธ</h3>
<p>ุจุงุฏ ุจุฑูุงูู ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูู:</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;

WriteLine(<span class="hljs-string">&quot;The main thread starts executing.&quot;</span>);

<span class="hljs-keyword">try</span>
{
    <span class="hljs-keyword">var</span> validateUserTask = Task.Run(() =&gt;
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnauthorizedAccessException(<span class="hljs-string">&quot;Unauthorized user.&quot;</span>)
    );
}
<span class="hljs-keyword">catch</span> (Exception e)
{
    WriteLine(<span class="hljs-string">$&quot;Caught error: <span class="hljs-subst">{e.Message}</span>&quot;</span>);
}

WriteLine(<span class="hljs-string">&quot;End of the program.&quot;</span>);
</code></pre>
<h4>ุฎุฑูุฌ</h4>
<p>ุจุง ุงุฌุฑุง ุงู ุจุฑูุงููุ ุฎุฑูุฌ ุฒุฑ ูุดุงูุฏู ูโุดูุฏ:</p>
<pre class="hljs"><code>The main thread starts executing.
End of the program.
</code></pre>
<p>๐น ูฺฉุชู: ุฎุฑูุฌ ูฺ ุงุทูุงุนุงุช ุฏุฑุจุงุฑู <strong>ุงุณุชุซูุง</strong> ูุดุงู ููโุฏูุฏ. ฺุฑุงุ<br>
ุฒุฑุง ุฏุฑ ุงู ุจุฑูุงููุ <strong>ูุฎ ุงุตู (main thread)</strong> ุจุง ุงุณุชุซูุง ููุงุฌู ูุดุฏุ ุจูฺฉู ุงู ุงุณุชุซูุง ุชูุณุท <strong>validateUserTask</strong> ฺฉู ุชูุณุท ูุฎ ุงุตู ุงุฌุงุฏ ุดุฏู ุจูุฏุ ุฑุฎ ุฏุงุฏู ุงุณุช.</p>
<p>ฺูู ุงุณุชุซูุงูุง <strong>ูุดุงูุฏูโูุดุฏู (unobserved)</strong> ูโุชูุงููุฏ ุฏุฑ ูุฑุงุญู ุจุนุฏ ูุดฺฉู ุงุฌุงุฏ ฺฉููุฏุ ุจูุชุฑ ุงุณุช ุขูโูุง ุฑุง ูุดุงูุฏู ู <strong>ูุฏุฑุช</strong> ฺฉูู.</p>
<hr>
<h3>ูุนุฑู AggregateException โก</h3>
<p>ฺุทูุฑ ูโุชูุงู ุงุทูุงุนุงุช ูุฑุจูุท ุจู ุงุณุชุซูุง ุฑุง ุจู ุฏุณุช ุขูุฑุฏุ<br>
ฺฉ ุฑูุด ูุงุถุญุ <strong>ูุฏุฑุช ุงุณุชุซูุง ุฏุฑ ุฏุงุฎู ููุงู Task</strong> ุงุณุช. ูุซุงู:</p>
<pre class="hljs"><code><span class="hljs-keyword">var</span> validateUserTask = Task.Run(() =&gt;
{
    <span class="hljs-built_in">string</span> msg = <span class="hljs-built_in">string</span>.Empty;
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnauthorizedAccessException(<span class="hljs-string">&quot;Unauthorized user.&quot;</span>);
    }
    <span class="hljs-keyword">catch</span> (Exception e)
    {
        WriteLine(<span class="hljs-string">$&quot;Caught error inside the task: <span class="hljs-subst">{e.Message}</span>&quot;</span>);
    }
    <span class="hljs-keyword">return</span> msg;
});
</code></pre>
<p>ุงูุง ุงฺฏุฑ <strong>Task ุงุณุชุซูุงูุง ุฑุง ูุฏุฑุช ูฺฉูุฏ</strong>ุ ฺฺฏููู ูโุชูุงู ุฌุฒุฆุงุช ุฎุทุง ุฑุง ุฏุฑุงูุช ฺฉุฑุฏุ</p>
<hr>
<h3>ูุซุงู ุนูู ฒ ๐</h3>
<p>ุฏุฑ <strong>ุจุฑูุงููโููุณ ูุจุชู ุจุฑ Task</strong>ุ ุงุณุชุซูุงูุง <strong>ุฏุฑูู ุดุก Task ุฐุฎุฑู ูโุดููุฏ</strong> ู <strong>ุจู ูุญุถ ูููุนุ ูพุฑุชุงุจ ููโุดููุฏ</strong>.</p>
<p>ุงฺฏุฑ ุงุณุชุซูุง ุฏุฑ ุฏุงุฎู ฺฉ Task ุฑุฎ ุฏูุฏุ ุฏุฑูู ฺฉ <strong>AggregateException</strong> ูุฑุงุฑ ูโฺฏุฑุฏ ฺฉู ุดุงูู <strong>ุชูุงู ุงุณุชุซูุงูุง ุงุณุช ฺฉู ุท ุงุฌุฑุง ุขู Task ุงุฌุงุฏ ุดุฏูโุงูุฏ</strong>.<br>
ุงู ูฺฺฏ ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุชุง ุงุณุชุซูุงูุง ุฑุง <strong>ุจูโุตูุฑุช ุฌูุน ุง ุฌุฏุงฺฏุงูู ูุฏุฑุช ฺฉูุฏ</strong>.</p>
<div align="center">
<p><img src="../../../assets/image/04/Table%204-2.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>โ๏ธ <strong>ูฺฉุชู ููู</strong></p>
<p>ฺฉูุงุณ <strong>AggregateException</strong> ุจู <strong>namespace System</strong> ุชุนูู ุฏุงุฑุฏ ู ุงุฒ ฺฉูุงุณ <strong>Exception</strong> ุงุฑุซโุจุฑ ูโฺฉูุฏ.</p>
<p>AggregateException ูโุชูุงูุฏ ุฏุฑ ูุฑ ฺฉ ุงุฒ ุณูุงุฑููุง ุฒุฑ ูพุฑุชุงุจ ุดูุฏ:<br>
โข ููุช ฺฉู ุดูุง ุณุน ูโฺฉูุฏ <strong>ูุชุฌู ฺฉ Task</strong> ุฑุง ุฏุฑุงูุช ฺฉูุฏ.<br>
โข ููุช ฺฉู ุจูโุทูุฑ ุตุฑุญ ูุชุฏ <strong>Wait</strong> ุฑุง ุฑู Task ูุฑุงุฎูุงู ูโฺฉูุฏ.<br>
โข ููุช ฺฉู Task ุฑุง ุจุง <strong>await</strong> ุงุฌุฑุง ูโฺฉูุฏ (ุงุฒ ุขูโุฌุง ฺฉู ุงู ฺฉุชุงุจ ุจู <strong>async/await</strong> ููโูพุฑุฏุงุฒุฏุ ูุนูุงู ุขู ุฑุง ุจุฑุฑุณ ููโฺฉูู).</p>
<p>ุงฺฉููู ูุชูุฌู ูุณุชุฏ ฺฉู ุฏุฑ ูุซุงู ูุจูุ ุงฺฏุฑ ฺฉ ุงุฒ ุฎุทูุท ุฒุฑ ุฑุง ุฏุงุฎู <strong>try block</strong> ุงุณุชูุงุฏู ฺฉูุฏุ ูโุชูุงูุฏ ุงุณุชุซูุง ุฑุง ูุดุงูุฏู ฺฉูุฏ:</p>
<pre class="hljs"><code>WriteLine(validateUserTask.Result);
</code></pre>
<p>ุง</p>
<pre class="hljs"><code>validateUserTask.Wait();
</code></pre>
<hr>
<h3>ูุซุงู ุนูู ๐ฅ๏ธ</h3>
<p>ุฏุฑ ุงู ูููููุ ุงุฒ ุฏุณุชูุฑ <strong>validateUserTask.Wait();</strong> ุฏุงุฎู try block ุงุณุชูุงุฏู ุดุฏู ุงุณุช (ุชุบุฑุงุช ุจุง <strong>bold</strong> ูุดุฎุต ุดุฏูโุงูุฏ):</p>
<pre class="hljs"><code><span class="hljs-comment">// ฺฉุฏ ูุจู ุจุฏูู ุชุบุฑ</span>
<span class="hljs-keyword">try</span>
{
    <span class="hljs-keyword">var</span> validateUserTask = Task.Run(() =&gt;
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnauthorizedAccessException(<span class="hljs-string">&quot;Unauthorized user.&quot;</span>)
    );
    validateUserTask.Wait(); <span class="hljs-comment">// ูุดุงูุฏู ุงุณุชุซูุง</span>
}
<span class="hljs-comment">// ุจูู ฺฉุฏ ุจุฏูู ุชุบุฑ</span>
</code></pre>
<h4>ุฎุฑูุฌ</h4>
<p>ุจุง ุงุฌุฑุง ูุฌุฏุฏ ุจุฑูุงููุ ุฎุฑูุฌ ุฒุฑ ูุดุงูุฏู ูโุดูุฏ:</p>
<pre class="hljs"><code>The main thread starts executing.
Caught error: One or more errors occurred. (Unauthorized user.)
End of the program.
</code></pre>
<p>๐น ูฺฉุชู: ุญุงูุง ุฎุทุง ููุงุด ุฏุงุฏู ูโุดูุฏุ ุงูุง ุงุทูุงุนุงุช ุฎุทุง <strong>โUnauthorized user.โ</strong> ุจูโุนููุงู ฺฉ <strong>InnerException</strong> ุฏุฑ AggregateException ุจุณุชูโุจูุฏ ุดุฏู ุงุณุช.</p>
<hr>
<h3>ุฌูุณู ูพุฑุณุด ู ูพุงุณุฎ โ</h3>
<p><strong>Q4.1</strong> ฺุฑุง ุงุทูุงุนุงุช ุฎุทุง โUnauthorized user.โ ุจูโุตูุฑุช InnerException ููุงุด ุฏุงุฏู ุดุฏุ</p>
<p>ุงู ุจุฑูุงูู ฺฉ <strong>AggregateException</strong> ุฑุง ฺฏุฑูุชู ุงุณุชุ ฺฉู ุจุฑุง <strong>ุชุฌูุน ฺูุฏู ุฎุทุง</strong> ุฏุฑ ฺฉ ุดุก ุงุณุชุซูุง ูุงุจู ูพุฑุชุงุจ ุงุณุชูุงุฏู ูโุดูุฏ. ฺูู ุงุณุชุซูุง ุฏุฑ <strong>ุจุฑูุงููโููุณ ูุจุชู ุจุฑ Task</strong> ุจุณุงุฑ ุฑุงุฌ ุงุณุช.</p>
<p>ุจุฑุง ุจุฑุฑุณุ ูโุชูุงูุฏ <strong>catch block</strong> ุฑุง ุจู ุดฺฉู ุฒุฑ ุชุบุฑ ุฏูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">catch</span> (Exception e)
{
    WriteLine(<span class="hljs-string">$&quot;Caught error: <span class="hljs-subst">{e.Message}</span>&quot;</span>);
    WriteLine(<span class="hljs-string">$&quot;Exception name: <span class="hljs-subst">{e.GetType().Name}</span>&quot;</span>);
}
</code></pre>
<p>ุจุง ุงุฌุฑุง ูุฌุฏุฏ ุจุฑูุงููุ ุฎุฑูุฌ ุจู ุตูุฑุช ุฒุฑ ุฎูุงูุฏ ุจูุฏ:</p>
<pre class="hljs"><code>The main thread starts executing.
Caught error: One or more errors occurred. (Unauthorized user.)
Exception name: AggregateException
End of the program.
</code></pre>
<p>๐ ููุงูโุทูุฑ ฺฉู ูุดุงูุฏู ูโฺฉูุฏุ ุจุฑูุงูู ฺฉ <strong>AggregateException</strong> ุฑุง ฺฏุฑูุชู ุงุณุช.<br>
ูุทุงุจู ูุณุชูุฏุงุช ุฑุณู ูุงฺฉุฑูุณุงูุช:</p>
<blockquote>
<p>ุจุฑุง ุจุงุฒฺฏุฑุฏุงูุฏู ุชูุงู ุงุณุชุซูุงูุง ุจู ูุฎ ูุฑุงุฎูุงูุ ุฒุฑุณุงุฎุช Task ุขูโูุง ุฑุง ุฏุฑ ฺฉ ููููู AggregateException ุจุณุชูโุจูุฏ ูโฺฉูุฏ.<br>
ุฎุงุตุช <strong>InnerExceptions</strong> ุงู ฺฉูุงุณ ุงูฺฉุงู ุดูุงุฑุด ู ุจุฑุฑุณ ููู ุงุณุชุซูุงูุง ุงุตู ุฑุง ูุฑุงูู ูโฺฉูุฏุ ุชุง ุจุชูุงูุฏ ูุฑ ฺฉุฏุงู ุฑุง ุจูโุตูุฑุช ุฌุฏุงฺฏุงูู ูุฏุฑุช (ุง ูุงุฏุฏู) ฺฉูุฏ.</p>
</blockquote>
<p>ุจูุงุจุฑุงูุ ููุงูโุทูุฑ ฺฉู ุฏุฑ ุฎุฑูุฌ ูุจู ูุดุงูุฏู ุดุฏุ ุฎุทุง ูุงูุน <strong>Unauthorized user.</strong> ุจูโุนููุงู ฺฉ <strong>InnerException</strong> ุจุณุชูโุจูุฏ ุดุฏู ุจูุฏ.</p>
<div align="center">
<p><img src="../../../assets/image/04/Table%204-3.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>โ๏ธ <strong>ูฺฉุชู ููู</strong></p>
<p>ุงุฒ ุขูโุฌุง ฺฉู <strong>AggregateException</strong> ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ฺูุฏู ุฎุทุง ุง ุดฺฉุณุช ุฑุง ุฏุฑ ูุญุทโูุง ููโุฒูุงู ุชุฌูุน ฺฉูุฏุ ุฏุฑ <strong>ุจุฑูุงููโููุณ ูุจุชู ุจุฑ Task</strong> ุจุณุงุฑ ูพุฑฺฉุงุฑุจุฑุฏ ุงุณุช. ุงุฒ ุงู ูพุณุ ูู ูููุงุฑู ุงุฒ <strong>AggregateException</strong> ุฏุงุฎู ุจููฺฉโูุง <strong>catch</strong> ุงุณุชูุงุฏู ุฎูุงูู ฺฉุฑุฏ.</p>
<hr>
<h3>ุงุณุชุฑุงุชฺโูุง ูุฏุฑุช ุงุณุชุซูุงูุง ๐๏ธ</h3>
<p>ุชุง ุงู ูุฑุญููุ ููุท ฺฉ ุงุณุชุซูุง ุฑุง ูุฏุฑุช ฺฉุฑุฏูโุงู. ุจุฏู ุงุณุช ฺฉู ุจุฑูุงูู ุดูุง ุจุง ฺูุฏู Task ูุฎุชูู ุณุฑูฺฉุงุฑ ุฎูุงูุฏ ุฏุงุดุช ู ูุฑฺฉุฏุงู ููฺฉู ุงุณุช ุงุณุชุซูุง ูุชูุงูุช ูพุฑุชุงุจ ฺฉููุฏ. ุจูุงุจุฑุงูุ ุจุงุฏ ุฑู ูุญูู ูุฏุฑุช ุงุณุชุซูุงูุง ุชูุฑฺฉุฒ ฺฉูู ฺฉู ูโุชูุงููุฏ ุชูุณุท ฺฉ ุง ฺูุฏ Task ุงุฌุงุฏ ุดููุฏ.</p>
<p>ูพุด ุงุฒ ุดุฑูุนุ ูุงุฒู ุงุณุช ุจุฏุงูุฏ ฺฉู <strong>ูุฏูโูุง ุจุฑูุงููโููุณ ูุฎุชูู</strong> ุงุณุชุฑุงุชฺโูุง ูุชูุงูุช ุจุฑุง ูุฏุฑุช ุงุณุชุซูุง ุฏุงุฑูุฏ.<br>
ุจู ุนููุงู ูุซุงู:</p>
<ul>
<li>ุฏุฑ <strong>Object-Oriented Programming (OOP)</strong> ูุนูููุงู ุงุฒ ุจููฺฉโูุง <strong>try, catch, finally</strong> ุงุณุชูุงุฏู ูโฺฉูู.</li>
<li>ุงูุง ุฏุฑ <strong>Functional Programming (FP)</strong> ฺูู ุจููฺฉโูุง ูุนูููุงู ูุฌูุฏ ูุฏุงุฑูุฏ.</li>
</ul>
<p>ุฏุฑ ุงูุฌุง ุชูุฑฺฉุฒ ูุง ุฑู OOP ุฎูุงูุฏ ุจูุฏ ู ุงุณุชุฑุงุชฺโูุง ุฑุง ุฏุฑ ุฏู ุฏุณุชู ุณุงุฏู ูโฺฉูู:<br>
โข ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ฺฉ ูฺฉุงู ๐<br>
โข ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ฺูุฏ ูฺฉุงู ๐ข</p>
<hr>
<h3>ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ฺฉ ูฺฉุงู ๐</h3>
<p>ุจุงุฏ ุจุง ุงููู ุฏุณุชู ุดุฑูุน ฺฉููุ ุนู <strong>ฺฺฏููฺฏ ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ฺฉ ููุทู ูุงุญุฏ</strong>.</p>
<h4>ูุซุงู ุนูู โ Demonstration 3 ๐ฅ๏ธ</h4>
<p>ุงู ุจุฑูุงูู ุฏู Task ูุฎุชูู ุฑุง ุฏุงุฎู Thread ุงุตู ุงุฌุงุฏ ูโฺฉูุฏ ู ูุฑ ฺฉุฏุงู ฺฉ ุงุณุชุซูุง ูพุฑุชุงุจ ูโฺฉููุฏ. ุฏุฑ ุงูุฌุง ุจุง ูพูุงุด <strong>InnerExceptions</strong>ุ ุฌุฒุฆุงุช ุฎุทุง ููุงุด ุฏุงุฏู ูโุดูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
WriteLine(<span class="hljs-string">&quot;Exception handling demo.&quot;</span>);

<span class="hljs-keyword">try</span>
{
    <span class="hljs-keyword">var</span> validateUserTask = Task.Run(
        () =&gt;
        {
            <span class="hljs-comment">// ฺฉุฏ Task ุงูู</span>
        }
    );
    <span class="hljs-comment">// ุณุงุฑ ฺฉุฏูุงุ ุฏุฑ ุตูุฑุช ูุฌูุฏ</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnauthorizedAccessException(<span class="hljs-string">&quot;Unauthorized user.&quot;</span>);

    <span class="hljs-keyword">var</span> storeDataTask = Task.Run(
        () =&gt;
        {
            <span class="hljs-comment">// ฺฉุฏ Task ุฏูู</span>
        }
    );
    <span class="hljs-comment">// ุณุงุฑ ฺฉุฏูุงุ ุฏุฑ ุตูุฑุช ูุฌูุฏ</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InsufficientMemoryException(<span class="hljs-string">&quot;Insufficient memory.&quot;</span>);

    Task.WaitAll(validateUserTask, storeDataTask);
}
<span class="hljs-keyword">catch</span> (AggregateException ae)
{
    <span class="hljs-keyword">foreach</span> (Exception e <span class="hljs-keyword">in</span> ae.InnerExceptions)
    {
        WriteLine(<span class="hljs-string">$&quot;Caught error: <span class="hljs-subst">{e.Message}</span>&quot;</span>);
    }
}
</code></pre>
<h4>ุฎุฑูุฌ ููููู</h4>
<pre class="hljs"><code>Exception handling demo.
Caught error: Unauthorized user.
Caught error: Insufficient memory.
</code></pre>
<p>ุงู ฺฉ ุฑูุด ุจุณุงุฑ ุฑุงุฌ ุจุฑุง ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ <strong>ุจุฑูุงููโููุณ ูุจุชู ุจุฑ Task</strong> ุงุณุช.</p>
<hr>
<h3>ุฑูุด ุฌุงฺฏุฒู ฑ ๐</h3>
<p>ุจู ุจููฺฉ <strong>catch</strong> ุฏุฑ ูุซุงู ูุจู ุชูุฌู ฺฉูุฏ. ุฏุฑ ุขู ุงุฒ <strong>ae.InnerExceptions</strong> ุจุฑุง ููุงุด ุฎุทุงูุง ุงุณุชูุงุฏู ุดุฏ.<br>
ุฏุฑ ุฑูุด ุฌุงฺฏุฒูุ ุงุจุชุฏุง <strong>InnerExceptions</strong> ุฑุง <strong>Flatten</strong> ูโฺฉูู ู ุณูพุณ ุงุณุชุซูุงูุง ุฑุง ูพูุงุด ูโฺฉูู:</p>
<pre class="hljs"><code><span class="hljs-keyword">catch</span> (AggregateException ae)
{
    <span class="hljs-comment">// ุฑูุด ุฌุงฺฏุฒู ฑ</span>
    <span class="hljs-keyword">var</span> exceptions = ae.Flatten().InnerExceptions;
    <span class="hljs-keyword">foreach</span> (Exception e <span class="hljs-keyword">in</span> exceptions)
    {
        WriteLine(<span class="hljs-string">$&quot;Caught error: <span class="hljs-subst">{e.Message}</span>&quot;</span>);
    }
}
</code></pre>
<p>ุงู ุฑูุด ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุชุง <strong>ุงุณุชุซูุงูุง ุชู ุฏุฑ ุชู</strong> ุฑุง ุจู ุตูุฑุช ฺฉ ูุณุช ูุณุทุญ ุจุฑุฑุณ ฺฉูุฏ ู ุจู ุฑุงุญุช ูุฏุฑุช ููุงุฏ.</p>
<h3>ุฑูุด ุฌุงฺฏุฒู ฒ ๐</h3>
<p>ุฏุฑ ฺฉูุงุณ <strong>AggregateException</strong> ูุชุฏ ุจู ูุงู <strong>Handle</strong> ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุดฺฉู ุขู ุจู ุตูุฑุช ุฒุฑ ุงุณุช:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Handle</span>(<span class="hljs-params">Func&lt;Exception, <span class="hljs-built_in">bool</span>&gt; predicate</span>)</span>
{
    <span class="hljs-comment">// ุจุฏูู ูุชุฏ ููุงุด ุฏุงุฏู ูุดุฏู ุงุณุช</span>
}
</code></pre>
<p>ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ูุชุฏุ ูโุชูุงูุฏ ฺฉ <strong>Handler</strong> ุจุฑุง ูุฑ ุงุณุชุซูุง ููุฌูุฏ ุฏุฑ <strong>AggregateException</strong> ูุฑุงุฎูุงู ฺฉูุฏ.<br>
ุจุฑุง ูุซุงูุ ุจุงุฏ ุจููฺฉ <strong>catch</strong> ุฏุฑ <strong>Demonstration 3</strong> ุฑุง ุจู ุดฺฉู ุฒุฑ ุจุงุฒููุณ ฺฉูู (ุฑูุดโูุง ูุจู ุฏุงุฎู ฺฉุงููุช ุจุฑุง ูุฑุฌุน ุณุฑุน ุดูุง ุจุงู ูุงูุฏูโุงูุฏ):</p>
<pre class="hljs"><code><span class="hljs-keyword">catch</span> (AggregateException ae)
{
    <span class="hljs-comment"><span class="hljs-doctag">///</span>/ ุฑูุด ุงููู</span>
    <span class="hljs-comment">//foreach (Exception e in ae.InnerExceptions)</span>
    <span class="hljs-comment">//{</span>
    <span class="hljs-comment">//    </span>
    <span class="hljs-comment">//}</span>

    <span class="hljs-comment"><span class="hljs-doctag">///</span>/ ุฑูุด ุฌุงฺฏุฒู ฑ</span>
    <span class="hljs-comment">//var exceptions = ae.Flatten().InnerExceptions;</span>
    <span class="hljs-comment">//foreach (Exception e in exceptions)</span>
    <span class="hljs-comment">//{</span>
    <span class="hljs-comment">//    </span>
    <span class="hljs-comment">//}</span>

    <span class="hljs-comment">// ุฑูุด ุฌุงฺฏุฒู ฒ</span>
    ae.Handle(e =&gt;
    {
        WriteLine(<span class="hljs-string">$&quot;Caught error: <span class="hljs-subst">{e.Message}</span>&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    });
}
</code></pre>
<p>ุจุง ุงุฌุฑุง ุงู ุจุฑูุงููุ ุฎุฑูุฌ ูุดุงุจู ุฑูุดโูุง ูุจู ุฏุฑุงูุช ุฎูุงูุฏ ุดุฏ.</p>
<p>๐ก <strong>ูฺฉุชู:</strong> ุฏุฑ ูพุฑูฺู <strong>Chapter4_Demo3</strong> ุชูุงู ุฑูุดโูุง ูุฎุชูู ฺฉู ุชุงฺฉููู ุจุญุซ ุดุฏ ููุฌูุฏ ุงุณุช ู ฺฉุฏูุง ุฌุงฺฏุฒู ุฏุงุฎู ฺฉุงููุช ุจุฑุง ููุงุณู ุณุฑุน ูุฑุงุฑ ุฏุงุฑูุฏ. ุจุง ุฏุงูููุฏ ุงู ูพุฑูฺู ูโุชูุงูุฏ ุงู ุฑูุดโูุง ุฑุง ุนูู ฺฉูุฏ ู ุชุณุช ฺฉูุฏ.</p>
<hr>
<h3>ูพุฑุณุด ู ูพุงุณุฎ ๐</h3>
<p><strong>Q4.2:</strong> ูู ุฏู ุงุณุชุซูุง ุงุฒ ุฏู Task ูุฎุชูู ูพุฑุชุงุจ ฺฉุฑุฏูโุงู. ฺฺฏููู ูโุชูุงูู ุขูโูุง ุฑุง ุงุฒ ูู ุชุดุฎุต ุฏููุ</p>
<p>โ ุณุงุฏู ุงุณุช. ูโุชูุงูุฏ <strong>ID</strong> Task ุง ฺฉ ูพุงู ููุงุณุจ ุฑุง ุฏุฑ <strong>Source</strong> ุงุณุชุซูุง ูุฑุงุฑ ุฏูุฏ.<br>
ููููู ุจุฑูุงูู ุจุง ุชุบุฑุงุช ฺฉูฺฺฉ ูุณุจุช ุจู <strong>Demonstration 3</strong>:</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
WriteLine(<span class="hljs-string">&quot;Exception handling demo.&quot;</span>);

<span class="hljs-keyword">try</span>
{
    <span class="hljs-keyword">var</span> validateUserTask = Task.Run(
        () =&gt;
        {
            <span class="hljs-comment">// ฺฉุฏ Task ุงูู</span>
        }
    );
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnauthorizedAccessException(<span class="hljs-string">&quot;Unauthorized user.&quot;</span>)
    { Source = <span class="hljs-string">&quot;validateUserTask&quot;</span> };

    <span class="hljs-keyword">var</span> storeDataTask = Task.Run(
        () =&gt;
        {
            <span class="hljs-comment">// ฺฉุฏ Task ุฏูู</span>
        }
    );
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InsufficientMemoryException(<span class="hljs-string">&quot;Insufficient memory.&quot;</span>)
    { Source = <span class="hljs-string">&quot;storeDataTask&quot;</span> };

    Task.WaitAll(validateUserTask, storeDataTask);
}
<span class="hljs-keyword">catch</span> (AggregateException ae)
{
    <span class="hljs-keyword">foreach</span> (Exception e <span class="hljs-keyword">in</span> ae.InnerExceptions)
    {
        WriteLine(<span class="hljs-string">$&quot;The task: <span class="hljs-subst">{e.Source}</span> raised <span class="hljs-subst">{e.GetType()}</span>: <span class="hljs-subst">{e.Message}</span>&quot;</span>);
    }
}
</code></pre>
<h4>ุฎุฑูุฌ ููููู</h4>
<pre class="hljs"><code>Exception handling demo.
The task: validateUserTask raised System.UnauthorizedAccessException: Unauthorized user.
The task: storeDataTask raised System.InsufficientMemoryException: Insufficient memory.
</code></pre>
<p><strong>Q4.3:</strong> ุขุง ูโุชูุงูู ููู ุฑูฺฉุฑุฏ ุฑุง ููุช ฺูุฏู Task ฺฉ ุงุณุชุซูุง ูุดุงุจู ูพุฑุชุงุจ ูโฺฉููุฏ ูู ุงุณุชูุงุฏู ฺฉููุ</p>
<p>โ ุจููุ ฺฉุงููุงู ุฏุฑุณุช ุงุณุช. ุงู ุฑูุด ุจุฑุง ูุฏุฑุช ููุฒูุงู ฺูุฏู ุงุณุชุซูุง ุญุช ุงุฒ ฺฉ ููุน ฺฉุณุงู ูุฒ ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ.</p>
<h3>ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ฺูุฏู ูฺฉุงู ๐๏ธ</h3>
<p>ูุฑุถ ูโฺฉูู ฺฉู ุชุง ุงูุฌุง ุจุง ุงุฏูโ ูุฏุฑุช ฺูุฏู ุงุณุชุซูุง ุขุดูุง ุดุฏูโุงุฏ. ุงู ุฑูุด ฺฉุงููุงู ูพุฐุฑูุชูโุดุฏู ู ุงุญุชูุงูุงู ุฑุงุฌโุชุฑู ุฑูฺฉุฑุฏ ุงุณุช.</p>
<p>ุฏุฑ ุงุฏุงููุ ุฑูุด ุฑุง ูุดุงู ูโุฏูู ฺฉู ุจุฎุด ุงุฒ <strong>AggregateException</strong> ุฑุง ุฏุฑ ฺฉ ูฺฉุงู ูุฏุฑุช ูโฺฉูุฏ ู ุจุฎุด ุจุงูโูุงูุฏู ุฑุง ุจู ุณุทุญ ุจุงูุงุชุฑ ููุชูู ฺฉุฑุฏู ู ุฏุฑ ุขูุฌุง ูุฏุฑุช ูโฺฉูุฏ. ุจู ุจุงู ุฏฺฏุฑุ ูโุฎูุงูู ุงุซุฑุจุฎุด ูุชุฏ <strong>Handle</strong> ุฑุง ุจุจูู.</p>
<p>ุงุจุชุฏุง ุจู ูุทุนู ฺฉุฏ ุฒุฑ ุชูุฌู ฺฉูุฏ (ุงู ฺฉุฏ ุงุฒ <strong>Demonstration 4</strong> ฺฏุฑูุชู ุดุฏู ุงุณุช). ุงู ฺฉุฏ ูุดุงู ูโุฏูุฏ ฺฉู ุชููุง ูโุฎูุงูุฏ <strong>InsufficientMemoryException</strong> ุฑุง ุฏุฑ ุงู ูฺฉุงู ูุฏุฑุช ฺฉูุฏ ู ุจูู ุงุณุชุซูุงูุง ุจู ุณูุณููโูุฑุงุชุจ ุจุงูุงุชุฑ ููุชูู ูโุดููุฏ. ุจู ููู ุฏูู <strong>if block</strong> ููุฏุงุฑ <strong>true</strong> ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ:</p>
<pre class="hljs"><code><span class="hljs-comment">// Some code before</span>
<span class="hljs-keyword">catch</span> (AggregateException ae)
{
    <span class="hljs-comment">//  Handling only InsufficientMemoryException, other</span>
    <span class="hljs-comment">// exceptions will be propagated up to the hierarchy</span>
    ae.Handle(e =&gt;
    {
        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">is</span> InsufficientMemoryException)
        {
            WriteLine(<span class="hljs-string">$&quot;Caught error inside InvokeTasks(): <span class="hljs-subst">{e.Message}</span>&quot;</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    });
}
</code></pre>
<hr>
<h3>Demonstration 4 ๐ฅ๏ธ</h3>
<p>ุฏุฑ ุงู ุจุฑูุงููุ <strong>Main thread</strong> ูุชุฏ <strong>InvokeTasks</strong> ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ ฺฉู ุจู ููุจู ุฎูุฏ ุณู Task ุงุฌุงุฏ ู ุงุฌุฑุง ูโฺฉูุฏ:</p>
<ul>
<li><strong>validateUserTask</strong></li>
<li><strong>storeDataTask</strong></li>
<li><strong>useDllTask</strong> (ุจุฑุง ุจุญุซ ุงุถุงูู ุดุฏู ุงุณุช ุชุง ูุดุงู ุฏูุฏ ูุงุฒู ูุณุช ุชุนุฏุงุฏ ูุณุงู Task ุฏุฑ ูุฑ ูฺฉุงู ุฏุงุดุชู ุจุงุดู)</li>
</ul>
<p>ุชูุงู ุงุณุชุซูุงูุง ููฺฉู ุฏุงุฎู <strong>InvokeTasks</strong> ฺฏุฑูุชู ูโุดููุฏุ ุงูุง ุชููุง <strong>InsufficientMemoryException</strong> ูุฏุฑุช ูโุดูุฏ. ุจูุงุจุฑุงู ุจูู ุงุณุชุซูุงูุง ุจู ุณุทุญ ุจุงูุงุชุฑ ููุชูู ูโุดููุฏ ู ุฏุฑ <strong>Main thread</strong> ูุฏุฑุช ูโุดููุฏ.</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
WriteLine(<span class="hljs-string">&quot;Exception handling demo.&quot;</span>);

<span class="hljs-keyword">try</span>
{
    InvokeTasks();
}
<span class="hljs-keyword">catch</span> (AggregateException ae)
{
    ae.Handle(e =&gt;
    {
        WriteLine(<span class="hljs-string">$&quot;Caught error inside Main(): <span class="hljs-subst">{e.Message}</span>&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    });
}

<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeTasks</span>()</span>
{
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-keyword">var</span> validateUserTask = Task.Run(
            () =&gt;
            {
                <span class="hljs-comment">// Some other code, if any</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnauthorizedAccessException(<span class="hljs-string">&quot;Unauthorized user.&quot;</span>);
            }
        );

        <span class="hljs-keyword">var</span> storeDataTask = Task.Run(
            () =&gt;
            {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InsufficientMemoryException(<span class="hljs-string">&quot;Insufficient memory.&quot;</span>);
            }
        );

        <span class="hljs-keyword">var</span> useDllTask = Task.Run(
            () =&gt;
            {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> DllNotFoundException(<span class="hljs-string">&quot;The required dll is missing!&quot;</span>);
            }
        );

        Task.WaitAll(validateUserTask, storeDataTask, useDllTask);
    }
    <span class="hljs-comment">// catch block ุฏุงุฎู InvokeTasks ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑ ููุงุด ุฏุงุฏู ูุดุฏู ุงุณุช</span>
}
</code></pre>
<p>๐ก <strong>ูฺฉุชู:</strong> ุจุฑุง ุฏุฏู ฺฉุฏ ฺฉุงูู ูพุฑูฺู ูโุชูุงูุฏ ุงุฒ ูุจโุณุงุช <strong>Apress</strong> ูพุฑูฺู ุฑุง ุฏุงูููุฏ ฺฉูุฏ.</p>
<hr>
<h3>ุฎุฑูุฌ ููููู ๐</h3>
<pre class="hljs"><code>Exception handling demo.
Caught error inside InvokeTasks(): Insufficient memory.
Caught error inside Main(): Unauthorized user.
Caught error inside Main(): The required dll is missing!
</code></pre>
<hr>
<h3>ูพุฑุณุด ู ูพุงุณุฎ ๐</h3>
<p><strong>Q4.4:</strong> ูโุฏุงูู ฺฉู ูโุชูุงู ุงุณุชุซูุงูุง ุฑุง ุจู ุฑูุดโูุง ูุฎุชูู ูุฏุฑุช ฺฉุฑุฏุ ุงูุง ุขุง ุฏุณุชูุฑุงูุนูู ฺฉู ุจุฑุง ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ูุญุทโูุง ููุฒูุงู ูุฌูุฏ ุฏุงุฑุฏุ</p>
<p>โ ูุนูููุงู ูุชุฎุตุตุงู ูพุดููุงุฏ ูโฺฉููุฏ ุงฺฏุฑ ุงุณุชุซูุงูุง ุฑุง ุฏุงุฎู Task ูุฏุฑุช ููโฺฉูุฏุ ุขูโูุง ุฑุง ุฏุฑ ูุฒุฏฺฉโุชุฑู ูฺฉุงู ุจู ุฌุง ฺฉู <strong>ููุชุธุฑ ุชฺฉูู Task</strong> ูุณุชุฏ ุง <strong>ูุชุฌู Task</strong> ุฑุง ุฏุฑุงูุช ูโฺฉูุฏุ ูุฏุฑุช ฺฉูุฏ. ุงู ุฑุงูููุง ุฑุง ูู ูู ุฑุนุงุช ูโฺฉูู.</p>
<hr>
<h3>ุฎูุงุตู ูุตู ๐</h3>
<p>ุงู ูุตู ุงุฏุงูู ุจุญุซ <strong>Task Programming</strong> ุจูุฏุ ุงูุง ุงู ุจุงุฑ ุชูุฑฺฉุฒ ุจุฑ <strong>ูุฏุฑุช ุงุณุชุซูุงูุง</strong> ุจุง ูุซุงูโูุง ู ูุทุงูุนูโูุง ููุฑุฏ ูุชูุงูุช ุจูุฏ. ุฏุฑ ุฎูุงุตูุ ูพุงุณุฎ ุงู ุณูุงูุงุช ุฏุงุฏู ุดุฏ:</p>
<ul>
<li>AggregateException ฺุณุช ู ฺุฑุง ุฏุฑ Task Programming ููู ุงุณุชุ</li>
<li>ฺฺฏููู ูโุชูุงู ุงุณุชุซูุงูุง ูุฎุชูู Taskโูุง ุฑุง ููุงุด ุฏุงุฏุ</li>
<li>ฺฺฏููู ูโุชูุงู InnerExceptions ุฑุง <strong>Flatten</strong> ฺฉุฑุฏุ</li>
<li>ฺฺฏููู ูโุชูุงู ุชูุงู ุงุณุชุซูุงูุง ููฺฉู ุฑุง ุจุง ูู ูุฏุฑุช ฺฉุฑุฏุ</li>
<li>ฺฺฏููู ูโุชูุงู ุงุณุชุซูุงูุง ููฺฉู ุฑุง ุฏุฑ ูฺฉุงูโูุง ุฌุฏุงฺฏุงูู ูุฏุฑุช ฺฉุฑุฏุ<br>
ุชูุฑูโูุง ๐</li>
</ul>
<p>ุจุฑุง ุณูุฌุด ุฏุฑฺฉ ุฎูุฏุ ุณุน ฺฉูุฏ ุชูุฑูโูุง ุฒุฑ ุฑุง ุงูุฌุงู ุฏูุฏ:</p>
<div align="center">
<p><img src="../../../assets/image/04/Table%204-4.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>ุงุฏุขูุฑ ๐<br>
ููุงูโุทูุฑ ฺฉู ูพุดโุชุฑ ฺฏูุชู ุดุฏุ ูโุชูุงูุฏ ุจุง ุงุทููุงู ูุฑุถ ฺฉูุฏ ฺฉู ุชูุงู namespaceโูุง ููุฑุฏ ูุงุฒ ุจุฑุง ุงู ูุทุนุงุช ฺฉุฏ ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏ. ุงู ูฺฉุชู ุจุฑุง ููู ุชูุฑูโูุง ุงู ฺฉุชุงุจ ูุฒ ุตุฏู ูโฺฉูุฏ.</p>
<hr>
<p><strong>ุชูุฑูโูุง ูุตู ด: ูุฏุฑุช ุงุณุชุซูุงูุง</strong></p>
<p><strong>E4.1</strong><br>
ุงฺฏุฑ ฺฉุฏ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏุ ุขุง ูโุชูุงูุฏ ุฎุฑูุฌ ุขู ุฑุง ูพุดโุจู ฺฉูุฏุ</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
WriteLine(<span class="hljs-string">&quot;Exercise 4.1&quot;</span>);
<span class="hljs-keyword">try</span>
{
    <span class="hljs-built_in">int</span> b = <span class="hljs-number">0</span>;
    Task&lt;<span class="hljs-built_in">int</span>&gt; <span class="hljs-keyword">value</span> = Task.Run(() =&gt; <span class="hljs-number">25</span> / b);
}
<span class="hljs-keyword">catch</span> (Exception e)
{
    WriteLine(<span class="hljs-string">$&quot;Caught: <span class="hljs-subst">{e.GetType()}</span>, Message: <span class="hljs-subst">{e.Message}</span>&quot;</span>);
}
WriteLine(<span class="hljs-string">&quot;End&quot;</span>);
</code></pre>
<hr>
<p><strong>E4.2</strong><br>
ุงฺฏุฑ ฺฉุฏ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏุ ุขุง ูโุชูุงูุฏ ุฎุฑูุฌ ุขู ุฑุง ูพุดโุจู ฺฉูุฏุ</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
WriteLine(<span class="hljs-string">&quot;Exercise 4.2 and Exercise 4.3&quot;</span>);
<span class="hljs-keyword">try</span>
{
    DoSomething();
}
<span class="hljs-keyword">catch</span> (AggregateException ae)
{
    ae.Handle(
        e =&gt;
        {
            WriteLine(<span class="hljs-string">$&quot;Caught inside main: <span class="hljs-subst">{e.Message}</span>&quot;</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    );
}

<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DoSomething</span>()</span>
{
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-keyword">var</span> task1 = Task.Run(() =&gt; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidDataException(<span class="hljs-string">&quot;invalid data&quot;</span>));
        <span class="hljs-keyword">var</span> task2 = Task.Run(() =&gt; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> OutOfMemoryException(<span class="hljs-string">&quot;insufficient memory&quot;</span>));
        <span class="hljs-comment">// For Exercise 4.2</span>
        Task.WaitAll(task1, task2);
        <span class="hljs-comment">// For Exercise 4.3</span>
        <span class="hljs-comment">// task1.Wait();</span>
        <span class="hljs-comment">// task2.Wait();</span>
    }
    <span class="hljs-keyword">catch</span> (AggregateException ae)
    {
        ae.Handle(
            e =&gt;
            {
                <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">is</span> InvalidDataException)
                {
                    WriteLine(<span class="hljs-string">$&quot;The DoSomething method encounters: <span class="hljs-subst">{e.Message}</span>&quot;</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">else</span>
                {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            }
        );
    }
}
</code></pre>
<hr>
<p><strong>E4.3</strong><br>
ุฏุฑ ุจุฑูุงูู ูุจูุ ุฎุท ุฒุฑ:</p>
<pre class="hljs"><code>Task.WaitAll(task1, task2);
</code></pre>
<p>ุฑุง ุจุง ุฎุทูุท ุฒุฑ ุฌุงฺฏุฒู ฺฉูุฏ:</p>
<pre class="hljs"><code>task1.Wait();
task2.Wait();
</code></pre>
<p>ุขุง ูโุชูุงูุฏ ุฎุฑูุฌ ุขู ุฑุง ูพุดโุจู ฺฉูุฏุ</p>
<hr>
<p><strong>E4.4</strong><br>
ุงฺฏุฑ ฺฉุฏ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏุ ุขุง ูโุชูุงูุฏ ุฎุฑูุฌ ุขู ุฑุง ูพุดโุจู ฺฉูุฏุ</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
WriteLine(<span class="hljs-string">&quot;Exercise 4.4&quot;</span>);
<span class="hljs-keyword">try</span>
{
    <span class="hljs-built_in">int</span> b = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> task1 = Task.Run(() =&gt; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">&quot;invalid operation&quot;</span>));
    <span class="hljs-keyword">var</span> task2 = Task.Run(() =&gt; <span class="hljs-number">5</span>/b);
    Task.WaitAny(task1, task2);
    WriteLine(<span class="hljs-string">&quot;End&quot;</span>);
}
<span class="hljs-keyword">catch</span> (AggregateException ae)
{
    ae.Handle(e =&gt;
    {
        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">is</span> InvalidOperationException || e <span class="hljs-keyword">is</span> DivideByZeroException)
        {
            WriteLine(<span class="hljs-string">$&quot;Caught error: <span class="hljs-subst">{e.Message}</span>&quot;</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    });
}
</code></pre>
<hr>
<p><strong>E4.5</strong><br>
ุขุง ูโุชูุงูุฏ ุฎุฑูุฌ ุจุฑูุงูู ุฒุฑ ุฑุง ูพุดโุจู ฺฉูุฏุ</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> <span class="hljs-keyword">static</span> System.Console;
WriteLine(<span class="hljs-string">&quot;Exercise 4.5&quot;</span>);
<span class="hljs-keyword">var</span> errorTask = Task.Run(() =&gt; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">&quot;unwanted situation&quot;</span>));
<span class="hljs-keyword">var</span> outerTask = Task.Factory.StartNew(() =&gt; errorTask);
<span class="hljs-keyword">while</span> (!outerTask.IsCompleted) { Thread.Sleep(<span class="hljs-number">10</span>); }
WriteLine(<span class="hljs-string">$&quot;The status of the outer task is: <span class="hljs-subst">{outerTask.Status}</span>&quot;</span>);
<span class="hljs-keyword">while</span> (!outerTask.Unwrap().IsCompleted) { Thread.Sleep(<span class="hljs-number">10</span>); }
WriteLine(<span class="hljs-string">$&quot;The status of the inner task is: <span class="hljs-subst">{outerTask.Unwrap().Status}</span>&quot;</span>);
</code></pre>
<p>ุฑุงูโุญู ุชูุฑูโูุง ๐<br>
ุฏุฑ ุงุฏุงููุ ููููู ูพุงุณุฎ ุชูุฑูโูุง ูุตู ด ุขูุฑุฏู ุดุฏู ุงุณุช:</p>
<hr>
<p><strong>E4.1</strong><br>
ุงู ุจุฑูุงูู ุฎุฑูุฌ ุฒุฑ ุฑุง ุชููุฏ ูโฺฉูุฏ:</p>
<pre class="hljs"><code>Exercise 4.1
End
</code></pre>
<p>๐ก <strong>ุชูุถุญ ููุณูุฏู:</strong> ุดูุง ุงุณุชุซูุง ุฑุง ูุดุงูุฏู ููโฺฉูุฏ ฺูู ูุฎ ุงุตู (main thread) ุจุง ุขู ููุงุฌู ูุดุฏูุ ุงุณุชุซูุง ุชูุณุท ุชุณฺฉ ฺฉู ุงู ูุฎ ุงุฌุงุฏ ฺฉุฑุฏู ุจูุฏ ุฑุฎ ุฏุงุฏู ุงุณุช.</p>
<p>ุจุฑุง ูุดุงูุฏู ุงุณุชุซูุงุ ูโุชูุงูุฏ ุจููฺฉ <code>try</code> ุฑุง ุจู ุดฺฉู ุฒุฑ ุชุบุฑ ุฏูุฏ (ุชุบุฑุงุช ุจุง <strong>ูพุฑุฑูฺฏ</strong> ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช):</p>
<pre class="hljs"><code><span class="hljs-comment">// There is no change in the previous code</span>
<span class="hljs-keyword">try</span>
{
}
<span class="hljs-built_in">int</span> b = <span class="hljs-number">0</span>;
Task&lt;<span class="hljs-built_in">int</span>&gt; <span class="hljs-keyword">value</span> = Task.Run(() =&gt; <span class="hljs-number">25</span> / b);
WriteLine(<span class="hljs-keyword">value</span>.Result);  <span class="hljs-comment">// ุชุบุฑ ูพุฑุฑูฺฏ</span>
<span class="hljs-comment">// There is no change in the remaining code as well</span>
</code></pre>
<p>ุฎุฑูุฌ ุจุฑูุงูู ูพุณ ุงุฒ ุชุบุฑ:</p>
<pre class="hljs"><code>Exercise 4.1
Caught: System.AggregateException, Message: One or more errors occurred. (Attempted to divide by zero.)
End
</code></pre>
<p>โ๏ธ ุชูุฌู ฺฉูุฏ ฺฉู ุจู ุฌุง ูุดุงูุฏู <code>System.DivideByZeroException</code>ุ <code>System.AggregateException</code> ุฏุฏู ูโุดูุฏ. ุงู ูุชุฌูโ ููุฑุฏ ุงูุชุธุงุฑ ุงู ุจุฑูุงูู ุงุณุช.</p>
<hr>
<p><strong>E4.2</strong><br>
ุฎุฑูุฌ ุจุฑูุงูู ุจู ุดฺฉู ุฒุฑ ุงุณุช:</p>
<pre class="hljs"><code>Exercise 4.2 and Exercise 4.3
The DoSomething method encounters: invalid data
Caught inside main: insufficient memory
</code></pre>
<hr>
<p><strong>E4.3</strong><br>
ููุช ุงุฒ <code>task1.Wait();</code> ุงุณุชูุงุฏู ูโฺฉูุฏุ <code>InvalidDataException</code> ุฑุฎ ูโุฏูุฏ ู ฺฉูุชุฑู ุงุฒ ุจููฺฉ <code>try</code> ุฎุงุฑุฌ ูโุดูุฏ. ุฎุฑูุฌ ุจู ุดฺฉู ุฒุฑ ุฎูุงูุฏ ุจูุฏ:</p>
<pre class="hljs"><code>Exercise 4.2 and Exercise 4.3
The DoSomething method encounters: invalid data
</code></pre>
<hr>
<p><strong>E4.4</strong><br>
ุงู ุจุฑูุงูู ุฎุฑูุฌ ุฒุฑ ุฑุง ุชููุฏ ูโฺฉูุฏ:</p>
<pre class="hljs"><code>Exercise 4.4
End
</code></pre>
<p>๐ก ุฏูู ุนุฏู ูุดุงูุฏู ุงุณุชุซูุงูุง ุฏุฑ ุฎุฑูุฌ: ููุช ุงุฒ <code>WaitAny</code> ุงุณุชูุงุฏู ูโฺฉูุฏุ ุงุณุชุซูุง ุชุณฺฉโูุง ุจู <code>AggregateException</code> ููุชูู ููโุดูุฏ.</p>
<p>๐ ูพุดููุงุฏ ูุทุงูุนู: ุจูุงฺฏ ุงุณุชูู ฺฉูุฑ ุฏุฑ ููุฑุฏ ุชูุงูุช <code>WaitAny</code> ู <code>WaitAll</code><br>
<a href="https://blog.stephencleary.com/2014/10/a-tour-of-task-part-5-wait.html">https://blog.stephencleary.com/2014/10/a-tour-of-task-part-5-wait.html</a></p>
<p>ุฎูุงุตู ุชูุงูุช:</p>
<ul>
<li><code>WaitAny</code> ููุท ููุชุธุฑ ุงููู ุชุณฺฉ ุชฺฉูู ูโูุงูุฏ ู ุงุณุชุซูุง ุฑุง ุจู <code>AggregateException</code> ููุชูู ููโฺฉูุฏ.</li>
<li>ุจุงุฏ ุฎุทุงูุง ูุฑ ุชุณฺฉ ุฑุง ุจุนุฏ ุงุฒ ุจุงุฒฺฏุดุช <code>WaitAny</code> ุจุฑุฑุณ ฺฉูุฏ.</li>
</ul>
<p>ุจุฑุง ูุดุงูุฏู ุฌุฒุฆุงุช ุงุณุชุซูุง ุฏุฑ ุฎุฑูุฌุ ุจููฺฉ <code>try</code> ุฑุง ุจู ุดฺฉู ุฒุฑ ุชุบุฑ ุฏูุฏ:</p>
<pre class="hljs"><code><span class="hljs-built_in">int</span> b = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> task1 = Task.Run(() =&gt; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">&quot;invalid operation&quot;</span>));
<span class="hljs-keyword">var</span> task2 = Task.Run(() =&gt; <span class="hljs-number">5</span> / b);
<span class="hljs-comment">// Task.WaitAny(task1, task2);</span>
<span class="hljs-keyword">var</span> tasks = <span class="hljs-keyword">new</span>[]{ task1, task2 };
<span class="hljs-built_in">int</span> taskIndex = Task.WaitAny(tasks);
tasks[taskIndex].Wait();
WriteLine(<span class="hljs-string">&quot;End&quot;</span>);
</code></pre>
<p>ุฎุฑูุฌ ููููู ูพุณ ุงุฒ ุชุบุฑ:</p>
<pre class="hljs"><code>Exercise 4.4
Caught error: invalid operation
</code></pre>
<hr>
<p><strong>E4.5</strong><br>
ุฎุฑูุฌ ุจุฑูุงูู ุจู ุดฺฉู ุฒุฑ ุงุณุช:</p>
<pre class="hljs"><code>Exercise 4.5
The status of the outer task is: RanToCompletion
The status of the inner task is: Faulted
</code></pre>

</main>


 

  <!-- ููุชุฑ ูุดุชุฑฺฉ -->
  <footer class="footer">
    <div class="container">
      <p>
        <img src="/icone/copyright.svg" alt="ฺฉูพโุฑุงุช" width="14" height="14"
             style="vertical-align:middle;margin-inline:4px">
        <span id="y"></span> Gitab โ ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู
      </p>
    </div>
  </footer>

  <!-- ุณุงู + ุงุณฺฉุฑูพุช ุชู -->
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    (() => {
      const root = document.documentElement;
      const btn = document.getElementById('themeToggle');
      const KEY = 'gitab-theme';
      const media = window.matchMedia('(prefers-color-scheme: dark)');
      const getEffective = s => s === 'auto' ? (media.matches ? 'dark' : 'light') : s;
      function updateTheme(s) {
        root.setAttribute('data-theme', s);
        const mode = getEffective(s);
        root.dataset.colorMode = mode;
        btn.dataset.icon = mode === 'dark' ? 'moon' : 'sun';
      }
      const saved = localStorage.getItem(KEY) || 'auto';
      updateTheme(saved);
      btn.addEventListener('click', () => {
        const curr = localStorage.getItem(KEY) || 'auto';
        const next = curr === 'auto' ? 'dark' : curr === 'dark' ? 'light' : 'auto';
        localStorage.setItem(KEY, next);
        updateTheme(next);
      });
      media.addEventListener('change', () => {
        if ((localStorage.getItem(KEY) || 'auto') === 'auto') updateTheme('auto');
      });
      window.addEventListener('DOMContentLoaded', () => updateTheme(saved));
    })();
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<script>
document.querySelectorAll('pre code').forEach(block => {
  const btn = document.createElement('button');
  btn.className = 'copy-btn';

  const icon = document.createElement('img');
  icon.src = '/icone/copy.svg';
  icon.alt = 'Copy';
  btn.appendChild(icon);

  block.parentNode.insertBefore(btn, block);

  btn.addEventListener('click', async () => {
    await navigator.clipboard.writeText(block.textContent);
    btn.classList.add('copied');
    setTimeout(() => btn.classList.remove('copied'), 1500);
  });
});
</script>
<script>
  document.body.dataset.page = window.location.pathname;
</script>
<script>
  // ุจุงุฒ ู ุจุณุชู ฺฉุฑุฏู ููู ููุจุงู
  const menuBtn = document.querySelector(".menu-toggle");
  const nav = document.querySelector(".nav");

  if (menuBtn && nav) {
    // ุจุงุฒ ู ุจุณุชู ุดุฏู ุจุง ุฏฺฉูู
    menuBtn.addEventListener("click", (e) => {
      e.stopPropagation(); // ูุฐุงุฑู ฺฉูฺฉ ุฑู ุฎูุฏ ุฏฺฉูู ุจุงุนุซ ุจุณุชู ุดุฏู ุจุดู
      nav.classList.toggle("show");
    });

    // ุจุณุชู ููู ุจุง ฺฉูฺฉ ุจุฑูู
    document.addEventListener("click", (e) => {
      const clickedInsideNav = nav.contains(e.target);
      const clickedMenuButton = menuBtn.contains(e.target);
      if (!clickedInsideNav && !clickedMenuButton) {
        nav.classList.remove("show");
      }
    });
  }
</script>



</body>

</html>
