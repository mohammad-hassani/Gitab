<h1>ูุตู ุณุฒุฏูู: ุชุดุฎุต (Diagnostics)</h1>
<p>ููุช ฺุฒ ุงุดุชุจุงู ูพุด ูโุฑูุฏุ ุฎู ููู ุงุณุช ฺฉู ุงุทูุงุนุงุช ูุงุฒู ุจุฑุง ฺฉูฺฉ ุจู <strong>ุชุดุฎุต (diagnosing) ูุดฺฉู</strong> ุฏุฑ ุฏุณุชุฑุณ ุจุงุดุฏ. ฺฉ <strong>ูุญุท ุชูุณุนู ฺฉูพุงุฑฺู (Integrated Development Environment โ IDE)</strong> ุง ฺฉ <strong>ุฏุจุงฺฏุฑ (debugger)</strong> ูโุชูุงูุฏ ุฏุฑ ุงู ุฒููู ุจุณุงุฑ ฺฉูฺฉโฺฉููุฏู ุจุงุดุฏโุงูุง ูุนูููุงู ููุท ุฏุฑ ุทูู ุชูุณุนู ููุฌูุฏ ุงุณุช.<br>
ูพุณ ุงุฒ ุงูุชุดุงุฑ (ship) ฺฉ ุจุฑูุงููุ ุฎูุฏู ุจุฑูุงูู ุจุงุฏ ุงุทูุงุนุงุช ุชุดุฎุต ุฑุง ุฌูุนโุขูุฑ ู ุซุจุช ฺฉูุฏ. ุจุฑุง ุจุฑุขูุฑุฏู ฺฉุฑุฏู ุงู ูุงุฒุ <strong>.NET</strong> ูุฌููุนูโุง ุงุฒ ุงูฺฉุงูุงุช ุฑุง ูุฑุงูู ูโฺฉูุฏ ุชุง ุจุชูุงู ุงุทูุงุนุงุช ุชุดุฎุต ุฑุง ูุงฺฏโฺฏุฑ ฺฉุฑุฏุ ุฑูุชุงุฑ ุจุฑูุงูู ุฑุง ูุงูุชูุฑ ฺฉุฑุฏุ ุฎุทุงูุง ุฒูุงู ุงุฌุฑุง ุฑุง ุดูุงุณุง ฺฉุฑุฏ ู ุฏุฑ ุตูุฑุช ููุฌูุฏ ุจูุฏูุ ุจุง ุงุจุฒุงุฑูุง ุฏุจุงฺฏ ฺฉูพุงุฑฺู ุดุฏ.</p>
<p>ุจุฑุฎ ุงุจุฒุงุฑูุง ู APIูุง ุชุดุฎุตุ ูุฎุตูุต <strong>Windows</strong> ูุณุชูุฏ ุฒุฑุง ุจู ูุงุจูุชโูุง ุณุณุชูโุนุงูู ููุฏูุฒ ูุงุจุณุชูโุงูุฏ. ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุดููุบ ุดุฏู <strong>BCL (.NET Base Class Library)</strong> ุจุง APIูุง ูุฎุชุต ูพูุชูุฑูุ ูุงฺฉุฑูุณุงูุช ุขูโูุง ุฑุง ุฏุฑ ูพฺฉุฌโูุง ุฌุฏุงฺฏุงููโ <strong>NuGet</strong> ุนุฑุถู ฺฉุฑุฏู ุงุณุช ฺฉู ูโุชูุงูุฏ ุจู ุตูุฑุช ุงุฎุชุงุฑ ุจู ุขูโูุง ุงุฑุฌุงุน ุฏูุฏ. ุจุด ุงุฒ ุฏูุงุฒุฏู ูพฺฉุฌ ูุฎุตูุต ููุฏูุฒ ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ูููโ ุขูโูุง ุฑุง ฺฉุฌุง ุจุง ูพฺฉุฌ ุงุตู <strong>Microsoft.Windows.Compatibility</strong> ุงุณุชูุงุฏู ฺฉูุฏ.</p>
<p>ุงููุงุน (types) ูุนุฑูโุดุฏู ุฏุฑ ุงู ูุตูุ ุนูุฏุชุงู ุฏุฑ <strong>namespace ุจู ูุงู System.Diagnostics</strong> ุชุนุฑู ุดุฏูโุงูุฏ.</p>
<hr>
<h3>โ๏ธ ฺฉุงููพุงู ุดุฑุท (Conditional Compilation)</h3>
<p>ุดูุง ูโุชูุงูุฏ ูุฑ ุจุฎุด ุงุฒ ฺฉุฏ ุฏุฑ C# ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ <strong>ุฏุณุชูุฑุงุช ูพุดโูพุฑุฏุงุฒูุฏู (preprocessor directives)</strong> ุจู ุตูุฑุช ุดุฑุท ฺฉุงููพุงู ฺฉูุฏ.<br>
ุงู ุฏุณุชูุฑุงุชุ ุฏุณุชูุฑุงูุนููโูุง ุฎุงุต ุจุฑุง ฺฉุงููพุงูุฑ ูุณุชูุฏ ฺฉู ุจุง ููุงุฏ <code>#</code> ุดุฑูุน ูโุดููุฏ (ู ุจุฑุฎูุงู ุณุงุฑ ุณุงุฎุชุงุฑูุง C#ุ ุจุงุฏ ุฏุฑ ฺฉ ุฎุท ุฌุฏุงฺฏุงูู ูุฑุงุฑ ฺฏุฑูุฏ). ุงุฒ ูุธุฑ ููุทูุ ุงู ุฏุณุชูุฑุงุช ูุจู ุงุฒ ุงูุฌุงู ฺฉุงููพุงู ุงุตู ุงุฌุฑุง ูโุดููุฏ (ูุฑฺูุฏ ุฏุฑ ุนููุ ฺฉุงููพุงูุฑ ุขูโูุง ุฑุง ุฏุฑ ูุฑุญููโ <strong>lexical parsing</strong> ูพุฑุฏุงุฒุด ูโฺฉูุฏ).</p>
<p>ุฏุณุชูุฑุงุช ูพุดโูพุฑุฏุงุฒูุฏู ุจุฑุง ฺฉุงููพุงู ุดุฑุท ุนุจุงุฑุชโุงูุฏ ุงุฒ:</p>
<ul>
<li><code>#if</code></li>
<li><code>#else</code></li>
<li><code>#endif</code></li>
<li><code>#elif</code></li>
</ul>
<p>โ ุฏุณุชูุฑ <code>#if</code> ุจู ฺฉุงููพุงูุฑ ูโฺฏูุฏ ุจุฎุด ุงุฒ ฺฉุฏ ุฑุง ูุงุฏุฏู ุจฺฏุฑุฏ ูฺฏุฑ ุงูโฺฉู ฺฉ <strong>symbol</strong> ูุดุฎุต ุชุนุฑู ุดุฏู ุจุงุดุฏ.<br>
ูโุชูุงูุฏ ฺฉ symbol ุฑุง ุจู ุฏู ุฑูุด ุชุนุฑู ฺฉูุฏ:</p>
<ol>
<li>ุฏุฑ ุณูุฑุณโฺฉุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุฏุณุชูุฑ <code>#define</code> (ฺฉู ููุท ุจู ููุงู ูุงู ุงุนูุงู ูโุดูุฏ).</li>
<li>ุฏุฑ ูุงู <strong>.csproj</strong> ุจุง ุงุณุชูุงุฏู ุงุฒ ุนูุตุฑ <code>&lt;DefineConstants&gt;</code> (ฺฉู ุฏุฑ ุงู ุตูุฑุชุ ุจู ฺฉู assembly ุงุนูุงู ูโุดูุฏ).</li>
</ol>
<p>ูุซุงู:</p>
<pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-keyword">define</span> TESTMODE</span>
<span class="hljs-comment">// #define ุจุงุฏ ุฏุฑ ุจุงูุง ูุงู ููุดุชู ุดูุฏ</span>
<span class="hljs-comment">// ุทุจู ูุฑุงุฑุฏุงุฏุ ูุงู symbol ูุง ุจุง ุญุฑูู ุจุฒุฑฺฏ ููุดุชู ูโุดููุฏ.</span>
<span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        <span class="hljs-meta">#<span class="hljs-keyword">if</span> TESTMODE</span>
        Console.WriteLine(<span class="hljs-string">&quot;in test mode!&quot;</span>);   <span class="hljs-comment">// OUTPUT: in test mode!</span>
        <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
    }
}
</code></pre>
<p>ุงฺฏุฑ ุฎุท ุงูู (ุนู <code>#define TESTMODE</code>) ุฑุง ุญุฐู ฺฉููุ ุจุฑูุงูู ุจุฏูู ุฎุท <code>Console.WriteLine</code> ฺฉุงููพุงู ุฎูุงูุฏ ุดุฏโุงูฺฏุงุฑ ฺฉู ฺฉูุงู ฺฉุงููุช ุดุฏู ุจุงุดุฏ.</p>
<p>๐ ุฏุณุชูุฑ <code>#else</code> ูุดุงุจู ุฏุณุชูุฑ <code>else</code> ุฏุฑ C# ุงุณุช ู <code>#elif</code> ูู ูุนุงุฏู <code>#else</code> ุจู ููุฑุงู ฺฉ <code>#if</code> ุงุณุช.<br>
ุนููฺฏุฑูุง <code>||</code>, <code>&amp;&amp;</code>, ู <code>!</code> ูุฒ ุจู ุชุฑุชุจ <strong>or</strong>ุ <strong>and</strong> ู <strong>not</strong> ุนูู ูโฺฉููุฏ:</p>
<pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-keyword">if</span> TESTMODE &amp;&amp; !PLAYMODE      // ุงฺฏุฑ TESTMODE ูุนุงู ุจุงุดุฏ ู PLAYMODE ูุนุงู ูุจุงุดุฏ</span>
   ...
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<p>ุงูุง ุงุฏุชุงู ุจุงุดุฏ: ุงู ฺฉ ุนุจุงุฑุช ูุนููู C# ูุณุช ู symbolูุง ฺฉู ุฑู ุขูโูุง ุนูู ูโฺฉูุฏ ูฺ ุงุฑุชุจุงุท ุจู ูุชุบุฑูุงโฺู ุงุณุชุงุชฺฉ ู ฺู ุบุฑ ุงุฒ ุขูโูุฏุงุฑูุฏ.</p>
<hr>
<h3>๐๏ธ ุชุนุฑู symbolูุง ุฏุฑ ุณุทุญ assembly</h3>
<p>ูโุชูุงูุฏ symbolูุง ุฑุง ฺฉู ุฏุฑ ุชูุงู ูุงูโูุง ฺฉ assembly ุงุนูุงู ูโุดููุฏุ ุฏุฑ ูุงู <code>.csproj</code> ุชุนุฑู ฺฉูุฏ (ุง ุฏุฑ Visual Studioุ ุงุฒ ุทุฑู ุชุจ <strong>Build</strong> ุฏุฑ ูพูุฌุฑูโ <strong>Project Properties</strong>).</p>
<p>ูุซุงู:</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">PropertyGroup</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">DefineConstants</span>&gt;</span>TESTMODE;PLAYMODE<span class="hljs-tag">&lt;/<span class="hljs-name">DefineConstants</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">PropertyGroup</span>&gt;</span>
</code></pre>
<p>ุงฺฏุฑ ฺฉ symbol ุฑุง ุฏุฑ ุณุทุญ assembly ุชุนุฑู ฺฉุฑุฏู ุจุงุดุฏ ู ุจุฎูุงูุฏ ุขู ุฑุง ุจุฑุง ฺฉ ูุงู ุฎุงุต <strong>ูุบู (undefine)</strong> ฺฉูุฏุ ูโุชูุงูุฏ ุงุฒ ุฏุณุชูุฑ <code>#undef</code> ุงุณุชูุงุฏู ฺฉูุฏ.</p>
<hr>
<h3>โ๏ธ ฺฉุงููพุงู ุดุฑุท ุฏุฑ ุจุฑุงุจุฑ ูพุฑฺูโูุง ูุชุบุฑ ุงุณุชุงุชฺฉ</h3>
<p>ุดูุง ูโุชูุงูุฏ ููุงู ูุซุงู ูุจู ุฑุง ุจุง ฺฉ ููุฏ ุงุณุชุงุชฺฉ ุณุงุฏู ูู ูพุงุฏูโุณุงุฒ ฺฉูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">static</span> <span class="hljs-keyword">internal</span> <span class="hljs-built_in">bool</span> TestMode = <span class="hljs-literal">true</span>;
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
{
    <span class="hljs-keyword">if</span> (TestMode) Console.WriteLine(<span class="hljs-string">&quot;in test mode!&quot;</span>);
}
</code></pre>
<p>ุงู ุฑูุด ูุฒุช <strong>ูพฺฉุฑุจูุฏ ุฏุฑ ุฒูุงู ุงุฌุฑุง (runtime configuration)</strong> ุฑุง ุฏุงุฑุฏ.<br>
ูพุณ ฺุฑุง ุจุงุฏ ฺฉุงููพุงู ุดุฑุท ุฑุง ุงูุชุฎุงุจ ฺฉููุ</p>
<p>ุฏูู ุงู ุงุณุช ฺฉู <strong>ฺฉุงููพุงู ุดุฑุท ูโุชูุงูุฏ ฺฉุงุฑูุง ุงูุฌุงู ุฏูุฏ ฺฉู ูพุฑฺูโูุง ูุชุบุฑ ููโุชูุงููุฏ</strong>ุ ูุซู:</p>
<ul>
<li>ุฏุฑุฌ ุดุฑุท ฺฉ <strong>attribute</strong></li>
<li>ุชุบุฑ ููุน ุงุนูุงูโุดุฏูโ ฺฉ ูุชุบุฑ</li>
<li>ุชุบุฑ ุจู namespaceูุง ุง type aliasูุง ุฏุฑ ฺฉ ุฏุณุชูุฑ <code>using</code></li>
</ul>
<p>ูุซุงู:</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> TestType =
<span class="hljs-meta">#<span class="hljs-keyword">if</span> V2</span>
    MyCompany.Widgets.GadgetV2;
<span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
    MyCompany.Widgets.Gadget;
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<p>ุดูุง ุญุช ูโุชูุงูุฏ <strong>ุฑูฺฉุชูุฑูฺฏโูุง ุจุฒุฑฺฏ</strong> ุฑุง ุฒุฑ ฺฉ ุฏุณุชูุฑ ฺฉุงููพุงู ุดุฑุท ูุฑุงุฑ ุฏูุฏุ ุทูุฑ ฺฉู ุจุชูุงูุฏ ุจูุงูุงุตูู ุจู ูุณุฎูโ ูุฏู ู ุฌุฏุฏ ุฌุงุจูโุฌุง ุดูุฏ. ููฺูู ูโุชูุงูุฏ ฺฉุชุงุจุฎุงููโูุง ุจููุณุฏ ฺฉู ุฏุฑ ุจุฑุงุจุฑ ฺูุฏ ูุณุฎูโ ูุฎุชูู runtime ฺฉุงููพุงู ุดููุฏ ู ูุฑ ุฌุง ฺฉู ุงูฺฉุงู ุฏุงุฑุฏุ ุงุฒ ูุงุจูุชโูุง ุฌุฏุฏ ุจูุฑู ุจุจุฑูุฏ.</p>
<p>ฺฉ ุฏฺฏุฑ ุงุฒ ูุฒุงุง ฺฉุงููพุงู ุดุฑุท ุงู ุงุณุช ฺฉู <strong>ฺฉุฏูุง ุฏุจุงฺฏ ูโุชูุงููุฏ ุจู ุงููุงุน (types) ุฏุฑ assemblyูุง ุงุดุงุฑู ฺฉููุฏ ฺฉู ุฏุฑ ูุณุฎูโ ููุง (deployment) ฺฏูุฌุงูุฏู ููโุดููุฏ.</strong> ๐</p>
<h3>๐ ูฺฺฏ <strong>Conditional Attribute</strong></h3>
<p>ูฺฺฏ <strong>Conditional</strong> ุจู ฺฉุงููพุงูุฑ ุฏุณุชูุฑ ูโุฏูุฏ ฺฉู ุงฺฏุฑ ฺฉ <strong>symbol</strong> ูุดุฎุต ุชุนุฑู ูุดุฏู ุจุงุดุฏุ ูุฑ ูุฑุงุฎูุงู (call) ุจู ฺฉ ฺฉูุงุณ ุง ูุชุฏ ุฎุงุต ุฑุง ูุงุฏุฏู ุจฺฏุฑุฏ.</p>
<p>ุจุฑุง ุฏุฏู ฺฉุงุฑุจุฑุฏ ุงู ูฺฺฏุ ูุฑุถ ฺฉูุฏ ูุชุฏ ุจุฑุง ุซุจุช ูุถุนุช (logging status) ููุดุชูโุงุฏ:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogStatus</span> (<span class="hljs-params"><span class="hljs-built_in">string</span> msg</span>)</span>
{
    <span class="hljs-built_in">string</span> logFilePath = ...
    System.IO.File.AppendAllText (logFilePath, msg + <span class="hljs-string">&quot;\r\n&quot;</span>);
}
</code></pre>
<p>ุญุงูุง ุชุตูุฑ ฺฉูุฏ ูโุฎูุงูุฏ ุงู ูุชุฏ ููุท ุฒูุงู ุงุฌุฑุง ุดูุฏ ฺฉู symbol ุจู ูุงู <strong>LOGGINGMODE</strong> ุชุนุฑู ุดุฏู ุจุงุดุฏ.</p>
<p>ุฑุงูโุญู ุงูู ุงู ุงุณุช ฺฉู ูููโ ูุฑุงุฎูุงูโูุง <code>LogStatus</code> ุฑุง ุฏุงุฎู ฺฉ ุฏุณุชูุฑ <code>#if</code> ูุฑุงุฑ ุฏูุฏ:</p>
<pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-keyword">if</span> LOGGINGMODE</span>
LogStatus(<span class="hljs-string">&quot;Message Headers: &quot;</span> + GetMsgHeaders());
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<p>ุงู ฺฉุงุฑ ูุชุฌูโ ุงุฏูโุขู ูโุฏูุฏุ ุงูุง ุฎุณุชูโฺฉููุฏู ู ููุชโฺฏุฑ ุงุณุช.<br>
ุฑุงูโุญู ุฏูู ุงู ุงุณุช ฺฉู ุฏุณุชูุฑ <code>#if</code> ุฑุง ุฏุงุฎู ุฎูุฏ ูุชุฏ <code>LogStatus</code> ูุฑุงุฑ ุฏูู. ุงูุง ุงู ูุดฺฉู ุฏุงุฑุฏุ ฺุฑุง ฺฉู ุงฺฏุฑ ุงูโุทูุฑ ูุฑุงุฎูุงู ุดูุฏ:</p>
<pre class="hljs"><code>LogStatus(<span class="hljs-string">&quot;Message Headers: &quot;</span> + GetComplexMessageHeaders());
</code></pre>
<p>ุฏุฑ ุงู ุญุงูุชุ ูุชุฏ <code>GetComplexMessageHeaders</code> ููุดู ูุฑุงุฎูุงู ุฎูุงูุฏ ุดุฏโฺฉู ููฺฉู ุงุณุช ุจุงุนุซ ุงูุช ฺฉุงุฑุง (performance hit) ุดูุฏ.</p>
<hr>
<h3>๐ ุชุฑฺฉุจ ุฏู ุฑุงูโุญู ุจุง <strong>Conditional Attribute</strong></h3>
<p>ูโุชูุงูู ุนููฺฉุฑุฏ ุฑุงูโุญู ุงูู (ูุชุฌูโ ูุทููุจ) ู ุฑุงุญุช ุฑุงูโุญู ุฏูู ุฑุง ุจุง ุงูุฒูุฏู ูฺฺฏ <strong>Conditional</strong> (ฺฉู ุฏุฑ <code>System.Diagnostics</code> ุชุนุฑู ุดุฏู) ุจู ูุชุฏ <code>LogStatus</code> ุจู ุฏุณุช ุจุงูุฑู:</p>
<pre class="hljs"><code>[<span class="hljs-meta">Conditional(<span class="hljs-string">&quot;LOGGINGMODE&quot;</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogStatus</span> (<span class="hljs-params"><span class="hljs-built_in">string</span> msg</span>)</span>
{
    ...
}
</code></pre>
<p>ุงู ฺฉุงุฑ ุจู ฺฉุงููพุงูุฑ ุฏุณุชูุฑ ูโุฏูุฏ ฺฉู ุชูุงู ูุฑุงุฎูุงูโูุง <code>LogStatus</code> ุฑุง ุทูุฑ ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ ฺฉู ฺฏู ุฏุงุฎู ฺฉ ุฏุณุชูุฑ <code>#if LOGGINGMODE</code> ูุฑุงุฑ ุฏุงุฑูุฏ.<br>
ุงฺฏุฑ symbol ุชุนุฑู ูุดุฏู ุจุงุดุฏุ <strong>ูุฑฺฏููู ูุฑุงุฎูุงู ุจู <code>LogStatus</code> ฺฉูุงู ุงุฒ ุฎุฑูุฌ ููุง ฺฉุงููพุงู ุญุฐู ุฎูุงูุฏ ุดุฏ</strong>โุงุฒ ุฌููู <strong>evaluation</strong> ุขุฑฺฏููุงูโูุง.<br>
ุจูุงุจุฑุงู ูุฑ ุนุจุงุฑุช ฺฉู ุงุซุฑ ุฌุงูุจ (side effect) ุฏุงุดุชู ุจุงุดุฏ ูุฒ ฺฉูุงู ุงุฌุฑุง ููโุดูุฏ. โจ</p>
<p>ุงู ูฺฺฏ ุญุช ุฒูุงู ฺฉู <code>LogStatus</code> ู ูุชุฏ ูุฑุงุฎูุงููุฏู ุฏุฑ ุฏู assembly ูุชูุงูุช ุจุงุดูุฏ ูุฒ ุจู ุฏุฑุณุช ฺฉุงุฑ ูโฺฉูุฏ.</p>
<hr>
<h3>๐ฆ ฺฉ ูุฒุช ุฏฺฏุฑ</h3>
<p>ูุฒุช ุฏฺฏุฑ <code>[Conditional]</code> ุงู ุงุณุช ฺฉู ุจุฑุฑุณ ุดุฑุท ุฏุฑ ุฒูุงู <strong>ฺฉุงููพุงู ฺฉุฏ ูุฑุงุฎูุงููุฏู</strong> ุงูุฌุงู ูโุดูุฏุ ูู ุฏุฑ ุฒูุงู ฺฉุงููพุงู ูุชุฏ ููุตุฏ. ุงู ุนู ุดูุง ูโุชูุงูุฏ ฺฉุชุงุจุฎุงููโุง ุญุงู ูุชุฏูุง ูุซู <code>LogStatus</code> ุจููุณุฏ ู ููุท <strong>ฺฉ ูุณุฎู ุงุฒ ุขู ฺฉุชุงุจุฎุงูู</strong> ุฑุง ุจุณุงุฒุฏ.</p>
<p>๐ ูฺฺฏ <code>Conditional</code> ุฏุฑ ุฒูุงู ุงุฌุฑุง ูฺ ุชุฃุซุฑ ูุฏุงุฑุฏโุงู ููุท ฺฉ ุฏุณุชูุฑุงูุนูู ุจุฑุง ฺฉุงููพุงูุฑ ุงุณุช.</p>
<hr>
<h3>๐ ุฌุงฺฏุฒูโูุง <strong>Conditional Attribute</strong></h3>
<p>ูฺฺฏ <code>Conditional</code> ุฒูุงู ุจโูุงุฏู ุงุณุช ฺฉู ุจุฎูุงูุฏ ุนููฺฉุฑุฏ ุฑุง ุจูโุทูุฑ <strong>ูพูุง (runtime)</strong> ูุนุงู ุง ุบุฑูุนุงู ฺฉูุฏ.<br>
ุฏุฑ ุงู ุญุงูุช ุจุงุฏ ุงุฒ ฺฉ ุฑุงูโุญู ูุจุชู ุจุฑ <strong>ูุชุบุฑ (variable-based)</strong> ุงุณุชูุงุฏู ฺฉูุฏ.</p>
<p>ุณุคุงู ุจุนุฏ ุงู ุงุณุช ฺฉู ฺุทูุฑ ูโุชูุงูู ุงุฒ ุงุฌุฑุง ุขุฑฺฏููุงูโูุง ุฏุฑ ููฺฏุงู ูุฑุงุฎูุงู ูุชุฏูุง ูุงฺฏโฺฏุฑ ุดุฑุท ุฌููฺฏุฑ ฺฉููุ<br>
ุฑุงูโุญู ุชุงุจุน (functional approach) ุงู ูุดฺฉู ุฑุง ุจุฑุทุฑู ูโฺฉูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Linq;
<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> EnableLogging;
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogStatus</span> (<span class="hljs-params">Func&lt;<span class="hljs-built_in">string</span>&gt; message</span>)</span>
    {
        <span class="hljs-built_in">string</span> logFilePath = ...
        <span class="hljs-keyword">if</span> (EnableLogging)
            System.IO.File.AppendAllText (logFilePath, message() + <span class="hljs-string">&quot;\r\n&quot;</span>);
    }
}
</code></pre>
<p>ุจุง ุงุณุชูุงุฏู ุงุฒ <strong>lambda expression</strong>ุ ูโุชูุงูู ุงู ูุชุฏ ุฑุง ุจุฏูู ุดููุบ ุงุถุงู ุณูุชฺฉุณ ูุฑุงุฎูุงู ฺฉูู:</p>
<pre class="hljs"><code>LogStatus(() =&gt; <span class="hljs-string">&quot;Message Headers: &quot;</span> + GetComplexMessageHeaders());
</code></pre>
<p>ุงฺฏุฑ ููุฏุงุฑ <code>EnableLogging</code> ุจุฑุงุจุฑ <code>false</code> ุจุงุดุฏุ ูุชุฏ <code>GetComplexMessageHeaders</code> ูฺโููุช ุงุฌุฑุง ูุฎูุงูุฏ ุดุฏ. ๐</p>
<hr>
<h3>๐ ฺฉูุงุณโูุง <strong>Debug</strong> ู <strong>Trace</strong></h3>
<p>ฺฉูุงุณโูุง ุงุณุชุงุชฺฉ <strong>Debug</strong> ู <strong>Trace</strong> ูุงุจูุชโูุง ูพุงูโุง ุจุฑุง <strong>logging</strong> ู <strong>assertion</strong> ูุฑุงูู ูโฺฉููุฏ.<br>
ุงู ุฏู ฺฉูุงุณ ุจุณุงุฑ ุดุจู ฺฉุฏฺฏุฑ ูุณุชูุฏุ ุชูุงูุช ุงุตู ุฏุฑ <strong>ูุฏู ุงุณุชูุงุฏู</strong> ุงุณุช:</p>
<ul>
<li>ฺฉูุงุณ <strong>Debug</strong> ุจุฑุง <strong>buildูุง ุฏุจุงฺฏ</strong> ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดุฏู ุงุณุช.</li>
<li>ฺฉูุงุณ <strong>Trace</strong> ุจุฑุง ูุฑ ุฏู ุญุงูุช <strong>ุฏุจุงฺฏ</strong> ู <strong>release</strong> ุทุฑุงุญ ุดุฏู ุงุณุช.</li>
</ul>
<p>ุจุฑุง ููู:</p>
<ul>
<li>ุชูุงู ูุชุฏูุง ฺฉูุงุณ <code>Debug</code> ุจุง <code>[Conditional(&quot;DEBUG&quot;)]</code> ุชุนุฑู ุดุฏูโุงูุฏ.</li>
<li>ุชูุงู ูุชุฏูุง ฺฉูุงุณ <code>Trace</code> ุจุง <code>[Conditional(&quot;TRACE&quot;)]</code> ุชุนุฑู ุดุฏูโุงูุฏ.</li>
</ul>
<p>ุนู: ุชูุงู ูุฑุงุฎูุงูโูุง ฺฉู ุจู <code>Debug</code> ุง <code>Trace</code> ุงูุฌุงู ูโุฏูุฏุ ุชูุณุท ฺฉุงููพุงูุฑ ุญุฐู ูโุดููุฏ ูฺฏุฑ ุงูโฺฉู symbolูุง <code>DEBUG</code> ุง <code>TRACE</code> ุชุนุฑู ุดุฏู ุจุงุดูุฏ.<br>
(ุฏุฑ <strong>Visual Studio</strong> ูโุชูุงูุฏ ุงู symbolูุง ุฑุง ุงุฒ ุทุฑู ุชุจ <strong>Build</strong> ุฏุฑ ูพูุฌุฑูโ <strong>Project Properties</strong> ูุนุงู ฺฉูุฏ. ุฏุฑ ูพุฑูฺูโูุง ุฌุฏุฏุ symbol <code>TRACE</code> ุจูโุทูุฑ ูพุดโูุฑุถ ูุนุงู ุงุณุช.)</p>
<hr>
<h3>๐ ูุชุฏูุง ููู Debug ู Trace</h3>
<p>ูุฑ ุฏู ฺฉูุงุณ <strong>Debug</strong> ู <strong>Trace</strong> ูุชุฏูุง ุฒุฑ ุฑุง ุงุฑุงุฆู ูโุฏููุฏ:</p>
<ul>
<li><code>Write</code></li>
<li><code>WriteLine</code></li>
<li><code>WriteIf</code></li>
</ul>
<p>ุงู ูุชุฏูุง ุจู ุทูุฑ ูพุดโูุฑุถ ูพุงูโูุง ุฑุง ุจู ูพูุฌุฑูโ <strong>ุฎุฑูุฌ ุฏุจุงฺฏุฑ (debuggerโs output window)</strong> ุงุฑุณุงู ูโฺฉููุฏ:</p>
<pre class="hljs"><code>Debug.Write(<span class="hljs-string">&quot;Data&quot;</span>);
Debug.WriteLine(<span class="hljs-number">23</span> * <span class="hljs-number">34</span>);
<span class="hljs-built_in">int</span> x = <span class="hljs-number">5</span>, y = <span class="hljs-number">3</span>;
Debug.WriteIf(x &gt; y, <span class="hljs-string">&quot;x is greater than y&quot;</span>);
</code></pre>
<p>ฺฉูุงุณ <strong>Trace</strong> ุนูุงูู ุจุฑ ุงูโูุงุ ูุชุฏูุง ุฒุฑ ุฑุง ูู ุฏุงุฑุฏ:</p>
<ul>
<li><code>TraceInformation</code></li>
<li><code>TraceWarning</code></li>
<li><code>TraceError</code></li>
</ul>
<p>ุชูุงูุช ุฑูุชุงุฑ ุงู ูุชุฏูุง ุจุง ูุชุฏูุง <code>Write</code> ุจุณุชฺฏ ุจู <strong>TraceListeners ูุนุงู</strong> ุฏุงุฑุฏ (ฺฉู ุฏุฑ ุจุฎุด ยซTraceListenerยป ุฏุฑ ุตูุญูโ ถฑฒ ุชูุถุญ ุฏุงุฏู ุดุฏู ุงุณุช).</p>
<h3>๐ Fail ู Assert</h3>
<p>ฺฉูุงุณโูุง <strong>Debug</strong> ู <strong>Trace</strong> ูุฑ ุฏู ูุชุฏูุง <strong>Fail</strong> ู <strong>Assert</strong> ุฑุง ูุฑุงูู ูโฺฉููุฏ.</p>
<ul>
<li>ูุชุฏ <strong>Fail</strong> ูพุงู ุฑุง ุจู ูุฑ <strong>TraceListener</strong> ููุฌูุฏ ุฏุฑ ูุฌููุนูโ <strong>Listeners</strong> ฺฉูุงุณ Debug ุง Trace ุงุฑุณุงู ูโฺฉูุฏ (ุจุฎุด ุจุนุฏ ุฑุง ุจุจูุฏ). ุงู ูุชุฏ ุจูโุทูุฑ ูพุดโูุฑุถ ูพุงู ุฑุง ุฏุฑ ุฎุฑูุฌ ุฏุจุงฺฏุฑ ูโููุณุฏ:</li>
</ul>
<pre class="hljs"><code>Debug.Fail(<span class="hljs-string">&quot;File data.txt does not exist!&quot;</span>);
</code></pre>
<ul>
<li>ูุชุฏ <strong>Assert</strong> ุฏุฑ ุตูุฑุช ฺฉู ุขุฑฺฏููุงู ุจูู ุขู <code>false</code> ุจุงุดุฏุ ูุชุฏ Fail ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ. ุงู ุนูู ุฑุง <strong>assertion</strong> ูโูุงููุฏ ู ุงฺฏุฑ ููุถ ุดูุฏุ ูุดุงูโุฏููุฏูโ ูุฌูุฏ <strong>ุจุงฺฏ</strong> ุฏุฑ ฺฉุฏ ุงุณุช. ูุดุฎุต ฺฉุฑุฏู ูพุงู ุฎุทุง ุงุฎุชุงุฑ ุงุณุช:</li>
</ul>
<pre class="hljs"><code>Debug.Assert(File.Exists(<span class="hljs-string">&quot;data.txt&quot;</span>), <span class="hljs-string">&quot;File data.txt does not exist!&quot;</span>);
<span class="hljs-keyword">var</span> result = ...
Debug.Assert(result != <span class="hljs-literal">null</span>);
</code></pre>
<p>ูุชุฏูุง <strong>Write</strong>ุ <strong>Fail</strong> ู <strong>Assert</strong> ููฺฏ overloadูุง ุฏุงุฑูุฏ ฺฉู ุนูุงูู ุจุฑ ูพุงูุ ฺฉ <strong>category string</strong> ูู ูโูพุฐุฑูุฏโฺุฒ ฺฉู ูโุชูุงูุฏ ุฏุฑ ูพุฑุฏุงุฒุด ุฎุฑูุฌ ููุฏ ุจุงุดุฏ.</p>
<hr>
<h3>โ๏ธ ุฌุงฺฏุฒู assertion ุจุง Exception</h3>
<p>ฺฉ ุฌุงฺฏุฒู ุจุฑุง assertion ุงู ุงุณุช ฺฉู ููุช ุดุฑุท ุจุฑุนฺฉุณ ุจุฑูุฑุงุฑ ุจูุฏุ ฺฉ <strong>exception</strong> ูพุฑุชุงุจ ฺฉูุฏ.<br>
ุงู ุฑูุด ุฏุฑ ููฺฏุงู ุงุนุชุจุงุฑุณูุฌ ุขุฑฺฏููุงูโูุง ูุชุฏ ุจุณุงุฑ ุฑุงุฌ ุงุณุช:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ShowMessage</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message</span>)</span>
{
    <span class="hljs-keyword">if</span> (message == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">&quot;message&quot;</span>);
    ...
}
</code></pre>
<p>ุงูุง ุชูุงูุชโูุง:</p>
<ul>
<li>ุงู ููุน ยซassertionยป ุจุฏูู ูุฏ ู ุดุฑุท ฺฉุงููพุงู ูโุดูุฏ ู ุงูุนุทุงูโูพุฐุฑ ฺฉูุชุฑ ุฏุงุฑุฏ (ฺูู ูุชุฌูโ ุดฺฉุณุช assertion ุฑุง ููโุชูุงูุฏ ุจุง <strong>TraceListeners</strong> ฺฉูุชุฑู ฺฉูุฏ).</li>
<li>ุงุฒ ูุธุฑ ููุ ุงู ุงุตูุงู assertion ูุณุช.</li>
<li><strong>Assertion</strong> ูุดุงูโุฏููุฏูโ ุจุงฺฏ ุฏุฑ <strong>ฺฉุฏ ูุชุฏ ุฌุงุฑ</strong> ุงุณุช ุงฺฏุฑ ููุถ ุดูุฏ.</li>
<li><strong>Exception</strong> ุฏุฑ ููฺฏุงู ุงุนุชุจุงุฑุณูุฌ ุขุฑฺฏููุงูุ ูุดุงูโุฏููุฏูโ ุจุงฺฏ ุฏุฑ <strong>ฺฉุฏ ูุฑุงุฎูุงููุฏู</strong> ุงุณุช.</li>
</ul>
<hr>
<h3>๐ก TraceListener</h3>
<p>ฺฉูุงุณ <strong>Trace</strong> ฺฉ ูฺฺฏ ุงุณุชุงุชฺฉ ุจู ูุงู <strong>Listeners</strong> ุฏุงุฑุฏ ฺฉู ูุฌููุนูโุง ุงุฒ ูููููโูุง <strong>TraceListener</strong> ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ุงู listenerูุง ูุณุฆูู ูพุฑุฏุงุฒุด ูุญุชูุง ุฎุฑูุฌ ูุชุฏูุง <strong>Write</strong>ุ <strong>Fail</strong> ู <strong>Trace</strong> ูุณุชูุฏ.</p>
<p>ุจู ุทูุฑ ูพุดโูุฑุถุ ูุฌููุนูโ <strong>Listeners</strong> ุดุงูู ฺฉ listener ูุงุญุฏ ุงุณุช: <strong>DefaultTraceListener</strong>.</p>
<p>ุงู listener ูพุดโูุฑุถ ุฏู ูฺฺฏ ููู ุฏุงุฑุฏ:</p>
<ol>
<li>ููุช ุจู ุฏุจุงฺฏุฑ ูุซู Visual Studio ูุชุตู ุจุงุดุฏุ ูพุงูโูุง ุจู <strong>ุฎุฑูุฌ ุฏุจุงฺฏุฑ</strong> ููุดุชู ูโุดููุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ูพุงูโูุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.</li>
<li>ููุช ูุชุฏ <strong>Fail</strong> ูุฑุงุฎูุงู ุดูุฏ (ุง ฺฉ assertion ุดฺฉุณุช ุจุฎูุฑุฏ)ุ ุจุฑูุงูู ูุชููู ูโุดูุฏ.</li>
</ol>
<hr>
<h3>๐ ุชุบุฑ ุฑูุชุงุฑ TraceListener</h3>
<p>ูโุชูุงูุฏ ุงู ุฑูุชุงุฑ ุฑุง ุชุบุฑ ุฏูุฏุ ุจู ุงู ุตูุฑุช ฺฉู listener ูพุดโูุฑุถ ุฑุง ุญุฐู ฺฉูุฏ ู listenerูุง ุฏูุฎูุงูุชุงู ุฑุง ุงุถุงูู ฺฉูุฏ.</p>
<p>โ ุดูุง ูโุชูุงูุฏ:</p>
<ul>
<li>
<p>ุงุฒ ุงุจุชุฏุง ฺฉ listener ุจุณุงุฒุฏ (ุจุง <strong>ุฒุฑฺฉูุงุณโฺฏุฑ ุงุฒ TraceListener</strong>).</p>
</li>
<li>
<p>ุง ุงุฒ ฺฉ ุงุฒ ุงููุงุน ุงุฒ ูพุด ุชุนุฑูโุดุฏู ุงุณุชูุงุฏู ฺฉูุฏ:</p>
<ul>
<li><strong>TextWriterTraceListener</strong> โ ููุดุชู ุฏุฑ ฺฉ <strong>Stream</strong> ุง <strong>TextWriter</strong> ุง ุงุถุงูู ฺฉุฑุฏู ุจู ฺฉ ูุงู.</li>
<li><strong>EventLogTraceListener</strong> โ ููุดุชู ุฏุฑ <strong>Windows Event Log</strong> (ููุท ููุฏูุฒ).</li>
<li><strong>EventProviderTraceListener</strong> โ ููุดุชู ุฏุฑ ุฒุฑุณุณุชู <strong>ETW (Event Tracing for Windows)</strong> (ูพุดุชุจุงู ฺูุฏ ุณฺฉู).</li>
</ul>
</li>
</ul>
<p>ุนูุงูู ุจุฑ ุงูุ <strong>TextWriterTraceListener</strong> ุฎูุฏ ุจู ฺูุฏ ููุน ุฏฺฏุฑ ุฒุฑฺฉูุงุณ ุดุฏู ุงุณุช:</p>
<ul>
<li><strong>ConsoleTraceListener</strong></li>
<li><strong>DelimitedListTraceListener</strong></li>
<li><strong>XmlWriterTraceListener</strong></li>
<li><strong>EventSchemaTraceListener</strong></li>
</ul>
<hr>
<h3>โ๏ธ ูุซุงู: ุงูุฒูุฏู ฺูุฏ Listener</h3>
<p>ูุซุงู ุฒุฑ listener ูพุดโูุฑุถ Trace ุฑุง ูพุงฺฉ ูโฺฉูุฏ ู ุณูพุณ ุณู listener ุงุถุงูู ูโฺฉูุฏ:</p>
<ol>
<li>ฺฉ listener ฺฉู ุจู ูุงู ุงุถุงูู ูโฺฉูุฏ.</li>
<li>ฺฉ listener ฺฉู ุฑู ฺฉูุณูู ูโููุณุฏ.</li>
<li>ฺฉ listener ฺฉู ุฏุฑ Windows Event Log ูโููุณุฏ.</li>
</ol>
<pre class="hljs"><code><span class="hljs-comment">// ูพุงฺฉ ฺฉุฑุฏู listener ูพุดโูุฑุถ:</span>
Trace.Listeners.Clear();

<span class="hljs-comment">// ุงูุฒูุฏู writer ฺฉู ุฏุฑ ูุงู trace.txt ูุงฺฏ ูโููุณุฏ:</span>
Trace.Listeners.Add(<span class="hljs-keyword">new</span> TextWriterTraceListener(<span class="hljs-string">&quot;trace.txt&quot;</span>));

<span class="hljs-comment">// ฺฏุฑูุชู ุฎุฑูุฌ ฺฉูุณูู ู ุงูุฒูุฏู ุจู ุนููุงู listener:</span>
System.IO.TextWriter tw = Console.Out;
Trace.Listeners.Add(<span class="hljs-keyword">new</span> TextWriterTraceListener(tw));

<span class="hljs-comment">// ุชูุธู Windows Event Log ู ุงูุฒูุฏู listener</span>
<span class="hljs-comment">// ุชูุฌู: CreateEventSource ูุงุฒููุฏ ุฏุณุชุฑุณ admin ุงุณุช</span>
<span class="hljs-keyword">if</span> (!EventLog.SourceExists(<span class="hljs-string">&quot;DemoApp&quot;</span>))
    EventLog.CreateEventSource(<span class="hljs-string">&quot;DemoApp&quot;</span>, <span class="hljs-string">&quot;Application&quot;</span>);

Trace.Listeners.Add(<span class="hljs-keyword">new</span> EventLogTraceListener(<span class="hljs-string">&quot;DemoApp&quot;</span>));
</code></pre>
<p>๐น ุฏุฑ ููุฑุฏ <strong>Windows Event Log</strong>:</p>
<ul>
<li>ูพุงูโูุง ฺฉู ุจุง <strong>Write</strong>ุ <strong>Fail</strong> ุง <strong>Assert</strong> ูโููุณุฏุ ููุดู ุจู ุนููุงู ูพุงู <strong>Information</strong> ุฏุฑ Event Viewer ููุงุด ุฏุงุฏู ูโุดููุฏ.</li>
<li>ูพุงูโูุง ฺฉู ุจุง <strong>TraceWarning</strong> ุง <strong>TraceError</strong> ูโููุณุฏุ ุจู ุชุฑุชุจ ุจู ุตูุฑุช <strong>warning</strong> ุง <strong>error</strong> ููุงุด ุฏุงุฏู ูโุดููุฏ.</li>
</ul>
<hr>
<h3>๐๏ธ ููุชุฑ ู ุชูุธูุงุช TraceListener</h3>
<p>ฺฉูุงุณ <strong>TraceListener</strong> ฺฉ ูฺฺฏ ุจู ูุงู <strong>Filter</strong> (ุงุฒ ููุน <code>TraceFilter</code>) ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ุจุฑุง ฺฉูุชุฑู ููุดุชู ูพุงูโูุง ุฑู ุขู listener ุงุณุชูุงุฏู ฺฉูุฏ.</p>
<p>ุจุฑุง ุงู ฺฉุงุฑ ูโุชูุงูุฏ:</p>
<ul>
<li>ฺฉ ุงุฒ ุฒุฑฺฉูุงุณโูุง ุขูุงุฏูโ <code>TraceFilter</code> ูุซู <strong>EventTypeFilter</strong> ุง <strong>SourceFilter</strong> ุฑุง ุงุณุชูุงุฏู ฺฉูุฏ.</li>
<li>ุง ฺฉ ฺฉูุงุณ ุณูุงุฑุด ุงุฒ <code>TraceFilter</code> ุจุณุงุฒุฏ ู ูุชุฏ <strong>ShouldTrace</strong> ุฑุง override ฺฉูุฏ.</li>
</ul>
<p>(ูุซูุงู ูโุชูุงูุฏ ูพุงูโูุง ุฑุง ุจุฑ ุงุณุงุณ category ููุชุฑ ฺฉูุฏ.)</p>
<hr>
<h3>๐งฉ ูฺฺฏโูุง ุฏฺฏุฑ TraceListener</h3>
<ul>
<li>ูฺฺฏโูุง <strong>IndentLevel</strong> ู <strong>IndentSize</strong> โ ุจุฑุง ฺฉูุชุฑู ุชูุฑูุชฺฏ (indentation).</li>
<li>ูฺฺฏ <strong>TraceOutputOptions</strong> โ ุจุฑุง ููุดุชู ุฏุงุฏูโูุง ุงุถุงูู.</li>
</ul>
<p>ูุซุงู:</p>
<pre class="hljs"><code>TextWriterTraceListener tl = <span class="hljs-keyword">new</span> TextWriterTraceListener(Console.Out);
tl.TraceOutputOptions = TraceOptions.DateTime | TraceOptions.Callstack;

Trace.TraceWarning(<span class="hljs-string">&quot;Orange alert&quot;</span>);
</code></pre>
<p>ุฎุฑูุฌ:</p>
<pre class="hljs"><code>DiagTest.vshost.exe Warning: 0 : Orange alert
    DateTime=2007-03-08T05:57:13.6250000Z
    Callstack=   at System.Environment.GetStackTrace(Exception e, Boolean needFileInfo)
                 at System.Environment.get_StackTrace()
                 at ...
</code></pre>
<h3>๐ฆ ูพุงฺฉโุณุงุฒ ู ุจุณุชู Listeners</h3>
<p>ุจุฑุฎ ุงุฒ <strong>listeners</strong>โูุง ูุซู <code>TextWriterTraceListener</code> ุฏุฑ ููุงุช ุฎุฑูุฌ ุฑุง ุฏุฑูู ฺฉ <strong>stream</strong> ูโููุณูุฏ ฺฉู ุชุญุช <strong>cache</strong> ูุฑุงุฑ ุฏุงุฑุฏ. ุงู ููุถูุน ุฏู ูพุงูุฏ ุฏุงุฑุฏ:</p>
<ul>
<li>โ๏ธ ฺฉ ูพุงู ููฺฉู ุงุณุช ุจูุงูุงุตูู ุฏุฑ <strong>ุฎุฑูุฌ stream ุง ูุงู</strong> ุธุงูุฑ ูุดูุฏ.</li>
<li>๐๏ธ ุดูุง ุจุงุฏ ูุจู ุงุฒ ูพุงุงู ุจุฑูุงููุ <strong>listener</strong> ุฑุง ุจุจูุฏุฏ ุง ุญุฏุงูู <strong>flush</strong> ฺฉูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ุขูฺู ุฏุฑ cache ุงุณุช ุงุฒ ุฏุณุช ูโุฑูุฏ (ุจูโุทูุฑ ูพุดโูุฑุถ ุชุง <strong>ด KB</strong> ุงฺฏุฑ ุฏุฑ ุญุงู ููุดุชู ุฏุฑ ูุงู ุจุงุดุฏ).</li>
</ul>
<p>ฺฉูุงุณโูุง <strong>Trace</strong> ู <strong>Debug</strong> ูุชุฏูุง ุงุณุชุงุชฺฉ <code>Close</code> ู <code>Flush</code> ุฑุง ูุฑุงูู ูโฺฉููุฏ ฺฉู ุจูโุชุฑุชุจ ุฑู ูููโ listeners ุงุนูุงู ูโุดููุฏ (ฺฉู ุจู ููุจูโ ุฎูุฏ <code>Close</code> ุง <code>Flush</code> ุฑุง ุฑู writers ู streams ุฒุฑู ุตุฏุง ูโุฒููุฏ).</p>
<ul>
<li><code>Close</code> ุจูโุทูุฑ ุถูู <code>Flush</code> ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏุ <strong>file handle</strong>ูุง ุฑุง ูโุจูุฏุฏ ู ุงุฒ ููุดุชู ุฏุงุฏูโ ุจุดุชุฑ ุฌููฺฏุฑ ูโฺฉูุฏ.</li>
</ul>
<p>๐ ุจูโุทูุฑ ฺฉู:</p>
<ul>
<li>ูุจู ุงุฒ ูพุงุงู ุจุฑูุงููุ ุงุฒ <code>Close</code> ุงุณุชูุงุฏู ฺฉูุฏ.</li>
<li>ูุฑ ุฒูุงู ฺฉู ุฎูุงุณุชุฏ ูุทูุฆู ุดูุฏ ุฏุงุฏูโูุง ูุนู ููุดุชู ุดุฏูโุงูุฏุ ุงุฒ <code>Flush</code> ุงุณุชูุงุฏู ฺฉูุฏ.</li>
</ul>
<p>ุงู ููุถูุน ุฒูุงู ุงููุช ุฏุงุฑุฏ ฺฉู ุงุฒ listeners ูุจุชู ุจุฑ <strong>stream</strong> ุง <strong>file</strong> ุงุณุชูุงุฏู ฺฉูุฏ.</p>
<p>ููฺููุ ฺฉูุงุณโูุง <strong>Trace</strong> ู <strong>Debug</strong> ฺฉ ูฺฺฏ ุจู ูุงู <code>AutoFlush</code> ุฏุงุฑูุฏ. ุงฺฏุฑ ููุฏุงุฑ ุขู <code>true</code> ุจุงุดุฏุ ุจุนุฏ ุงุฒ ูุฑ ูพุงูุ ฺฉ <code>Flush</code> ุงูุฌุงู ูโุดูุฏ.</p>
<p>๐ ุชูุตู ููู:<br>
ุงฺฏุฑ ุงุฒ <strong>listeners</strong> ูุจุชู ุจุฑ ูุงู ุง stream ุงุณุชูุงุฏู ูโฺฉูุฏุ ุจูุชุฑ ุงุณุช <code>AutoFlush</code> ุฑุง ุฑู <code>true</code> ุจฺฏุฐุงุฑุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ุงฺฏุฑ ฺฉ <strong>Unhandled Exception</strong> ุง ุฎุทุง ุจุญุฑุงู ุฑุฎ ุฏูุฏุ ุขุฎุฑู <strong>ด KB ุงุทูุงุนุงุช ุชุดุฎุต</strong> ููฺฉู ุงุณุช ุงุฒ ุฏุณุช ุจุฑูุฏ.</p>
<hr>
<h3>๐ ฺฉูพุงุฑฺฺฏ ุจุง Debugger</h3>
<p>ฺฏุงู ุงููุงุช ููุฏ ุงุณุช ฺฉู ฺฉ ุจุฑูุงูู ุฏุฑ ุตูุฑุช ููุฌูุฏ ุจูุฏูุ ุจุง <strong>Debugger</strong> ุชุนุงูู ุฏุงุดุชู ุจุงุดุฏ.</p>
<ul>
<li>ุฏุฑ ุฒูุงู ุชูุณุนูุ Debugger ูุนูููุงู ููุงู IDE ุดูุงุณุช (ูุซูุงู <strong>Visual Studio</strong>).</li>
<li>ุฏุฑ ุฒูุงู ุงุณุชูุฑุงุฑุ Debugger ุงุญุชูุงูุงู ุงุจุฒุงุฑูุง ุณุทุญ ูพุงูโุชุฑ ูุซู <strong>WinDbg</strong>ุ <strong>Cordbg</strong> ุง <strong>MDbg</strong> ุฎูุงูุฏ ุจูุฏ.</li>
</ul>
<hr>
<h4>๐ Attach ู Break</h4>
<p>ฺฉูุงุณ ุงุณุชุงุชฺฉ <code>Debugger</code> ุฏุฑ <strong>System.Diagnostics</strong> ุชูุงุจุน ุงุตู ุฒุฑ ุฑุง ุจุฑุง ุชุนุงูู ุจุง Debugger ูุฑุงูู ูโฺฉูุฏ:</p>
<ul>
<li><code>Break</code></li>
<li><code>Launch</code></li>
<li><code>Log</code></li>
<li><code>IsAttached</code></li>
</ul>
<p>๐น ุจุฑุง ุฏุจุงฺฏ ฺฉุฑุฏู ฺฉ ุจุฑูุงููุ ุงุจุชุฏุง ุจุงุฏ <strong>Debugger ุจู ุขู attach ุดูุฏ</strong>. ุงฺฏุฑ ุจุฑูุงูู ุฑุง ุงุฒ ุฏุงุฎู IDE ุงุฌุฑุง ฺฉูุฏุ ุงู ฺฉุงุฑ ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ุงูุฌุงู ูโุดูุฏ (ูฺฏุฑ ุงูฺฉู ุนูุฏุงู ฺฏุฒููโ โStart without debuggingโ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ).</p>
<p>ุงูุง ฺฏุงู ุดุฑูุน ุจุฑูุงูู ุฏุฑ ุญุงูุช ุฏุจุงฺฏ ุงุฒ ุฏุงุฎู IDE ุงูฺฉุงูโูพุฐุฑ ุง ุฑุงุญุช ูุณุช (ูุซูุงู ุฏุฑ <strong>Windows Service</strong> ุง ุญุช ุฏุฑ ฺฉ <strong>Visual Studio Designer</strong>).</p>
<p>๐ ุฑุงูโุญู:</p>
<ul>
<li>ุจุฑูุงูู ุฑุง ุจูโุตูุฑุช ุนุงุฏ ุงุฌุฑุง ฺฉูุฏ.</li>
<li>ุณูพุณ ุงุฒ ุฏุงุฎู IDE ฺฏุฒููโ <strong>Debug Process</strong> ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ.</li>
</ul>
<p>ุงูุจุชู ุงู ุฑูุด ุงุฌุงุฒู ููโุฏูุฏ ุฏุฑ ูุฑุงุญู ุงูููโ ุงุฌุฑุง ุจุฑูุงููุ Breakpoint ุจฺฏุฐุงุฑุฏ.</p>
<p>โ๏ธ ุฑูุด ุฌุงฺฏุฒู: ูุฑุงุฎูุงู <code>Debugger.Break</code> ุงุฒ ุฏุงุฎู ุจุฑูุงูู. ุงู ูุชุฏ ุจุงุนุซ ูโุดูุฏ ฺฉ Debugger ุฑุงูโุงูุฏุงุฒ ุดูุฏุ ุจู ุจุฑูุงูู attach ุดูุฏ ู ุงุฌุฑุง ุขู ุฑุง ูุชููู ฺฉูุฏ.</p>
<ul>
<li><code>Launch</code> ูุดุงุจู ุงุณุช ุงูุง ุงุฌุฑุง ุจุฑูุงูู ุฑุง ูุชููู ููโฺฉูุฏ.</li>
<li>ุจุนุฏ ุงุฒ attach ุดุฏูุ ูโุชูุงูุฏ ุจุง ูุชุฏ <code>Log</code> ูพุงูโูุง ุฑุง ูุณุชููุงู ุจู <strong>ูพูุฌุฑูโ ุฎุฑูุฌ Debugger</strong> ุจูุฑุณุชุฏ.</li>
<li>ูุถุนุช attach ุจูุฏู Debugger ุฑุง ูู ูโุชูุงูุฏ ุจุง ูฺฺฏ <code>IsAttached</code> ุจุฑุฑุณ ฺฉูุฏ.</li>
</ul>
<hr>
<h4>๐๏ธ ูฺฺฏโูุง Debugger</h4>
<p>ุฏู Attribute ููู ูุฌูุฏ ุฏุงุฑูุฏ:</p>
<ul>
<li><code>DebuggerStepThrough</code></li>
<li><code>DebuggerHidden</code></li>
</ul>
<p>ุงูโูุง ุจู Debugger ูพุดููุงุฏ ูโุฏููุฏ ููฺฏุงู <strong>Single-Stepping</strong> (ุงุฌุฑุง ุฎุทโุจูโุฎุท) ุจุง ฺฉ ูุชุฏุ ุณุงุฒูุฏู ุง ฺฉูุงุณ ุฎุงุต ฺฺฏููู ุฑูุชุงุฑ ฺฉูุฏ.</p>
<ul>
<li>
<p><code>DebuggerStepThrough</code> ุจู Debugger ูโฺฏูุฏ <strong>ุจุฏูู ุชุนุงูู ฺฉุงุฑุจุฑุ ุงุฒ ุฑู ฺฉ ูุชุฏ ุนุจูุฑ ฺฉูุฏ</strong>.<br>
โก๏ธ ุงู ููุถูุน ุฏุฑ ูุชุฏูุง <strong>ุฎูุฏฺฉุงุฑ ุชููุฏุดุฏู</strong> ู ูุชุฏูุง <strong>Proxy</strong> ฺฉู ฺฉุงุฑ ุงุตู ุฑุง ุจู ุฌุง ุฏฺฏุฑ ูพุงุณ ูโุฏููุฏ ููุฏ ุงุณุช.</p>
</li>
<li>
<p>ุงฺฏุฑ ุฏุฑ ูุชุฏ ูุงูุน (real method) Breakpoint ุชูุธู ุดูุฏุ Debugger ููฺูุงู ูุชุฏ Proxy ุฑุง ุฏุฑ Call Stack ูุดุงู ูโุฏูุฏโูฺฏุฑ ุงูฺฉู Attribute <code>DebuggerHidden</code> ูู ุงุถุงูู ุดูุฏ.</p>
</li>
</ul>
<p>๐ ุชุฑฺฉุจ ุงู ุฏู Attribute ุฏุฑ Proxyูุง ฺฉูฺฉ ูโฺฉูุฏ ฺฉุงุฑุจุฑ ุชูุฑฺฉุฒ ุจุดุชุฑ ุฑู <strong>ููุทู ุจุฑูุงูู</strong> ุฏุงุดุชู ุจุงุดุฏ ู ฺฉูุชุฑ ุฏุฑฺฏุฑ ุฌุฒุฆุงุช ุดูุฏ:</p>
<pre class="hljs"><code>[<span class="hljs-meta">DebuggerStepThrough, DebuggerHidden</span>]
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DoWorkProxy</span>()</span>
{
  <span class="hljs-comment">// setup...</span>
  DoWork();
  <span class="hljs-comment">// teardown...</span>
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DoWork</span>()</span> {...}   <span class="hljs-comment">// ูุชุฏ ุงุตู</span>
</code></pre>
<hr>
<h3>โ๏ธ ูพุฑุฏุงุฒุดโูุง (Processes) ู Threadูุง ูพุฑุฏุงุฒุด</h3>
<p>ุฏุฑ ุจุฎุด ุขุฎุฑ ูุตู ถุ ุชูุถุญ ุฏุงุฏู ฺฉู ฺุทูุฑ ุจุง <code>Process.Start</code> ฺฉ ูพุฑุฏุงุฒุด ุฌุฏุฏ ุฑุงูโุงูุฏุงุฒ ฺฉูุฏ.<br>
ฺฉูุงุณ <code>Process</code> ููฺูู ุงุฌุงุฒู ูโุฏูุฏ ูพุฑุฏุงุฒุดโูุง ุฏฺฏุฑ ุฑุง ุฑู ููุงู ฺฉุงููพูุชุฑ ุง ฺฉ ฺฉุงููพูุชุฑ ุฏฺฏุฑ <strong>ูพุฑุณโูุฌู ู ูุฏุฑุช ฺฉูุฏ</strong>.</p>
<ul>
<li>ฺฉูุงุณ <code>Process</code> ุจุฎุด ุงุฒ <strong>.NET Standard 2.0</strong> ุงุณุชุ ูุฑฺูุฏ ูุงุจูุชโูุง ุขู ุฑู <strong>UWP</strong> ูุญุฏูุฏ ูโุดูุฏ.</li>
</ul>
<hr>
<h4>๐ ุจุฑุฑุณ ูพุฑุฏุงุฒุดโูุง ุฏุฑ ุญุงู ุงุฌุฑุง</h4>
<p>ูุชุฏูุง <code>Process.GetProcessXXX</code> ูพุฑุฏุงุฒุดโูุง ุฑุง ุจุฑ ุงุณุงุณ <strong>ูุงู</strong> ุง <strong>ุดูุงุณูโ ูพุฑุฏุงุฒุด (PID)</strong> ุง ูููโ ูพุฑุฏุงุฒุดโูุง ุฏุฑ ุญุงู ุงุฌุฑุง ุฑู ฺฉ ฺฉุงููพูุชุฑ ุฎุงุต ุจุฑูโฺฏุฑุฏุงููุฏ.</p>
<p>ุงู ุดุงูู ูพุฑุฏุงุฒุดโูุง <strong>Managed</strong> ู <strong>Unmanaged</strong> ูโุดูุฏ.</p>
<p>ูุฑ ูููููโ <code>Process</code> ูุฌููุนูโุง ุงุฒ ูฺฺฏโูุง ุฏุงุฑุฏ ฺฉู ุดุงูู ููุงุฑุฏ ุฒุฑ ูุณุชูุฏ:</p>
<ul>
<li>ูุงู</li>
<li>ID</li>
<li>ุงูููุช</li>
<li>ูุตุฑู ุญุงูุธู ู ูพุฑุฏุงุฒูุฏู</li>
<li>Window Handleูุง</li>
<li>ู โฆ</li>
</ul>
<p>ููููู ฺฉุฏ ุฒุฑ ูููโ ูพุฑุฏุงุฒุดโูุง ุฏุฑ ุญุงู ุงุฌุฑุง ุฑู ฺฉุงููพูุชุฑ ูุนู ุฑุง ูุณุช ูโฺฉูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">foreach</span> (Process p <span class="hljs-keyword">in</span> Process.GetProcesses())
<span class="hljs-keyword">using</span> (p)
{
    Console.WriteLine(p.ProcessName);
    Console.WriteLine(<span class="hljs-string">&quot;   PID:      &quot;</span> + p.Id);
    Console.WriteLine(<span class="hljs-string">&quot;   Memory:   &quot;</span> + p.WorkingSet64);
    Console.WriteLine(<span class="hljs-string">&quot;   Threads:  &quot;</span> + p.Threads.Count);
}
</code></pre>
<ul>
<li><code>Process.GetCurrentProcess</code> ูพุฑุฏุงุฒุด ูุนู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.</li>
<li>ุจุฑุง ูพุงุงู ุฏุงุฏู ุจู ฺฉ ูพุฑุฏุงุฒุด ูโุชูุงูุฏ ุงุฒ ูุชุฏ <code>Kill</code> ุงุณุชูุงุฏู ฺฉูุฏ.</li>
</ul>
<h3>๐งต ุจุฑุฑุณ Threadูุง ุฏุฑ ฺฉ Process</h3>
<p>ุดูุง ูโุชูุงูุฏ ุจุง ูฺฺฏ <strong><code>Process.Threads</code></strong>ุ ุฑู Threadูุง ูพุฑุฏุงุฒุดโูุง ุฏฺฏุฑ ูู <strong>enumerate</strong> ฺฉูุฏ.<br>
ุงูุง ุดุกูุง ฺฉู ุฏุฑุงูุช ูโฺฉูุฏุ <strong><code>System.Threading.Thread</code></strong> ูุณุชูุฏุ ุจูฺฉู ุงุฒ ููุน <strong><code>ProcessThread</code></strong> ูุณุชูุฏ. ุงู ููุน ุจุฑุง <strong>ูุธุงู ูุฏุฑุช</strong> (Administrative) ุทุฑุงุญ ุดุฏู ุงุณุชุ ูู ุจุฑุง ููฺฏุงูโุณุงุฒ (Synchronization).</p>
<p>๐น ฺฉ <strong>ProcessThread</strong> ุงุทูุงุนุงุช ุชุดุฎุต (Diagnostic) ุฏุฑุจุงุฑูโ Thread ุฒุฑุจูุง ุงุฑุงุฆู ูโุฏูุฏ ู ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ุจุฑุฎ ุฌูุจูโูุง ุขู ุฑุง ฺฉูุชุฑู ฺฉูุฏ (ูุซู ุงูููุช ู ูุงุจุณุชฺฏ ุจู ูพุฑุฏุงุฒูุฏู).</p>
<p>ููููู ฺฉุฏ:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnumerateThreads</span> (<span class="hljs-params">Process p</span>)</span>
{
  <span class="hljs-keyword">foreach</span> (ProcessThread pt <span class="hljs-keyword">in</span> p.Threads)
  {
    Console.WriteLine (pt.Id);
    Console.WriteLine (<span class="hljs-string">&quot;   State:    &quot;</span> + pt.ThreadState);
    Console.WriteLine (<span class="hljs-string">&quot;   Priority: &quot;</span> + pt.PriorityLevel);
    Console.WriteLine (<span class="hljs-string">&quot;   Started:  &quot;</span> + pt.StartTime);
    Console.WriteLine (<span class="hljs-string">&quot;   CPU time: &quot;</span> + pt.TotalProcessorTime);
  }
}
</code></pre>
<hr>
<h3>๐ StackTrace ู StackFrame</h3>
<p>ฺฉูุงุณโูุง <strong>StackTrace</strong> ู <strong>StackFrame</strong> ฺฉ ููุง ููุทโุฎูุงูุฏู ุงุฒ <strong>Call Stack</strong> ุงุฌุฑุง ุจุฑูุงูู ุงุฑุงุฆู ูโุฏููุฏ.</p>
<p>๐ ุดูุง ูโุชูุงูุฏ Stack Trace ุฑุง ุจุฑุง:</p>
<ul>
<li>Thread ูุนู</li>
<li>ุง ฺฉ <strong>Exception</strong></li>
</ul>
<p>ุจูโุฏุณุช ุขูุฑุฏ.</p>
<p>ุงู ุงุทูุงุนุงุช ุจุดุชุฑ ุจุฑุง <strong>ุชุดุฎุต ุฎุทุงูุง (Diagnostics)</strong> ููุฏ ูุณุชูุฏุ ูุฑฺูุฏ ฺฏุงู ูู ุฏุฑ ุจุฑูุงููโููุณ (ุญููโูุง ุง Hacks) ุจูโฺฉุงุฑ ูโุฑููุฏ.</p>
<ul>
<li><strong>StackTrace</strong> โ ฺฉ Call Stack ฺฉุงูู ุฑุง ููุงุด ูโุฏูุฏ.</li>
<li><strong>StackFrame</strong> โ ฺฉ ูุฑุงุฎูุงู ูุชุฏ ูููุฑุฏ ุฏุฑูู ุขู Stack ุฑุง ููุงุด ูโุฏูุฏ.</li>
</ul>
<p>๐ก ูฺฉุชู:<br>
ุงฺฏุฑ ููุท ูโุฎูุงูุฏ <strong>ูุงู ู ุดูุงุฑู ุฎุท ูุชุฏ ูุฑุงุฎูุงููุฏู</strong> ุฑุง ุจุฏุงูุฏุ ุงุณุชูุงุฏู ุงุฒ <strong>Caller Info Attributes</strong> ฺฏุฒููโุง ุณุฑุนโุชุฑ ู ุณุงุฏูโุชุฑ ุงุณุช (ุฏุฑ ุตูุญู ฒดถ ุชูุถุญ ุฏุงุฏู ุดุฏู).</p>
<hr>
<h4>๐ผ๏ธ ุณุงุฎุชู ฺฉ StackTrace</h4>
<p>ุงฺฏุฑ ฺฉ ุดุก <strong>StackTrace</strong> ุจุฏูู ุขุฑฺฏููุงู (ุง ููุฑุงู ุจุง ฺฉ ุขุฑฺฏููุงู bool) ุจุณุงุฒุฏ:</p>
<ul>
<li>ุดูุง ฺฉ Snapshot ุงุฒ Call Stack ูุนู ูโฺฏุฑุฏ.</li>
<li>ุงฺฏุฑ ุขุฑฺฏููุงู <code>true</code> ุจุงุดุฏุ <strong>StackTrace</strong> ูุงูโูุง <code>.pdb</code> (project debug) ุฑุง ูู ูโุฎูุงูุฏ (ุงฺฏุฑ ููุฌูุฏ ุจุงุดูุฏ) ู ุจู ุดูุง <strong>ูุงู ูุงูุ ุดูุงุฑู ุฎุท ู ุดูุงุฑู ุณุชูู</strong> ุฑุง ูู ูโุฏูุฏ.</li>
</ul>
<p>๐ง ูุงูโูุง <code>.pdb</code> ุฒูุงู ุชููุฏ ูโุดููุฏ ฺฉู ุจุฑูุงูู ุฑุง ุจุง ฺฏุฒููโ <code>/debug</code> ฺฉุงููพุงู ฺฉูุฏ. (Visual Studio ุจูโุทูุฑ ูพุดโูุฑุถ ุงู ฺฉุงุฑ ุฑุง ุงูุฌุงู ูโุฏูุฏุ ูฺฏุฑ ุงูฺฉู ุฏุฑ <strong>Advanced Build Settings</strong> ุฎูุงูุด ุฑุง ุจุฎูุงูุฏ).</p>
<p>ูพุณ ุงุฒ ฺฏุฑูุชู ฺฉ StackTraceุ ูโุชูุงูุฏ:</p>
<ul>
<li>ฺฉ Frame ุฎุงุต ุฑุง ุจุง <code>GetFrame</code> ุจุฑุฑุณ ฺฉูุฏ.</li>
<li>ุง ูููโ Frameูุง ุฑุง ุจุง <code>GetFrames</code> ุฏุฑุงูุช ฺฉูุฏ.</li>
</ul>
<hr>
<h4>๐จ ููููู ฺฉุฏ</h4>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span> { A (); }
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">A</span>()</span>    { B (); }
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">B</span>()</span>    { C (); }
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">C</span>()</span>
{
  StackTrace s = <span class="hljs-keyword">new</span> StackTrace(<span class="hljs-literal">true</span>);
  Console.WriteLine (<span class="hljs-string">&quot;Total frames:   &quot;</span> + s.FrameCount);
  Console.WriteLine (<span class="hljs-string">&quot;Current method: &quot;</span> + s.GetFrame(<span class="hljs-number">0</span>).GetMethod().Name);
  Console.WriteLine (<span class="hljs-string">&quot;Calling method: &quot;</span> + s.GetFrame(<span class="hljs-number">1</span>).GetMethod().Name);
  Console.WriteLine (<span class="hljs-string">&quot;Entry method:   &quot;</span> +
                      s.GetFrame(s.FrameCount<span class="hljs-number">-1</span>).GetMethod().Name);

  Console.WriteLine (<span class="hljs-string">&quot;Call Stack:&quot;</span>);
  <span class="hljs-keyword">foreach</span> (StackFrame f <span class="hljs-keyword">in</span> s.GetFrames())
    Console.WriteLine (
      <span class="hljs-string">&quot;  File: &quot;</span>   + f.GetFileName() +
      <span class="hljs-string">&quot;  Line: &quot;</span>   + f.GetFileLineNumber() +
      <span class="hljs-string">&quot;  Col: &quot;</span>    + f.GetFileColumnNumber() +
      <span class="hljs-string">&quot;  Offset: &quot;</span> + f.GetILOffset() +
      <span class="hljs-string">&quot;  Method: &quot;</span> + f.GetMethod().Name);
}
</code></pre>
<hr>
<h4>๐ฅ๏ธ ุฎุฑูุฌ</h4>
<pre class="hljs"><code>Total frames:   4
Current method: C
Calling method: B
Entry method: Main
Call stack:
  File: C:\Test\Program.cs  Line: 15  Col: 4  Offset: 7  Method: C
  File: C:\Test\Program.cs  Line: 12  Col: 22 Offset: 6  Method: B
  File: C:\Test\Program.cs  Line: 11  Col: 22 Offset: 6  Method: A
  File: C:\Test\Program.cs  Line: 10  Col: 25 Offset: 6  Method: Main
</code></pre>
<p>๐ ูฺฉุชูโูุง:</p>
<ul>
<li><strong>IL Offset</strong> ูุญู ุฏุณุชูุฑ ุจุนุฏ ุฑุง ูุดุงู ูโุฏูุฏุ ูู ุฏุณุชูุฑ ุฏุฑ ุญุงู ุงุฌุฑุง.</li>
<li>ุงูุง ุดูุงุฑู ุฎุท ู ุณุชูู (ุงฺฏุฑ ูุงู <code>.pdb</code> ููุฌูุฏ ุจุงุดุฏ) ูุนูููุงู ููุทูโ ุงุฌุฑุง ูุงูุน ุฑุง ูุดุงู ูโุฏููุฏ.</li>
<li>CLR ุชูุงุด ูโฺฉูุฏ ุงู ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ IL ุงุณุชูุจุงุท ฺฉูุฏ. ุจุฑุง ููู ฺฉุงููพุงูุฑ ุฏุณุชูุฑูุง <strong>nop</strong> (no-operation) ุฑุง ุฏุฑุฌ ูโฺฉูุฏ.</li>
</ul>
<p>โ๏ธ ุงูุง ุงฺฏุฑ ุจุง <strong>Optimization</strong> ฺฉุงููพุงู ฺฉูุฏ:</p>
<ul>
<li>ุฏุณุชูุฑูุง nop ุฏุฑุฌ ููโุดููุฏ.</li>
<li>ุจูุงุจุฑุงู StackTrace ููฺฉู ุงุณุช ุดูุงุฑู ุฎุท/ุณุชูู ุฏุณุชูุฑ ุจุนุฏ ุฑุง ูุดุงู ุฏูุฏ.</li>
<li>Optimization ูโุชูุงูุฏ ุญุช ูุชุฏูุง ุฑุง ุงุฏุบุงู ฺฉูุฏ ู StackTrace ุฑุง ฺฉูุชุฑ ูุงุจูโุงุนุชูุงุฏ ุณุงุฒุฏ.</li>
</ul>
<hr>
<h4>๐ ุฑุงู ูุงูุจุฑ</h4>
<p>ูุฑุงุฎูุงู <code>ToString()</code> ุฑู ฺฉ StackTrace ููุงู ุงุทูุงุนุงุช ุถุฑูุฑ ุฑุง ุจูโุตูุฑุช ุณุงุฏูโุชุฑ ูโุฏูุฏ:</p>
<pre class="hljs"><code>at DebugTest.Program.C() in C:\Test\Program.cs:line 16
at DebugTest.Program.B() in C:\Test\Program.cs:line 12
at DebugTest.Program.A() in C:\Test\Program.cs:line 11
at DebugTest.Program.Main() in C:\Test\Program.cs:line 10
</code></pre>
<hr>
<h4>โ๏ธ StackTrace ุฑู Exception</h4>
<p>ูโุชูุงูุฏ StackTrace ูุฑุจูุท ุจู ฺฉ Exception ุฑุง ูู ุจฺฏุฑุฏ (ุจุฑุง ุฏุฏู ุงูฺฉู ฺู ฺุฒ ููุฌุฑ ุจู ูพุฑุชุงุจ ุดุฏู Exception ุดุฏ) ุจุง ูพุงุณโุฏุงุฏู ุขู ุจู ุณุงุฒูุฏูโ <code>StackTrace</code>.</p>
<ul>
<li>ุฎูุฏ <strong>Exception</strong> ฺฉ ูฺฺฏ ุจู ูุงู <code>StackTrace</code> ุฏุงุฑุฏุ ุงูุง ุงู ููุท ฺฉ <strong>string ุณุงุฏู</strong> ุจุฑูโฺฏุฑุฏุงูุฏุ ูู ฺฉ ุดุก StackTrace.</li>
<li>ุฏุงุดุชู ฺฉ ุดุก StackTrace ุฎู ููุฏุชุฑ ุงุณุชุ ูุฎุตูุตุงู ุจุฑุง <strong>Log ฺฉุฑุฏู Exceptionูุง ุจุนุฏ ุงุฒ ุงุณุชูุฑุงุฑ (Deployment)</strong> ฺฉู ูุนูููุงู ูุงูโูุง <code>.pdb</code> ููุฌูุฏ ูุณุชูุฏ.</li>
</ul>
<p>โ ุฏุฑ ุงู ุญุงูุช ูโุชูุงูุฏ ุจูโุฌุง ุดูุงุฑู ุฎุท/ุณุชููุ <strong>IL Offset</strong> ุฑุง Log ฺฉูุฏ.<br>
ู ุจุง ุงุณุชูุงุฏู ุงุฒ <strong>ildasm</strong>ุ ูุญู ุฏูู ุฎุทุง ุฏุฑูู ูุชุฏ ุฑุง ุจุงุจุฏ.</p>
<hr>
<h3>๐ช Windows Event Logs</h3>
<p>ูพูุชูุฑู <strong>Win32</strong> ฺฉ ูฺฉุงูุฒู <strong>Log ูุฑฺฉุฒ</strong> ุจูโูุงู <strong>Windows Event Logs</strong> ูุฑุงูู ูโฺฉูุฏ.</p>
<ul>
<li>
<p>ฺฉูุงุณโูุง <strong>Debug</strong> ู <strong>Trace</strong> ฺฉู ูุจูุงู ุงุณุชูุงุฏู ฺฉุฑุฏูุ ุฏุฑ ุตูุฑุช ุซุจุช ฺฉ <strong>EventLogTraceListener</strong> ูโุชูุงููุฏ ุฏุฑ Windows Event Log ุจููุณูุฏ.</p>
</li>
<li>
<p>ุจุง ฺฉูุงุณ <strong>EventLog</strong>ุ ุดูุง ูโุชูุงูุฏ:</p>
<ul>
<li>ูุณุชููุงู ุฏุฑ Windows Event Log ุจููุณุฏ (ุจุฏูู ูุงุฒ ุจู Trace ุง Debug).</li>
<li>ุง ุฏุงุฏูโูุง ุฑูุฏุงุฏ ุฑุง ุจุฎูุงูุฏ ู ูพุงุด ฺฉูุฏ.</li>
</ul>
</li>
</ul>
<p>๐๏ธ ููุดุชู ุฏุฑ Event Log ุฏุฑ <strong>ุจุฑูุงููโูุง Windows Service</strong> ุจุณุงุฑ ููุทู ุงุณุช. ฺูู ุงฺฏุฑ ุฎุทุง ุฑุฎ ุฏูุฏุ ููโุชูุงูุฏ ฺฉ UI ุจุงุฒ ฺฉูุฏ ู ุจู ฺฉุงุฑุจุฑ ุจฺฏูุฏ ุจู ูุงู ุฎุงุต ุจุฑุง ุงุทูุงุนุงุช ุชุดุฎุต ูุฑุงุฌุนู ฺฉูุฏ. ููฺููุ ฺูู ููุดุชู Serviceูุง ุฏุฑ Event Log ฺฉ <strong>ุฑูู ุงุณุชุงูุฏุงุฑุฏ</strong> ุงุณุชุ ุงู ุงููู ุฌุง ุฎูุงูุฏ ุจูุฏ ฺฉู ฺฉ ูุฏุฑ ุณุณุชู (Administrator) ุจุฑุง ุจุฑุฑุณ ูุดฺฉู ุณุฑูุณ ุดูุง ูฺฏุงู ูโฺฉูุฏ.</p>
<hr>
<p>๐ ุณู Event Log ุงุณุชุงูุฏุงุฑุฏ ุฏุฑ ููุฏูุฒ ูุฌูุฏ ุฏุงุฑุฏ:</p>
<ul>
<li><strong>Application</strong></li>
<li><strong>System</strong></li>
<li><strong>Security</strong></li>
</ul>
<p>๐ ูุนูููุงู ุจุฑูุงููโูุง ุฏุฑ <strong>Application Log</strong> ูโููุณูุฏ.</p>
<h3>โ๏ธ ููุดุชู ุฏุฑ <strong>Event Log</strong></h3>
<p>ุจุฑุง ููุดุชู ุฏุฑ <strong>Windows Event Log</strong> ูุฑุงุญู ุฒุฑ ุฑุง ุงูุฌุงู ุฏูุฏ:</p>
<p>1๏ธโฃ ฺฉ ุงุฒ ุณู <strong>event log</strong> ููุฌูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ (ูุนูููุงู <strong>Application</strong>).<br>
2๏ธโฃ ฺฉ <strong>source name</strong> (ูุงู ููุจุน) ูุดุฎุต ฺฉูุฏ ู ุฏุฑ ุตูุฑุช ูุงุฒ ุขู ุฑุง ุจุณุงุฒุฏ (ุณุงุฎุชู ูุงุฒููุฏ ุฏุณุชุฑุณ ูุฏุฑุช ุงุณุช).<br>
3๏ธโฃ ูุชุฏ <strong>EventLog.WriteEntry</strong> ุฑุง ุจุง ูุงู ูุงฺฏุ ูุงู ููุจุน ู ุฏุงุฏูโ ูพุงู ูุฑุงุฎูุงู ฺฉูุฏ.</p>
<p>๐น <strong>Source name</strong> ฺฉ ูุงู ูุดุฎุต ู ูุงุจู ุดูุงุณุง ุจุฑุง ุจุฑูุงููโ ุดูุงุณุช. ูุจู ุงุฒ ุงุณุชูุงุฏู ุจุงุฏ ุขู ุฑุง ุซุจุช ฺฉูุฏ. ุงู ฺฉุงุฑ ุจุง ูุชุฏ <strong>CreateEventSource</strong> ุงูุฌุงู ูโุดูุฏ. ุณูพุณ ูโุชูุงูุฏ ุงุฒ ูุชุฏ <strong>WriteEntry</strong> ุงุณุชูุงุฏู ฺฉูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> SourceName = <span class="hljs-string">&quot;MyCompany.WidgetServer&quot;</span>;
<span class="hljs-comment">// CreateEventSource ูุงุฒููุฏ ุฏุณุชุฑุณ ูุฏุฑุช ุงุณุชุ ุจูุงุจุฑุงู ูุนูููุงู ุฏุฑ ุจุฎุด ูุตุจ ุจุฑูุงูู ุงูุฌุงู ูโุดูุฏ.</span>
<span class="hljs-keyword">if</span> (!EventLog.SourceExists(SourceName))
    EventLog.CreateEventSource(SourceName, <span class="hljs-string">&quot;Application&quot;</span>);

EventLog.WriteEntry(SourceName,
  <span class="hljs-string">&quot;Service started; using configuration file=...&quot;</span>,
  EventLogEntryType.Information);
</code></pre>
<p>๐ธ ููุฏุงุฑ <strong>EventLogEntryType</strong> ูโุชูุงูุฏ ฺฉ ุงุฒ ููุงุฑุฏ ุฒุฑ ุจุงุดุฏ:</p>
<ul>
<li><strong>Information</strong> โน๏ธ</li>
<li><strong>Warning</strong> โ๏ธ</li>
<li><strong>Error</strong> โ</li>
<li><strong>SuccessAudit</strong> โ</li>
<li><strong>FailureAudit</strong> ๐ซ</li>
</ul>
<p>ูุฑฺฉุฏุงู ุฏุฑ <strong>Windows Event Viewer</strong> ุจุง ฺฉ ุขฺฉูู ูุชูุงูุช ููุงุด ุฏุงุฏู ูโุดููุฏ. ููฺูู ูโุชูุงูุฏ ุจูโุทูุฑ ุงุฎุชุงุฑ ฺฉ <strong>Category</strong> ู <strong>Event ID</strong> (ูุฑ ุฏู ุนุฏุฏ ุฏูุฎูุงู) ู ุฏุงุฏูโ ุจุงูุฑ ุงุถุงูู ฺฉูุฏ.</p>
<p>๐ ูุชุฏ <strong>CreateEventSource</strong> ููฺูู ุงุฌุงุฒู ูโุฏูุฏ ูุงู ฺฉ ฺฉุงููพูุชุฑ ุฏฺฏุฑ ุฑุง ูุดุฎุต ฺฉูุฏุ ุฏุฑ ุตูุฑุช ฺฉู ุฏุณุชุฑุณ ฺฉุงู ุฏุงุดุชู ุจุงุดุฏุ ูโุชูุงูุฏ ุฏุฑ <strong>event log</strong> ุขู ุณุณุชู ูู ุจููุณุฏ.</p>
<hr>
<h3>๐ ุฎูุงูุฏู ุงุฒ <strong>Event Log</strong></h3>
<p>ุจุฑุง ุฎูุงูุฏู ุงุฒ ฺฉ <strong>event log</strong>:<br>
1๏ธโฃ ฺฉูุงุณ <strong>EventLog</strong> ุฑุง ุจุง ูุงู ูุงฺฏ ููุฑุฏูุธุฑ (ู ุฏุฑ ุตูุฑุช ูุงุฒุ ูุงู ฺฉ ฺฉุงููพูุชุฑ ุฏฺฏุฑ) ูููููโุณุงุฒ ฺฉูุฏ.<br>
2๏ธโฃ ูุฑ ูุฑูุฏ ุฑุง ุงุฒ ุทุฑู ูฺฺฏ <strong>Entries</strong> ุจุฎูุงูุฏ:</p>
<pre class="hljs"><code>EventLog log = <span class="hljs-keyword">new</span> EventLog(<span class="hljs-string">&quot;Application&quot;</span>);
Console.WriteLine(<span class="hljs-string">&quot;Total entries: &quot;</span> + log.Entries.Count);

EventLogEntry last = log.Entries[log.Entries.Count - <span class="hljs-number">1</span>];
Console.WriteLine(<span class="hljs-string">&quot;Index:   &quot;</span> + last.Index);
Console.WriteLine(<span class="hljs-string">&quot;Source:  &quot;</span> + last.Source);
Console.WriteLine(<span class="hljs-string">&quot;Type:    &quot;</span> + last.EntryType);
Console.WriteLine(<span class="hljs-string">&quot;Time:    &quot;</span> + last.TimeWritten);
Console.WriteLine(<span class="hljs-string">&quot;Message: &quot;</span> + last.Message);
</code></pre>
<p>๐น ููฺูู ูโุชูุงูุฏ ูููโ ูุงฺฏโูุง ุฑุง ุจุฑุง ฺฉุงููพูุชุฑ ูุนู (ุง ฺฉ ุณุณุชู ุฏฺฏุฑ) ุจุง ูุชุฏ <strong>EventLog.GetEventLogs</strong> ูพูุงุด ฺฉูุฏ (ุจุฑุง ุฏุณุชุฑุณ ฺฉุงูู ูุงุฒ ุจู ุฏุณุชุฑุณ ูุฏุฑุช ุฏุงุฑุฏ):</p>
<pre class="hljs"><code><span class="hljs-keyword">foreach</span> (EventLog log <span class="hljs-keyword">in</span> EventLog.GetEventLogs())
    Console.WriteLine(log.LogDisplayName);
</code></pre>
<p>ุงู ูุนูููุงู ุญุฏุงูู ุดุงูู <strong>Application</strong>ุ <strong>Security</strong> ู <strong>System</strong> ุฎูุงูุฏ ุจูุฏ.</p>
<hr>
<h3>๐ ูุงูุชูุฑูฺฏ <strong>Event Log</strong></h3>
<p>ูโุชูุงูุฏ ุจูโูุญุถ ููุดุชูโุดุฏู ฺฉ ูุฑูุฏ ุฌุฏุฏ ุฏุฑ <strong>Windows Event Log</strong> ูุทูุน ุดูุฏ. ุงู ฺฉุงุฑ ุจุง <strong>EntryWritten event</strong> ุงูุฌุงู ูโุดูุฏ. ุงู ุฑูุฏุงุฏ ุจุฑุง ูุงฺฏโูุง ุณุณุชู ูุญู ูุนุงู ูโุดูุฏ ู ูุงุฑุบ ุงุฒ ุงูฺฉู ฺฉุฏุงู ุจุฑูุงูู ูุฑูุฏ ุฑุง ููุดุชู ุงุณุชุ ุฑุฎ ุฎูุงูุฏ ุฏุงุฏ.</p>
<p>ุจุฑุง ูุนุงูโุณุงุฒ ูุงูุชูุฑูฺฏ ูุงฺฏ:<br>
1๏ธโฃ ฺฉ ููููู ุงุฒ <strong>EventLog</strong> ุงุฌุงุฏ ฺฉูุฏ.<br>
2๏ธโฃ ูฺฺฏ <strong>EnableRaisingEvents</strong> ุฑุง ุฑู true ูุฑุงุฑ ุฏูุฏ.<br>
3๏ธโฃ ุฑูุฏุงุฏ <strong>EntryWritten</strong> ุฑุง ููุฏู ฺฉูุฏ.</p>
<p>ููููู ฺฉุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> log = <span class="hljs-keyword">new</span> EventLog(<span class="hljs-string">&quot;Application&quot;</span>))
{
    log.EnableRaisingEvents = <span class="hljs-literal">true</span>;
    log.EntryWritten += DisplayEntry;
    Console.ReadLine();
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DisplayEntry</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> sender, EntryWrittenEventArgs e</span>)</span>
{
    EventLogEntry entry = e.Entry;
    Console.WriteLine(entry.Message);
}
</code></pre>
<h3>โก <strong>Performance Counters</strong></h3>
<p><strong>Performance Counters</strong> ฺฉ ูุงุจูุช ุงุฎุชุตุงุต <strong>Windows</strong> ุงุณุช ู ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุขู ุจุงุฏ ูพฺฉุฌ <strong>NuGet</strong> ุจุง ูุงู<br>
<code>System.Diagnostics.PerformanceCounter</code> ูุตุจ ุดูุฏ.<br>
ุงฺฏุฑ ูุฏู ุดูุง <strong>Linux</strong> ุง <strong>macOS</strong> ุจุงุดุฏุ ุจุงุฏ ุจู ุจุฎุด <strong>โCross-Platform Diagnostic Toolsโ</strong> ุฏุฑ ุตูุญูโ 625 ูุฑุงุฌุนู ฺฉูุฏ ุชุง ุงุจุฒุงุฑูุง ุฌุงฺฏุฒู ุฑุง ุจุจูุฏ.</p>
<hr>
<h4>๐ ูุฏู ุงุฒ Performance Counters</h4>
<p>ูฺฉุงูุฒูโูุง ูุงฺฏโฺฏุฑ ฺฉู ุชุงฺฉููู ุจุฑุฑุณ ฺฉุฑุฏู ุจุดุชุฑ ุจุฑุง <strong>ุชุญููโูุง ุจุนุฏ</strong> ููุฏ ูุณุชูุฏ.<br>
ุงูุง ุงฺฏุฑ ุจุฎูุงูู ุงุฒ ูุถุนุช <strong>ูุนู</strong> ฺฉ ุจุฑูุงูู ุง ฺฉู ุณุณุชู ูุทูุน ุดููุ ูุงุฒ ุจู ุฑูฺฉุฑุฏ <strong>ุจูุงุฏุฑูฺฏ (real-time)</strong> ุฏุงุฑู.</p>
<p>๐น ุฑุงูฺฉุงุฑ <strong>Win32</strong> ุจุฑุง ุงู ูุงุฒุ ุงุณุชูุงุฏู ุงุฒ ุฒุฑุณุงุฎุช <strong>performance-monitoring</strong> ุงุณุช. ุงู ุฒุฑุณุงุฎุช ุดุงูู:</p>
<ul>
<li>ูุฌููุนูโุง ุงุฒ <strong>performance counters</strong> ุงุณุช ฺฉู ุชูุณุท ุณุณุชู ู ุจุฑูุงููโูุง ููุชุดุฑ ูโุดููุฏ.</li>
<li>ุงุจุฒุงุฑูุง ุฏุฑ ูุงูุจ <strong>Microsoft Management Console (MMC) snap-ins</strong> ุจุฑุง ูุงูุชูุฑูฺฏ ุจูุงุฏุฑูฺฏ ุงู ฺฉุงูุชุฑูุง.</li>
</ul>
<hr>
<h4>๐๏ธ ุฏุณุชูโุจูุฏ Performance Counters</h4>
<p>ฺฉุงูุชุฑูุง ุนููฺฉุฑุฏ ุฏุฑ ฺฏุฑููโูุง ุจู ูุงู <strong>category</strong> (ุง <strong>performance object</strong> ุฏุฑ ุฑุงุจุทโูุง ฺฏุฑุงูฺฉ) ูุฑุงุฑ ุฏุงุฑูุฏ.<br>
ูุฑ <strong>category</strong> ูุฌููุนูโุง ุงุฒ ฺฉุงูุชุฑูุง ูุฑุชุจุท ุฑุง ุจุฑุง ูุงูุชูุฑูฺฏ ฺฉ ุฌูุจู ุงุฒ ุณุณุชู ุง ุจุฑูุงูู ฺฏุฑุฏ ูู ูโุขูุฑุฏ.</p>
<p>ูุซุงูโูุง:</p>
<ul>
<li><strong>System</strong> โ๏ธ</li>
<li><strong>Processor</strong> ๐ฅ๏ธ</li>
<li><strong>.NET CLR Memory</strong> ๐พ</li>
</ul>
<p>ุฏุฑ ุฏุณุชูโ <strong>.NET CLR Memory</strong> ฺฉุงูุชุฑูุง ูุงููุฏ:</p>
<ul>
<li><strong>% Time in GC</strong></li>
<li><strong># Bytes in All Heaps</strong></li>
<li><strong>Allocated bytes/sec</strong></li>
</ul>
<p>ูุฑ <strong>category</strong> ูโุชูุงูุฏ ฺฉ ุง ฺูุฏ <strong>instance</strong> ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุจูโุตูุฑุช ูุณุชูู ูุงุจู ูุงูุชูุฑูฺฏ ูุณุชูุฏ.<br>
ุจุฑุง ููููู:</p>
<ul>
<li>ฺฉุงูุชุฑ <strong>% Processor Time</strong> ุฏุฑ ุฏุณุชูโ <strong>Processor</strong> ุงู ุงูฺฉุงู ุฑุง ูโุฏูุฏ ฺฉู <strong>ุงุณุชูุงุฏู ุงุฒ CPU</strong> ุฑุง ูุงูุชูุฑ ฺฉูุฏ.</li>
<li>ุฏุฑ ฺฉ ุณุณุชู ฺูุฏูพุฑุฏุงุฒูุฏูโุงุ ุงู ฺฉุงูุชุฑ ฺฉ instance ุจุฑุง ูุฑ CPU ุฏุงุฑุฏ ู ุดูุง ูโุชูุงูุฏ ูุตุฑู ูุฑ CPU ุฑุง ุฌุฏุงฺฏุงูู ุจุฑุฑุณ ฺฉูุฏ.</li>
</ul>
<hr>
<h4>โ๏ธ ูฺฉุชูโ ููู ุฏุฑุจุงุฑูโ ุฏุณุชุฑุณ</h4>
<p>ุฎูุงูุฏู <strong>performance counters</strong> ุง <strong>categories</strong> ููฺฉู ุงุณุช ูุงุฒููุฏ ุฏุณุชุฑุณ <strong>administrator</strong> ุฑู ุณุณุชู ูุญู ุง ููุตุฏ ุจุงุดุฏุ ุจุณุชู ุจู ฺุฒ ฺฉู ูโุฎูุงูุฏ ุจุฑุฑุณ ฺฉูุฏ.</p>
<hr>
<h3>๐ Enumerating the Available Counters</h3>
<p>ฺฉุฏ ุฒุฑ ูููโ <strong>performance counters</strong> ููุฌูุฏ ุฏุฑ ุณุณุชู ุฑุง ูพูุงุด ูโฺฉูุฏ. ุงฺฏุฑ ุฏุณุชูโุง <strong>instance</strong> ุฏุงุดุชู ุจุงุดุฏุ ฺฉุงูุชุฑูุง ูุฑุจูุท ุจู ูุฑ instance ูุฒ ุจุฑุฑุณ ูโุดููุฏ:</p>
<pre class="hljs"><code>PerformanceCounterCategory[] cats =
    PerformanceCounterCategory.GetCategories();

<span class="hljs-keyword">foreach</span> (PerformanceCounterCategory cat <span class="hljs-keyword">in</span> cats)
{
    Console.WriteLine(<span class="hljs-string">&quot;Category: &quot;</span> + cat.CategoryName);
    <span class="hljs-built_in">string</span>[] instances = cat.GetInstanceNames();

    <span class="hljs-keyword">if</span> (instances.Length == <span class="hljs-number">0</span>)
    {
        <span class="hljs-keyword">foreach</span> (PerformanceCounter ctr <span class="hljs-keyword">in</span> cat.GetCounters())
            Console.WriteLine(<span class="hljs-string">&quot;  Counter: &quot;</span> + ctr.CounterName);
    }
    <span class="hljs-keyword">else</span>   <span class="hljs-comment">// Dump counters with instances</span>
    {
        <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> instance <span class="hljs-keyword">in</span> instances)
        {
            Console.WriteLine(<span class="hljs-string">&quot;  Instance: &quot;</span> + instance);
            <span class="hljs-keyword">if</span> (cat.InstanceExists(instance))
                <span class="hljs-keyword">foreach</span> (PerformanceCounter ctr <span class="hljs-keyword">in</span> cat.GetCounters(instance))
                    Console.WriteLine(<span class="hljs-string">&quot;    Counter: &quot;</span> + ctr.CounterName);
        }
    }
}
</code></pre>
<p>๐ ุฎุฑูุฌ ุงู ฺฉุฏ ุจุด ุงุฒ <strong>ฑฐูฌฐฐฐ ุฎุท</strong> ุฎูุงูุฏ ุจูุฏ!<br>
ููฺูู ุงุฌุฑุง ุขู ฺฉู ุทูู ูโฺฉุดุฏุ ฺูู ูุชุฏ <strong>PerformanceCounterCategory.InstanceExists</strong> ูพุงุฏูโุณุงุฒ ฺฉุงุฑุขูุฏ ูุฏุงุฑุฏ.<br>
ุฏุฑ ฺฉ ุณุณุชู ูุงูุนุ ุจูุชุฑ ุงุณุช ุงุทูุงุนุงุช ุฌุฒุฆโุชุฑ ุฑุง ููุท ุฏุฑ ุตูุฑุช ูุงุฒ ุฏุฑุงูุช ฺฉูุฏ.</p>
<hr>
<h3>๐ ุงุณุชุฎุฑุงุฌ ููุท Performance Counters ูุฑุจูุท ุจู .NET</h3>
<p>ููููู ฺฉุฏ ุฒุฑ ุจุง ุงุณุชูุงุฏู ุงุฒ <strong>LINQ</strong> ููุท ฺฉุงูุชุฑูุง ูุฑุจูุท ุจู <strong>.NET</strong> ุฑุง ูุงฺฉุด ฺฉุฑุฏู ู ูุชุฌู ุฑุง ุฏุฑ ฺฉ ูุงู XML ุฐุฎุฑู ูโฺฉูุฏ:</p>
<pre class="hljs"><code><span class="hljs-keyword">var</span> x =
  <span class="hljs-keyword">new</span> XElement(<span class="hljs-string">&quot;counters&quot;</span>,
    <span class="hljs-keyword">from</span> PerformanceCounterCategory cat <span class="hljs-keyword">in</span>
         PerformanceCounterCategory.GetCategories()
    <span class="hljs-keyword">where</span> cat.CategoryName.StartsWith(<span class="hljs-string">&quot;.NET&quot;</span>)
    <span class="hljs-keyword">let</span> instances = cat.GetInstanceNames()
    <span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-keyword">new</span> <span class="hljs-title">XElement</span>(<span class="hljs-params"><span class="hljs-string">&quot;category&quot;</span>,
      <span class="hljs-keyword">new</span> XAttribute(<span class="hljs-string">&quot;name&quot;</span>, cat.CategoryName</span>),
      instances.Length</span> == <span class="hljs-number">0</span>
        ? <span class="hljs-keyword">from</span> c <span class="hljs-keyword">in</span> cat.GetCounters()
          <span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-keyword">new</span> <span class="hljs-title">XElement</span>(<span class="hljs-params"><span class="hljs-string">&quot;counter&quot;</span>,
            <span class="hljs-keyword">new</span> XAttribute(<span class="hljs-string">&quot;name&quot;</span>, c.CounterName</span>))
        : <span class="hljs-keyword">from</span> i <span class="hljs-keyword">in</span> instances
          <span class="hljs-keyword">select</span> <span class="hljs-keyword">new</span> <span class="hljs-title">XElement</span>(<span class="hljs-params"><span class="hljs-string">&quot;instance&quot;</span>, <span class="hljs-keyword">new</span> XAttribute(<span class="hljs-string">&quot;name&quot;</span>, i</span>),
            !cat.<span class="hljs-title">InstanceExists</span>(<span class="hljs-params">i</span>)
              ? <span class="hljs-literal">null</span>
              : <span class="hljs-keyword">from</span> c <span class="hljs-keyword">in</span> cat.<span class="hljs-title">GetCounters</span>(<span class="hljs-params">i</span>)
                <span class="hljs-keyword">select</span> <span class="hljs-keyword">new</span> <span class="hljs-title">XElement</span>(<span class="hljs-params"><span class="hljs-string">&quot;counter&quot;</span>,
                  <span class="hljs-keyword">new</span> XAttribute(<span class="hljs-string">&quot;name&quot;</span>, c.CounterName</span>))
        )
    )
  )</span>;

x.Save(<span class="hljs-string">&quot;counters.xml&quot;</span>);
</code></pre>
<h3>๐ <strong>ุฎูุงูุฏู ุฏุงุฏูโูุง Performance Counter</strong></h3>
<p>ุจุฑุง ฺฏุฑูุชู ููุฏุงุฑ ฺฉ <strong>performance counter</strong> ุจุงุฏ ฺฉ ุดุก ุงุฒ ฺฉูุงุณ <strong>PerformanceCounter</strong> ุจุณุงุฒุฏ ู ุณูพุณ ฺฉ ุงุฒ ูุชุฏูุง ุฒุฑ ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ:</p>
<ul>
<li><strong>NextValue</strong> โ ฺฉ ููุฏุงุฑ ุณุงุฏู ุงุฒ ููุน <code>float</code> ุจุฑูโฺฏุฑุฏุงูุฏ.</li>
<li><strong>NextSample</strong> โ ฺฉ ุดุก ุงุฒ ููุน <code>CounterSample</code> ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู ุดุงูู ูฺฺฏโูุง ูพุดุฑูุชูโุชุฑ ูุซู <code>CounterFrequency</code>ุ <code>TimeStamp</code>ุ <code>BaseValue</code> ู <code>RawValue</code> ุงุณุช.</li>
</ul>
<hr>
<h4>๐ฅ๏ธ ููููู: ููุงุด ูุตุฑู CPU</h4>
<p>ฺฉุงูุณุชุฑุงฺฉุชูุฑ ฺฉูุงุณ <strong>PerformanceCounter</strong> ุณู ูพุงุฑุงูุชุฑ ูโฺฏุฑุฏ:</p>
<ul>
<li>ูุงู <strong>category</strong></li>
<li>ูุงู <strong>counter</strong></li>
<li>ฺฉ <strong>instance</strong> ุงุฎุชุงุฑ</li>
</ul>
<p>ุจุฑุง ููุงุด ุฏุฑุตุฏ ุงุณุชูุงุฏูโ ูพุฑุฏุงุฒูุฏู (CPU) ุฑู ูููโ ูุณุชูโูุง:</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> PerformanceCounter pc = <span class="hljs-keyword">new</span> PerformanceCounter(
    <span class="hljs-string">&quot;Processor&quot;</span>,
    <span class="hljs-string">&quot;% Processor Time&quot;</span>,
    <span class="hljs-string">&quot;_Total&quot;</span>);

Console.WriteLine(pc.NextValue());
</code></pre>
<hr>
<h4>๐พ ููููู: ููุงุด ูุตุฑู ูุงูุน ุญุงูุธูโ ุฎุตูุต ูพุฑุฏุงุฒุด ุฌุงุฑ</h4>
<pre class="hljs"><code><span class="hljs-built_in">string</span> procName = Process.GetCurrentProcess().ProcessName;

<span class="hljs-keyword">using</span> PerformanceCounter pc = <span class="hljs-keyword">new</span> PerformanceCounter(
    <span class="hljs-string">&quot;Process&quot;</span>,
    <span class="hljs-string">&quot;Private Bytes&quot;</span>,
    procName);

Console.WriteLine(pc.NextValue());
</code></pre>
<hr>
<h3>๐ ูุงูุชูุฑูฺฏ ุชุบุฑุงุช (Polling)</h3>
<p>ฺฉูุงุณ <strong>PerformanceCounter</strong> ุฑูุฏุงุฏ <strong>ValueChanged</strong> ูุฏุงุฑุฏ. ุจูุงุจุฑุงู ุจุฑุง ูุงูุชูุฑูฺฏ ุชุบุฑุงุช ุจุงุฏ <strong>polling</strong> ุงูุฌุงู ุฏูุฏ.<br>
ุฏุฑ ูุซุงู ุฒุฑุ ูุฑ <strong>ฒฐฐ ููโุซุงูู</strong> ููุฏุงุฑ ุจุฑุฑุณ ูโุดูุฏ ุชุง ุฒูุงู ฺฉู ุจุง <strong>EventWaitHandle</strong> ุณฺฏูุงู ุชููู ุงุฑุณุงู ุดูุฏ:</p>
<pre class="hljs"><code><span class="hljs-comment">// ูุงุฒููุฏ import ฺฉุฑุฏู System.Threading ู System.Diagnostics</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Monitor</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> category, <span class="hljs-built_in">string</span> counter, <span class="hljs-built_in">string</span> instance,
                   EventWaitHandle stopper</span>)</span>
{
    <span class="hljs-keyword">if</span> (!PerformanceCounterCategory.Exists(category))
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">&quot;Category does not exist&quot;</span>);

    <span class="hljs-keyword">if</span> (!PerformanceCounterCategory.CounterExists(counter, category))
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">&quot;Counter does not exist&quot;</span>);

    <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) instance = <span class="hljs-string">&quot;&quot;</span>;   <span class="hljs-comment">// &quot;&quot; == ุจุฏูู instance (ูู null!)</span>

    <span class="hljs-keyword">if</span> (instance != <span class="hljs-string">&quot;&quot;</span> &amp;&amp;
        !PerformanceCounterCategory.InstanceExists(instance, category))
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">&quot;Instance does not exist&quot;</span>);

    <span class="hljs-built_in">float</span> lastValue = <span class="hljs-number">0f</span>;

    <span class="hljs-keyword">using</span> (PerformanceCounter pc = <span class="hljs-keyword">new</span> PerformanceCounter(category, counter, instance))
        <span class="hljs-keyword">while</span> (!stopper.WaitOne(<span class="hljs-number">200</span>, <span class="hljs-literal">false</span>))
        {
            <span class="hljs-built_in">float</span> <span class="hljs-keyword">value</span> = pc.NextValue();
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">value</span> != lastValue)   <span class="hljs-comment">// ููุท ุงฺฏุฑ ุชุบุฑ ฺฉูุฏ ููุงุด ุฏุงุฏู ูโุดูุฏ</span>
            {
                Console.WriteLine(<span class="hljs-keyword">value</span>);
                lastValue = <span class="hljs-keyword">value</span>;
            }
        }
}
</code></pre>
<hr>
<h4>โ๏ธ ุงุฌุฑุง ููุฒูุงู ุจุฑุง CPU ู ุฏุณฺฉ</h4>
<pre class="hljs"><code>EventWaitHandle stopper = <span class="hljs-keyword">new</span> ManualResetEvent(<span class="hljs-literal">false</span>);

<span class="hljs-keyword">new</span> Thread(() =&gt;
    Monitor(<span class="hljs-string">&quot;Processor&quot;</span>, <span class="hljs-string">&quot;% Processor Time&quot;</span>, <span class="hljs-string">&quot;_Total&quot;</span>, stopper)
).Start();

<span class="hljs-keyword">new</span> Thread(() =&gt;
    Monitor(<span class="hljs-string">&quot;LogicalDisk&quot;</span>, <span class="hljs-string">&quot;% Idle Time&quot;</span>, <span class="hljs-string">&quot;C:&quot;</span>, stopper)
).Start();

Console.WriteLine(<span class="hljs-string">&quot;Monitoring - press any key to quit&quot;</span>);
Console.ReadKey();

stopper.Set();
</code></pre>
<hr>
<h3>๐๏ธ ุงุฌุงุฏ ฺฉุงูุชุฑ ู ููุดุชู ุฏุงุฏู ุฏุฑ Performance Counter</h3>
<p>ูุจู ุงุฒ ููุดุชู ุฏุงุฏู ุจุงุฏ:</p>
<ol>
<li>ฺฉ <strong>category</strong> ุจุณุงุฒุฏ.</li>
<li>ูููโ <strong>counters</strong> ูุฑุจูุท ุจู ุขู ุฏุณุชู ุฑุง <strong>ุฏุฑ ฺฉ ูุฑุญูู</strong> ุชุนุฑู ฺฉูุฏ.</li>
</ol>
<p>ูุซุงู:</p>
<pre class="hljs"><code><span class="hljs-built_in">string</span> category = <span class="hljs-string">&quot;Nutshell Monitoring&quot;</span>;
<span class="hljs-comment">// ุฏู ฺฉุงูุชุฑ ุฏุฑ ุงู ุฏุณุชู ุชุนุฑู ูโฺฉูู</span>
<span class="hljs-built_in">string</span> eatenPerMin = <span class="hljs-string">&quot;Macadamias eaten so far&quot;</span>;
<span class="hljs-built_in">string</span> tooHard = <span class="hljs-string">&quot;Macadamias deemed too hard&quot;</span>;

<span class="hljs-keyword">if</span> (!PerformanceCounterCategory.Exists(category))
{
    CounterCreationDataCollection cd = <span class="hljs-keyword">new</span> CounterCreationDataCollection();

    cd.Add(<span class="hljs-keyword">new</span> CounterCreationData(
        eatenPerMin,
        <span class="hljs-string">&quot;Number of macadamias consumed, including shelling time&quot;</span>,
        PerformanceCounterType.NumberOfItems32));

    cd.Add(<span class="hljs-keyword">new</span> CounterCreationData(
        tooHard,
        <span class="hljs-string">&quot;Number of macadamias that will not crack, despite much effort&quot;</span>,
        PerformanceCounterType.NumberOfItems32));

    PerformanceCounterCategory.Create(
        category,
        <span class="hljs-string">&quot;Test Category&quot;</span>,
        PerformanceCounterCategoryType.SingleInstance,
        cd);
}
</code></pre>
<p>๐ ุงู ฺฉุงูุชุฑูุง ุจุนุฏ ุงุฒ ุงุฌุงุฏุ ุฏุฑ ุงุจุฒุงุฑ ูุงูุชูุฑูฺฏ Windows Performance ุธุงูุฑ ูโุดููุฏ (ฺฏุฒููโ <strong>Add Counters</strong>).<br>
ุงฺฏุฑ ุจุฎูุงูุฏ ุจุนุฏูุง ฺฉุงูุชุฑูุง ุจุดุชุฑ ุงุถุงูู ฺฉูุฏุ ุจุงุฏ ุงูู <strong>ฺฉู category ุฑุง ุญุฐู</strong> ฺฉูุฏ (<code>PerformanceCounterCategory.Delete</code>).</p>
<p>โ๏ธ ุงุฌุงุฏ ู ุญุฐู performance counters ูุงุฒููุฏ <strong>ุฏุณุชุฑุณ administrator</strong> ุงุณุชุ ู ูุนูููุงู ุงู ฺฉุงุฑ ุฏุฑ ุฒูุงู ูุตุจ ุจุฑูุงูู ุงูุฌุงู ูโุดูุฏ.</p>
<hr>
<h3>โ๏ธ ููุดุชู ููุฏุงุฑ ุฏุฑ Counter</h3>
<p>ุจุนุฏ ุงุฒ ุงุฌุงุฏ ฺฉ ฺฉุงูุชุฑุ ูโุชูุงูุฏ ููุฏุงุฑ ุขู ุฑุง ุชุบุฑ ุฏูุฏ. ฺฉุงู ุงุณุช ฺฉ ุดุก <strong>PerformanceCounter</strong> ุจุณุงุฒุฏุ ูฺฺฏ <strong>ReadOnly</strong> ุฑุง <code>false</code> ฺฉูุฏ ู ุณูพุณ ููุฏุงุฑ <strong>RawValue</strong> ุง ูุชุฏูุง <strong>Increment / IncrementBy</strong> ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ:</p>
<pre class="hljs"><code><span class="hljs-built_in">string</span> category = <span class="hljs-string">&quot;Nutshell Monitoring&quot;</span>;
<span class="hljs-built_in">string</span> eatenPerMin = <span class="hljs-string">&quot;Macadamias eaten so far&quot;</span>;

<span class="hljs-keyword">using</span> (PerformanceCounter pc = <span class="hljs-keyword">new</span> PerformanceCounter(category, eatenPerMin, <span class="hljs-string">&quot;&quot;</span>))
{
    pc.ReadOnly = <span class="hljs-literal">false</span>;

    pc.RawValue = <span class="hljs-number">1000</span>;
    pc.Increment();
    pc.IncrementBy(<span class="hljs-number">10</span>);

    Console.WriteLine(pc.NextValue());    <span class="hljs-comment">// ุฎุฑูุฌ: 1011</span>
}
</code></pre>
<hr>
<p>โจ ุจู ุงู ุชุฑุชุจ ูโุชูุงูู ูู ููุงุฏุฑ <strong>performance counters</strong> ุฑุง ุจุฎูุงูู ู ูู ฺฉุงูุชุฑูุง ุงุฎุชุตุงุต ุฎูุฏูุงู ุฑุง ุงุฌุงุฏ ู ููุฏุงุฑุฏู ฺฉูู.</p>
<h3>ฺฉูุงุณ Stopwatch โฑ๏ธ</h3>
<p>ฺฉูุงุณ <strong>Stopwatch</strong> ฺฉ ูฺฉุงูุฒู ุฑุงุญุช ุจุฑุง ุงูุฏุงุฒูโฺฏุฑ ุฒูุงู ุงุฌุฑุง ฺฉุฏ ูุฑุงูู ูโฺฉูุฏ. ุงู ฺฉูุงุณ ุงุฒ <strong>ุจุงูุงุชุฑู ุฏูุช</strong> ฺฉู ุณุณุชูโุนุงูู ู ุณุฎุชโุงูุฒุงุฑ ุงุฑุงุฆู ูโุฏููุฏ ุงุณุชูุงุฏู ูโฺฉูุฏ (ูุนูููุงู ฺฉูุชุฑ ุงุฒ ฺฉ ูฺฉุฑูุซุงูู).<br>
๐น ุฏุฑ ููุงุจูุ <code>DateTime.Now</code> ู <code>Environment.TickCount</code> ุฏูุช ุญุฏูุฏ <strong>ฑต ููโุซุงูู</strong> ุฏุงุฑูุฏ.</p>
<p>ุจุฑุง ุงุณุชูุงุฏู:</p>
<ul>
<li>ูโุชูุงูุฏ ุจุง <code>StartNew</code> ฺฉ Stopwatch ุงุฌุงุฏ ฺฉุฑุฏู ู ุจูุงูุงุตูู ุดุฑูุน ุจู ฺฉุงุฑ ฺฉูุฏ.</li>
<li>ุง ุฏุณุช ููููู ุจุณุงุฒุฏ ู ุณูพุณ <code>Start</code> ุฑุง ุตุฏุง ุจุฒูุฏ.</li>
</ul>
<p>ูฺฺฏ <code>Elapsed</code> ฺฉ <strong>TimeSpan</strong> ุจุฑูโฺฏุฑุฏุงูุฏ:</p>
<pre class="hljs"><code>Stopwatch s = Stopwatch.StartNew();
System.IO.File.WriteAllText(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-number">30000000</span>));
Console.WriteLine(s.Elapsed);    <span class="hljs-comment">// 00:00:01.4322661</span>
</code></pre>
<p>๐น ูฺฺฏโูุง ุฏฺฏุฑ:</p>
<ul>
<li><code>ElapsedTicks</code> โ ุชุนุฏุงุฏ ุชฺฉโูุง ฺฏุฐุดุชู (long).</li>
<li><code>ElapsedMilliseconds</code> โ ุฒูุงู ฺฏุฐุดุชู ุจู ููโุซุงูู (ูุนูููุงู ุฑุงุญุชโุชุฑู).</li>
<li>ุจุฑุง ุชุจุฏู ุชฺฉโูุง ุจู ุซุงูู: <code>ticks / Stopwatch.Frequency</code>.</li>
</ul>
<p>ูุฑุงุฎูุงู <code>Stop</code> ุจุงุนุซ ูุฑุฒ ุดุฏู <code>Elapsed</code> ู <code>ElapsedTicks</code> ูโุดูุฏ.<br>
โ ุชูุฌู: ุญุช ููุช Stopwatch ุฏุฑ ุญุงู ุงุฌุฑุงุณุชุ ูฺ ูุนุงูุช ูพุณโุฒูููโุง ุงุถุงูู ุงุฌุงุฏ ููโฺฉูุฏุ ูพุณ <code>Stop</code> ุงุฎุชุงุฑ ุงุณุช.</p>
<hr>
<h3>ุงุจุฒุงุฑูุง ุชุดุฎุต ฺฉุฑุงุณโูพูุชูุฑู ๐ง๐</h3>
<p>ุฏุฑ ุงู ุจุฎุดุ ุงุจุฒุงุฑูุง ุชุดุฎุต ูุงุจู ุงุณุชูุงุฏู ุฏุฑ ููู ูพูุชูุฑูโูุง (.NET) ูุนุฑู ูโุดููุฏ:</p>
<ul>
<li><strong>dotnet-counters</strong> โ ุงุฑุงุฆู ููุง ฺฉู ุงุฒ ูุถุนุช ฺฉ ุงูพูฺฉุดู ุฏุฑ ุญุงู ุงุฌุฑุง (ุญุงูุธู ู CPU).</li>
<li><strong>dotnet-trace</strong> โ ูุงูุชูุฑูฺฏ ุฏููโุชุฑ ุนููฺฉุฑุฏ ู ุฑูุฏุงุฏูุง.</li>
<li><strong>dotnet-dump</strong> โ ฺฏุฑูุชู <em>memory dump</em> ููฺฏุงู ูุงุฒ ุง ุจุนุฏ ุงุฒ ฺฉุฑุด.</li>
</ul>
<p>๐ ุงู ุงุจุฒุงุฑูุง ูุงุฒ ุจู ุฏุณุชุฑุณ ุงุฏูู ูุฏุงุฑูุฏ ู ูู ุจุฑุง ุชูุณุนู ู ูู ูุญุท ุนููุงุช ููุงุณุจ ูุณุชูุฏ.</p>
<hr>
<h3>ุงุจุฒุงุฑ dotnet-counters ๐</h3>
<p>ุงุจุฒุงุฑ <strong>dotnet-counters</strong> ูุตุฑู ุญุงูุธู ู CPU ฺฉ ูพุฑูุณู .NET ุฑุง ูุงูุชูุฑ ฺฉุฑุฏู ู ุฏุงุฏูโูุง ุฑุง ุฏุฑ ฺฉูุณูู (ุง ูุงู) ููุงุด ูโุฏูุฏ.</p>
<h4>ูุตุจ</h4>
<pre class="hljs"><code>dotnet tool install --global dotnet-counters
</code></pre>
<h4>ูุงูุชูุฑ ฺฉุฑุฏู ฺฉ ูพุฑูุณู</h4>
<pre class="hljs"><code>dotnet-counters monitor System.Runtime --process-id &lt;&lt;<span class="hljs-string">ProcessID&gt;&gt;
</span></code></pre>
<ul>
<li><code>System.Runtime</code> ุนู ูููโ ฺฉุงูุชุฑูุง ุฏุณุชู <strong>System.Runtime</strong> ุฑุง ูุงูุชูุฑ ฺฉูู.</li>
<li>ูโุชูุงูุฏ ุฏุณุชู ุง ูุงู ฺฉุงูุชุฑ ุฎุงุต ุจุฏูุฏ.</li>
<li>ุฏุณุชูุฑ <code>dotnet-counters list</code> ููู ุฏุณุชูโูุง ู ฺฉุงูุชุฑูุง ููุฌูุฏ ุฑุง ูุณุช ูโฺฉูุฏ.</li>
</ul>
<hr>
<h3>ุฎุฑูุฌ ููููู ๐</h3>
<p>(ุจูโุตูุฑุช ูุฏุงูู ุขูพุฏุช ูโุดูุฏ)</p>
<pre class="hljs"><code>Press p to pause, r to resume, q to quit.
   Status: Running
[System.Runtime]
   # of Assemblies Loaded                            63
   % Time in GC (since last GC)                       0
   Allocation Rate (Bytes / sec)                244,864
   CPU Usage (%)                                      6
   Exceptions / sec                                   0
   GC Heap Size (MB)                                  8
   Gen 0 GC / sec                                     0
   Gen 0 Size (B)                               265,176
   Gen 1 GC / sec                                     0
   Gen 1 Size (B)                               451,552
   Gen 2 GC / sec                                     0
   Gen 2 Size (B)                                    24
   LOH Size (B)                               3,200,296
   Monitor Lock Contention Count / sec                0
   Number of Active Timers                            0
   ThreadPool Completed Work Items / sec             15
   ThreadPool Queue Length                            0
   ThreadPool Threads Count                           9
   Working Set (MB)                                  52
</code></pre>
<p><strong>ูููโ ุฏุณุชูุฑุงุช ููุฌูุฏ:</strong></p>
<div align="center">
<p><img src="../../../assets/image/13/Table-13-1.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>ูพุงุฑุงูุชุฑูุง ุฒุฑ ูพุดุชุจุงู ูโุดููุฏ:</p>
<div align="center">
<p><img src="../../../assets/image/13/Table-13-2.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>dotnet-trace<br>
ุฑุฏุงุจโูุง (Traces) ุณูุงุจู ุฒูุงูโุจูุฏโุดุฏูโุง ุงุฒ ุฑูุฏุงุฏูุง ุฏุฑ ุจุฑูุงูู ุดูุง ูุณุชูุฏุ ูุงููุฏ ูุฑุงุฎูุงู ฺฉ ูุชุฏ ุง ุงุฌุฑุง ฺฉ ูพุฑุณโูุฌู ูพุงฺฏุงู ุฏุงุฏู. ุฑุฏุงุจโูุง ูโุชูุงููุฏ ุดุงูู ูุนุงุฑูุง ุนููฺฉุฑุฏ ู ุฑูุฏุงุฏูุง ุณูุงุฑุด ูุฒ ุจุงุดูุฏ ู ูโุชูุงููุฏ ุงุทูุงุนุงุช ูุญู ูุงููุฏ ููุงุฏุฑ ูุชุบุฑูุง ูุญู ุฑุง ูุฒ ุฏุฑ ุจุฑ ุจฺฏุฑูุฏ. ุจู ุทูุฑ ุณูุชุ .NET Framework ู ูุฑูโูุฑฺฉโูุง ูุงููุฏ <a href="http://ASP.NET">ASP.NET</a> ุงุฒ ETW ุงุณุชูุงุฏู ูโฺฉุฑุฏูุฏ. ุฏุฑ .NET 5ุ ุฑุฏุงุจโูุง ุจุฑูุงูู ููฺฏุงู ุงุฌุฑุง ุฑู ููุฏูุฒ ุฏุฑ ETW ู ุฑู ูููฺฉุณ ุฏุฑ LTTng ููุดุชู ูโุดููุฏ.</p>
<p>ุจุฑุง ูุตุจ ุงู ุงุจุฒุงุฑุ ุฏุณุชูุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:</p>
<pre class="hljs"><code>dotnet tool install --global dotnet-trace
</code></pre>
<p>ุจุฑุง ุดุฑูุน ุถุจุท ุฑูุฏุงุฏูุง ฺฉ ุจุฑูุงููุ ุฏุณุชูุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:</p>
<pre class="hljs"><code>dotnet-trace collect --process-id &lt;&lt;ProcessId&gt;&gt;
</code></pre>
<p>ุงู ุฏุณุชูุฑ dotnet-trace ุฑุง ุจุง ูพุฑููุงู ูพุดโูุฑุถ ุงุฌุฑุง ูโฺฉูุฏ ฺฉู ุฑูุฏุงุฏูุง CPU ู ุฒูุงู ุงุฌุฑุง .NET ุฑุง ุฌูุนโุขูุฑ ฺฉุฑุฏู ู ุฏุฑ ูุงู ุจู ูุงู <code>trace.nettrace</code> ุฐุฎุฑู ูโฺฉูุฏ. ูโุชูุงูุฏ ุจุง ฺฏุฒูู <code>--profile</code> ูพุฑููุงูโูุง ุฏฺฏุฑ ุฑุง ูุดุฎุต ฺฉูุฏ:</p>
<ul>
<li><code>gc-verbose</code> ุฑุฏุงุจ ุฌูุนโุขูุฑ ุฒุจุงูู ู ุชุฎุตุต ูููููโุง ุงุดุง ุฑุง ุงูุฌุงู ูโุฏูุฏ.</li>
<li><code>gc-collect</code> ุฌูุนโุขูุฑ ุฒุจุงูู ุฑุง ุจุง ุณุฑุจุงุฑ ฺฉู ุฑุฏุงุจ ูโฺฉูุฏ.</li>
</ul>
<p>ฺฏุฒูู <code>-o</code> ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ูุงู ูุงู ุฎุฑูุฌ ูุชูุงูุช ูุดุฎุต ฺฉูุฏ.</p>
<p>ุฎุฑูุฌ ูพุดโูุฑุถ ฺฉ ูุงู <code>.netperf</code> ุงุณุช ฺฉู ูโุชูุงู ุขู ุฑุง ูุณุชููุงู ุฏุฑ ููุฏูุฒ ุจุง ุงุจุฒุงุฑ <strong>PerfView</strong> ุชุญูู ฺฉุฑุฏ. ููฺูู ูโุชูุงูุฏ dotnet-trace ุฑุง ูุงุฏุงุฑ ฺฉูุฏ ูุงู ุณุงุฒฺฏุงุฑ ุจุง <strong>Speedscope</strong> ุงุฌุงุฏ ฺฉูุฏุ ฺฉู ฺฉ ุณุฑูุณ ุชุญูู ุขููุงู ุฑุงฺฏุงู ุฏุฑ <a href="https://speedscope.app">https://speedscope.app</a> ุงุณุช. ุจุฑุง ุงุฌุงุฏ ูุงู Speedscope (<code>.speedscope.json</code>) ุงุฒ ฺฏุฒูู <code>--format speedscope</code> ุงุณุชูุงุฏู ฺฉูุฏ.</p>
<p>ุขุฎุฑู ูุณุฎู PerfView ุฑุง ูโุชูุงูุฏ ุงุฒ <a href="https://github.com/microsoft/perfview">https://github.com/microsoft/perfview</a> ุฏุงูููุฏ ฺฉูุฏ. ูุณุฎูโุง ฺฉู ุจุง ููุฏูุฒ 10 ุนุฑุถู ูโุดูุฏ ููฺฉู ุงุณุช ุงุฒ ูุงูโูุง <code>.netperf</code> ูพุดุชุจุงู ูฺฉูุฏ.</p>
<p>ุฏุณุชูุฑุงุช ุฒุฑ ูพุดุชุจุงู ูโุดููุฏ:</p>
<div align="center">
<p><img src="../../../assets/image/13/Table-13-3.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<h3>ุฑูุฏุงุฏูุง ุณูุงุฑุด Trace ๐ฏ</h3>
<p>ุจุฑูุงูู ุดูุง ูโุชูุงูุฏ ุจุง ุชุนุฑู ฺฉ <strong>EventSource</strong> ุณูุงุฑุดุ ุฑูุฏุงุฏูุง ุงุฎุชุตุงุต ุชููุฏ ฺฉูุฏ:</p>
<pre class="hljs"><code>[<span class="hljs-meta">EventSource(Name = <span class="hljs-string">&quot;MyTestSource&quot;</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyEventSource</span> : <span class="hljs-title">EventSource</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> MyEventSource Instance = <span class="hljs-keyword">new</span> MyEventSource();

    MyEventSource() : <span class="hljs-keyword">base</span>(EventSourceSettings.EtwSelfDescribingEventFormat)
    {
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Log</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message, <span class="hljs-built_in">int</span> someNumber</span>)</span>
    {
        WriteEvent(<span class="hljs-number">1</span>, message, someNumber);
    }
}
</code></pre>
<p>ูุชุฏ <strong>WriteEvent</strong> ุฏุงุฑุง ฺูุฏ ูุณุฎู (Overload) ุงุณุช ู ูโุชูุงูุฏ ุชุฑฺฉุจโูุง ูุฎุชูู ุงุฒ ุงููุงุน ุณุงุฏู (ุจูโูฺู ุฑุดุชูโูุง ู ุงุนุฏุงุฏ ุตุญุญ) ุฑุง ุจูพุฐุฑุฏ. ุณูพุณ ูโุชูุงูุฏ ุจู ุงู ุตูุฑุช ุงุฒ ุขู ุงุณุชูุงุฏู ฺฉูุฏ:</p>
<pre class="hljs"><code>MyEventSource.Instance.Log(<span class="hljs-string">&quot;Something&quot;</span>, <span class="hljs-number">123</span>);
</code></pre>
<p>ููฺฏุงู ุงุณุชูุงุฏู ุงุฒ <strong>dotnet-trace</strong>ุ ุจุงุฏ ูุงู ูุฑ ููุจุน ุฑูุฏุงุฏ ุณูุงุฑุด ฺฉู ูโุฎูุงูุฏ ุซุจุช ุดูุฏ ุฑุง ูุดุฎุต ฺฉูุฏ:</p>
<pre class="hljs"><code>dotnet-trace collect --process-id &lt;&lt;<span class="hljs-string">ProcessId&gt;&gt; --providers MyTestSource
</span></code></pre>
<hr>
<h3>dotnet-dump ๐พ</h3>
<p>ฺฉ <strong>Dump</strong>ุ ฺฉู ฺฏุงู ุจู ุขู <strong>Core Dump</strong> ูู ฺฏูุชู ูโุดูุฏุ ุชุตูุฑ ุงุฒ ูุถุนุช ุญุงูุธู ูุฌุงุฒ ฺฉ ูพุฑุฏุงุฒุด ุงุณุช. ุดูุง ูโุชูุงูุฏ ฺฉ ูพุฑุฏุงุฒุด ุฏุฑ ุญุงู ุงุฌุฑุง ุฑุง ุจูโุตูุฑุช ุฏุณุช Dump ฺฉูุฏ ุง ุณุณุชูโุนุงูู ุฑุง ุชูุธู ฺฉูุฏ ุชุง ููฺฏุงู ฺฉุฑุด ุจุฑูุงููุ ุงู Dump ุชููุฏ ุดูุฏ.</p>
<h4>ุฏุฑ ุงูุจููุชู ูููฺฉุณ</h4>
<p>ุจุฑุง ูุนุงู ฺฉุฑุฏู Core Dump ููฺฏุงู ฺฉุฑุด ุจุฑูุงูู:</p>
<pre class="hljs"><code><span class="hljs-built_in">ulimit</span> -c unlimited
</code></pre>
<p>(ูุฑุงุญู ููฺฉู ุงุณุช ุจุณุชู ุจู ุชูุฒุน ูููฺฉุณ ูุชูุงูุช ุจุงุดุฏ)</p>
<h4>ุฏุฑ ููุฏูุฒ</h4>
<p>ุงุฒ <strong>regedit.exe</strong> ุจุฑุง ุงุฌุงุฏ ุง ูุฑุงุด ฺฉูุฏ ุฒุฑ ุฏุฑ Hive ูุฑุจูุท ุจู Local Machine ุงุณุชูุงุฏู ฺฉูุฏ:</p>
<pre class="hljs"><code>SOFTWARE\Microsoft\Windows\Windows Error Reporting\LocalDumps
</code></pre>
<p>ุฒุฑ ุงู ูุณุฑุ ฺฉ ฺฉูุฏ ุจุง ูุงู ููุงู ูุงู ุงุฌุฑุง ุฎูุฏ ุงุถุงูู ฺฉูุฏ (ูุซูุงู <code>foo.exe</code>) ู ุณูพุณ ฺฉูุฏูุง ุฒุฑ ุฑุง ุงุถุงูู ููุงุฏ:</p>
<ul>
<li><strong>DumpFolder (REG_EXPAND_SZ):</strong> ูุณุฑ ุฐุฎุฑู ูุงูโูุง Dump</li>
<li><strong>DumpType (REG_DWORD):</strong> ููุฏุงุฑ ฒ ุจุฑุง ุฏุฑุฎูุงุณุช Full Dump</li>
<li><strong>(ุงุฎุชุงุฑ) DumpCount (REG_DWORD):</strong> ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ูุงูโูุง Dump ูุจู ุงุฒ ุญุฐู ูุฏูโุชุฑู ุขูโูุง</li>
</ul>
<p>ุจุฑุง ูุตุจ ุงุจุฒุงุฑุ ุฏุณุชูุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:</p>
<pre class="hljs"><code>dotnet tool install --global dotnet-dump
</code></pre>
<p>ูพุณ ุงุฒ ูุตุจุ ูโุชูุงูุฏ ฺฉ Dump ุจูโุตูุฑุช ุฏุณุช ุงุฌุงุฏ ฺฉูุฏ (ุจุฏูู ุชููู ูพุฑุฏุงุฒุด):</p>
<pre class="hljs"><code>dotnet-dump collect --process-id &lt;&lt;<span class="hljs-string">YourProcessId&gt;&gt;
</span></code></pre>
<p>ุจุฑุง ุดุฑูุน ฺฉ <strong>Interactive Shell</strong> ุฌูุช ุชุญูู ูุงู Dump:</p>
<pre class="hljs"><code>dotnet-dump analyze &lt;&lt;<span class="hljs-string">dumpfile&gt;&gt;
</span></code></pre>
<p>ุงฺฏุฑ ฺฉ Exception ุจุงุนุซ ฺฉุฑุด ุจุฑูุงูู ุดุฏู ุจุงุดุฏุ ูโุชูุงูุฏ ุงุฒ ุฏุณุชูุฑ <strong>printexceptions</strong> (ุง ฺฉูุชุงู ุดุฏู ุขู <strong>pe</strong>) ุจุฑุง ููุงุด ุฌุฒุฆุงุช Exception ุงุณุชูุงุฏู ฺฉูุฏ.<br>
Shell ุงุจุฒุงุฑ <strong>dotnet-dump</strong> ุฏุณุชูุฑุงุช ูุชุนุฏุฏ ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ุจุง ุฏุณุชูุฑ <strong>help</strong> ูุณุช ฺฉุงูู ุขูโูุง ุฑุง ูุดุงูุฏู ฺฉูุฏ.</p>
