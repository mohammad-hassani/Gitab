<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gitab | ฺฉุชุงุจุฎุงููู ุชุฑุฌููโูุง ุฏุงุชโูุช ู ุณ ุดุงุฑูพ</title>
  <meta name="description" content="ุชุฑุฌููโูุง ูุงุฑุณ ฺฉุชุงุจโูุง ูู โ ุณุฑุนุ ูููุงู ู ูุงุจู ุงุชฺฉุง.">
  <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
  <!-- ูุฏุฑ ูุดุชุฑฺฉ -->
  <header class="header">
    <div class="container nav-wrap">
      <a class="brand" href="/">
        <img src="/icone/logo.svg" alt="Gitab" width="28" height="28">
        <span>Gitab</span>
      </a>

      <nav class="nav">
        <a href="/">ุฎุงูู</a>
        <a href="/books/list-books">ฺฉุชุงุจโูุง</a>
        <a href="#">ููฺฉุงุฑ</a>
        <a href="#">ุฏุฑุจุงุฑูโูุง</a>
      </nav>

     <div class="nav-actions">
  <button id="themeToggle" class="icon-btn theme-btn" aria-label="ุชุบุฑ ุญุงูุช">
    <img class="icon-sun" src="/icone/sun.svg" alt="ุฑูุดู">
    <img class="icon-moon" src="/icone/moon.svg" alt="ุชุงุฑฺฉ">
  </button>

  <a class="icon-btn" href="https://github.com/hheydarian/Gitab" target="_blank" title="GitHub">
    <img src="/icone/github.svg" alt="GitHub">
  </a>
</div>

  </header>

  <!-- ูุญุชูุง ุตูุญู -->
  <main class="site-main">
    <h1>ูุตู ุดุงูุฒุฏูู: ุดุจฺฉูโุณุงุฒ</h1>
<p>.NET ูุฌููุนูโุง ุงุฒ ฺฉูุงุณโูุง ุฑุง ุฏุฑ ูุถุง ูุงู <strong>System.Net.*</strong> ุจุฑุง ุจุฑูุฑุงุฑ ุงุฑุชุจุงุท ุงุฒ ุทุฑู ูพุฑูุชฺฉูโูุง ุงุณุชุงูุฏุงุฑุฏ ุดุจฺฉู ูุซู <strong>HTTP</strong> ู <strong>TCP/IP</strong> ุงุฑุงุฆู ูโุฏูุฏ. ุฏุฑ ุงูุฌุง ุฎูุงุตูโุง ุงุฒ ุงุฌุฒุง ฺฉูุฏ ุขูุฑุฏู ุดุฏู ุงุณุช:</p>
<ul>
<li><strong>HttpClient</strong> ุจุฑุง ูุตุฑู APIูุง ูุจ ูุจุชู ุจุฑ HTTP ู ุณุฑูุณโูุง <strong>RESTful</strong></li>
<li><strong>HttpListener</strong> ุจุฑุง ููุดุชู ฺฉ ุณุฑูุฑ <strong>HTTP</strong></li>
<li><strong>SmtpClient</strong> ุจุฑุง ุณุงุฎุช ู ุงุฑุณุงู ูพุงูโูุง ุงูู ุงุฒ ุทุฑู <strong>SMTP</strong></li>
<li><strong>Dns</strong> ุจุฑุง ุชุจุฏู ุจู ูุงู ุฏุงููู ู ุขุฏุฑุณโูุง</li>
<li>ฺฉูุงุณโูุง <strong>TcpClient</strong>ุ <strong>UdpClient</strong>ุ <strong>TcpListener</strong> ู <strong>Socket</strong> ุจุฑุง ุฏุณุชุฑุณ ูุณุชูู ุจู ูุงูโูุง ุงูุชูุงู ู ุดุจฺฉู</li>
</ul>
<p>ุงููุงุน (Types) ููุฌูุฏ ุฏุฑ ุงู ูุตู ุงุฒ .NET ุฏุฑ ูุถุง ูุงูโูุง <strong>System.Net.*</strong> ู <strong>System.IO</strong> ูุฑุงุฑ ุฏุงุฑูุฏ.</p>
<p>.NET ููฺูู ูพุดุชุจุงู ุณูุช ฺฉูุงูุช ุงุฒ <strong>FTP</strong> ุฑุง ูุฑุงูู ูโฺฉูุฏุ ุงูุง ููุท ุงุฒ ุทุฑู ฺฉูุงุณโูุง ฺฉู ุงุฒ ูุณุฎูโ .NET 6 ุจูโุจุนุฏ ุจูโุนููุงู <strong>obsolete</strong> (ููุณูุฎ) ุนูุงูุชโฺฏุฐุงุฑ ุดุฏูโุงูุฏ. ุงฺฏุฑ ูุงุฒู ุจุงุดุฏ ุงุฒ <strong>FTP</strong> ุงุณุชูุงุฏู ฺฉูุฏุ ุจูุชุฑู ฺฏุฒูู ุงุณุชูุงุฏู ุงุฒ ฺฉ ฺฉุชุงุจุฎุงููโ <strong>NuGet</strong> ูุซู <strong>FluentFTP</strong> ุงุณุช.</p>
<hr>
<h3>ูุนูุงุฑ ุดุจฺฉู ๐๏ธ</h3>
<p>ุดฺฉู ฑถ-ฑ ุงููุงุน ุดุจฺฉูโุง .NET ู ูุงูโูุง ุงุฑุชุจุงุท ฺฉู ุฏุฑ ุขูโูุง ูุฑุงุฑ ุฏุงุฑูุฏ ุฑุง ูุดุงู ูโุฏูุฏ. ุจุดุชุฑ ุงููุงุน ุฏุฑ <strong>ูุงูโ ุงูุชูุงู (Transport layer)</strong> ุง <strong>ูุงูโ ฺฉุงุฑุจุฑุฏ (Application layer)</strong> ูุฑุงุฑ ุฏุงุฑูุฏ.</p>
<ul>
<li>
<p>ูุงูโ ุงูุชูุงู ูพุฑูุชฺฉูโูุง ูพุงูโุง ุจุฑุง ุงุฑุณุงู ู ุฏุฑุงูุช ุจุงุชโูุง ุฑุง ุชุนุฑู ูโฺฉูุฏ (<strong>TCP</strong> ู <strong>UDP</strong>).</p>
</li>
<li>
<p>ูุงูโ ฺฉุงุฑุจุฑุฏ ูพุฑูุชฺฉูโูุง ุณุทุญ ุจุงูุงุชุฑ ุฑุง ุชุนุฑู ูโฺฉูุฏ ฺฉู ุจุฑุง ุจุฑูุงููโูุง ุฎุงุต ุทุฑุงุญ ุดุฏูโุงูุฏุ ูุซู:</p>
<ul>
<li>ุจุงุฒุงุจ ุตูุญุงุช ูุจ (<strong>HTTP</strong>)</li>
<li>ุงุฑุณุงู ุงูู (<strong>SMTP</strong>)</li>
<li>ุชุจุฏู ุจู ูุงู ุฏุงููู ู ุขุฏุฑุณโูุง <strong>IP</strong> (<strong>DNS</strong>)</li>
</ul>
</li>
</ul>
<div align="center">
<p><img src="../../../assets/image/16/Table-16-1.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>ูุนูููุงู ุจุฑูุงููโููุณ ุฏุฑ <strong>ูุงูโ ฺฉุงุฑุจุฑุฏ (Application layer)</strong> ุฑุงุญุชโุชุฑ ุงุณุชุ ุจุงุงูโุญุงูุ ุฏูุงู ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ููฺฉู ุงุณุช ุจุฎูุงูุฏ ูุณุชููุงู ุฏุฑ <strong>ูุงูโ ุงูุชูุงู (Transport layer)</strong> ฺฉุงุฑ ฺฉูุฏ.</p>
<ul>
<li>ฺฉ ุงุฒ ุฏูุงู ุงู ุงุณุช ฺฉู ุจู ฺฉ ูพุฑูุชฺฉู ฺฉุงุฑุจุฑุฏ ูุงุฒ ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุฏุฑ .NET ุงุฑุงุฆู ูุดุฏู ุงุณุชุ ูุซู <strong>POP3</strong> ุจุฑุง ุฏุฑุงูุช ุงูู.</li>
<li>ุฏูู ุฏฺฏุฑ ุงู ุงุณุช ฺฉู ุจุฎูุงูุฏ ฺฉ ูพุฑูุชฺฉู ุณูุงุฑุด ุจุฑุง ฺฉ ุจุฑูุงููโ ุฎุงุต ุทุฑุงุญ ฺฉูุฏุ ูุซู ฺฉ <strong>ฺฉูุงูุช ููุชุง ุจู ููุชุง (peer-to-peer client)</strong>.</li>
</ul>
<hr>
<h3>ูพุฑูุชฺฉู HTTP ู ุงููุช ุขู ๐</h3>
<p>ุฏุฑ ุจู ูพุฑูุชฺฉูโูุง ฺฉุงุฑุจุฑุฏุ <strong>HTTP</strong> ุจู ุฏูู ฺฉุงุฑุจุฑุฏ ุนูููโุงุด ุงููุช ูฺูโุง ุฏุงุฑุฏ. ุญุงูุช ูพุงูโุง ุนููฺฉุฑุฏ ุขูโยซุงู ุตูุญูโ ูุจ ุจุง ุงู URL ุฑุง ุจู ูู ุจุฏูยปโุจูโุฎูุจ ุจุง ุงูฺฏููุง ุฏฺฏุฑ ูุซู ยซูุชุฌูโ ูุฑุงุฎูุงู ุงู endpoint ุจุง ุงู ุขุฑฺฏููุงูโูุง ุฑุง ุจู ูู ุจุฏูยป ุณุงุฒฺฏุงุฑ ูโุดูุฏ.</p>
<p>ุนูุงูู ุจุฑ ูุนู <strong>get</strong>ุ ุงูุนุงู ุฏฺฏุฑ ูุซู <strong>put</strong>ุ <strong>post</strong> ู <strong>delete</strong> ูู ูุฌูุฏ ุฏุงุฑูุฏ ฺฉู ุงูฺฉุงู ุณุงุฎุช ุณุฑูุณโูุง ูุจุชู ุจุฑ <strong>REST</strong> ุฑุง ูุฑุงูู ูโฺฉููุฏ.</p>
<p><strong>HTTP</strong> ููฺูู ูุฌููุนูโ ฺฏุณุชุฑุฏูโุง ุงุฒ ูุงุจูุชโูุง ุฏุงุฑุฏ ฺฉู ุฏุฑ ุจุฑูุงููโูุง ุชุฌุงุฑ ฺูุฏูุงู ู ูุนูุงุฑโูุง ุณุฑูุณโูุญูุฑ ููุฏ ูุณุชูุฏุ ูุซู:</p>
<ul>
<li>ูพุฑูุชฺฉูโูุง ุจุฑุง <strong>ุงุญุฑุงุฒ ููุช (authentication)</strong> ู <strong>ุฑูุฒูฺฏุงุฑ (encryption)</strong></li>
<li><strong>ูุทุนูโุจูุฏ ูพุงูโูุง (message chunking)</strong></li>
<li><strong>ูุฏุฑูุง ู ฺฉูฺฉโูุง ูุงุจูโฺฏุณุชุฑุด (extensible headers and cookies)</strong></li>
<li>ุงูฺฉุงู ุงูฺฉู ฺูุฏู ุจุฑูุงููโ ุณุฑูุฑ ฺฉ <strong>ูพูุฑุช</strong> ู ฺฉ <strong>ุขุฏุฑุณ IP</strong> ูุดุชุฑฺฉ ุฏุงุดุชู ุจุงุดูุฏ</li>
</ul>
<p>ุจู ููู ุฏูุงูุ <strong>HTTP</strong> ุฏุฑ .NET ุจูโุฎูุจ ูพุดุชุจุงู ูโุดูุฏโูู ุจูโุตูุฑุช ูุณุชูู (ููุงูโุทูุฑ ฺฉู ุฏุฑ ุงู ูุตู ุชูุถุญ ุฏุงุฏู ูโุดูุฏ) ู ูู ุฏุฑ ุณุทูุญ ุจุงูุงุชุฑุ ุงุฒ ุทุฑู ููุงูุฑโูุง ูุซู <strong>Web API</strong> ู <strong>ASP.NET Core</strong>.</p>
<hr>
<p>ููุงูโุทูุฑ ฺฉู ุงุฒ ุจุญุซโูุง ุจุงูุง ูุดุฎุต ุงุณุชุ ุญูุฒูโ ุดุจฺฉูโุณุงุฒ ูพุฑ ุงุฒ <strong>ุงุฎุชุตุงุฑููุณโูุง (acronyms)</strong> ุงุณุช. ูุชุฏุงููโุชุฑู ุขูโูุง ุฏุฑ <strong>ุฌุฏูู ฑถ-ฑ</strong> ููุฑุณุช ุดุฏูโุงูุฏ. ๐</p>
<div align="center">
<p><img src="../../../assets/image/16/Table-16-2.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<h3>ุขุฏุฑุณโูุง ู ูพูุฑุชโูุง</h3>
<p>ุจุฑุง ุงูฺฉู ุงุฑุชุจุงุท ุจุฑูุฑุงุฑ ุดูุฏุ ฺฉ ฺฉุงููพูุชุฑ ุง ุฏุณุชฺฏุงู ูุงุฒ ุจู ฺฉ <strong>ุขุฏุฑุณ</strong> ุฏุงุฑุฏ. ุงูุชุฑูุช ุงุฒ ุฏู ุณุณุชู ุขุฏุฑุณโุฏู ุงุณุชูุงุฏู ูโฺฉูุฏ:</p>
<ul>
<li>
<p><strong>IPv4</strong>
ุฏุฑ ุญุงู ุญุงุถุฑ ุณุณุชู ุบุงูุจ ุขุฏุฑุณโุฏู ุงุณุช. ุขุฏุฑุณโูุง <strong>IPv4</strong> ุฏุงุฑุง ุนุฑุถ ณฒ ุจุช ูุณุชูุฏ. ููุช ุจูโุตูุฑุช ุฑุดุชู (string) ูุงูุจโุจูุฏ ูโุดููุฏุ ุจู ุดฺฉู ฺูุงุฑ ุนุฏุฏ ุงุนุดุงุฑ ุจุง ุฌุฏุงฺฉููุฏูโ ููุทู ููุดุชู ูโุดููุฏ (ุจุฑุง ูุซุงู: <code>101.102.103.104</code>). ฺฉ ุขุฏุฑุณ ูโุชูุงูุฏ ุฏุฑ ฺฉู ุฏูุง ููุญุตุฑุจูโูุฑุฏ ุจุงุดุฏ ุง ููุท ุฏุฑ ฺฉ <strong>ุฒุฑุดุจฺฉู (subnet)</strong> ุฎุงุต (ูุซู ฺฉ ุดุจฺฉูโ ุดุฑฺฉุช).</p>
</li>
<li>
<p><strong>IPv6</strong>
ุณุณุชู ุขุฏุฑุณโุฏู ุฌุฏุฏุชุฑ ุงุณุช ฺฉู ุนุฑุถ ุขู <strong>ฑฒธ ุจุช</strong> ูโุจุงุดุฏ. ุขุฏุฑุณโูุง ุฏุฑ ูุงูุจ ุฑุดุชูโุง ุจู ุดฺฉู <strong>ูฺฏุฒุงุฏุณูุงู</strong> ููุดุชู ูโุดููุฏ ู ุจุง <strong>ฺฉูููู (:)</strong> ุงุฒ ูู ุฌุฏุง ูโุดููุฏ (ุจุฑุง ูุซุงู:
<code>[3EA0:FFFF:198A:E4A3:4FF2:54fA:41BC:8D31]</code>).
ุฏุฑ .NET ุจุงุฏ ุจุฑุงฺฉุชโูุง ูุฑุจุน ([]) ุฑุง ุฏูุฑ ุขุฏุฑุณ ุงุถุงูู ฺฉูุฏ.</p>
</li>
</ul>
<hr>
<p>ฺฉูุงุณ <strong>IPAddress</strong> ุฏุฑ ูุถุง ูุงู <strong>System.Net</strong> ฺฉ ุขุฏุฑุณ ุฑุง ุฏุฑ ูุฑ ฺฉ ุงุฒ ุงู ุฏู ูพุฑูุชฺฉู ููุงุด ูโุฏูุฏ. ุงู ฺฉูุงุณ ฺฉ <strong>ุณุงุฒูุฏู (constructor)</strong> ุฏุงุฑุฏ ฺฉู ฺฉ ุขุฑุงูโ ุจุงุช ูโฺฏุฑุฏ ู ฺฉ ูุชุฏ ุงุณุชุงุชฺฉ ุจู ูุงู <strong>Parse</strong> ฺฉู ฺฉ ุฑุดุชูโ ูุงูุจโุจูุฏโุดุฏูโ ุตุญุญ ุฑุง ูโฺฏุฑุฏ:</p>
<pre><code class="language-csharp">IPAddress a1 = new IPAddress (new byte[] { 101, 102, 103, 104 });
IPAddress a2 = IPAddress.Parse (&quot;101.102.103.104&quot;);
Console.WriteLine (a1.Equals (a2));       // True

Console.WriteLine (a1.AddressFamily);     // InterNetwork

IPAddress a3 = IPAddress.Parse(&quot;[3EA0:FFFF:198A:E4A3:4FF2:54fA:41BC:8D31]&quot;);
Console.WriteLine (a3.AddressFamily);     // InterNetworkV6
</code></pre>
<hr>
<h3>ูพูุฑุชโูุง ๐</h3>
<p>ูพุฑูุชฺฉูโูุง <strong>TCP</strong> ู <strong>UDP</strong> ูุฑ ุขุฏุฑุณ IP ุฑุง ุจู <strong>ถตูฌตณต ูพูุฑุช</strong> ุชูุณู ูโฺฉููุฏ. ุงู ฺฉุงุฑ ุจู ฺฉ ฺฉุงููพูุชุฑ ุฏุฑ ฺฉ ุขุฏุฑุณ ูุงุญุฏ ุงุฌุงุฒู ูโุฏูุฏ ฺูุฏู ุจุฑูุงูู ุฑุง ุงุฌุฑุง ฺฉูุฏุ ูุฑฺฉุฏุงู ุฑู ูพูุฑุช ุฎูุฏุด.</p>
<p>ุจุณุงุฑ ุงุฒ ุจุฑูุงููโูุง ูพูุฑุชโูุง ูพุดโูุฑุถ ุงุณุชุงูุฏุงุฑุฏ ุฏุงุฑูุฏุ ุจุฑุง ูุซุงู:</p>
<ul>
<li><strong>HTTP</strong> ุงุฒ ูพูุฑุช ธฐ ุงุณุชูุงุฏู ูโฺฉูุฏ.</li>
<li><strong>SMTP</strong> ุงุฒ ูพูุฑุช ฒต ุงุณุชูุงุฏู ูโฺฉูุฏ.</li>
</ul>
<p>ูพูุฑุชโูุง <strong>TCP</strong> ู <strong>UDP</strong> ุงุฒ <strong>ดนฑตฒ ุชุง ถตตณต</strong> ุจูโุทูุฑ ุฑุณู ุจุฏูู ุชุฎุตุต ูุณุชูุฏุ ุจูุงุจุฑุงู ฺฏุฒููโ ุฎูุจ ุจุฑุง <strong>ุขุฒูุงุด</strong> ู <strong>ุงุณุชูุฑุงุฑูุง ฺฉูฺฺฉ</strong> ูุณุชูุฏ.</p>
<p>ุชุฑฺฉุจ ฺฉ ุขุฏุฑุณ IP ู ฺฉ ูพูุฑุช ุฏุฑ .NET ุชูุณุท ฺฉูุงุณ <strong>IPEndPoint</strong> ููุงุด ุฏุงุฏู ูโุดูุฏ:</p>
<pre><code class="language-csharp">IPAddress a = IPAddress.Parse (&quot;101.102.103.104&quot;);
IPEndPoint ep = new IPEndPoint (a, 222);      // Port 222
Console.WriteLine (ep.ToString());            // 101.102.103.104:222
</code></pre>
<hr>
<h3>URI ๐</h3>
<p><strong>ูุงุฑูุงูโูุง (Firewalls)</strong> ูพูุฑุชโูุง ุฑุง ูุณุฏูุฏ ูโฺฉููุฏ. ุฏุฑ ุจุณุงุฑ ุงุฒ ูุญุทโูุง ุดุฑฺฉุชุ ููุท ุชุนุฏุงุฏ ฺฉู ุงุฒ ูพูุฑุชโูุง ุจุงุฒ ูุณุชูุฏโูุนูููุงู:</p>
<ul>
<li>ูพูุฑุช ธฐ (ุจุฑุง <strong>HTTP</strong> ุฑูุฒฺฏุฐุงุฑโูุดุฏู)</li>
<li>ูพูุฑุช ดดณ (ุจุฑุง <strong>HTTP</strong> ุงูู ุง HTTPS)</li>
</ul>
<p><strong>URI</strong> ฺฉ ุฑุดุชูโ ูุงูุจโุจูุฏโุดุฏูโ ุฎุงุต ุงุณุช ฺฉู ฺฉ ููุจุน (resource) ุฏุฑ ุงูุชุฑูุช ุง ฺฉ LAN ุฑุง ุชูุตู ูโฺฉูุฏุ ูุซู ฺฉ ุตูุญูโ ูุจุ ูุงู ุง ุขุฏุฑุณ ุงูู.</p>
<p>ูููููโูุง:</p>
<ul>
<li><code>http://www.ietf.org</code></li>
<li><code>ftp://myisp/doc.txt</code></li>
<li><code>mailto:joe@bloggs.com</code></li>
</ul>
<p>ูุงูุจ ุฏูู URI ุชูุณุท <strong>IETF (Internet Engineering Task Force)</strong> ุชุนุฑู ุดุฏู ุงุณุช.</p>
<p>ฺฉ <strong>URI</strong> ุฑุง ูโุชูุงู ุจู ูุฌููุนูโุง ุงุฒ ุนูุงุตุฑ ุชูุณู ฺฉุฑุฏโูุนูููุงู ุดุงูู <strong>scheme</strong>ุ <strong>authority</strong> ู <strong>path</strong>.</p>
<p>ฺฉูุงุณ <strong>Uri</strong> ุฏุฑ ูุถุง ูุงู <strong>System</strong> ุฏููุงู ููู ุชูุณูโุจูุฏ ุฑุง ุงูุฌุงู ูโุฏูุฏ ู ฺฉ property ุจุฑุง ูุฑ ุนูุตุฑ ุฏุฑ ุงุฎุชุงุฑ ูโฺฏุฐุงุฑุฏ (ููุงูโุทูุฑ ฺฉู ุฏุฑ ุดฺฉู ฑถ-ฒ ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช).</p>
<div align="center">
<p><img src="../../../assets/image/16/Table-16-3.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<h3>ฺฉูุงุณ Uri ๐งญ</h3>
<p>ฺฉูุงุณ <strong>Uri</strong> ุฒูุงู ููุฏ ุงุณุช ฺฉู ูุงุฒ ุฏุงุดุชู ุจุงุดุฏ ูุงูุจ ฺฉ ุฑุดุชูโ <strong>URI</strong> ุฑุง ุงุนุชุจุงุฑุณูุฌ ฺฉูุฏ ุง ฺฉ URI ุฑุง ุจู ุจุฎุดโูุง ุชุดฺฉูโุฏููุฏูโุงุด ุชูุณู ฺฉูุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ูโุชูุงูุฏ URI ุฑุง ุตุฑูุงู ูุซู ฺฉ ุฑุดุชู ุฏุฑ ูุธุฑ ุจฺฏุฑุฏโุจุดุชุฑ ูุชุฏูุง ุดุจฺฉูโุง ูู <strong>overload</strong> ุดุฏูโุงูุฏ ุชุง ูู ฺฉ ุดุก <strong>Uri</strong> ู ูู ฺฉ ุฑุดุชู ุฑุง ุจูพุฐุฑูุฏ.</p>
<p>ูโุชูุงูุฏ ฺฉ ุดุก <strong>Uri</strong> ุฑุง ุจุง ุนุจูุฑ ุฏุงุฏู ูุฑฺฉุฏุงู ุงุฒ ุฑุดุชูโูุง ุฒุฑ ุจู ุณุงุฒูุฏูโุงุด ุงุฌุงุฏ ฺฉูุฏ:</p>
<ul>
<li>ฺฉ ุฑุดุชูโ <strong>URI</strong>ุ ูุซู:
<code>http://www.ebay.com</code> ุง <code>file://janespc/sharedpics/dolphin.jpg</code></li>
<li>ฺฉ ูุณุฑ ูุทูู ุจู ฺฉ ูุงู ุฑู ูุงุฑุฏ ุฏุณฺฉุ ูุซู:
<code>c:\myfiles\data.xlsx</code> (ุฑู ููุฏูุฒ) ุง <code>/tmp/myfiles/data.xlsx</code> (ุฑู ููฺฉุณ)</li>
<li>ฺฉ ูุณุฑ <strong>UNC</strong> ุจู ฺฉ ูุงู ุฏุฑ ุดุจฺฉู LANุ ูุซู:
<code>\\janespc\sharedpics\dolphin.jpg</code></li>
</ul>
<p>ูุณุฑูุง ูุงู ู UNC ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ุจู URI ุชุจุฏู ูโุดููุฏ: ูพุฑูุชฺฉู <code>&quot;file:&quot;</code> ุงุถุงูู ูโุดูุฏ ู <strong>ุจฺฉโุงุณูุดโูุง</strong> (<code>\</code>) ุจู <strong>ููุฑูุงุฑุฏ ุงุณูุดโูุง</strong> (<code>/</code>) ุชุจุฏู ูโุดููุฏ. ุณุงุฒูุฏูโูุง <strong>Uri</strong> ููฺูู ูุจู ุงุฒ ุณุงุฎุช ุดุกุ ุฑุดุชูโ ุดูุง ุฑุง ฺฉู ูพุงฺฉโุณุงุฒ ูโฺฉููุฏุ ุดุงูู:</p>
<ul>
<li>ุชุจุฏู <strong>scheme</strong> ู <strong>hostname</strong> ุจู ุญุฑูู ฺฉูฺฺฉ</li>
<li>ุญุฐู ูพูุฑุชโูุง ุฎุงู ุง ูพุดโูุฑุถ</li>
</ul>
<p>ุงฺฏุฑ ุฑุดุชูโ URI ุฑุง ุจุฏูู scheme (ูุซู <code>www.test.com</code>) ุจุฏูุฏุ ฺฉ <strong>UriFormatException</strong> ูพุฑุชุงุจ ูโุดูุฏ.</p>
<hr>
<p>ฺฉูุงุณ <strong>Uri</strong> ุฏุงุฑุง propertyูุง ุฒุฑ ุงุณุช:</p>
<ul>
<li><strong>IsLoopback</strong> โ ูุดุฎุต ูโฺฉูุฏ ฺฉู ุขุง URI ุจู ูุฒุจุงู ูุญู (<strong>127.0.0.1</strong>) ุงุดุงุฑู ูโฺฉูุฏ ุง ูู.</li>
<li><strong>IsFile</strong> โ ูุดุฎุต ูโฺฉูุฏ ฺฉู ุขุง URI ุจู ฺฉ ูุณุฑ ูุญู ุง UNC ุงุดุงุฑู ุฏุงุฑุฏ ุง ูู (ุจุง <strong>IsUnc</strong>).</li>
</ul>
<p>ุงฺฏุฑ <strong>IsFile</strong> ููุฏุงุฑ true ุจุฑฺฏุฑุฏุงูุฏุ property ุจู ูุงู <strong>LocalPath</strong> ูุณุฎูโุง ุงุฒ <strong>AbsolutePath</strong> ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ ฺฉู ุจุง ุณุณุชูโุนุงูู ูุญู ุณุงุฒฺฏุงุฑ ุงุณุช (ุจุง ุงุณูุดโูุง ุง ุจฺฉโุงุณูุดโูุง ููุงุณุจ)ุ ู ูโุชูุงูุฏ ุฑู ุขู ูุชุฏูุง ูุซู <strong>File.Open</strong> ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ.</p>
<p>ูููููโูุง <strong>Uri</strong> ููุท propertyูุง <strong>read-only</strong> ุฏุงุฑูุฏ. ุจุฑุง ุชุบุฑ ฺฉ URI ููุฌูุฏุ ุจุงุฏ ฺฉ ุดุก <strong>UriBuilder</strong> ุงุฌุงุฏ ฺฉูุฏโุงู ฺฉูุงุณ propertyูุง ูุงุจูโููุดุชู ุฏุงุฑุฏ ู ูโุชูุงูุฏ ุฏูุจุงุฑู ุจู ฺฉ Uri ุงุฒ ุทุฑู property ุฎูุฏุด ุจู ูุงู <strong>Uri</strong> ุชุจุฏู ุดูุฏ.</p>
<hr>
<h3>ูุชุฏูุง ู ูุซุงูโูุง ๐</h3>
<p>ฺฉูุงุณ <strong>Uri</strong> ูุชุฏูุง ุจุฑุง ููุงุณู ู ุชูุฑู ูุณุฑูุง ูุฑุงูู ูโฺฉูุฏ:</p>
<pre><code class="language-csharp">Uri info = new Uri (&quot;http://www.domain.com:80/info/&quot;);
Uri page = new Uri (&quot;http://www.domain.com/info/page.html&quot;);

Console.WriteLine (info.Host);     // www.domain.com
Console.WriteLine (info.Port);     // 80
Console.WriteLine (page.Port);     // 80  (Uri ูพูุฑุช ูพุดโูุฑุถ HTTP ุฑุง ูโุดูุงุณุฏ)
Console.WriteLine (info.IsBaseOf (page));   // True

Uri relative = info.MakeRelativeUri (page);
Console.WriteLine (relative.IsAbsoluteUri); // False
Console.WriteLine (relative.ToString());    // page.html
</code></pre>
<p>ฺฉ <strong>URI ูุณุจ (relative URI)</strong> ูุซู <code>page.html</code> ุฏุฑ ุงู ูุซุงูุ ุงฺฏุฑ ุชูุฑุจุงู ูุฑ property ุง ูุชุฏ ุจูโุฌุฒ <strong>IsAbsoluteUri</strong> ู <strong>ToString</strong> ุฑุง ูุฑุงุฎูุงู ฺฉูุฏุ ฺฉ exception ูพุฑุชุงุจ ูโฺฉูุฏ. ูโุชูุงูุฏ ูุณุชููุงู ฺฉ URI ูุณุจ ุจุณุงุฒุฏ:</p>
<pre><code class="language-csharp">Uri u = new Uri (&quot;page.html&quot;, UriKind.Relative);
</code></pre>
<hr>
<h3>ุงููุช ุงุณูุด ุงูุชูุง <code>/</code> โ๏ธ</h3>
<p>ุงุณูุด ุงูุชูุง ุฏุฑ ฺฉ URI ููู ุงุณุช ู ุฑู ูพุฑุฏุงุฒุด ุฏุฑุฎูุงุณุช ุชูุณุท ุณุฑูุฑ ุชุฃุซุฑ ูโฺฏุฐุงุฑุฏ.</p>
<p>ุจุฑุง ูุซุงูุ ุฏุฑ ฺฉ ุณุฑูุฑ ูุจ ุณูุช:</p>
<ul>
<li>URI ุจู ุดฺฉู <code>http://www.albahari.com/nutshell/</code> โ ุณุฑูุฑ ุฏุฑ ูพูุดูโ <code>nutshell</code> ุฌุณุชโูุฌู ูโฺฉูุฏ ู ูุงู ูพุดโูุฑุถ (ูุนูููุงู <code>index.html</code>) ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ.</li>
<li>URI ุจุฏูู ุงุณูุด ุงูุชูุง <code>http://www.albahari.com/nutshell</code> โ ุณุฑูุฑ ุจู ุฏูุจุงู ูุงู ุจู ูุงู <code>nutshell</code> (ุจุฏูู ูพุณููุฏ) ุฏุฑ ูพูุดูโ ุฑุดู ูโฺฏุฑุฏุฏ. ุงฺฏุฑ ฺูู ูุงู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ุงุบูุจ ฺฉ ุฎุทุง <strong>301 Permanent Redirect</strong> ุจุฑูโฺฏุฑุฏุงูุฏ ู ูพุดููุงุฏ ูโฺฉูุฏ ฺฉู ฺฉูุงูุช ุฏูุจุงุฑู ุจุง ุงุณูุด ุงูุชูุง ุฏุฑุฎูุงุณุช ุจูุฑุณุชุฏ.</li>
</ul>
<p>ฺฉูุงูุชโูุง HTTP ุฏุฑ .NET ุจูโุทูุฑ ูพุดโูุฑุถ ููุงููุฏ ูุฑูุฑฺฏุฑูุง ุนูู ูโฺฉููุฏ ู ุจูโุทูุฑ ุดูุงู ุฏุฑุฎูุงุณุช ุฑุง ุจุง URI ูพุดููุงุฏ ุฏูุจุงุฑู ุงุฑุณุงู ูโฺฉููุฏ. ุงู ุนู ุงฺฏุฑ ุงุณูุด ุงูุชูุง ุฑุง ูุฑุงููุด ฺฉูุฏุ ุฏุฑุฎูุงุณุช ููฺูุงู ฺฉุงุฑ ุฎูุงูุฏ ฺฉุฑุฏโุงูุง ฺฉ <strong>ุฑูุชโูโุจุฑฺฏุดุช ุงุถุงููโ ุบุฑุถุฑูุฑ</strong> ุงุฌุงุฏ ูโุดูุฏ.</p>
<hr>
<h3>ูุชุฏูุง ุงุณุชุงุชฺฉ ููุฏ ๐</h3>
<p>ฺฉูุงุณ <strong>Uri</strong> ูุชุฏูุง ฺฉูฺฉ ุงุณุชุงุชฺฉ ูุฒ ุฏุงุฑุฏุ ูุซู:</p>
<ul>
<li><strong>EscapeUriString()</strong> โ ฺฉ ุฑุดุชู ุฑุง ุจู ฺฉ URL ูุนุชุจุฑ ุชุจุฏู ูโฺฉูุฏ (ฺฉุงุฑุงฺฉุชุฑูุง ุจุง ููุฏุงุฑ ASCII ุจุดุชุฑ ุงุฒ ฑฒท ุฑุง ุจู ููุงุด ูฺฏุฒุงุฏุณูุงู ุชุบุฑ ูโุฏูุฏ).</li>
<li><strong>CheckHostName()</strong> ู <strong>CheckSchemeName()</strong> โ ุจุฑุฑุณ ูโฺฉููุฏ ฺฉู ุขุง ฺฉ ุฑุดุชู ุงุฒ ูุธุฑ ูุญู ุจุฑุง property ูุฑุจูุทู ูุนุชุจุฑ ุงุณุช ุง ูู (ุงูุง ูุฌูุฏ ูุฒุจุงู ุง URI ุฑุง ุจุฑุฑุณ ููโฺฉููุฏ).</li>
</ul>
<hr>
<h2>HttpClient ๐</h2>
<p>ฺฉูุงุณ <strong>HttpClient</strong> ฺฉ API ูุฏุฑู ุจุฑุง ุนููุงุช ฺฉูุงูุช HTTP ุงุฑุงุฆู ูโุฏูุฏ ู ุฌุงฺฏุฒู <strong>WebClient</strong> ู <strong>WebRequest/WebResponse</strong> (ฺฉู ุงฺฉููู <strong>obsolete</strong> ุดุฏูโุงูุฏ) ุงุณุช.</p>
<p>ุงู ฺฉูุงุณ ุฏุฑ ูุงฺฉูุด ุจู ุฑุดุฏ <strong>APIูุง ูุจ ูุจุชู ุจุฑ HTTP</strong> ู <strong>ุณุฑูุณโูุง REST</strong> ุทุฑุงุญ ุดุฏ ู ุชุฌุฑุจูโ ุจูุชุฑ ุจุฑุง ูพุฑูุชฺฉูโูุง ูพฺุฏูโุชุฑ ุงุฒ ููุท ุฏุฑุงูุช ฺฉ ุตูุญูโ ูุจ ุงุฑุงุฆู ูโุฏูุฏ.</p>
<h3>ูุงุจูุชโูุง ฺฉูุฏ HttpClient โ</h3>
<ul>
<li>ฺฉ ูููููโ <strong>HttpClient</strong> ูโุชูุงูุฏ ุฏุฑุฎูุงุณุชโูุง ููโุฒูุงู ุฑุง ูุฏุฑุช ฺฉูุฏ ู ุจูโุฎูุจ ุจุง ูุงุจูุชโูุง ูุซู <strong>ูุฏุฑูุง ุณูุงุฑุดุ ฺฉูฺฉโูุง ู ุฑูุดโูุง ุงุญุฑุงุฒ ููุช</strong> ฺฉุงุฑ ฺฉูุฏ.</li>
<li>ุงุฌุงุฒู ูโุฏูุฏ <strong>Message Handler</strong>ูุง ุณูุงุฑุด ุจููุณุฏ ู ุงุถุงูู ฺฉูุฏ โ ุจุฑุง <strong>mocking</strong> ุฏุฑ ุชุณุชโูุง ูุงุญุฏ ู ุงุฌุงุฏ <strong>pipelineูุง ุณูุงุฑุด</strong> (ูุซู ูุงฺฏโุจุฑุฏุงุฑุ ูุดุฑุฏูโุณุงุฒุ ุฑูุฒูฺฏุงุฑ ู โฆ).</li>
<li>ฺฉ ุณุณุชู ููุน (type system) ุบู ู ูุงุจูโฺฏุณุชุฑุด ุจุฑุง <strong>Headers</strong> ู <strong>Content</strong> ุฏุงุฑุฏ.</li>
</ul>
<p>โ๏ธ <strong>HttpClient ุงุฒ ฺฏุฒุงุฑุด ูพุดุฑูุช (progress reporting) ูพุดุชุจุงู ููโฺฉูุฏ</strong>. ุจุฑุง ุฑุงูโุญูุ ูโุชูุงูุฏ ุจู ูููููโ <code>HttpClient with Progress.linq</code> ุฏุฑ ุณุงุช ููุณูุฏู ุง ฺฏุงูุฑ ูููููโูุง LINQPad ูุฑุงุฌุนู ฺฉูุฏ.</p>
<hr>
<h3>ุงุณุชูุงุฏูโ ุณุงุฏู ุงุฒ HttpClient ๐</h3>
<p>ุณุงุฏูโุชุฑู ุฑูุด: ูููููโุณุงุฒ ู ุงุณุชูุงุฏู ุงุฒ ูุชุฏูุง <strong>Get*</strong>:</p>
<pre><code class="language-csharp">string html = await new HttpClient().GetStringAsync (&quot;http://linqpad.net&quot;);
</code></pre>
<p>ููฺูู ูุชุฏูุง <strong>GetByteArrayAsync</strong> ู <strong>GetStreamAsync</strong> ูุฌูุฏ ุฏุงุฑูุฏ. ุชูุงู ูุชุฏูุง I/O ุฏุฑ <strong>HttpClient</strong> ุจูโุตูุฑุช <strong>asynchronous</strong> ูุณุชูุฏ.</p>
<p>๐ก ุจุฑุฎูุงู WebRequest/WebResponseุ ุจุฑุง ุจูุชุฑู ฺฉุงุฑุง ุจุงุฏ ุงุฒ <strong>ฺฉ ูููููโ HttpClient</strong> ุงุณุชูุงุฏูโ ูุฌุฏุฏ ฺฉูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ุนููุงุชโูุง ูุซู <strong>DNS resolution</strong> ุฏูุจุงุฑู ู ุฏูุจุงุฑู ุงูุฌุงู ูโุดููุฏ ู <strong>ุณุงฺฉุชโูุง</strong> (sockets) ุจุดุชุฑ ุงุฒ ุญุฏ ูุงุฒู ุจุงุฒ ูโูุงููุฏ.</p>
<p>ููููู:</p>
<pre><code class="language-csharp">var client = new HttpClient();
var task1 = client.GetStringAsync (&quot;http://www.linqpad.net&quot;);
var task2 = client.GetStringAsync (&quot;http://www.albahari.com&quot;);

Console.WriteLine (await task1);
Console.WriteLine (await task2);
</code></pre>
<hr>
<h3>ูฺฺฏโูุง ู ูพฺฉุฑุจูุฏ โ๏ธ</h3>
<ul>
<li><strong>Timeout</strong> โ ุชุนู ูโฺฉูุฏ ฺฉ ุฏุฑุฎูุงุณุช ฺูุฏุฑ ูโุชูุงูุฏ ุทูู ุจฺฉุดุฏ.</li>
<li><strong>BaseAddress</strong> โ ฺฉ URI ูพุงู ุจู ูููโ ุฏุฑุฎูุงุณุชโูุง ุงุถุงูู ูโฺฉูุฏ.</li>
</ul>
<p>ุจุดุชุฑ propertyูุง ุฏฺฏุฑ ุฏุฑ ฺฉูุงุณ <strong>HttpClientHandler</strong> ุชุนุฑู ุดุฏูโุงูุฏ. ุจุฑุง ุฏุณุชุฑุณ ุจู ุขู:</p>
<pre><code class="language-csharp">var handler = new HttpClientHandler { UseProxy = false };
var client = new HttpClient (handler);
</code></pre>
<p>ุฏุฑ ุงู ูุซุงูุ <strong>ูพุดุชุจุงู ุงุฒ Proxy</strong> ุบุฑูุนุงู ุดุฏ ุชุง ูุฒููโ ุดูุงุณุง ุฎูุฏฺฉุงุฑ Proxy ุญุฐู ุดูุฏ ู ฺฉุงุฑุง ุงูุฒุงุด ุงุจุฏ.</p>
<p>ฺฉูุงุณ <strong>HttpClientHandler</strong> ููฺูู propertyูุง ุจุฑุง ฺฉูุชุฑู <strong>ฺฉูฺฉโูุงุ ุฑุฏุงุฑฺฉุช ุฎูุฏฺฉุงุฑุ ุงุญุฑุงุฒ ููุช</strong> ู โฆ ุฏุงุฑุฏ.</p>
<hr>
<h3>GetAsync ู Response Messages ๐ฉ</h3>
<p>ูุชุฏูุง <strong>GetStringAsync</strong>ุ <strong>GetByteArrayAsync</strong> ู <strong>GetStreamAsync</strong> ูุงูุจุฑูุง ุจุฑุง ูุชุฏ ุนูููโุชุฑ <strong>GetAsync</strong> ูุณุชูุฏ ฺฉู ฺฉ <strong>HttpResponseMessage</strong> ุจุฑูโฺฏุฑุฏุงูุฏ:</p>
<pre><code class="language-csharp">var client = new HttpClient();
// GetAsync ููฺูู ฺฉ CancellationToken ูโูพุฐุฑุฏ
HttpResponseMessage response = await client.GetAsync (&quot;http://...&quot;);

response.EnsureSuccessStatusCode();
string html = await response.Content.ReadAsStringAsync();
</code></pre>
<ul>
<li><strong>HttpResponseMessage</strong> โ ุฏุณุชุฑุณ ุจู <strong>Headers</strong> ู <strong>StatusCode</strong>.</li>
<li>ุงฺฏุฑ <strong>status code ูุงูููู</strong> ูุซู ดฐด ุจุฑฺฏุฑุฏุฏุ exception ูพุฑุชุงุจ ููโุดูุฏ ูฺฏุฑ ุงูฺฉู <strong>EnsureSuccessStatusCode</strong> ุฑุง ุตุฑุญุงู ูุฑุงุฎูุงู ฺฉูุฏ.</li>
<li>ุฎุทุงูุง ุงุฑุชุจุงุท ุง DNS โ ููุดู exception ูพุฑุชุงุจ ูโฺฉููุฏ.</li>
</ul>
<p>ููฺููุ <strong>HttpContent</strong> ูุชุฏ ุจู ูุงู <strong>CopyToAsync</strong> ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ุฎุฑูุฌ ุฑุง ุจู ฺฉ <strong>Stream ุฏฺฏุฑ</strong> ุจููุณุฏ:</p>
<pre><code class="language-csharp">using (var fileStream = File.Create (&quot;linqpad.html&quot;))
  await response.Content.CopyToAsync (fileStream);
</code></pre>
<p>ูุชุฏ <strong>GetAsync</strong> ฺฉ ุงุฒ ฺูุงุฑ ูุชุฏ ูุชูุงุธุฑ ุจุง ุงูุนุงู HTTP ุงุณุช (ุจูู: <strong>PostAsyncุ PutAsyncุ DeleteAsync</strong>).</p>
<hr>
<h3>SendAsync ู Request Messages ๐จ</h3>
<p>ูุชุฏูุง <strong>GetAsyncุ PostAsyncุ PutAsync ู DeleteAsync</strong> ููฺฏ ูุงูุจุฑูุง ุจุฑุง <strong>SendAsync</strong> ูุณุชูุฏุ ูุชุฏ ุณุทุญโูพุงู ฺฉู ููู ฺุฒ ุจู ุขู ุฎุชู ูโุดูุฏ.</p>
<p>ุจุฑุง ุงุณุชูุงุฏู:</p>
<pre><code class="language-csharp">var client = new HttpClient();
var request = new HttpRequestMessage (HttpMethod.Get, &quot;http://...&quot;);
HttpResponseMessage response = await client.SendAsync (request);

response.EnsureSuccessStatusCode();
</code></pre>
<p>ุงุฌุงุฏ ฺฉ <strong>HttpRequestMessage</strong> ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ propertyูุง ุฏุฑุฎูุงุณุช ูุซู <strong>Headers</strong> ู <strong>Content</strong> ุฑุง ุดุฎุตโุณุงุฒ ฺฉูุฏุ ฺฉู ุดุงูู ุขูพููุฏ ุฏุงุฏูโูุง ูุฒ ูโุดูุฏ.</p>
<h3>๐ค ุขูพููุฏ ุฏุงุฏูโูุง ู HttpContent</h3>
<p>ุจุนุฏ ุงุฒ ูููููโุณุงุฒ ฺฉ ุดุก ุงุฒ ููุน <code>HttpRequestMessage</code>ุ ูโุชูุงูุฏ ุจุง ููุฏุงุฑุฏู ุจู ูฺฺฏ <strong>Content</strong> ุฏุงุฏูโุง ุจุฑุง ุขูพููุฏ ูุดุฎุต ฺฉูุฏ. ููุน ุงู ูฺฺฏ ฺฉ ฺฉูุงุณ ุงูุชุฒุงุน ุจู ูุงู <code>HttpContent</code> ุงุณุช. .NET ฺูุฏู ุฒุฑฺฉูุงุณ ูุดุฎุต ุจุฑุง ุงููุงุน ูุฎุชูู ุฏุงุฏู ูุฑุงูู ฺฉุฑุฏู ุงุณุช (ู ุงูุจุชู ูโุชูุงูุฏ ฺฉูุงุณ ุงุฎุชุตุงุต ุฎูุฏุชุงู ุฑุง ูู ุจููุณุฏ):</p>
<ul>
<li><code>ByteArrayContent</code></li>
<li><code>StringContent</code></li>
<li><code>FormUrlEncodedContent</code> (ุจุฎุด <strong>Uploading Form Data</strong> ุฏุฑ ุตูุญู 754 ุฑุง ุจุจูุฏ)</li>
<li><code>StreamContent</code></li>
</ul>
<p>๐น ูุซุงู:</p>
<pre><code class="language-csharp">var client = new HttpClient (new HttpClientHandler { UseProxy = false });
var request = new HttpRequestMessage (
 HttpMethod.Post, &quot;http://www.albahari.com/EchoPost.aspx&quot;);
request.Content = new StringContent (&quot;This is a test&quot;);
HttpResponseMessage response = await client.SendAsync (request);
response.EnsureSuccessStatusCode();
Console.WriteLine (await response.Content.ReadAsStringAsync());
</code></pre>
<hr>
<h3>โ๏ธ HttpMessageHandler</h3>
<p>ูุจูุงู ฺฏูุชู ฺฉู ุจุดุชุฑ ูฺฺฏโูุง ุณูุงุฑุดโุณุงุฒ ุฏุฑุฎูุงุณุชโูุง ูู ุฏุฑ <code>HttpClient</code> ุจูฺฉู ุฏุฑ <code>HttpClientHandler</code> ุชุนุฑู ุดุฏูโุงูุฏ. ุฏุฑ ูุงูุนุ <code>HttpClientHandler</code> ุฒุฑฺฉูุงุณ ุงุฒ ฺฉูุงุณ ุงูุชุฒุงุน <code>HttpMessageHandler</code> ุงุณุช ฺฉู ุจู ุดฺฉู ุฒุฑ ุชุนุฑู ูโุดูุฏ:</p>
<pre><code class="language-csharp">public abstract class HttpMessageHandler : IDisposable
{
  protected internal abstract Task&lt;HttpResponseMessage&gt; SendAsync
    (HttpRequestMessage request, CancellationToken cancellationToken);
  public void Dispose();
  protected virtual void Dispose (bool disposing);
}
</code></pre>
<p>ูุชุฏ <code>SendAsync</code> ุฏุฑูู ูุชุฏ <code>SendAsync</code> ฺฉูุงุณ <code>HttpClient</code> ูุฑุงุฎูุงู ูโุดูุฏ.
<code>HttpMessageHandler</code> ุจู ุงูุฏุงุฒูโุง ุณุงุฏู ุงุณุช ฺฉู ุจุชูุงู ุจูโุฑุงุญุช ุขู ุฑุง ุฒุฑฺฉูุงุณ ฺฉุฑุฏ ู ุฏุฑ ูุชุฌูุ ฺฉ ููุทูโ ุชูุณุนูโูพุฐุฑ ุจุฑุง <code>HttpClient</code> ูุฑุงูู ูโฺฉูุฏ.</p>
<hr>
<h3>๐งช Unit Testing ู Mocking</h3>
<p>ูโุชูุงูู <code>HttpMessageHandler</code> ุฑุง ุฒุฑฺฉูุงุณ ฺฉูู ุชุง ฺฉ <strong>Mocking Handler</strong> ุจุฑุง ฺฉูฺฉ ุจู ุชุณุช ูุงุญุฏ ุจุณุงุฒู:</p>
<pre><code class="language-csharp">class MockHandler : HttpMessageHandler
{
  Func &lt;HttpRequestMessage, HttpResponseMessage&gt; _responseGenerator;
  public MockHandler
    (Func &lt;HttpRequestMessage, HttpResponseMessage&gt; responseGenerator)
  {
    _responseGenerator = responseGenerator;
  }
  protected override Task &lt;HttpResponseMessage&gt; SendAsync
    (HttpRequestMessage request, CancellationToken cancellationToken)
  {
    cancellationToken.ThrowIfCancellationRequested();
    var response = _responseGenerator (request);
    response.RequestMessage = request;
    return Task.FromResult (response);
  }
}
</code></pre>
<p>๐น ุณุงุฒูุฏูโ ุงู ฺฉูุงุณ ฺฉ ุชุงุจุน ุฏุฑุงูุช ูโฺฉูุฏ ฺฉู ูุดุฎุต ูโฺฉูุฏ ูพุงุณุฎ ุงุฒ ุฑู ุฏุฑุฎูุงุณุช ฺฺฏููู ุณุงุฎุชู ุดูุฏ. ุงู ุฑูฺฉุฑุฏ ุจุณุงุฑ ุงูุนุทุงูโูพุฐุฑ ุงุณุช ุฒุฑุง ููุงู ููุฏูุฑ ูโุชูุงูุฏ ฺูุฏู ุฏุฑุฎูุงุณุช ูุฎุชูู ุฑุง ุชุณุช ฺฉูุฏ.</p>
<p>ูุชุฏ <code>SendAsync</code> ุฏุฑ ุงูุฌุง ุจูโุตูุฑุช <strong>ููฺฏุงู</strong> ุนูู ูโฺฉูุฏ ฺูู ุงุฒ <code>Task.FromResult</code> ุงุณุชูุงุฏู ฺฉุฑุฏูโุงู. ุงูุจุชู ูโุชูุงูุณุชู ุจุง ุจุฑฺฏุฑุฏุงูุฏู <code>Task&lt;HttpResponseMessage&gt;</code> ุงุฒ ุชุงุจุน ูพุงุณุฎโุณุงุฒุ ุญุงูุช <strong>ุบุฑููฺฏุงู</strong> ุฑุง ูู ุญูุธ ฺฉููุ ุงูุง ุงุฒ ุขูุฌุง ฺฉู ุชุงุจุน Mock ูุนูููุงู ฺฉูุชุงู ู ุณุฑุน ุงุณุชุ ุถุฑูุฑุช ูุฏุงุฑุฏ.</p>
<p>๐น ูุญููโ ุงุณุชูุงุฏู:</p>
<pre><code class="language-csharp">var mocker = new MockHandler (request =&gt; 
  new HttpResponseMessage (HttpStatusCode.OK)
  {
    Content = new StringContent (&quot;You asked for &quot; + request.RequestUri)
  });
var client = new HttpClient (mocker);    
var response = await client.GetAsync (&quot;http://www.linqpad.net&quot;);
string result = await response.Content.ReadAsStringAsync();
Assert.AreEqual (&quot;You asked for http://www.linqpad.net/&quot;, result);
</code></pre>
<p>(<code>Assert.AreEqual</code> ูุชุฏ ุงุณุช ฺฉู ูุนูููุงู ุฏุฑ ูุฑูโูุฑฺฉโูุง ุชุณุช ูุงุญุฏ ูุซู NUnit ุงุณุชูุงุฏู ูโุดูุฏ.)</p>
<hr>
<h3>๐ ุฒูุฌุฑูโุณุงุฒ ููุฏูุฑูุง ุจุง DelegatingHandler</h3>
<p>ูโุชูุงูุฏ ฺฉ Message Handler ุจุณุงุฒุฏ ฺฉู ฺฉ ููุฏูุฑ ุฏฺฏุฑ ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ (ู ุฏุฑ ูุชุฌู ุฒูุฌุฑูโุง ุงุฒ ููุฏูุฑูุง ุงุฌุงุฏ ุดูุฏ). ุงู ฺฉุงุฑ ุงุฒ ุทุฑู ุฒุฑฺฉูุงุณ ฺฉุฑุฏู <code>DelegatingHandler</code> ุงูุฌุงู ูโุดูุฏ. ุจุง ุงู ุฑูุด ูโุชูุงูุฏ ูพุฑูุชฺฉูโูุง ุณูุงุฑุด ูุงููุฏ <strong>ุงุญุฑุงุฒ ููุชุ ูุดุฑุฏูโุณุงุฒ ู ุฑูุฒฺฏุฐุงุฑ</strong> ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ.</p>
<p>๐น ูููููโ ฺฉ ููุฏูุฑ ูุงฺฏ ุณุงุฏู:</p>
<pre><code class="language-csharp">class LoggingHandler : DelegatingHandler 
{
  public LoggingHandler (HttpMessageHandler nextHandler)
  {
     InnerHandler = nextHandler;
  }
  protected async override Task &lt;HttpResponseMessage&gt; SendAsync
    (HttpRequestMessage request, CancellationToken cancellationToken)
  {
    Console.WriteLine (&quot;Requesting: &quot; + request.RequestUri);
    var response = await base.SendAsync (request, cancellationToken);
    Console.WriteLine (&quot;Got response: &quot; + response.StatusCode);
    return response;
  }
}
</code></pre>
<p>โ ุฏุฑ ุงูุฌุง ูุง <strong>ุบุฑููุฒูุงู</strong> ุฑุง ุฏุฑ Override ฺฉุฑุฏู <code>SendAsync</code> ุญูุธ ฺฉุฑุฏูโุงู. ุงุณุชูุงุฏู ุงุฒ <code>async</code> ุฏุฑ ูุชุฏูุง ฺฉู ุฎุฑูุฌ Task ุฏุงุฑูุฏ ูู ูุงููู ุงุณุช ู ูู ุฏุฑ ุงูุฌุง ูุทููุจ.</p>
<hr>
<h3>๐ ูพุฑูฺฉุณ (Proxy)</h3>
<p>ฺฉ <strong>Proxy Server</strong> ูุงุณุทูโุง ุงุณุช ฺฉู ุฏุฑุฎูุงุณุชโูุง HTTP ุงุฒ ุทุฑู ุขู ูุณุฑุฏู ูโุดููุฏ. ุณุงุฒูุงูโูุง ูุนูููุงู ุจุฑุง ุฏุณุชุฑุณ ฺฉุงุฑฺฉูุงู ุจู ุงูุชุฑูุช ุงุฒ ุทุฑู ฺฉ ูพุฑูฺฉุณ ุงุณุชูุงุฏู ูโฺฉููุฏ ฺูู ูุฏุฑุช ุงููุช ุฑุง ุณุงุฏูโุชุฑ ูโฺฉูุฏ. ูพุฑูฺฉุณ ุขุฏุฑุณ ุฎูุฏุด ุฑุง ุฏุงุฑุฏ ู ูโุชูุงูุฏ ุงุญุฑุงุฒ ููุช ุจุฎูุงูุฏ ุชุง ููุท ฺฉุงุฑุจุฑุงู ุงูุชุฎุงุจโุดุฏู ุฏุฑ LAN ุจู ุงูุชุฑูุช ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏ.</p>
<p>ุจุฑุง ุงุณุชูุงุฏู ุงุฒ Proxy ุฏุฑ <code>HttpClient</code>:</p>
<pre><code class="language-csharp">WebProxy p = new WebProxy (&quot;192.178.10.49&quot;, 808);
p.Credentials = new NetworkCredential (&quot;username&quot;, &quot;password&quot;, &quot;domain&quot;);
var handler = new HttpClientHandler { Proxy = p };
var client = new HttpClient (handler);
...
</code></pre>
<p>ูฺฺฏ <code>UseProxy</code> ุฏุฑ <code>HttpClientHandler</code> ุฑุง ูโุชูุงู ุฑู <code>false</code> ุชูุธู ฺฉุฑุฏ ุชุง ุจู ุฌุง null ฺฉุฑุฏู <code>Proxy</code>ุ ุชุดุฎุต ุฎูุฏฺฉุงุฑ ุบุฑูุนุงู ุดูุฏ.</p>
<p>ุงฺฏุฑ ููฺฏุงู ุณุงุฎุชู <code>NetworkCredential</code> ฺฉ <strong>ุฏุงููู</strong> ูุดุฎุต ฺฉูุฏุ ูพุฑูุชฺฉูโูุง ุงุญุฑุงุฒ ููุช ูุจุชู ุจุฑ ููุฏูุฒ (NTLM ุง Kerberos) ุงุณุชูุงุฏู ูโุดููุฏ. ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ฺฉุงุฑุจุฑ ูุนู ููุฏูุฒุ ููุฏุงุฑ <code>CredentialCache.DefaultNetworkCredentials</code> ุฑุง ุจู ูฺฺฏ <code>Credentials</code> ูพุฑูฺฉุณ ุงุฎุชุตุงุต ุฏูุฏ.</p>
<p>ููฺูู ุจูโุฌุง ุชูุธู Proxy ุฏุฑ ูุฑ ุจุงุฑ ุงุณุชูุงุฏูุ ูโุชูุงูุฏ ููุฏุงุฑ ูพุดโูุฑุถ ุณุฑุงุณุฑ ุฑุง ูุดุฎุต ฺฉูุฏ:</p>
<pre><code class="language-csharp">HttpClient.DefaultWebProxy = myWebProxy;
</code></pre>
<hr>
<h3>๐ ุงุญุฑุงุฒ ููุช (Authentication)</h3>
<p>ูโุชูุงูุฏ ูุงู ฺฉุงุฑุจุฑ ู ุฑูุฒ ุนุจูุฑ ุฑุง ุจู ุงู ุตูุฑุช ุจู <code>HttpClient</code> ุจุฏูุฏ:</p>
<pre><code class="language-csharp">string username = &quot;myuser&quot;;
string password = &quot;mypassword&quot;;
var handler = new HttpClientHandler();
handler.Credentials = new NetworkCredential (username, password);
var client = new HttpClient (handler);
...
</code></pre>
<p>ุงู ุฑูุด ุจุง ูพุฑูุชฺฉูโูุง ูุจุชู ุจุฑ ุฏุงููฺฏ ูุซู <strong>Basic</strong> ู <strong>Digest</strong> ฺฉุงุฑ ูโฺฉูุฏ ู ุงุฒ ุทุฑู ฺฉูุงุณ <code>AuthenticationManager</code> ูุฒ ูุงุจู ฺฏุณุชุฑุด ุงุณุช. ููฺูู ุงุฒ <strong>Windows NTLM</strong> ู <strong>Kerberos</strong> ูู ูพุดุชุจุงู ูโฺฉูุฏ (ุงฺฏุฑ ููฺฏุงู ุณุงุฎุชู <code>NetworkCredential</code> ุฏุงููู ูุงุฑุฏ ฺฉุฑุฏู ุจุงุดุฏ). ุงฺฏุฑ ุจุฎูุงูุฏ ุงุฒ ฺฉุงุฑุจุฑ ูุนู ููุฏูุฒ ุงุณุชูุงุฏู ฺฉูุฏุ ฺฉุงู ุงุณุช ูฺฺฏ <code>Credentials</code> ุฑุง ููุฏุงุฑุฏู ูฺฉูุฏ ู ุจูโุฌุง ุขู <code>UseDefaultCredentials = true</code> ุชูุธู ฺฉูุฏ.</p>
<p>ููุช ุงุทูุงุนุงุช ูุฑูุฏ (Credentials) ุฑุง ูุดุฎุต ูโฺฉูุฏุ <code>HttpClient</code> ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ูพุฑูุชฺฉู ููุงุณุจ ุฑุง ูุฐุงฺฉุฑู ูโฺฉูุฏ. ุฏุฑ ุจุฑุฎ ููุงุฑุฏ ฺฏุฒููโูุง ูุฎุชูู ูุฌูุฏ ุฏุงุฑุฏุ ุจุฑุง ูุซุงูุ ูพุงุณุฎ ุงูููโ ฺฉ ุณุฑูุฑ Microsoft Exchange Web Mail ููฺฉู ุงุณุช ุดุงูู ูุฏุฑูุง ุฒุฑ ุจุงุดุฏ:</p>
<pre><code>HTTP/1.1 401 Unauthorized
Content-Length: 83
Content-Type: text/html
Server: Microsoft-IIS/6.0
WWW-Authenticate: Negotiate
WWW-Authenticate: NTLM
WWW-Authenticate: Basic realm=&quot;exchange.somedomain.com&quot;
X-Powered-By: ASP.NET
Date: Sat, 05 Aug 2006 12:37:23 GMT
</code></pre>
<p>ฺฉุฏ <strong>401</strong> ุจู ูุนูุง ูุงุฒ ุจู ุงุญุฑุงุฒ ููุช ุงุณุชุ ูุฏุฑูุง <code>WWW-Authenticate</code> ูู ูุดุงู ูโุฏููุฏ ฺู ูพุฑูุชฺฉูโูุง ูพุดุชุจุงู ูโุดููุฏ.</p>
<p>ุงฺฏุฑ <code>HttpClientHandler</code> ุฑุง ุจุง ูุงู ฺฉุงุฑุจุฑ ู ุฑูุฒ ุฏุฑุณุช ูพฺฉุฑุจูุฏ ฺฉูุฏุ ุงู ูพุงู ุฑุง ูุฎูุงูุฏ ุฏุฏ ฺูู ุฒูุงู ุงุฌุฑุง ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ฺฉ ูพุฑูุชฺฉู ุณุงุฒฺฏุงุฑ ุงูุชุฎุงุจ ูโฺฉูุฏุ ุฏุฑุฎูุงุณุช ุงุตู ุฑุง ุฏูุจุงุฑู ุงุฑุณุงู ูโฺฉูุฏ ู ฺฉ ูุฏุฑ ุงุถุงู ุงุถุงูู ูโฺฉูุฏ.</p>
<p>ูุซุงู:</p>
<pre><code>Authorization: Negotiate TlRMTVNTUAAABAAAt5II2gjACDArAAACAwACACgAAAAQ
ATmKAAAAD0lVDRdPUksHUq9VUA==
</code></pre>
<p>ุงู ูฺฉุงูุฒู ุดูุงู ุงุณุชุ ุงูุง ุจุงุนุซ ูโุดูุฏ ูุฑ ุฏุฑุฎูุงุณุช ฺฉ ุฑูุชโูุจุฑฺฏุดุช ุงุถุงู ุงุฌุงุฏ ฺฉูุฏ. ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงู ููุถูุน ุฏุฑ ุฏุฑุฎูุงุณุชโูุง ุจุนุฏ ุจู ููุงู URIุ ูโุชูุงูุฏ ูฺฺฏ <code>PreAuthenticate</code> ุฏุฑ <code>HttpClientHandler</code> ุฑุง ุฑู true ูุฑุงุฑ ุฏูุฏ.</p>
<h3>๐ CredentialCache</h3>
<p>ูโุชูุงูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุดุก <code>CredentialCache</code> ฺฉ <strong>ูพุฑูุชฺฉู ุงุญุฑุงุฒ ููุช ุฎุงุต</strong> ุฑุง ูุฌุจูุฑ ฺฉูุฏ.
ฺฉ Credential Cache ุดุงูู ฺฉ ุง ฺูุฏ ุดุก <code>NetworkCredential</code> ุงุณุช ฺฉู ูุฑฺฉุฏุงู ุจู ฺฉ ูพุฑูุชฺฉู ู ฺฉ <strong>URI prefix</strong> ุฎุงุต ูุชุตู ูุณุชูุฏ.</p>
<p>ุจูโุนููุงู ูุซุงูุ ููฺฉู ุงุณุช ุจุฎูุงูุฏ ุฏุฑ ููฺฏุงู ูุฑูุฏ ุจู <strong>Exchange Server</strong> ุงุฒ ูพุฑูุชฺฉู Basic ุงุณุชูุงุฏู ูฺฉูุฏ (ฺูู ุฑูุฒูุง ุฑุง ุจู ุตูุฑุช <strong>ูุชู ุณุงุฏู</strong> ุงุฑุณุงู ูโฺฉูุฏ):</p>
<pre><code class="language-csharp">CredentialCache cache = new CredentialCache();
Uri prefix = new Uri (&quot;http://exchange.somedomain.com&quot;);
cache.Add (prefix, &quot;Digest&quot;,  new NetworkCredential (&quot;joe&quot;, &quot;passwd&quot;));
cache.Add (prefix, &quot;Negotiate&quot;, new NetworkCredential (&quot;joe&quot;, &quot;passwd&quot;));
var handler = new HttpClientHandler();
handler.Credentials = cache;
...
</code></pre>
<p>ูพุฑูุชฺฉู ุงุญุฑุงุฒ ููุช ุจู ุตูุฑุช ุฑุดุชูโุง ูุดุฎุต ูโุดูุฏ. ููุงุฏุฑ ูุนุชุจุฑ ุดุงูู ููุงุฑุฏ ุฒุฑ ูุณุชูุฏ:
<code>Basic</code>, <code>Digest</code>, <code>NTLM</code>, <code>Kerberos</code>, <code>Negotiate</code></p>
<p>๐น ุฏุฑ ุงู ูุซุงูุ ูพุฑูุชฺฉู <strong>Negotiate</strong> ุงูุชุฎุงุจ ูโุดูุฏ ฺูู ุณุฑูุฑ ุฏุฑ ูุฏุฑูุง ุงุญุฑุงุฒ ููุช ุฎูุฏ ูพุดุชุจุงู ุงุฒ Digest ุฑุง ุงุนูุงู ูฺฉุฑุฏู ุงุณุช.
Negotiate ฺฉ ูพุฑูุชฺฉู ููุฏูุฒ ุงุณุช ฺฉู ุฏุฑ ุนูู ุจู <strong>Kerberos</strong> ุง <strong>NTLM</strong> ุชุฑุฌูู ูโุดูุฏุ ุจุณุชู ุจู ุงูฺฉู ุณุฑูุฑ ฺู ูุงุจูุช ุฏุงุดุชู ุจุงุดุฏ. ุงู ูฺฉุงูุฒู ุจุงุนุซ ูโุดูุฏ ุงูพูฺฉุดู ุดูุง ุฏุฑ ุจุฑุงุจุฑ ุงุณุชุงูุฏุงุฑุฏูุง ุงููุช ุขูุฏู ูู <strong>ุณุงุฒฺฏุงุฑ</strong> ุจุงู ุจูุงูุฏ.</p>
<p>ุจุฑุง ุงูุฒูุฏู ฺฉุงุฑุจุฑ ูุนู ููุฏูุฒ ุจู Credential Cache ุจุฏูู ูุงุฒ ุจู ุฑูุฒ ุนุจูุฑุ ูโุชูุงูุฏ ุงุฒ ูฺฺฏ ุงุณุชุง <code>CredentialCache.DefaultNetworkCredentials</code> ุงุณุชูุงุฏู ฺฉูุฏ:</p>
<pre><code class="language-csharp">cache.Add (prefix, &quot;Negotiate&quot;, CredentialCache.DefaultNetworkCredentials);
</code></pre>
<hr>
<h3>๐จ ุงุญุฑุงุฒ ููุช ุงุฒ ุทุฑู Header</h3>
<p>ุฑุงู ุฏฺฏุฑ ุงุญุฑุงุฒ ููุชุ ุชูุธู ูุณุชูู <strong>ูุฏุฑ ุงุญุฑุงุฒ ููุช</strong> ุงุณุช:</p>
<pre><code class="language-csharp">var client = new HttpClient();
client.DefaultRequestHeaders.Authorization = 
  new AuthenticationHeaderValue (&quot;Basic&quot;,
    Convert.ToBase64String (Encoding.UTF8.GetBytes (&quot;username:password&quot;)));
...
</code></pre>
<p>ุงู ุงุณุชุฑุงุชฺ ุจุง ุณุณุชูโูุง ุงุญุฑุงุฒ ููุช ุณูุงุฑุด ูุซู <strong>OAuth</strong> ูู ฺฉุงุฑ ูโฺฉูุฏ.</p>
<hr>
<h3>๐ ูุฏุฑูุง (Headers)</h3>
<p><code>HttpClient</code> ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ฺฉู ุจู ฺฉ ุฏุฑุฎูุงุณุชุ ูุฏุฑูุง HTTP ุณูุงุฑุด ุงุถุงูู ฺฉูุฏ ุง ูุฏุฑูุง ูพุงุณุฎ ุฑุง ูุฑูุฑ ฺฉูุฏ.
ฺฉ ูุฏุฑ ุฏุฑ ุงุตู ฺฉ ุฌูุช <strong>ฺฉูุฏ/ููุฏุงุฑ</strong> ุงุณุช ฺฉู ุดุงูู <strong>ูุชุงุฏุชุง</strong> ูโุดูุฏ (ูุซู ููุน ูุญุชูุง ูพุงู ุง ูุฑูโุงูุฒุงุฑ ุณุฑูุฑ).</p>
<ul>
<li>ูฺฺฏ <code>DefaultRequestHeaders</code> ุจุฑุง ูุฏุฑูุง ุงุณุช ฺฉู ุฑู <strong>ูููโ ุฏุฑุฎูุงุณุชโูุง</strong> ุงุนูุงู ูโุดููุฏ:</li>
</ul>
<pre><code class="language-csharp">var client = new HttpClient (handler);
client.DefaultRequestHeaders.UserAgent.Add (
  new ProductInfoHeaderValue (&quot;VisualStudio&quot;, &quot;2022&quot;));
client.DefaultRequestHeaders.Add (&quot;CustomHeader&quot;, &quot;VisualStudio/2022&quot;);
</code></pre>
<ul>
<li>ูฺฺฏ <code>Headers</code> ุฏุฑ ฺฉูุงุณ <code>HttpRequestMessage</code> ูุฎุตูุต ูุฏุฑูุง ุฎุงุต ููุงู ุฏุฑุฎูุงุณุช ุงุณุช.</li>
</ul>
<hr>
<h3>โ Query Strings</h3>
<p><strong>Query String</strong> ุฑุดุชูโุง ุงุณุช ฺฉู ุจู URI ุงุถุงูู ูโุดูุฏ (ุจุนุฏ ุงุฒ ุนูุงูุช ุณุคุงู) ู ุจุฑุง ุงุฑุณุงู ุฏุงุฏูโูุง ุณุงุฏู ุจู ุณุฑูุฑ ุงุณุชูุงุฏู ูโุดูุฏ.</p>
<p>๐น ุณุงุฎุชุงุฑ ฺฉู:</p>
<pre><code>?key1=value1&amp;key2=value2&amp;key3=value3...
</code></pre>
<p>ูุซุงู:</p>
<pre><code class="language-csharp">string requestURI = &quot;http://www.google.com/search?q=HttpClient&amp;hl=fr&quot;;
</code></pre>
<p>ุงฺฏุฑ ุงุญุชูุงู ุฏุงุฑุฏ Query ุดุงูู <strong>ฺฉุงุฑุงฺฉุชุฑูุง ุฎุงุต ุง ูุงุตูู</strong> ุจุงุดุฏุ ูโุชูุงูุฏ ุงุฒ ูุชุฏ <code>EscapeDataString</code> ุฏุฑ ฺฉูุงุณ <code>Uri</code> ุงุณุชูุงุฏู ฺฉูุฏ ุชุง URI ูุนุชุจุฑ ุชููุฏ ุดูุฏ:</p>
<pre><code class="language-csharp">string search = Uri.EscapeDataString (&quot;(HttpClient or HttpRequestMessage)&quot;);
string language = Uri.EscapeDataString (&quot;fr&quot;);
string requestURI = &quot;http://www.google.com/search?q=&quot; + search +
                   &quot;&amp;hl=&quot; + language;
</code></pre>
<p>๐น ูุชุฌู:</p>
<pre><code>http://www.google.com/search?q=(HttpClient%20OR%20HttpRequestMessage)&amp;hl=fr
</code></pre>
<p>(ูุชุฏ <code>EscapeDataString</code> ุดุจู <code>EscapeUriString</code> ุงุณุชุ ุจุง ุงู ุชูุงูุช ฺฉู ฺฉุงุฑุงฺฉุชุฑูุง ูุซู <code>&amp;</code> ู <code>=</code> ุฑุง ูู ฺฉุฏฺฏุฐุงุฑ ูโฺฉูุฏุ ฺูู ุฏุฑ ุบุฑ ุงู ุตูุฑุช Query String ุฑุง ุจูโูู ูโุฑุฒุฏ.)</p>
<hr>
<h3>๐ค ุขูพููุฏ ุฏุงุฏูโูุง ูุฑู (Uploading Form Data)</h3>
<p>ุจุฑุง ุขูพููุฏ ุฏุงุฏูโูุง ูุฑู HTMLุ ฺฉ ุดุก ุงุฒ ููุน <code>FormUrlEncodedContent</code> ุจุณุงุฒุฏ ู ููุงุฏุฑ ุฑุง ุฏุฑ ุขู ูุฑุงุฑ ุฏูุฏ. ุณูพุณ ูโุชูุงูุฏ ุขู ุฑุง ุจู ูุชุฏ <code>PostAsync</code> ุจุฏูุฏ ุง ุจู ูฺฺฏ <code>Content</code> ฺฉ ุฏุฑุฎูุงุณุช ุงุฎุชุตุงุต ุฏูุฏ:</p>
<pre><code class="language-csharp">string uri = &quot;http://www.albahari.com/EchoPost.aspx&quot;;
var client = new HttpClient();
var dict = new Dictionary&lt;string,string&gt; 
{
    { &quot;Name&quot;, &quot;Joe Albahari&quot; },
    { &quot;Company&quot;, &quot;O'Reilly&quot; }
};
var values = new FormUrlEncodedContent (dict);
var response = await client.PostAsync (uri, values);
response.EnsureSuccessStatusCode();
Console.WriteLine (await response.Content.ReadAsStringAsync());
</code></pre>
<hr>
<h3>๐ช ฺฉูฺฉโูุง (Cookies)</h3>
<p>ฺฉ <strong>Cookie</strong> ุฌูุช ุฑุดุชู <strong>ูุงู/ููุฏุงุฑ</strong> ุงุณุช ฺฉู ฺฉ ุณุฑูุฑ HTTP ุฏุฑ ูุฏุฑ ูพุงุณุฎ ุจุฑุง ฺฉูุงูุช ุงุฑุณุงู ูโฺฉูุฏ. ูุฑูุฑฺฏุฑูุง ูุนูููุงู ฺฉูฺฉโูุง ุฑุง ุฐุฎุฑู ูโฺฉููุฏ ู ุฏุฑ ูุฑ ุฏุฑุฎูุงุณุช ุจุนุฏ (ุจู ููุงู ุขุฏุฑุณ) ุฏูุจุงุฑู ุจู ุณุฑูุฑ ูโูุฑุณุชูุฏ ุชุง ุฒูุงู ุงููุถุง.</p>
<p>๐น ูุฏู ฺฉูฺฉ: ุณุฑูุฑ ุจุชูุงูุฏ ุจูููุฏ ุขุง ููฺูุงู ุจุง ููุงู ฺฉูุงูุช ูุจู ุฏุฑ ุงุฑุชุจุงุท ุงุณุช ุง ุฎุฑ (ุจุฏูู ูุงุฒ ุจู Query Stringโูุง ุงุถุงู).</p>
<p>ุจูโุทูุฑ ูพุดโูุฑุถุ <code>HttpClient</code> ฺฉูฺฉโูุง ุฏุฑุงูุช ุฑุง <strong>ูุงุฏุฏู ูโฺฏุฑุฏ</strong>. ุจุฑุง ูพุฐุฑุด ฺฉูฺฉโูุง ุจุงุฏ ฺฉ <code>CookieContainer</code> ุจุณุงุฒุฏ ู ุขู ุฑุง ุจู <code>HttpClientHandler</code> ุงุฎุชุตุงุต ุฏูุฏ:</p>
<pre><code class="language-csharp">var cc = new CookieContainer();
var handler = new HttpClientHandler();
handler.CookieContainer = cc;
var client = new HttpClient (handler);
...
</code></pre>
<p>ุจุฑุง ุงุณุชูุงุฏู ูุฌุฏุฏ ุงุฒ ฺฉูฺฉโูุง ุฏุฑ ุฏุฑุฎูุงุณุชโูุง ุจุนุฏุ ฺฉุงู ุงุณุช ุงุฒ ููุงู <code>CookieContainer</code> ุฏูุจุงุฑู ุงุณุชูุงุฏู ฺฉูุฏ.
ููฺูู ูโุชูุงูุฏ ฺฉ <code>CookieContainer</code> ุชุงุฒู ุจุณุงุฒุฏ ู ฺฉูฺฉโูุง ุฑุง ุจูโุตูุฑุช ุฏุณุช ุงุถุงูู ฺฉูุฏ:</p>
<pre><code class="language-csharp">Cookie c = new Cookie (&quot;PREF&quot;,
                       &quot;ID=6b10df1da493a9c4:TM=1179...&quot;,
                       &quot;/&quot;,
                       &quot;.google.com&quot;);
freshCookieContainer.Add (c);
</code></pre>
<p>ุขุฑฺฏููุงู ุณูู ู ฺูุงุฑู ุจู ุชุฑุชุจ <strong>ูุณุฑ (Path)</strong> ู <strong>ุฏุงููู (Domain)</strong> ุตุงุฏุฑฺฉููุฏู ุฑุง ูุดุฎุต ูโฺฉููุฏ.</p>
<p>ฺฉ <code>CookieContainer</code> ุฏุฑ ุณูุช ฺฉูุงูุช ูโุชูุงูุฏ ฺฉูฺฉโูุง ุงุฒ ฺูุฏู ูุจุฏุง ูุฎุชูู ุฑุง ุฏุฑ ุฎูุฏ ุฌุง ุฏูุฏุ <code>HttpClient</code> ููุท ฺฉูฺฉโูุง ุฑุง ูโูุฑุณุชุฏ ฺฉู ูุณุฑ ู ุฏุงูููโุดุงู ุจุง ุณุฑูุฑ ุฏุฑุฎูุงุณุชโุดุฏู ูุทุงุจูุช ุฏุงุดุชู ุจุงุดูุฏ.</p>
<h3>๐ฅ๏ธ ููุดุชู ฺฉ HTTP Server</h3>
<p>ุงฺฏุฑ ูุงุฒ ุจู ููุดุชู ฺฉ <strong>HTTP server</strong> ุฏุงุดุชู ุจุงุดุฏุ ฺฉ ุฑูฺฉุฑุฏ ุณุทุญ ุจุงูุงุชุฑ (ุงุฒ .NET 6 ุจู ุจุนุฏ) ุงุณุชูุงุฏู ุงุฒ <strong>ASP.NET Minimal API</strong> ุงุณุช. ุจุฑุง ุดุฑูุน ููุท ฺฉุงู ุงุณุช:</p>
<pre><code class="language-csharp">var app = WebApplication.CreateBuilder().Build();
app.MapGet (&quot;/&quot;, () =&gt; &quot;Hello, world!&quot;);
app.Run();
</code></pre>
<p>ููฺูู ูโุชูุงูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณ <strong>HttpListener</strong>ุ ุณุฑูุฑ HTTP ุงุฎุชุตุงุต ุฎูุฏุชุงู ุฑุง ุจุณุงุฒุฏ. ูููููโ ุฒุฑ ฺฉ ุณุฑูุฑ ุณุงุฏู ุงุณุช ฺฉู ุฑู ูพูุฑุช 51111 ฺฏูุด ูโุฏูุฏุ ููุชุธุฑ ฺฉ ุฏุฑุฎูุงุณุช ุงุฒ ฺฉูุงูุช ูโุดูุฏ ู ุณูพุณ ฺฉ ูพุงุณุฎ ฺฉโุฎุท ุจุฑูโฺฏุฑุฏุงูุฏ:</p>
<pre><code class="language-csharp">using var server = new SimpleHttpServer();
// ุงุฑุณุงู ฺฉ ุฏุฑุฎูุงุณุช ุงุฒ ฺฉูุงูุช:
Console.WriteLine (await new HttpClient().GetStringAsync
  (&quot;http://localhost:51111/MyApp/Request.txt&quot;));

class SimpleHttpServer : IDisposable
{
  readonly HttpListener listener = new HttpListener();
  public SimpleHttpServer() =&gt; ListenAsync();  

  async void ListenAsync()
  {
    listener.Prefixes.Add (&quot;http://localhost:51111/MyApp/&quot;);  // ฺฏูุด ุฏุงุฏู ุฑู ูพูุฑุช 51111
    listener.Start();

    // ููุชุธุฑ ฺฉ ุฏุฑุฎูุงุณุช ฺฉูุงูุช:
    HttpListenerContext context = await listener.GetContextAsync();

    // ูพุงุณุฎ ุจู ุฏุฑุฎูุงุณุช:
    string msg = &quot;You asked for: &quot; + context.Request.RawUrl;
    context.Response.ContentLength64 = Encoding.UTF8.GetByteCount (msg);
    context.Response.StatusCode = (int)HttpStatusCode.OK;
    using (Stream s = context.Response.OutputStream)
    using (StreamWriter writer = new StreamWriter (s))
      await writer.WriteAsync (msg);
  }

  public void Dispose() =&gt; listener.Close();
}
</code></pre>
<p>๐ค <strong>ุฎุฑูุฌ:</strong></p>
<pre><code>You asked for: /MyApp/Request.txt
</code></pre>
<p>ุฑู ููุฏูุฒุ <code>HttpListener</code> ุจู ุตูุฑุช ุฏุงุฎู ุงุฒ <strong>.NET Socket</strong> ุงุณุชูุงุฏู ููโฺฉูุฏุ ุจูฺฉู ุงุฒ <strong>Windows HTTP Server API</strong> ฺฉูฺฉ ูโฺฏุฑุฏ. ุงู ููุถูุน ุจุงุนุซ ูโุดูุฏ ฺูุฏู ุจุฑูุงูู ุฑู ฺฉ IP ู ูพูุฑุช ฺฉุณุงู ฺฏูุด ุจุฏููุฏุ ุจู ุดุฑุท ฺฉู ูุฑ ฺฉุฏุงู ูพุดููุฏูุง ูุชูุงูุช ุซุจุช ฺฉููุฏ (ูุซูุงู <code>/myapp</code> ุง <code>/anotherapp</code>).</p>
<p>ูฺฺฏโูุง ุงุตู:</p>
<ul>
<li>ุฏุฑุฎูุงุณุชโูุง ฺฉูุงูุช ุงุฒ ุทุฑู ูุชุฏ <code>GetContext</code> ฺฏุฑูุชู ูโุดูุฏ.</li>
<li>ุดูุง ูโุชูุงูุฏ ูุฏุฑูุงุ ฺฉูฺฉโูุง ู ูุถุนุช ูพุงุณุฎ ุฑุง ุชูุธู ฺฉูุฏ.</li>
<li>ุญุฏุงูู ุจุงุฏ <strong>ContentLength</strong> ู <strong>StatusCode</strong> ุฑุง ูุดุฎุต ฺฉูุฏ.</li>
</ul>
<p>ูุซุงู ฺฉ <strong>ูุจโุณุฑูุฑ ุณุงุฏู ู ูุงููุฒูุงู</strong> ุจุฑุง ุงุฑุงุฆูโ ูุงูโูุง:</p>
<pre><code class="language-csharp">class WebServer
{
  HttpListener _listener;
  string _baseFolder;  // ูพูุดูโ ูุจโูพุฌโูุง
  public WebServer (string uriPrefix, string baseFolder)
  {
    _listener = new HttpListener();
    _listener.Prefixes.Add (uriPrefix);
    _baseFolder = baseFolder;
  }

  public async void Start()
  {
    _listener.Start();
    while (true)
      try 
      {
        var context = await _listener.GetContextAsync();
        Task.Run (() =&gt; ProcessRequestAsync (context));
      }
      catch (HttpListenerException)     { break; }
      catch (InvalidOperationException) { break; }
  }

  public void Stop() =&gt; _listener.Stop();

  async void ProcessRequestAsync (HttpListenerContext context)
  {
    try
    {
      string filename = Path.GetFileName (context.Request.RawUrl);
      string path = Path.Combine (_baseFolder, filename);
      byte[] msg;

      if (!File.Exists (path))
      {
        Console.WriteLine (&quot;Resource not found: &quot; + path);
        context.Response.StatusCode = (int) HttpStatusCode.NotFound;
        msg = Encoding.UTF8.GetBytes (&quot;Sorry, that page does not exist&quot;);
      }
      else
      {
        context.Response.StatusCode = (int) HttpStatusCode.OK;
        msg = File.ReadAllBytes (path);
      }

      context.Response.ContentLength64 = msg.Length;
      using (Stream s = context.Response.OutputStream)
        await s.WriteAsync (msg, 0, msg.Length);
    }
    catch (Exception ex) { Console.WriteLine (&quot;Request error: &quot; + ex); }
  }
}
</code></pre>
<p>๐ ุฑุงูโุงูุฏุงุฒ:</p>
<pre><code class="language-csharp">var server = new WebServer (&quot;http://localhost:51111/&quot;, @&quot;d:\webroot&quot;);
try
{
  server.Start();
  Console.WriteLine (&quot;Server running... press Enter to stop&quot;);
  Console.ReadLine();
}
finally { server.Stop(); }
</code></pre>
<p>ุญุงูุง ูโุชูุงูุฏ ุจุง ูุฑ ูุฑูุฑฺฏุฑ ุงู ุณุฑูุฑ ุฑุง ุชุณุช ฺฉูุฏ.</p>
<hr>
<h3>๐ ุงุณุชูุงุฏู ุงุฒ DNS</h3>
<p>ฺฉูุงุณ ุงุณุชุงุชฺฉ <strong>Dns</strong> ุนููุงุช <strong>Domain Name System</strong> ุฑุง ฺฉูพุณููู ูโฺฉูุฏ.</p>
<p>๐น ุชุจุฏู ูุงู ุฏุงููู ุจู IP:</p>
<pre><code class="language-csharp">foreach (IPAddress a in Dns.GetHostAddresses (&quot;albahari.com&quot;))
  Console.WriteLine (a.ToString());  // 205.210.42.167
</code></pre>
<p>๐น ุชุจุฏู IP ุจู ูุงู ุฏุงููู:</p>
<pre><code class="language-csharp">IPHostEntry entry = Dns.GetHostEntry (&quot;205.210.42.167&quot;);
Console.WriteLine (entry.HostName);  // albahari.com
</code></pre>
<p>๐น ุฑูุด ูุงููุฒูุงู:</p>
<pre><code class="language-csharp">foreach (IPAddress a in await Dns.GetHostAddressesAsync (&quot;albahari.com&quot;))
  Console.WriteLine (a.ToString());
</code></pre>
<hr>
<h3>๐ง ุงุฑุณุงู ุงูู ุจุง SmtpClient</h3>
<p>ฺฉูุงุณ <strong>SmtpClient</strong> ุฏุฑ ูุถุง ูุงู <code>System.Net.Mail</code> ุจุฑุง ุงุฑุณุงู ุงูู ุจุง ูพุฑูุชฺฉู <strong>SMTP</strong> ุงุณุชูุงุฏู ูโุดูุฏ.</p>
<p>ูุซุงู ุณุงุฏู:</p>
<pre><code class="language-csharp">SmtpClient client = new SmtpClient();
client.Host = &quot;mail.myserver.com&quot;;
client.Send (&quot;from@adomain.com&quot;, &quot;to@adomain.com&quot;, &quot;subject&quot;, &quot;body&quot;);
</code></pre>
<p>๐ ุงูุฒูุฏู ูพูุณุชโูุง:</p>
<pre><code class="language-csharp">SmtpClient client = new SmtpClient();
client.Host = &quot;mail.myisp.net&quot;;
MailMessage mm = new MailMessage();
mm.Sender = new MailAddress (&quot;kay@domain.com&quot;, &quot;Kay&quot;);
mm.From   = new MailAddress (&quot;kay@domain.com&quot;, &quot;Kay&quot;);
mm.To.Add  (new MailAddress (&quot;bob@domain.com&quot;, &quot;Bob&quot;));
mm.CC.Add  (new MailAddress (&quot;dan@domain.com&quot;, &quot;Dan&quot;));
mm.Subject = &quot;Hello!&quot;;
mm.Body = &quot;Hi there. Here's the photo!&quot;;
mm.IsBodyHtml = false;
mm.Priority = MailPriority.High;
Attachment a = new Attachment (&quot;photo.jpg&quot;,
                               System.Net.Mime.MediaTypeNames.Image.Jpeg);
mm.Attachments.Add (a);
client.Send (mm);
</code></pre>
<p>๐ ุจุดุชุฑ ุณุฑูุฑูุง SMTP ููุท ุงุฑุชุจุงุทโูุง <strong>ุงุญุฑุงุฒ ููุชโุดุฏู ู ุงูู (SSL/TLS)</strong> ุฑุง ูุจูู ูโฺฉููุฏ:</p>
<pre><code class="language-csharp">var client = new SmtpClient (&quot;smtp.myisp.com&quot;, 587)
{
  Credentials = new NetworkCredential (&quot;me@myisp.com&quot;, &quot;MySecurePass&quot;),
  EnableSsl = true
};
client.Send (&quot;me@myisp.com&quot;, &quot;someone@somewhere.com&quot;, &quot;Subject&quot;, &quot;Body&quot;);
Console.WriteLine (&quot;Sent&quot;);
</code></pre>
<p>๐ ุฏุฑ ุฒูุงู ุชูุณุนูุ ูโุชูุงูุฏ ุงููโูุง ุฑุง ุจู ุฌุง ุงุฑุณุงูุ ุฏุฑ ฺฉ ูพูุดู ุฐุฎุฑู ฺฉูุฏ:</p>
<pre><code class="language-csharp">SmtpClient client = new SmtpClient();
client.DeliveryMethod = SmtpDeliveryMethod.SpecifiedPickupDirectory;
client.PickupDirectoryLocation = @&quot;c:\mail&quot;;
</code></pre>
<hr>
<p>โจ ุฏุฑ ุงู ุจุฎุด ุงุฏ ฺฏุฑูุชู ฺุทูุฑ ุฏุฑ .NET ฺฉ <strong>HTTP server</strong> ุณุงุฏู ุจููุณูุ ุจุง <strong>DNS</strong> ฺฉุงุฑ ฺฉูู ู ุจุง ุงุณุชูุงุฏู ุงุฒ <strong>SMTP</strong> ุงูู ุงุฑุณุงู ฺฉูู.</p>
<h2>ุงุณุชูุงุฏู ุงุฒ TCP ๐</h2>
<p>TCP ู UDP ูพุฑูุชฺฉูโูุง ูุงูโ <strong>Transport</strong> ูุณุชูุฏ ฺฉู ุจุดุชุฑ ุณุฑูุณโูุง ุงูุชุฑูุช ู ุดุจฺฉูโูุง ูุญู (LAN) ุจุฑ ูพุงูโ ุขูโูุง ุณุงุฎุชู ุดุฏูโุงูุฏ. ุจูโุนููุงู ููููู:</p>
<ul>
<li>ูพุฑูุชฺฉูโูุง HTTP (ูุณุฎูโ ฒ ู ูพุงูโุชุฑ)ุ FTP ู SMTP ุงุฒ <strong>TCP</strong> ุงุณุชูุงุฏู ูโฺฉููุฏ.</li>
<li>ูพุฑูุชฺฉูโูุง DNS ู HTTP ูุณุฎูโ ณ ุงุฒ <strong>UDP</strong> ุงุณุชูุงุฏู ูโฺฉููุฏ.</li>
</ul>
<p>TCP ฺฉ ูพุฑูุชฺฉู <strong>Connection-Oriented</strong> ุงุณุช ู ูฺฉุงูุฒูโูุง ุงุทููุงู (Reliability) ุฏุงุฑุฏุ ุฏุฑ ุญุงู ฺฉู UDP <strong>Connectionless</strong> ุจูุฏูุ ุณุฑุจุงุฑ (Overhead) ฺฉูุชุฑ ุฏุงุฑุฏ ู ุงุฒ <strong>Broadcasting</strong> ูพุดุชุจุงู ูโฺฉูุฏ. ุจุฑุง ูููููุ <strong>BitTorrent</strong> ู <strong>Voice over IP (VoIP)</strong> ุงุฒ UDP ุจูุฑู ูโุจุฑูุฏ. โก</p>
<p>ูุงูโ Transport ูุณุจุช ุจู ูุงูโูุง ุจุงูุงุชุฑ ุงูุนุทุงูโูพุฐุฑ ุจุดุชุฑ ูุฑุงูู ูโฺฉูุฏ ู ูโุชูุงูุฏ ฺฉุงุฑุง ุจูุชุฑ ูู ุฏุงุดุชู ุจุงุดุฏุ ุงูุง ุจุงุฏ ฺฉุงุฑูุง ูุซู <strong>Authentication</strong> ู <strong>Encryption</strong> ุฑุง ุฎูุฏุชุงู ูุฏุฑุช ฺฉูุฏ.</p>
<hr>
<h3>TCP ุฏุฑ .NET</h3>
<p>ุฏุฑ .NET ุฏู ุงูุชุฎุงุจ ุงุตู ูุฌูุฏ ุฏุงุฑุฏ:</p>
<ol>
<li>ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณโูุง ุณุงุฏูโุชุฑ <strong>TcpClient</strong> ู <strong>TcpListener</strong></li>
<li>ุง ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณ ูพุดุฑูุชูโุชุฑ ู ูพุฑุงูฺฉุงูุงุชโุชุฑ <strong>Socket</strong></li>
</ol>
<p>ุฏุฑ ูุงูุน ูโุชูุงู ุงู ุฏู ุฑุง ุจุง ูู ุชุฑฺฉุจ ฺฉุฑุฏุ ุฒุฑุง <strong>TcpClient</strong> ุงุฒ ุทุฑู ูฺฺฏ <strong>Client</strong>ุ ุดุก ุงุตู <strong>Socket</strong> ุฑุง ุฏุฑ ุงุฎุชุงุฑ ูโฺฏุฐุงุฑุฏ. ฺฉูุงุณ <strong>Socket</strong> ุชูุธูุงุช ุจุดุชุฑ ุฑุง ุจุฑุง ุฏุณุชุฑุณ ูุณุชูู ุจู ูุงูโ ุดุจฺฉู (IP) ู ุญุช ูพุฑูุชฺฉูโูุง ุบุฑุงูุชุฑูุช ูุซู <strong>Novell SPX/IPX</strong> ูุฑุงูู ูโฺฉูุฏ.</p>
<p>ูุซู ุณุงุฑ ูพุฑูุชฺฉูโูุงุ TCP ูู ุจู <strong>Client</strong> ู <strong>Server</strong> ุชูุงูุช ูุงุฆู ูโุดูุฏ:</p>
<ul>
<li>Client ุฏุฑุฎูุงุณุช ุฑุง ุขุบุงุฒ ูโฺฉูุฏ.</li>
<li>Server ููุชุธุฑ ุฏุฑุงูุช ุฏุฑุฎูุงุณุช ูโูุงูุฏ.</li>
</ul>
<p>ูููููโ ฺฉ <strong>Client ููฺฏุงู (Synchronous TCP Client)</strong>:</p>
<pre><code class="language-csharp">using (TcpClient client = new TcpClient())
{
    client.Connect(&quot;address&quot;, port);
    using (NetworkStream n = client.GetStream())
    {
        // Read and write to the network stream...
    }
}
</code></pre>
<ul>
<li>ูุชุฏ <strong>Connect</strong> ุฏุฑ TcpClient ุจููฺฉู ูโุดูุฏ ุชุง ุงุชุตุงู ุจุฑูุฑุงุฑ ฺฏุฑุฏุฏ (ูุณุฎูโ ุบุฑููฺฏุงู ุขู <strong>ConnectAsync</strong> ุงุณุช).</li>
<li>ูพุณ ุงุฒ ุขูุ <strong>NetworkStream</strong> ุงูฺฉุงู ุงุฑุชุจุงุท ุฏูุทุฑูู (ุงุฑุณุงู ู ุฏุฑุงูุช ุฏุงุฏูโูุง ุจุงูุฑ) ุจุง ุณุฑูุฑ ุฑุง ูุฑุงูู ูโฺฉูุฏ.</li>
</ul>
<hr>
<h3>ฺฉ ุณุฑูุฑ ุณุงุฏูโ TCP</h3>
<pre><code class="language-csharp">TcpListener listener = new TcpListener(&lt;ip address&gt;, port);
listener.Start();
while (keepProcessingRequests)
    using (TcpClient c = listener.AcceptTcpClient())
    using (NetworkStream n = c.GetStream())
    {
        // Read and write to the network stream...
    }
listener.Stop();
</code></pre>
<ul>
<li>ุจุฑุง <strong>TcpListener</strong> ุจุงุฏ ุขุฏุฑุณ IP ูุญู ุชุนู ุดูุฏ (ฺฉ ฺฉุงููพูุชุฑ ุจุง ุฏู ฺฉุงุฑุช ุดุจฺฉู ูโุชูุงูุฏ ุฏู ุขุฏุฑุณ ุฏุงุดุชู ุจุงุดุฏ).</li>
<li>ูโุชูุงู ุงุฒ <strong>IPAddress.Any</strong> ุงุณุชูุงุฏู ฺฉุฑุฏ ุชุง ุฑู ุชูุงู ุขุฏุฑุณโูุง IP ูุญู ฺฏูุด ุฏูุฏ.</li>
<li>ูุชุฏ <strong>AcceptTcpClient</strong> ุชุง ุฏุฑุงูุช ุฏุฑุฎูุงุณุช ุงุฒ ฺฉ Client ุจููฺฉู ูโูุงูุฏ (ูุณุฎูโ ุบุฑููฺฏุงู ุขู ูุฒ ูุฌูุฏ ุฏุงุฑุฏ).</li>
<li>ูพุณ ุงุฒ ุฏุฑุงูุช ุงุชุตุงูุ ูุดุงุจู Clientุ ุงุฒ <strong>GetStream</strong> ุจุฑุง ุงุฑุชุจุงุท ุงุณุชูุงุฏู ูโฺฉูู.</li>
</ul>
<p>โ๏ธ ููฺฏุงู ฺฉุงุฑ ุฏุฑ ูุงูโ Transport ุจุงุฏ ฺฉ <strong>ูพุฑูุชฺฉู ูฺฉุงููู</strong> ุชุนุฑู ฺฉูุฏ (ฺู ฺฉุณ ฺู ุฒูุงู ุตุญุจุช ฺฉูุฏ ู ฺู ุฒูุงู ฺฏูุด ุฏูุฏ). ุงฺฏุฑ ูุฑ ุฏู ุทุฑู ููโุฒูุงู ุตุญุจุช ุง ููโุฒูุงู ฺฏูุด ฺฉููุฏุ ุงุฑุชุจุงุท ุงุฒ ฺฉุงุฑ ูโุงูุชุฏโูุซู ูุงฺฉโุชุงฺฉ! ๐๏ธ</p>
<hr>
<h3>ููููู ูพุฑูุชฺฉู ุณุงุฏู (Hello โ Hello right back!)</h3>
<pre><code class="language-csharp">using System;
using System.IO;
using System.Net;
using System.Net.Sockets;
using System.Threading;

new Thread(Server).Start();   // ุงุฌุฑุง ูุชุฏ ุณุฑูุฑ ุจูโุทูุฑ ููุงุฒ
Thread.Sleep(500);            // ฺฉู ูฺฉุซ ุจุฑุง ุฑุงูโุงูุฏุงุฒ ุณุฑูุฑ
Client();

void Client()
{
    using (TcpClient client = new TcpClient(&quot;localhost&quot;, 51111))
    using (NetworkStream n = client.GetStream())
    {
        BinaryWriter w = new BinaryWriter(n);
        w.Write(&quot;Hello&quot;);
        w.Flush();
        Console.WriteLine(new BinaryReader(n).ReadString());
    }
}

void Server()   // ููุท ฺฉ ุฏุฑุฎูุงุณุช ุฑุง ูพุฑุฏุงุฒุด ูโฺฉูุฏ
{
    TcpListener listener = new TcpListener(IPAddress.Any, 51111);
    listener.Start();
    using (TcpClient c = listener.AcceptTcpClient())
    using (NetworkStream n = c.GetStream())
    {
        string msg = new BinaryReader(n).ReadString();
        BinaryWriter w = new BinaryWriter(n);
        w.Write(msg + &quot; right back!&quot;);
        w.Flush();   // ุญุชูุง ุจุงุฏ Flush ุดูุฏ ฺูู Writer ุขุฒุงุฏ ููโุดูุฏ
    }
    listener.Stop();
}

// OUTPUT: Hello right back!
</code></pre>
<ul>
<li>ุฏุฑ ุงู ูุซุงู ุงุฒ <strong>localhost loopback</strong> ุงุณุชูุงุฏู ุดุฏู ุชุง Client ู Server ุฑู ููุงู ุณุณุชู ุงุฌุฑุง ุดููุฏ.</li>
<li>ูพูุฑุช ุฏุฑ ุจุงุฒูโ ุขุฒุงุฏ (ุจุงูุงุชุฑ ุงุฒ ดนฑตฒ) ุงูุชุฎุงุจ ุดุฏู ุงุณุช.</li>
<li>ุจุฑุง ุงุฑุณุงู ู ุฏุฑุงูุช ูุชูโูุง ุงุฒ <strong>BinaryWriter</strong> ู <strong>BinaryReader</strong> ุงุณุชูุงุฏู ฺฉุฑุฏูโุงู.</li>
<li>ุงู ุงุจุฒุงุฑูุง ุจุฑุฎูุงู <strong>StreamReader/StreamWriter</strong> ุฑุดุชูโูุง ุฑุง ุจุง ฺฉ ุนุฏุฏ ุทูู (Length Prefix) ุฐุฎุฑู ูโฺฉููุฏุ ุจูุงุจุฑุงู <strong>BinaryReader</strong> ุฏููุงู ูโุฏุงูุฏ ฺูุฏ ุจุงุช ุจุงุฏ ุจุฎูุงูุฏ.</li>
</ul>
<p>ุงฺฏุฑ ุงุฒ <strong>StreamReader.ReadToEnd</strong> ุงุณุชูุงุฏู ฺฉูุฏุ ููฺฉู ุงุณุช ุงุชุตุงู ูฺโููุช ุชูุงู ูุดูุฏ ู ุนููุงุช ุฎูุงูุฏู ุจุฑุง ููุดู ุจููฺฉู ุดูุฏุ ฺูู <strong>NetworkStream</strong> ุงูุชูุง ูุดุฎุต ูุฏุงุฑุฏ. โ๏ธ
ููฺูู <strong>StreamReader</strong> ุจู ุฏูู ุฏุงุดุชู <strong>Read-Ahead Buffer</strong>ุ ููฺฉู ุงุณุช ุจุด ุงุฒ ุญุฏ ูุงุฒ ุจุฎูุงูุฏ ู ุจุงุนุซ ุจููฺฉู ุดุฏู ุดูุฏ. ุงูุง <strong>FileStream</strong> ฺูู ูุดฺฉู ูุฏุงุฑุฏ ฺูู ุงูุชูุง ูุดุฎุต ุฏุงุฑุฏ ู ูุชุฏ <strong>Read</strong> ุฏุฑ ูพุงุงู ููุฏุงุฑ <code>0</code> ุจุงุฒูโฺฏุฑุฏุงูุฏ.</p>
<hr>
<h3>ููโุฒูุงู (Concurrency) ุจุง TCP โก</h3>
<p>ฺฉูุงุณโูุง <strong>TcpClient</strong> ู <strong>TcpListener</strong> ูุชุฏูุง <strong>Asynchronous</strong> ุฏุงุฑูุฏ ฺฉู ุจุฑุง ููุงุณโูพุฐุฑ ุจูุชุฑ ุงุณุชูุงุฏู ูโุดููุฏ. ฺฉุงู ุงุณุช ูุชุฏูุง ุจููฺฉูโุดููุฏู ุฑุง ุจุง ูุณุฎูโ Async ุฌุงฺฏุฒู ฺฉุฑุฏู ู ูุชุฌู ุฑุง <strong>await</strong> ฺฉูุฏ.</p>
<p>ูููููโ ฺฉ ุณุฑูุฑ <strong>Async</strong>:</p>
<pre><code class="language-csharp">async void RunServerAsync()
{
    var listener = new TcpListener(IPAddress.Any, 51111);
    listener.Start();
    try
    {
        while (true)
            Accept(await listener.AcceptTcpClientAsync());
    }
    finally { listener.Stop(); }
}

async Task Accept(TcpClient client)
{
    await Task.Yield();
    try
    {
        using (client)
        using (NetworkStream n = client.GetStream())
        {
            byte[] data = new byte[5000];
            int bytesRead = 0; int chunkSize = 1;
            while (bytesRead &lt; data.Length &amp;&amp; chunkSize &gt; 0)
                bytesRead += chunkSize =
                    await n.ReadAsync(data, bytesRead, data.Length - bytesRead);
            Array.Reverse(data);   // ูุนฺฉูุณ ฺฉุฑุฏู ุขุฑุงูโ ุจุงุชโูุง
            await n.WriteAsync(data, 0, data.Length);
        }
    }
    catch (Exception ex) { Console.WriteLine(ex.Message); }
}
</code></pre>
<p>ุงู ุจุฑูุงูู <strong>Scalable</strong> ุงุณุช ฺูู ุจุฑุง ฺฉู ูุฏุช ุฏุฑุฎูุงุณุช ฺฉ Thread ุงุดุบุงู ููโฺฉูุฏ.
ูุซูุงู ุงฺฏุฑ ฑฐฐฐ Client ููโุฒูุงู ูุชุตู ุดููุฏ ู ูุฑฺฉุฏุงู ฺูุฏ ุซุงูู ุทูู ุจฺฉุดุฏุ ุงู ุฑุงูฺฉุงุฑ ูุงุฒ ุจู ฑฐฐฐ Thread ูุฏุงุฑุฏ. ููุท ุฏุฑ ุจุงุฒูโูุง ฺฉูุชุงู ูุจู ู ุจุนุฏ ุงุฒ ุนุจุงุฑุชโูุง <code>await</code> ุงุฒ Thread ุงุณุชูุงุฏู ูโฺฉูุฏ. โ</p>
<hr>
<h3>ุฏุฑุงูุช ุงูู POP3 ุจุง TCP ๐ง</h3>
<p>ุฏุฑ .NET ูพุดุชุจุงู ุฏุฑ ุณุทุญ <strong>Application Layer</strong> ุจุฑุง ูพุฑูุชฺฉู <strong>POP3</strong> ูุฌูุฏ ูุฏุงุฑุฏ. ุจูุงุจุฑุงู ุจุงุฏ ุฏุฑ <strong>TCP Layer</strong> ฺฉุฏููุณ ฺฉูุฏ. ุฎูุดุจุฎุชุงููุ ูพุฑูุชฺฉู POP3 ุณุงุฏู ุงุณุช ู ฺฏูุชฺฏู ุขู ุจูโุตูุฑุช ุฒุฑ ูพุด ูโุฑูุฏ:</p>
<div align="center">
<p><img src="../../../assets/image/16/Table-16-4.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<h2>ุฏุฑุงูุช ุงูู POP3 ุจุง TCP ๐ง</h2>
<p>ูุฑ ุฏุณุชูุฑ ู ูพุงุณุฎ ุฏุฑ ูพุฑูุชฺฉู <strong>POP3</strong> ุจุง ฺฉ ุฎุท ุฌุฏุฏ (<strong>CR + LF</strong>) ูพุงุงู ูโุงุจุฏุ ุจูโุฌุฒ ุฏุณุชูุฑุงุช ฺูุฏุฎุท ูุซู <strong>LIST</strong> ู <strong>RETR</strong> ฺฉู ุจุง ฺฉ ููุทู (<code>.</code>) ุฏุฑ ฺฉ ุฎุท ุฌุฏุงฺฏุงูู ุชูุงู ูโุดููุฏ.
ุงุฒ ุขูโุฌุง ฺฉู ููโุชูุงูู ุงุฒ <strong>StreamReader</strong> ุจุง <strong>NetworkStream</strong> ุงุณุชูุงุฏู ฺฉููุ ุงุจุชุฏุง ฺฉ ูุชุฏ ฺฉูฺฉ ุจุฑุง ุฎูุงูุฏู ฺฉ ุฎุท ูุชู ุจูโุตูุฑุช <strong>ุจุฏูู ุจุงูุฑ (Nonbuffered)</strong> ูโููุณู:</p>
<pre><code class="language-csharp">string ReadLine (Stream s)
{
    List&lt;byte&gt; lineBuffer = new List&lt;byte&gt;();
    while (true)
    {
        int b = s.ReadByte();
        if (b == 10 || b &lt; 0) break;
        if (b != 13) lineBuffer.Add((byte)b);
    }
    return Encoding.UTF8.GetString(lineBuffer.ToArray());
}
</code></pre>
<hr>
<h3>ูุชุฏ ฺฉูฺฉ ุจุฑุง ุงุฑุณุงู ุฏุณุชูุฑ โ๏ธ</h3>
<p>ููฺูู ฺฉ ูุชุฏ ฺฉูฺฉ ุจุฑุง ุงุฑุณุงู ุฏุณุชูุฑ ูุงุฒ ุฏุงุฑู. ฺูู ููุดู ุงูุชุธุงุฑ ุฏุงุฑู ูพุงุณุฎ ุจุง <strong>+OK</strong> ุดุฑูุน ุดูุฏุ ูโุชูุงูู ูพุงุณุฎ ุฑุง ุฏุฑ ููุงู ูุญุธู ุจุฎูุงูู ู ุงุนุชุจุงุฑุณูุฌ ฺฉูู:</p>
<pre><code class="language-csharp">void SendCommand (Stream stream, string line)
{
    byte[] data = Encoding.UTF8.GetBytes(line + &quot;\r\n&quot;);
    stream.Write(data, 0, data.Length);
    string response = ReadLine(stream);
    if (!response.StartsWith(&quot;+OK&quot;))
        throw new Exception(&quot;POP Error: &quot; + response);
}
</code></pre>
<hr>
<h3>ุฏุฑุงูุช ุงููโูุง ุงุฒ ุณุฑูุฑ ๐ฌ</h3>
<p>ุจุง ุฏุงุดุชู ุงู ูุชุฏูุงุ ฺฉุงุฑ ุฏุฑุงูุช ุงูู ุณุงุฏู ูโุดูุฏ. ฺฉุงู ุงุณุช ฺฉ ุงุชุตุงู TCP ุฑู ูพูุฑุช <strong>ฑฑฐ</strong> (ูพูุฑุช ูพุดโูุฑุถ POP3) ุจุฑูุฑุงุฑ ฺฉูู ู ุจุง ุณุฑูุฑ ฺฏูุชฺฏู ุฑุง ุขุบุงุฒ ฺฉูู. ุฏุฑ ุงู ูุซุงูุ ูุฑ ูพุงู ุงูู ุฏุฑ ฺฉ ูุงู ุชุตุงุฏู ุจุง ูพุณููุฏ <strong>.eml</strong> ุฐุฎุฑู ูโุดูุฏ ู ุณูพุณ ุงุฒ ุฑู ุณุฑูุฑ ุญุฐู ูโฺฏุฑุฏุฏ:</p>
<pre><code class="language-csharp">using (TcpClient client = new TcpClient(&quot;mail.isp.com&quot;, 110))
using (NetworkStream n = client.GetStream())
{
    ReadLine(n);                           // ุฎูุงูุฏู ูพุงู ุฎูุดโุขูุฏฺฏู
    SendCommand(n, &quot;USER username&quot;);
    SendCommand(n, &quot;PASS password&quot;);
    SendCommand(n, &quot;LIST&quot;);                // ุฏุฑุงูุช ุดูุงุณูโูุง ูพุงูโูุง

    List&lt;int&gt; messageIDs = new List&lt;int&gt;();
    while (true)
    {
        string line = ReadLine(n);         // ูุซูุง: &quot;1 1876&quot;
        if (line == &quot;.&quot;) break;
        messageIDs.Add(int.Parse(line.Split(' ')[0]));   // ุดูุงุณู ูพุงู
    }

    foreach (int id in messageIDs)         // ุฏุฑุงูุช ูุฑ ูพุงู
    {
        SendCommand(n, &quot;RETR &quot; + id);
        string randomFile = Guid.NewGuid().ToString() + &quot;.eml&quot;;
        using (StreamWriter writer = File.CreateText(randomFile))
            while (true)
            {
                string line = ReadLine(n); // ุฎูุงูุฏู ุฎุท ุจุนุฏ ูพุงู
                if (line == &quot;.&quot;) break;    // ููุทู = ูพุงุงู ูพุงู
                if (line == &quot;..&quot;) line = &quot;.&quot;; // ุฌุงฺฏุฒู ููุทูโ ุฏูุชุง
                writer.WriteLine(line);    // ููุดุชู ุฏุฑ ูุงู ุฎุฑูุฌ
            }
        SendCommand(n, &quot;DELE &quot; + id);      // ุญุฐู ูพุงู ุงุฒ ุณุฑูุฑ
    }

    SendCommand(n, &quot;QUIT&quot;);
}
</code></pre>
<hr>
<h3>ูฺฉุชู ๐ก</h3>
<p>ุฏุฑ <strong>NuGet</strong> ฺฉุชุงุจุฎุงููโูุง ูุชูโุจุงุฒ (<strong>Open Source</strong>) ุจุฑุง POP3 ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ูุงุจูุชโูุง ูุซู:</p>
<ul>
<li>ูพุดุชุจุงู ุงุฒ <strong>Authentication</strong></li>
<li>ุจุฑูุฑุงุฑ ุงุฑุชุจุงุท ุงูู <strong>TLS/SSL</strong></li>
<li>ู ูพุฑุฏุงุฒุด ูพุงูโูุง ุจุง <strong>MIME Parsing</strong></li>
</ul>
<p>ุฑุง ุฏุฑ ุงุฎุชุงุฑ ุดูุง ูุฑุงุฑ ูโุฏููุฏ. โ</p>

  </main>

  <!-- ููุชุฑ ูุดุชุฑฺฉ -->
  <footer class="footer">
    <div class="container">
      <p>
        <img src="/icone/copyright.svg" alt="ฺฉูพโุฑุงุช" width="14" height="14"
             style="vertical-align:middle;margin-inline:4px">
        <span id="y"></span> Gitab โ ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู
      </p>
    </div>
  </footer>

  <!-- ุณุงู + ุงุณฺฉุฑูพุช ุชู -->
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    (() => {
      const root = document.documentElement;
      const btn = document.getElementById('themeToggle');
      const KEY = 'gitab-theme';
      const media = window.matchMedia('(prefers-color-scheme: dark)');
      const getEffective = s => s === 'auto' ? (media.matches ? 'dark' : 'light') : s;
      function updateTheme(s) {
        root.setAttribute('data-theme', s);
        const mode = getEffective(s);
        root.dataset.colorMode = mode;
        btn.dataset.icon = mode === 'dark' ? 'moon' : 'sun';
      }
      const saved = localStorage.getItem(KEY) || 'auto';
      updateTheme(saved);
      btn.addEventListener('click', () => {
        const curr = localStorage.getItem(KEY) || 'auto';
        const next = curr === 'auto' ? 'dark' : curr === 'dark' ? 'light' : 'auto';
        localStorage.setItem(KEY, next);
        updateTheme(next);
      });
      media.addEventListener('change', () => {
        if ((localStorage.getItem(KEY) || 'auto') === 'auto') updateTheme('auto');
      });
      window.addEventListener('DOMContentLoaded', () => updateTheme(saved));
    })();
  </script>
</body>
</html>
