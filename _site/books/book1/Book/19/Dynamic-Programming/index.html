<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gitab | ฺฉุชุงุจุฎุงููู ุชุฑุฌููโูุง ุฏุงุชโูุช ู ุณ ุดุงุฑูพ</title>
  <meta name="description" content="ุชุฑุฌููโูุง ูุงุฑุณ ฺฉุชุงุจโูุง ูู โ ุณุฑุนุ ูููุงู ู ูุงุจู ุงุชฺฉุง.">
  <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
  <!-- ูุฏุฑ ูุดุชุฑฺฉ -->
  <header class="header">
    <div class="container nav-wrap">
      <a class="brand" href="/">
        <img src="/icone/logo.svg" alt="Gitab" width="28" height="28">
        <span>Gitab</span>
      </a>

      <nav class="nav">
        <a href="/">ุฎุงูู</a>
        <a href="/books/list-books">ฺฉุชุงุจโูุง</a>
        <a href="#">ููฺฉุงุฑ</a>
        <a href="#">ุฏุฑุจุงุฑูโูุง</a>
      </nav>

     <div class="nav-actions">
  <button id="themeToggle" class="icon-btn theme-btn" aria-label="ุชุบุฑ ุญุงูุช">
    <img class="icon-sun" src="/icone/sun.svg" alt="ุฑูุดู">
    <img class="icon-moon" src="/icone/moon.svg" alt="ุชุงุฑฺฉ">
  </button>

  <a class="icon-btn" href="https://github.com/hheydarian/Gitab" target="_blank" title="GitHub">
    <img src="/icone/github.svg" alt="GitHub">
  </a>
</div>

  </header>

  <!-- ูุญุชูุง ุตูุญู -->
  <main class="site-main">
    <h1>ูุตู ููุฒุฏูู:  ุจุฑูุงููโููุณ ูพูุง (Dynamic Programming)</h1>
<p>ูุตู ด ุชูุถุญ ุฏุงุฏ ฺฉู <strong>dynamic binding</strong> ุฏุฑ ุฒุจุงู C# ฺฺฏููู ฺฉุงุฑ ูโฺฉูุฏ.
ุฏุฑ ุงู ูุตูุ ุงุจุชุฏุง ุจูโุทูุฑ ูุฎุชุตุฑ ุจู <strong>Dynamic Language Runtime (DLR)</strong> ูโูพุฑุฏุงุฒู ู ุณูพุณ ุงูฺฏููุง ุฒุฑ ุฏุฑ ุจุฑูุงููโููุณ ูพูุง ุฑุง ุจุฑุฑุณ ูโฺฉูู:</p>
<ul>
<li><strong>Dynamic member overload resolution</strong></li>
<li><strong>Custom binding (implementing dynamic objects)</strong></li>
<li><strong>Dynamic language interoperability</strong></li>
</ul>
<p>ุฏุฑ ูุตู ฒดุ ุชูุถุญ ูโุฏูู ฺฉู <strong>dynamic</strong> ฺฺฏููู ูโุชูุงูุฏ <strong>COM interoperability</strong> ุฑุง ุจูุจูุฏ ุฏูุฏ.</p>
<p>ุงููุงุน (types) ูุนุฑูโุดุฏู ุฏุฑ ุงู ูุตูุ ุฏุฑ <strong>System.Dynamic namespace</strong> ูุฑุงุฑ ุฏุงุฑูุฏุ ุจูโุฌุฒ <strong>CallSite&lt;&gt;</strong> ฺฉู ุฏุฑ <strong>System.Runtime.CompilerServices</strong> ุชุนุฑู ุดุฏู ุงุณุช.</p>
<hr>
<h3>๐ Dynamic Language Runtime</h3>
<p>ุฒุจุงู C# ุจุฑุง ุงูุฌุงู <strong>dynamic binding</strong> ุจู <strong>DLR</strong> ูุชฺฉ ุงุณุช.</p>
<p>ุจุฑุฎูุงู ูุงูุดุ <strong>DLR</strong> ฺฉ ูุณุฎูโ ูพูุง ุงุฒ <strong>CLR</strong> ูุณุช. ุจูฺฉู ฺฉ <strong>ฺฉุชุงุจุฎุงูู (library)</strong> ุงุณุช ฺฉู ุฑู <strong>CLR</strong> ูุฑุงุฑ ูโฺฏุฑุฏโุฏููุงู ูุงููุฏ ูุฑ ฺฉุชุงุจุฎุงููโ ุฏฺฏุฑ ูุซู <strong>System.Xml.dll</strong>.</p>
<p>ูุธููโ ุงุตู DLR ุงุฑุงุฆูโ ุณุฑูุณโูุง ุฒูุงู ุงุฌุฑุง (runtime services) ุจุฑุง ฺฉูพุงุฑฺูโุณุงุฒ ุจุฑูุงููโููุณ ูพูุงโฺู ุฏุฑ ุฒุจุงูโูุง <strong>statically typed</strong> ู ฺู <strong>dynamically typed</strong>โุงุณุช. ุจูุงุจุฑุงูุ ุฒุจุงูโูุง ูุงููุฏ:</p>
<ul>
<li>C#</li>
<li>Visual Basic</li>
<li>IronPython</li>
<li>IronRuby</li>
</ul>
<p>ููฺฏ ุงุฒ ฺฉ ูพุฑูุชฺฉู ฺฉุณุงู ุจุฑุง <strong>dynamic function calls</strong> ุงุณุชูุงุฏู ูโฺฉููุฏ. ุงู ููุถูุน ุจุงุนุซ ูโุดูุฏ ุขูโูุง ุจุชูุงููุฏ ฺฉุชุงุจุฎุงููโูุง ุฑุง ุจู ุงุดุชุฑุงฺฉ ุจฺฏุฐุงุฑูุฏ ู ฺฉุฏ ุฑุง ฺฉู ุจู ุฒุจุงู ุฏฺฏุฑ ููุดุชู ุดุฏู ุงุฌุฑุง ฺฉููุฏ.</p>
<p>DLR ููฺูู ููุดุชู ุฒุจุงูโูุง ูพูุง ุฌุฏุฏ ุฏุฑ <strong>.NET</strong> ุฑุง ูุณุจุชุงู ุขุณุงู ูโฺฉูุฏ. ุจูโุฌุง ุขูฺฉู ููุณูุฏฺฏุงู ุฒุจุงู ูุฌุจูุฑ ุจุงุดูุฏ ูุณุชูู <strong>Intermediate Language (IL)</strong> ุชููุฏ ฺฉููุฏุ ูโุชูุงููุฏ ุฏุฑ ุณุทุญ <strong>expression trees</strong> ฺฉุงุฑ ฺฉููุฏ (ููุงู <strong>expression trees</strong> ููุฌูุฏ ุฏุฑ <strong>System.Linq.Expressions</strong> ฺฉู ุฏุฑ ูุตู ธ ุฏุฑุจุงุฑูโุดุงู ุตุญุจุช ฺฉุฑุฏู).</p>
<p>ุนูุงูู ุจุฑ ุงูุ DLR ุชุถูู ูโฺฉูุฏ ฺฉู ูููโ ูุตุฑูโฺฉููุฏฺฏุงู ุงุฒ ูุฒุช <strong>call-site caching</strong> ุจูุฑูโููุฏ ุดููุฏุ ฺฉ ุจูููโุณุงุฒ ฺฉู ุงุฒ ุชฺฉุฑุงุฑ ุบุฑุถุฑูุฑ ุชุตููุงุช ูพุฑูุฒููโ <strong>member resolution</strong> ุฏุฑ ุทูู dynamic binding ุฌููฺฏุฑ ูโฺฉูุฏ.</p>
<hr>
<h3>โ Call Site ฺุณุชุ</h3>
<p>ููุช ฺฉุงููพุงูุฑ ุจุง ฺฉ <strong>dynamic expression</strong> ุฑูุจูโุฑู ูโุดูุฏุ ููโุฏุงูุฏ ฺู ฺฉุณ ุขู ุนุจุงุฑุช ุฑุง ุฏุฑ ุฒูุงู ุงุฌุฑุง ุงุฑุฒุงุจ ุฎูุงูุฏ ฺฉุฑุฏ.</p>
<p>ูุซูุงู ูุชุฏ ุฒุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ:</p>
<pre><code class="language-csharp">public dynamic Foo (dynamic x, dynamic y)
{
  return x / y;   // Dynamic expression
}
</code></pre>
<p>ูุชุบุฑูุง <code>x</code> ู <code>y</code> ูโุชูุงููุฏ ูุฑ ฺุฒ ุจุงุดูุฏ:</p>
<ul>
<li>ฺฉ ุดุก <strong>CLR</strong></li>
<li>ฺฉ ุดุก <strong>COM</strong></li>
<li>ุง ุญุช ฺฉ ุดุก ุฏุฑ ฺฉ ุฒุจุงู ูพูุง</li>
</ul>
<p>ุจู ููู ุฏููุ ฺฉุงููพุงูุฑ ููโุชูุงูุฏ ุงุฒ ุฑูุด ูุนููู ุงุณุชุงุชฺฉ ุฎูุฏ (ุนู ุตุฏุง ุฒุฏู ฺฉ ูุชุฏ ูุดุฎุต ุงุฒ ฺฉ ููุน ูุดุฎุต) ุงุณุชูุงุฏู ฺฉูุฏ.
ุฏุฑ ุนูุถุ ฺฉุงููพุงูุฑ ฺฉุฏ ุชููุฏ ูโฺฉูุฏ ฺฉู ุฏุฑ ููุงุช ฺฉ <strong>expression tree</strong> ูโุณุงุฒุฏุ ุงู <strong>expression tree</strong> ุนููุงุช ุฑุง ุชูุตู ูโฺฉูุฏ ฺฉู ุชูุณุท ฺฉ <strong>call site</strong> ูุฏุฑุช ูโุดูุฏ ู <strong>DLR</strong> ุขู ุฑุง ุฏุฑ ุฒูุงู ุงุฌุฑุง bind ูโฺฉูุฏ.
ุฏุฑูุงูุนุ <strong>call site</strong> ูุงููุฏ ฺฉ ูุงุณุทู (intermediary) ุจู <strong>caller</strong> ู <strong>callee</strong> ุนูู ูโฺฉูุฏ.</p>
<p>ฺฉ <strong>call site</strong> ุชูุณุท ฺฉูุงุณ <strong>CallSite&lt;&gt;</strong> ุฏุฑ <strong>System.Core.dll</strong> ููุงุด ุฏุงุฏู ูโุดูุฏ.
ุจุง <strong>disassemble</strong> ฺฉุฑุฏู ูุชุฏ ูุจูุ ูุชุฌู ุชูุฑุจุงู ุจูโุดฺฉู ุฒุฑ ุฎูุงูุฏ ุจูุฏ:</p>
<pre><code class="language-csharp">static CallSite&lt;Func&lt;CallSite,object,object,object&gt;&gt; divideSite;

[return: Dynamic]
public object Foo ([Dynamic] object x, [Dynamic] object y)
{
  if (divideSite == null)
    divideSite =
      CallSite&lt;Func&lt;CallSite,object,object,object&gt;&gt;.Create (
        Microsoft.CSharp.RuntimeBinder.Binder.BinaryOperation (
          CSharpBinderFlags.None,
          ExpressionType.Divide,
          /* Remaining arguments omitted for brevity */ ));

  return divideSite.Target (divideSite, x, y);
}
</code></pre>
<p>ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ <strong>call site</strong> ุฏุฑ ฺฉ <strong>static field</strong> ุฐุฎุฑู ูโุดูุฏ ุชุง ูุฒููโ ุณุงุฎุช ูุฌุฏุฏ ุขู ุฏุฑ ูุฑ ุจุงุฑ ูุฑุงุฎูุงู ุงุฌุชูุงุจ ุดูุฏ.
ููฺููุ DLR ูุชุฌูโ <strong>binding phase</strong> ู <strong>method targets</strong> ูุงูุน ุฑุง cache ูโฺฉูุฏ. (ููฺฉู ุงุณุช ฺูุฏู target ุจุณุชู ุจู ููุนโูุง <code>x</code> ู <code>y</code> ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ.)</p>
<p>ูุฑุงุฎูุงู ูพูุง (dynamic call) ุฏุฑ ุนูู ุจุง ุตุฏุง ุฒุฏู <strong>Target</strong> (ฺฉู ฺฉ <strong>delegate</strong> ุงุณุช) ุงูุฌุงู ูโุดูุฏ ู ุนููููุฏูุง <code>x</code> ู <code>y</code> ุจู ุขู ูพุงุณ ุฏุงุฏู ูโุดููุฏ.</p>
<p>ูฺฉุชูโ ููู: ฺฉูุงุณ <strong>Binder</strong> ูุฎุตูุต ูุฑ ุฒุจุงู ุงุณุช.
ูุฑ ุฒุจุงู ฺฉู ุงุฒ <strong>dynamic binding</strong> ูพุดุชุจุงู ูโฺฉูุฏุ ฺฉ <strong>language-specific binder</strong> ุฏุงุฑุฏ ุชุง ุจู DLR ฺฉูฺฉ ฺฉูุฏ ุนุจุงุฑุงุช ุฑุง ูุทุงุจู ููุทู ุขู ุฒุจุงู ุชูุณุฑ ฺฉูุฏ ู ุฑูุชุงุฑ ุบุฑููุชุธุฑู ุจุฑุง ุจุฑูุงููโููุณ ุงุฌุงุฏ ูุดูุฏ.</p>
<p>ูุซูุงู ุงฺฏุฑ ูุชุฏ <code>Foo</code> ุฑุง ุจุง ููุงุฏุฑ ุนุฏุฏ <code>5</code> ู <code>2</code> ุตุฏุง ุจุฒูู:</p>
<ul>
<li><strong>C# binder</strong> ูุชุฌูโ <code>2</code> ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.</li>
<li>ุงูุง <strong>VB.NET binder</strong> ูุชุฌูโ <code>2.5</code> ุฑุง ุฎูุงูุฏ ุฏุงุฏ.</li>
</ul>
<hr>
<h3>โก Dynamic Member Overload Resolution</h3>
<p>ูุฑุงุฎูุงู ฺฉ ูุชุฏ <strong>statically known</strong> ุจุง ุขุฑฺฏููุงูโูุง <strong>dynamically typed</strong> ุจุงุนุซ ูโุดูุฏ ฺฉู <strong>member overload resolution</strong> ุงุฒ ุฒูุงู ฺฉุงููพุงู ุจู ุฒูุงู ุงุฌุฑุง ููุชูู ุดูุฏ.</p>
<p>ุงู ูฺฺฏ ุจุฑุง ุณุงุฏูโุณุงุฒ ุจุฑุฎ ูุธุงู ุจุฑูุงููโููุณ ููุฏ ุงุณุชโูุซู ุณุงุฏูโุชุฑ ฺฉุฑุฏู <strong>Visitor design pattern</strong>.
ููฺูู ุฏุฑ ุฏูุฑ ุฒุฏู ูุญุฏูุฏุชโูุง ุงุนูุงูโุดุฏู ุชูุณุท <strong>static typing</strong> ุฏุฑ C# ุจุณุงุฑ ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ.</p>
<h3>๐ฏ ุณุงุฏูโุณุงุฒ ุงูฺฏู Visitor</h3>
<p>ุจูโุทูุฑ ุฎูุงุตูุ <strong>Visitor pattern</strong> ุงู ุงูฺฉุงู ุฑุง ูโุฏูุฏ ฺฉู ุจุฏูู ุชุบุฑ ุฏุฑ ฺฉูุงุณโูุง ููุฌูุฏุ ฺฉ ูุชุฏ ุจู ฺฉ ุณูุณููโูุฑุงุชุจ ฺฉูุงุณ (class hierarchy) โุงุถุงููโ ฺฉูุฏ.</p>
<p>ุงฺฏุฑฺู ุงู ุงูฺฏู ููุฏ ุงุณุชุ ุงูุง ูุณุฎูโ <strong>ุงุณุชุงุชฺฉ</strong> ุขู ุฏุฑ ููุงุณู ุจุง ุจุณุงุฑ ุงุฒ ุงูฺฏููุง ุทุฑุงุญ ุฏฺฏุฑุ ุธุฑู ู ุบุฑูุณุชูู ุงุณุช. ููฺููุ ุงู ุงูฺฏู ูุงุฒ ุฏุงุฑุฏ ฺฉู ฺฉูุงุณโูุง ฺฉู ูุฑุงุฑ ุงุณุช ุจุงุฒุฏุฏ ุดููุฏุ โvisitor-friendlyโ ุจุงุดูุฏุ ุนู ฺฉ ูุชุฏ <strong>Accept</strong> ุฑุง ุฏุฑ ุงุฎุชุงุฑ ูุฑุงุฑ ุฏููุฏ. ุงู ููุถูุน ุฒูุงู ุบุฑููฺฉู ุงุณุช ฺฉู ฺฉูุงุณโูุง ุชุญุช ฺฉูุชุฑู ุดูุง ูุจุงุดูุฏ.</p>
<p>ุจุง ุงุณุชูุงุฏู ุงุฒ <strong>dynamic binding</strong> ูโุชูุงูุฏ ุจู ููุงู ูุฏู ุฏุณุช ูพุฏุง ฺฉูุฏโุงูุง ุจุณุงุฑ ุณุงุฏูโุชุฑ ู ุจุฏูู ูุงุฒ ุจู ุชุบุฑ ฺฉูุงุณโูุง ููุฌูุฏ.</p>
<p>ุจุฑุง ุฑูุดู ุดุฏู ููุถูุนุ ุจู ุณูุณููโูุฑุงุชุจ ฺฉูุงุณ ุฒุฑ ุฏูุช ฺฉูุฏ:</p>
<pre><code class="language-csharp">class Person
{
  public string FirstName { get; set; }
  public string LastName  { get; set; }
  // ูุฌููุนู Friends ูโุชูุงูุฏ ุดุงูู Customers ู Employees ุจุงุดุฏ:
  public readonly IList&lt;Person&gt; Friends = new Collection&lt;Person&gt; ();
}

class Customer : Person { public decimal CreditLimit { get; set; } }

class Employee : Person { public decimal Salary { get; set; } }
</code></pre>
<p>ูุฑุถ ฺฉูุฏ ูโุฎูุงูู ูุชุฏ ุจููุณู ฺฉู ุฌุฒุฆุงุช ฺฉ <strong>Person</strong> ุฑุง ุจูโุตูุฑุช ุจุฑูุงููโููุณ ุจู ฺฉ <strong>XElement</strong> ุฏุฑ XML ุตุงุฏุฑ ฺฉูุฏ.
ูุงุถุญโุชุฑู ุฑุงู ุงู ุงุณุช ฺฉู ุฏุฑ ฺฉูุงุณ <strong>Person</strong> ฺฉ ูุชุฏ ูุฌุงุฒ (virtual) ุจู ูุงู <strong>ToXElement()</strong> ุชุนุฑู ฺฉูู ฺฉู ฺฉ <strong>XElement</strong> ุดุงูู propertyูุง ฺฉ <strong>Person</strong> ุจุฑฺฏุฑุฏุงูุฏ.
ุณูพุณ ุฏุฑ ฺฉูุงุณโูุง <strong>Customer</strong> ู <strong>Employee</strong> ุขู ุฑุง override ฺฉูู ุชุง <strong>XElement</strong> ุจู ุชุฑุชุจ ุดุงูู <strong>CreditLimit</strong> ู <strong>Salary</strong> ูู ุจุงุดุฏ.</p>
<p>ุงูุง ุงู ุงูฺฏู ูโุชูุงูุฏ ุงุฒ ุฏู ุฌูุช ูุดฺฉูโุณุงุฒ ุจุงุดุฏ:</p>
<ol>
<li>ููฺฉู ุงุณุช ูุงูฺฉ ฺฉูุงุณโูุง <strong>Person</strong>ุ <strong>Customer</strong> ู <strong>Employee</strong> ูุจุงุดุฏ ู ุจูุงุจุฑุงู ูุชูุงูุฏ ุจู ุขูโูุง ูุชุฏ ุงุถุงูู ฺฉูุฏ. (ู extension methodูุง ูู ุฑูุชุงุฑ polymorphic ุงุฑุงุฆู ููโุฏููุฏ.)</li>
<li>ฺฉูุงุณโูุง <strong>Person</strong>ุ <strong>Customer</strong> ู <strong>Employee</strong> ููฺฉู ุงุณุช ููู ุญุงูุง ูู ุฎู ุจุฒุฑฺฏ ุจุงุดูุฏ. ฺฉ <strong>antipattern</strong> ุฑุงุฌุ <strong>God Object</strong> ุงุณุชุ ุฌุง ฺฉู ฺฉ ฺฉูุงุณ ูุซู <strong>Person</strong> ุขููุฏุฑ ุนููฺฉุฑุฏูุง ูุฎุชูู ุจู ุฎูุฏ ูโฺฏุฑุฏ ฺฉู ูฺฏูุฏุงุฑ ุขู ฺฉุงุจูุณโูุงุฑ ูโุดูุฏ. ฺฉ ุฑุงูโุญู ุฎูุจ ุงู ุงุณุช ฺฉู ุงุฒ ุงูุฒูุฏู ุชูุงุจุน ุจู <strong>Person</strong> ฺฉู ูุงุฒ ุจู ุฏุณุชุฑุณ ุจู ูุถุนุช ุฎุตูุต ุขู ูุฏุงุฑูุฏุ ูพุฑูุฒ ฺฉูู. ูุชุฏ <strong>ToXElement</strong> ูโุชูุงูุฏ ฺฉ ฺฉุงูุฏุฏ ุนุงู ุจุฑุง ุจุฑูู ฺฉุดุฏู ุดุฏู ุจุงุดุฏ.</li>
</ol>
<p>ุจุง ุงุณุชูุงุฏู ุงุฒ <strong>dynamic member overload resolution</strong> ูโุชูุงูู ูุงุจูุช <strong>ToXElement</strong> ุฑุง ุฏุฑ ฺฉ ฺฉูุงุณ ุฌุฏุงฺฏุงูู ูพุงุฏูโุณุงุฒ ฺฉููุ ุจุฏูู ุขูฺฉู ูุฌุจูุฑ ุดูู ุงุฒ switchูุง ุฒุดุช ุจุฑ ุงุณุงุณ ููุน ุงุณุชูุงุฏู ฺฉูู:</p>
<pre><code class="language-csharp">class ToXElementPersonVisitor
{
  public XElement DynamicVisit (Person p) =&gt; Visit ((dynamic)p);

  XElement Visit (Person p)
  {
    return new XElement (&quot;Person&quot;,
      new XAttribute (&quot;Type&quot;, p.GetType().Name),
      new XElement (&quot;FirstName&quot;, p.FirstName),
      new XElement (&quot;LastName&quot;, p.LastName),
      p.Friends.Select (f =&gt; DynamicVisit (f))
    );
  }

  XElement Visit (Customer c)   // ููุทู ุงุฎุชุตุงุต ุจุฑุง Customer
  {
    XElement xe = Visit ((Person)c);   // ุตุฏุง ุฒุฏู ูุชุฏ &quot;base&quot;
    xe.Add (new XElement (&quot;CreditLimit&quot;, c.CreditLimit));
    return xe;
  }

  XElement Visit (Employee e)   // ููุทู ุงุฎุชุตุงุต ุจุฑุง Employee
  {
    XElement xe = Visit ((Person)e);   // ุตุฏุง ุฒุฏู ูุชุฏ &quot;base&quot;
    xe.Add (new XElement (&quot;Salary&quot;, e.Salary));
    return xe;
  }
}
</code></pre>
<p>ูุชุฏ <strong>DynamicVisit</strong> ฺฉ <strong>dynamic dispatch</strong> ุงูุฌุงู ูโุฏูุฏโุนู ุฏุฑ ุฒูุงู ุงุฌุฑุงุ ุฏููโุชุฑู ูุณุฎูโ ูุชุฏ <strong>Visit</strong> ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ.</p>
<p>ุจู ุฎุท ฺฉู ุฏุฑ ุขู ูุชุฏ <strong>DynamicVisit</strong> ุฑู ูุฑ <strong>Person</strong> ุฏุฑ ูุฌููุนูโ <strong>Friends</strong> ุตุฏุง ุฒุฏู ูโุดูุฏ ุชูุฌู ฺฉูุฏ. ุงู ุชุถูู ูโฺฉูุฏ ฺฉู ุงฺฏุฑ ฺฉ ุฏูุณุช ุงุฒ ููุน <strong>Customer</strong> ุง <strong>Employee</strong> ุจุงุดุฏุ overload ุตุญุญ ูุฑุงุฎูุงู ุดูุฏ.</p>
<hr>
<h3>๐ ูุซุงู ุงุฌุฑุง</h3>
<pre><code class="language-csharp">var cust = new Customer
{
  FirstName = &quot;Joe&quot;, LastName = &quot;Bloggs&quot;, CreditLimit = 123
};

cust.Friends.Add (
  new Employee { FirstName = &quot;Sue&quot;, LastName = &quot;Brown&quot;, Salary = 50000 }
);

Console.WriteLine (new ToXElementPersonVisitor().DynamicVisit (cust));
</code></pre>
<hr>
<h3>๐ค ุฎุฑูุฌ</h3>
<pre><code class="language-xml">&lt;Person Type=&quot;Customer&quot;&gt;
  &lt;FirstName&gt;Joe&lt;/FirstName&gt;
  &lt;LastName&gt;Bloggs&lt;/LastName&gt;
  &lt;Person Type=&quot;Employee&quot;&gt;
    &lt;FirstName&gt;Sue&lt;/FirstName&gt;
    &lt;LastName&gt;Brown&lt;/LastName&gt;
    &lt;Salary&gt;50000&lt;/Salary&gt;
  &lt;/Person&gt;
  &lt;CreditLimit&gt;123&lt;/CreditLimit&gt;
&lt;/Person&gt;
</code></pre>
<h3>๐ ฺฏูููโูุง (Variations)</h3>
<p>ุงฺฏุฑ ูุตุฏ ุฏุงุดุชู ุจุงุดุฏ ุจุด ุงุฒ ฺฉ ฺฉูุงุณ Visitor ุจููุณุฏุ ฺฉ ุชุบุฑ ููุฏ ุงู ุงุณุช ฺฉู ฺฉ ฺฉูุงุณ ูพุงูโ ุงูุชุฒุงุน (<strong>abstract base class</strong>) ุจุฑุง Visitorูุง ุชุนุฑู ฺฉูุฏ:</p>
<pre><code class="language-csharp">abstract class PersonVisitor&lt;T&gt;
{
  public T DynamicVisit (Person p) { return Visit ((dynamic)p); }

  protected abstract T Visit (Person p);
  protected virtual T Visit (Customer c) { return Visit ((Person) c); }
  protected virtual T Visit (Employee e) { return Visit ((Person) e); }
}
</code></pre>
<p>ุฏุฑ ุงู ุญุงูุชุ ฺฉูุงุณโูุง ูุฑุฒูุฏ ูุงุฒ ูุฏุงุฑูุฏ ฺฉู ูุชุฏ <strong>DynamicVisit</strong> ุฎูุฏุดุงู ุฑุง ุชุนุฑู ฺฉููุฏุ ุชููุง ฺฉุงุฑ ฺฉู ุจุงุฏ ุงูุฌุงู ุฏููุฏ ุงู ุงุณุช ฺฉู ูุณุฎูโูุง <strong>Visit</strong> ุฑุง ฺฉู ูโุฎูุงููุฏ ููุทู ุงุฎุชุตุงุต ุจุฑุงุดุงู ุจููุณูุฏุ override ฺฉููุฏ.</p>
<p>ุงู ุฑูุด ุฏู ูุฒุช ุฏุงุฑุฏ:</p>
<ol>
<li>ูุชูุฑฺฉุฒ ฺฉุฑุฏู ูุชุฏูุง ฺฉู ุณูุณููโูุฑุงุชุจ <strong>Person</strong> ุฑุง ุฏุฑ ุจุฑ ูโฺฏุฑูุฏ.</li>
<li>ุงุฌุงุฒู ุฏุงุฏู ุจู ูพุงุฏูโุณุงุฒุงู ุจุฑุง ุตุฏุง ุฒุฏู ูุชุฏูุง ูพุงู (base methods) ุจู ุดฺฉู ุทุจุนโุชุฑ.</li>
</ol>
<p>ููููู:</p>
<pre><code class="language-csharp">class ToXElementPersonVisitor : PersonVisitor&lt;XElement&gt;
{
  protected override XElement Visit (Person p)
  {
    return new XElement (&quot;Person&quot;,
      new XAttribute (&quot;Type&quot;, p.GetType().Name),
      new XElement (&quot;FirstName&quot;, p.FirstName),
      new XElement (&quot;LastName&quot;, p.LastName),
      p.Friends.Select (f =&gt; DynamicVisit (f))
    );
  }

  protected override XElement Visit (Customer c)
  {
    XElement xe = base.Visit (c);
    xe.Add (new XElement (&quot;CreditLimit&quot;, c.CreditLimit));
    return xe;
  }

  protected override XElement Visit (Employee e)
  {
    XElement xe = base.Visit (e);
    xe.Add (new XElement (&quot;Salary&quot;, e.Salary));
    return xe;
  }
}
</code></pre>
<p>ุญุช ูโุชูุงูุฏ ุงุฒ ุฑู <strong>ToXElementPersonVisitor</strong> ูู ฺฉูุงุณ ูุฑุฒูุฏ ุจุณุงุฒุฏ.</p>
<hr>
<h3>๐ ุตุฏุง ุฒุฏู ูุงุดูุงุณ ุงุนุถุง ฺฉ ููุน Generic</h3>
<p>ุณุฎุชโฺฏุฑ <strong>static typing</strong> ุฏุฑ C# ฺฉ ุดูุดุฑ ุฏู ูุจู ุงุณุช:</p>
<ul>
<li>ุงุฒ ฺฉ ุทุฑู ุฏุฑ ุฒูุงู ฺฉุงููพุงู ูุฒุงู ูุดุฎุต ุงุฒ ุตุญุช ุฑุง ุชุถูู ูโฺฉูุฏ.</li>
<li>ุงุฒ ุทุฑู ุฏฺฏุฑุ ฺฏุงู ุงููุงุช ููุดุชู ุจุฑุฎ ุงุฒ ุงููุงุน ฺฉุฏ ุฑุง ุฏุดูุงุฑ ุง ุบุฑููฺฉู ูโุณุงุฒุฏุ ู ุฏุฑ ุงู ููุงูุน ุจุงุฏ ุงุฒ <strong>reflection</strong> ุงุณุชูุงุฏู ฺฉูุฏ.</li>
</ul>
<p>ุฏุฑ ฺูู ุดุฑุงุทุ <strong>dynamic binding</strong> ฺฉ ุฌุงฺฏุฒู ุชูุฒุชุฑ ู ุณุฑุนโุชุฑ ุงุฒ reflection ุงุณุช.</p>
<p>ูุซุงู: ููุช ูุงุฒ ุฏุงุฑุฏ ุจุง ฺฉ ุดุก ุงุฒ ููุน <code>G&lt;T&gt;</code> ฺฉุงุฑ ฺฉูุฏ ุฏุฑ ุญุงู ฺฉู ููุน <code>T</code> ูุงุดูุงุฎุชู ุงุณุช.</p>
<pre><code class="language-csharp">public class Foo&lt;T&gt; { public T Value; }
</code></pre>
<p>ูุฑุถ ฺฉูุฏ ูุชุฏ ุจู ุดฺฉู ุฒุฑ ุฏุงุฑู:</p>
<pre><code class="language-csharp">static void Write (object obj)
{
  if (obj is Foo&lt;&gt;)                           // Illegal
    Console.WriteLine ((Foo&lt;&gt;) obj).Value);   // Illegal
}
</code></pre>
<p>ุงู ฺฉุฏ ฺฉุงููพุงู ููโุดูุฏ: ฺูู ููโุชูุงูุฏ ุงุนุถุง ฺฉ ููุน generic ุบุฑูุชุญุฏ (unbound) ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ.</p>
<hr>
<h3>โจ ุฑุงูโุญู ุจุง dynamic binding</h3>
<p>ุฑุงู ุงูู ุงู ุงุณุช ฺฉู <strong>Value</strong> ุฑุง ุจูโุตูุฑุช ูพูุง (dynamic) ุตุฏุง ุจุฒูุฏ:</p>
<pre><code class="language-csharp">static void Write (dynamic obj)
{
  try { Console.WriteLine (obj.Value); }
  catch (Microsoft.CSharp.RuntimeBinder.RuntimeBinderException) {...}
}
</code></pre>
<hr>
<h3>๐พ Multiple Dispatch</h3>
<p>ุฒุจุงู C# ู CLR ููุดู ฺฉ ุดฺฉู ูุญุฏูุฏ ุงุฒ ูพูุง ุฑุง ุจุง <strong>virtual method calls</strong> ูพุดุชุจุงู ฺฉุฑุฏูโุงูุฏ.
ุชูุงูุช ุขู ุจุง <strong>dynamic binding</strong> ุฏุฑ ุงู ุงุณุช ฺฉู ุฏุฑ <strong>virtual calls</strong>ุ ฺฉุงููพุงูุฑ ุจุงุฏ ุฏุฑ ุฒูุงู ฺฉุงููพุงู ูุชุนูุฏ ุดูุฏ ฺฉู ฺฉุฏุงู ุนุถู ูุฌุงุฒ ุตุฏุง ุฒุฏู ุฎูุงูุฏ ุดุฏ (ุจุฑ ุงุณุงุณ ูุงู ู ุงูุถุง ูุชุฏ ฺฉู ูุฑุงุฎูุงู ุดุฏู ุงุณุช).</p>
<p>ุจู ุงู ูุนู ฺฉู:</p>
<ul>
<li>ุนุจุงุฑุช ูุฑุงุฎูุงู ุจุงุฏ ฺฉุงููุงู ุชูุณุท ฺฉุงููพุงูุฑ ุฏุฑฺฉ ุดูุฏ (ูุซูุงู ุจุงุฏ ุฏุฑ ุฒูุงู ฺฉุงููพุงู ูุดุฎุต ุดูุฏ ฺฉู ุขุง ฺฉ ุนุถู ูุฏู ฺฉ <strong>field</strong> ุงุณุช ุง ฺฉ <strong>property</strong>).</li>
<li><strong>Overload resolution</strong> ุจุงุฏ ฺฉุงููุงู ุชูุณุท ฺฉุงููพุงูุฑ ู ุจุฑ ุงุณุงุณ ููุนโูุง ุฒูุงู ฺฉุงููพุงู ุขุฑฺฏููุงูโูุง ุงูุฌุงู ุดูุฏ.</li>
</ul>
<p>ูุซุงู:</p>
<pre><code class="language-csharp">animal.Walk (owner);
</code></pre>
<p>ูุชุฌู: ุชูุงูุง ุงูุฌุงู <strong>virtual calls</strong> ุจู ูุงู <strong>single dispatch</strong> ุดูุงุฎุชู ูโุดูุฏ. ฺุฑุงุ</p>
<p>ฺูู ุชุตูู ุฒูุงู ุงุฌุฑุง ุจุฑุง ุงูฺฉู ูุชุฏ <strong>Walk</strong> ุณฺฏ ุตุฏุง ุฒุฏู ุดูุฏ ุง ูุชุฏ <strong>Walk</strong> ฺฏุฑุจูุ ููุท ุจู ููุน ุฏุฑุงูุชโฺฉููุฏู (<strong>receiver type</strong>)ุ ุนู <code>animal</code> ุจุณุชฺฏ ุฏุงุฑุฏ (ุจู ููู ุฏูู &quot;single&quot;).</p>
<p>ุงฺฏุฑ ฺูุฏู overload ุงุฒ <strong>Walk</strong> ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุงููุงุน ูุฎุชูู ุงุฒ <code>owner</code> ุฑุง ุจูพุฐุฑูุฏุ ุงูุชุฎุงุจ ุขูโูุง ุฏุฑ ุฒูุงู ฺฉุงููพุงู ู ุจุฏูู ุชูุฌู ุจู ููุน ูุงูุน <code>owner</code> ุงูุฌุงู ูโุดูุฏ.</p>
<hr>
<h3>๐ก Dynamic Multiple Dispatch</h3>
<p>ุฏุฑ ููุงุจูุ ฺฉ ูุฑุงุฎูุงู ูพูุง (dynamic call) ุงูุชุฎุงุจ overload ุฑุง ุชุง ุฒูุงู ุงุฌุฑุง ุจู ุชุฃุฎุฑ ูโุงูุฏุงุฒุฏ:</p>
<pre><code class="language-csharp">animal.Walk ((dynamic) owner);
</code></pre>
<p>ุงู ุจุงุฑ ุงูุชุฎุงุจ ููุง ุงูฺฉู ฺฉุฏุงู ูุชุฏ <strong>Walk</strong> ูุฑุงุฎูุงู ุดูุฏ ุจู ููุนโูุง ูุฑ ุฏู ุนู <code>animal</code> ู <code>owner</code> ุจุณุชฺฏ ุฏุงุฑุฏ.
ุจู ููู ุฏูู ุจู ุขู <strong>multiple dispatch</strong> ูโฺฏููุฏ: ฺูู ููุนโูุง ุฒูุงู ุงุฌุฑุง (<strong>runtime types</strong>) ุขุฑฺฏููุงูโูุง ุนูุงูู ุจุฑ <strong>receiver type</strong>ุ ุฏุฑ ุชุตููโฺฏุฑ ุฏุฎุงูุช ุฏุงุฑูุฏ.</p>
<hr>
<h3>โ๏ธ ูุดฺฉูุงุช ู ุฑุงูโุญู ุจูุชุฑ</h3>
<p>ุฑูุด ูุจู ุงู ูุฒุช ุฑุง ุฏุงุฑุฏ ฺฉู ุจุง ูุฑ ุดุฆ ฺฉู ฺฉ <strong>Value field</strong> ุง <strong>Value property</strong> ุฏุงุดุชู ุจุงุดุฏ ฺฉุงุฑ ูโฺฉูุฏ.
ุงูุง ูุดฺฉูุงุช ูู ุฏุงุฑุฏ:</p>
<ol>
<li>
<p>ฺฏุฑูุชู <strong>exception</strong> ุฏุฑ ุงู ุฑูุด ุดููุบ ู ูุงฺฉุงุฑุขูุฏ ุงุณุช (ู ูฺ ุฑุงู ูุณุช ฺฉู ุงุฒ ูุจู ุงุฒ DLR ุจูพุฑุณู &quot;ุขุง ุงู ุนููุงุช ูููู ุฎูุงูุฏ ุดุฏุ&quot;).</p>
</li>
<li>
<p>ุงฺฏุฑ <strong>Foo</strong> ฺฉ <strong>interface</strong> ูุซู <code>IFoo&lt;T&gt;</code> ุจุงุดุฏ ู ฺฉ ุงุฒ ุดุฑุงุท ุฒุฑ ุจุฑูุฑุงุฑ ุจุงุดุฏุ ุงู ุฑูุด ฺฉุงุฑ ููโฺฉูุฏ:</p>
<ul>
<li><strong>Value</strong> ุจูโุตูุฑุช <strong>explicitly implemented</strong> ุชุนุฑู ุดุฏู ุจุงุดุฏ.</li>
<li>ููุน ฺฉู <strong>IFoo<T></strong> ุฑุง ูพุงุฏูโุณุงุฒ ฺฉุฑุฏูุ ุบุฑูุงุจู ุฏุณุชุฑุณ ุจุงุดุฏ.</li>
</ul>
</li>
</ol>
<hr>
<h3>โ ุฑุงูโุญู ุจูุชุฑ: ูุชุฏ ฺฉูฺฉ overload ุดุฏู</h3>
<pre><code class="language-csharp">static void Write (dynamic obj)
{
  object result = GetFooValue (obj);
  if (result != null) Console.WriteLine (result);
}

static T GetFooValue&lt;T&gt; (Foo&lt;T&gt; foo) =&gt; foo.Value;
static object GetFooValue (object foo) =&gt; null;
</code></pre>
<p>ุงูุฌุง ูุง ูุชุฏ <strong>GetFooValue</strong> ุฑุง overload ฺฉุฑุฏู ุชุง ฺฉ ูพุงุฑุงูุชุฑ ุงุฒ ููุน <code>object</code> ูู ุจฺฏุฑุฏุ ฺฉู ููุด fallback ุฑุง ุฏุงุฑุฏ.</p>
<p>ุฏุฑ ุฒูุงู ุงุฌุฑุงุ <strong>C# dynamic binder</strong> ุจูุชุฑู overload ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ. ุงฺฏุฑ ุดุก ุฏุงุฏูโุดุฏู ุงุฒ ููุน <code>Foo&lt;T&gt;</code> ูุจุงุดุฏุ ูุณุฎูโ <strong>object-parameter</strong> ุงูุชุฎุงุจ ูโุดูุฏ ู ุจูโุฌุง ูพุฑุชุงุจ exception ููุฏุงุฑ null ุจุฑูโฺฏุฑุฏุงูุฏ.</p>
<hr>
<h3>๐ ฺฏุฒููโ ุฏฺฏุฑ</h3>
<p>ููุท overload ุงูู ุฑุง ุจููุณู ู ุณูพุณ <strong>RuntimeBinderException</strong> ุฑุง catch ฺฉูู.</p>
<ul>
<li><strong>ูุฒุช</strong>: ูโุชูุงูู ุชูุงุฒ ูุงุฆู ุดูู ุจู ุฒูุงู ฺฉู <code>foo.Value</code> ูุงูุนุงู null ุงุณุช ุง ุงุตูุงู ูุฌูุฏ ูุฏุงุฑุฏ.</li>
<li><strong>ุนุจ</strong>: ูุฒููโ ฺฉุงุฑุง ุจูโุฎุงุทุฑ ูพุฑุชุงุจ ู ฺฏุฑูุชู exception.</li>
</ul>
<hr>
<h3>๐ ูุซุงู: ToStringEx ุจุง dynamic binding</h3>
<p>ุฏุฑ ูุตู ฑธุ ููู ูุดฺฉู ุฑุง ุจุฑุง ฺฉ interface ุจุง ุงุณุชูุงุฏู ุงุฒ reflection ุญู ฺฉุฑุฏู (ฺฉู ุชูุงุด ุจุดุชุฑ ูุงุฒ ุฏุงุดุช).
ูุซุงู ูุง ุทุฑุงุญ ูุณุฎูโ ูุฏุฑุชููุฏุชุฑ ุงุฒ <strong>ToString()</strong> ุจูุฏ ฺฉู ูโุชูุงูุณุช ุงุดุงุฆ ูุงููุฏ <strong>IEnumerable</strong> ู <strong>IGrouping&lt;,&gt;</strong> ุฑุง ุฏุฑฺฉ ฺฉูุฏ.</p>
<p>ุงูุฌุง ููุงู ูุซุงู ุจุง dynamic bindingุ ุงูุง ุฒุจุงุชุฑ:</p>
<pre><code class="language-csharp">static string GetGroupKey&lt;TKey,TElement&gt; (IGrouping&lt;TKey,TElement&gt; group)
  =&gt; &quot;Group with key=&quot; + group.Key + &quot;: &quot;;

static string GetGroupKey (object source) =&gt; null;

public static string ToStringEx (object value)
{
  if (value == null) return &quot;&lt;null&gt;&quot;;
  if (value is string s) return s;
  if (value.GetType().IsPrimitive) return value.ToString();

  StringBuilder sb = new StringBuilder();
  string groupKey = GetGroupKey ((dynamic)value);   // Dynamic dispatch
  if (groupKey != null) sb.Append (groupKey);

  if (value is IEnumerable)
    foreach (object element in ((IEnumerable)value))
      sb.Append (ToStringEx (element) + &quot; &quot;);

  if (sb.Length == 0) sb.Append (value.ToString());
  return &quot;\r\n&quot; + sb.ToString();
}
</code></pre>
<hr>
<h3>โถ๏ธ ุงุฌุฑุง ฺฉุฏ</h3>
<pre><code class="language-csharp">Console.WriteLine (ToStringEx (&quot;xyyzzz&quot;.GroupBy (c =&gt; c) ));
</code></pre>
<p>๐ฝ ุฎุฑูุฌ:</p>
<pre><code>Group with key=x: x
Group with key=y: y y
Group with key=z: z z z
</code></pre>
<hr>
<p>ุฏุฑ ุงูุฌุง ุงุฒ <strong>dynamic member overload resolution</strong> ุจุฑุง ุญู ูุณุฆูู ุงุณุชูุงุฏู ฺฉุฑุฏู.</p>
<p>ุงฺฏุฑ ุจูโุฌุง ุขูุ ฺูู ฺฉุงุฑ ูโฺฉุฑุฏู:</p>
<pre><code class="language-csharp">dynamic d = value;
try { groupKey = d.Value; }
catch (Microsoft.CSharp.RuntimeBinder.RuntimeBinderException) {...}
</code></pre>
<p>ุงู ุฑูุด ุดฺฉุณุช ูโุฎูุฑุฏ. ฺุฑุงุ ฺูู ุนููฺฏุฑ <strong>GroupBy</strong> ุฏุฑ LINQ ฺฉ ููุน ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู <strong>IGrouping&lt;,&gt;</strong> ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ ู ุฎูุฏุด <strong>internal</strong> ุงุณุช:</p>
<pre><code class="language-csharp">internal class Grouping : IGrouping&lt;TKey,TElement&gt;, ...
{
  public TKey Key;
  ...
}
</code></pre>
<p>ุญุช ุงฺฏุฑ property <strong>Key</strong> ุจูโุตูุฑุช public ุชุนุฑู ุดุฏู ุจุงุดุฏุ ฺฉูุงุณ ุญุงู ุขู <strong>internal</strong> ุงุณุช ู ุจูุงุจุฑุงู ููุท ุงุฒ ุทุฑู <strong>IGrouping&lt;,&gt;</strong> ูุงุจู ุฏุณุชุฑุณ ุงุณุช.
ู ููุงูโุทูุฑ ฺฉู ุฏุฑ ูุตู ด ุชูุถุญ ุฏุงุฏูุ ูฺ ุฑุงู ูุฌูุฏ ูุฏุงุฑุฏ ฺฉู ุจู DLR ุจฺฏูู ููฺฏุงู ุตุฏุง ุฒุฏู dynamic memberุ ุจู ุขู interface bind ุดูุฏ.</p>
<h3>ูพุงุฏูโุณุงุฒ ุงุดุง ูพูุง ๐ฆโจ</h3>
<p>ฺฉ ุดุก ูโุชูุงูุฏ ุจุง ูพุงุฏูโุณุงุฒ <strong>IDynamicMetaObjectProvider</strong> ูุนูุงุดูุงุณ (binding semantics) ุฎูุฏุด ุฑุง ูุฑุงูู ฺฉูุฏโุง ุฑุงุญุชโุชุฑ ุงุฒ ุขูุ ุจุง ุงุฑุซโุจุฑ ุงุฒ ฺฉูุงุณ <strong>DynamicObject</strong>ุ ฺฉู ฺฉ ูพุงุฏูโุณุงุฒ ูพุดโูุฑุถ ุงุฒ ุงู ุงูุชุฑูุณ ุงุฑุงุฆู ูโุฏูุฏ.</p>
<p>ุงู ููุถูุน ุจูโุทูุฑ ูุฎุชุตุฑ ุฏุฑ ูุตู ด ุจุง ูุซุงู ุฒุฑ ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช:</p>
<pre><code class="language-csharp">dynamic d = new Duck();
d.Quack();                  // ูุชุฏ Quack ูุฑุงุฎูุงู ุดุฏ
d.Waddle();                 // ูุชุฏ Waddle ูุฑุงุฎูุงู ุดุฏ

public class Duck : DynamicObject
{
  public override bool TryInvokeMember(
    InvokeMemberBinder binder, object[] args, out object result)
  {
    Console.WriteLine (binder.Name + &quot; method was called&quot;);
    result = null;
    return true;
  }
}
</code></pre>
<hr>
<h3>DynamicObject ๐๏ธ</h3>
<p>ุฏุฑ ูุซุงู ุจุงูุงุ ูุง ูุชุฏ <strong>TryInvokeMember</strong> ุฑุง ุจุงุฒููุณ (override) ฺฉุฑุฏูุ ฺฉู ุจู ูุตุฑูโฺฉููุฏู ุงุฌุงุฒู ูโุฏูุฏ ุฑู ุดุก ูพูุง (dynamic object) ฺฉ ูุชุฏ ูุฑุงุฎูุงู ฺฉูุฏโูุซู <strong>Quack</strong> ุง <strong>Waddle</strong>.</p>
<p>ฺฉูุงุณ <strong>DynamicObject</strong> ูุชุฏูุง ูุฌุงุฒ (virtual methods) ุฏฺฏุฑ ูู ุฏุฑ ุงุฎุชุงุฑ ูุฑุงุฑ ูโุฏูุฏ ฺฉู ุจู ูุตุฑูโฺฉููุฏู ุงุฌุงุฒู ูโุฏููุฏ ุงุฒ ุฏฺฏุฑ ุณุงุฎุชุงุฑูุง ุจุฑูุงููโููุณ ุงุณุชูุงุฏู ฺฉูุฏ. ููุงุฑุฏ ุฒุฑ ูุชูุงุธุฑ ุจุง ุณุงุฎุชุงุฑูุง ูุณุชูุฏ ฺฉู ุฏุฑ ุฒุจุงู C# ููุงุด ุฏุงุฑูุฏ:</p>
<div align="center">
<p><img src="../../../assets/image/19/Table-19-1.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<h3>ูุชุฏูุง ูพูุง ุฏุฑ DynamicObject โก</h3>
<p>ุงู ูุชุฏูุง ุจุงุฏ ุฏุฑ ุตูุฑุช ููููุชุ ููุฏุงุฑ <strong>true</strong> ุจุฑฺฏุฑุฏุงููุฏ. ุงฺฏุฑ ููุฏุงุฑ <strong>false</strong> ุจุฑฺฏุฑุฏุงูุฏู ุดูุฏุ <strong>DLR</strong> (Dynamic Language Runtime) ุจู binder ุฒุจุงู ุจุฑูโฺฏุฑุฏุฏ ุชุง ุจูโุฏูุจุงู ุนุถู ููโูุงู ุฏุฑ ุฎูุฏ ุดุก ูพูุง (ุฒุฑฺฉูุงุณ DynamicObject) ุจฺฏุฑุฏุฏ. ุงฺฏุฑ ุงู ฺฉุงุฑ ูู ุดฺฉุณุช ุจุฎูุฑุฏุ ฺฉ ุงุณุชุซูุง <strong>RuntimeBinderException</strong> ูพุฑุชุงุจ ุฎูุงูุฏ ุดุฏ. ๐จ</p>
<hr>
<h3>ููููู ุจุง <code>TryGetMember</code> ู <code>TrySetMember</code> ๐</h3>
<p>ุฏุฑ ูุซุงู ุฒุฑุ ฺฉูุงุณ ุณุงุฎุชูโุงู ฺฉู ุจู ูุง ุงูฺฉุงู ูโุฏูุฏ ุจูโุตูุฑุช ูพูุง ุจู attributeูุง ุฏุฑ ฺฉ <strong>XElement (System.Xml.Linq)</strong> ุฏุณุชุฑุณ ูพุฏุง ฺฉูู:</p>
<pre><code class="language-csharp">static class XExtensions
{
  public static dynamic DynamicAttributes (this XElement e)
    =&gt; new XWrapper (e);

  class XWrapper : DynamicObject
  {
    XElement _element;
    public XWrapper (XElement e) { _element = e; }

    public override bool TryGetMember (GetMemberBinder binder,
                                       out object result)
    {
      result = _element.Attribute (binder.Name).Value;
      return true;
    }

    public override bool TrySetMember (SetMemberBinder binder,
                                       object value)
    {
      _element.SetAttributeValue (binder.Name, value);
      return true;
    }
  }
}
</code></pre>
<p>๐ ูุญููโ ุงุณุชูุงุฏู:</p>
<pre><code class="language-csharp">XElement x = XElement.Parse (@&quot;&lt;Label Text=&quot;&quot;Hello&quot;&quot; Id=&quot;&quot;5&quot;&quot;/&gt;&quot;);
dynamic da = x.DynamicAttributes();

Console.WriteLine (da.Id);        // 5
da.Text = &quot;Foo&quot;;
Console.WriteLine (x.ToString()); // &lt;Label Text=&quot;Foo&quot; Id=&quot;5&quot; /&gt;
</code></pre>
<hr>
<h3>ููููู ุจุง <code>System.Data.IDataRecord</code> ๐</h3>
<p>ุฏุฑ ูุซุงู ุจุนุฏุ ุจุฑุง ุณุงุฏูโุชุฑ ฺฉุฑุฏู ฺฉุงุฑ ุจุง <strong>data reader</strong>โูุงุ ุงุฒ DynamicObject ุงุณุชูุงุฏู ุดุฏู ุงุณุช:</p>
<pre><code class="language-csharp">public class DynamicReader : DynamicObject
{
  readonly IDataRecord _dataRecord;
  public DynamicReader (IDataRecord dr) { _dataRecord = dr; }

  public override bool TryGetMember (GetMemberBinder binder,
                                     out object result)
  {
    result = _dataRecord[binder.Name];
    return true;
  }
}
...
using (IDataReader reader = someDbCommand.ExecuteReader())
{
  dynamic dr = new DynamicReader (reader);
  while (reader.Read())
  {
    int id = dr.ID;
    string firstName = dr.FirstName;
    DateTime dob = dr.DateOfBirth;
    ...
  }
}
</code></pre>
<hr>
<h3>ููููู ุจุง <code>TryBinaryOperation</code> ู <code>TryInvoke</code> โ๐</h3>
<pre><code class="language-csharp">dynamic d = new Duck();
Console.WriteLine (d + d);       // foo
Console.WriteLine (d (78, 'x')); // 123

public class Duck : DynamicObject
{
  public override bool TryBinaryOperation (BinaryOperationBinder binder,
                                           object arg, out object result)
  {
    Console.WriteLine (binder.Operation);   // Add
    result = &quot;foo&quot;;
    return true;
  }

  public override bool TryInvoke (InvokeBinder binder,
                                  object[] args, out object result)
  {
    Console.WriteLine (args[0]); // 78
    result = 123;
    return true;
  }
}
</code></pre>
<hr>
<h3>ูุชุฏูุง ุชฺฉูู ุจุฑุง ุฒุจุงูโูุง ูพูุง ๐</h3>
<p>ฺฉูุงุณ <strong>DynamicObject</strong> ููฺูู ฺูุฏ ูุชุฏ ูุฌุงุฒ ุฏฺฏุฑ ุฑุง ุจุฑุง ุฑุงุญุช ุฒุจุงูโูุง ูพูุง ูุฑุงูู ูโฺฉูุฏ.</p>
<p>๐น ุจูโุทูุฑ ุฎุงุตุ ุจุงุฒููุณ ูุชุฏ <strong>GetDynamicMemberNames</strong> ุงู ุงูฺฉุงู ุฑุง ูโุฏูุฏ ฺฉู ูุณุช ุงุฒ ุชูุงู ูุงู ุงุนุถุง ฺฉู ุดุก ูพูุง ุงุฑุงุฆู ูโุฏูุฏุ ุจุฑฺฏุฑุฏุงูุฏู ุดูุฏ.</p>
<p>๐น ุฏูู ุฏฺฏุฑ ุจุฑุง ูพุงุฏูโุณุงุฒ <strong>GetDynamicMemberNames</strong> ุงู ุงุณุช ฺฉู <strong>ุฏุจุงฺฏุฑ Visual Studio</strong> ุงุฒ ุงู ูุชุฏ ุงุณุชูุงุฏู ูโฺฉูุฏ ุชุง ููุง ุงุฒ ฺฉ ุดุก ูพูุง ุฑุง ููุงุด ุฏูุฏ. ๐ฅ๏ธ</p>
<h3>ExpandoObject ๐ช</h3>
<p>ฺฉ ฺฉุงุฑุจุฑุฏ ุณุงุฏู ุฏฺฏุฑ ุงุฒ <strong>DynamicObject</strong> ูโุชูุงูุฏ ุงู ุจุงุดุฏ ฺฉู ฺฉ ฺฉูุงุณ ูพูุง ุจููุณู ฺฉู ุงุดุงุก ุฑุง ุฏุฑ ฺฉ <strong>Dictionary</strong> ุฐุฎุฑู ู ุจุงุฒุงุจ ฺฉูุฏ (ฺฉูุฏูุง ุงุฒ ููุน string). ุงูุง ุงู ูุงุจูุช ุงุฒ ูุจู ุชูุณุท ฺฉูุงุณ <strong>ExpandoObject</strong> ูุฑุงูู ุดุฏู ุงุณุช:</p>
<pre><code class="language-csharp">dynamic x = new ExpandoObject();
x.FavoriteColor = ConsoleColor.Green;
x.FavoriteNumber = 7;

Console.WriteLine (x.FavoriteColor);   // Green
Console.WriteLine (x.FavoriteNumber);  // 7
</code></pre>
<p>๐ ุฏุฑ ูุงูุนุ <strong>ExpandoObject</strong> ุงูุชุฑูุณ <strong>IDictionary&lt;string, object&gt;</strong> ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ. ุจูุงุจุฑุงู ูโุชูุงูู ูุซุงู ุจุงูุง ุฑุง ุงูโุทูุฑ ุงุฏุงูู ุฏูู:</p>
<pre><code class="language-csharp">var dict = (IDictionary&lt;string,object&gt;) x;
Console.WriteLine (dict[&quot;FavoriteColor&quot;]);   // Green
Console.WriteLine (dict[&quot;FavoriteNumber&quot;]);  // 7
Console.WriteLine (dict.Count);              // 2
</code></pre>
<hr>
<h3>ุชุนุงูู ุจุง ุฒุจุงูโูุง ูพูุง ๐</h3>
<p>ุงฺฏุฑฺู C# ุงุฒ ุทุฑู ฺฉููู ฺฉูุฏ <strong>dynamic</strong> ุงุฒ <strong>dynamic binding</strong> ูพุดุชุจุงู ูโฺฉูุฏุ ุงูุง ุงุฌุงุฒู ููโุฏูุฏ ฺฉ ุนุจุงุฑุช ุฐุฎุฑูโุดุฏู ุจู ุดฺฉู ุฑุดุชู (string) ุฑุง ุฏุฑ ุฒูุงู ุงุฌุฑุง ูุณุชููุงู ุงุฌุฑุง ฺฉูุฏ:</p>
<pre><code class="language-csharp">string expr = &quot;2 * 3&quot;;
// ููโุชูุงูู expr ุฑุง ุงุฌุฑุง ฺฉูู
</code></pre>
<p>ุนูุช ุงู ุงุณุช ฺฉู ุชุฑุฌููโ ฺฉ ุฑุดุชู ุจู ฺฉ <strong>expression tree</strong> ูุงุฒููุฏ ฺฉ <strong>lexical parser</strong> ู <strong>semantic parser</strong> ุงุณุช ฺฉู ุฏุฑ ฺฉุงููพุงูุฑ C# ูุฌูุฏ ุฏุงุฑูุฏุ ุงูุง ุจูโุตูุฑุช ุณุฑูุณ ุฏุฑ ุฒูุงู ุงุฌุฑุง ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏ. ุฏุฑ ุฒูุงู ุงุฌุฑุงุ C# ููุท ฺฉ <strong>binder</strong> ูุฑุงูู ูโฺฉูุฏ ฺฉู ุจู <strong>DLR</strong> ูโฺฏูุฏ ฺฺฏููู ฺฉ expression tree ุงุฒ ูุจู ุณุงุฎุชูโุดุฏู ุฑุง ุชูุณุฑ ฺฉูุฏ.</p>
<p>๐จโ๐ป ุฏุฑ ุฒุจุงูโูุง ูุงูุนุงู ูพูุง ูุซู <strong>IronPython</strong> ู <strong>IronRuby</strong>ุ ูโุชูุงู ุฑุดุชูโูุง ุฑุง ุจูโุตูุฑุช ูุณุชูู ุงุฌุฑุง ฺฉุฑุฏ. ุงู ููุถูุน ุจุฑุง ฺฉุงุฑูุง ูุซู <strong>ุงุณฺฉุฑูพุชโููุณ</strong>ุ ุณุงุฎุช <strong>ุณุณุชูโูุง ูพฺฉุฑุจูุฏ ูพูุง</strong>ุ ู ูพุงุฏูโุณุงุฒ <strong>rules engine</strong> ุจุณุงุฑ ููุฏ ุงุณุช. ุจูุงุจุฑุงูุ ุงฺฏุฑฺู ูโุชูุงูุฏ ุจุดุชุฑ ุจุฑูุงูู ุฑุง ุฏุฑ C# ุจููุณุฏุ ุงูุง ููฺฉู ุงุณุช ุจุฑุง ุจุฑุฎ ูุธุงู ุฎุงุตุ ุจู ุงุณุชูุงุฏู ุงุฒ ฺฉ ุฒุจุงู ูพูุง ูุงุฒ ุฏุงุดุชู ุจุงุดุฏ.</p>
<p>ููฺูู ฺฏุงู ููฺฉู ุงุณุช ุจุฎูุงูุฏ ุงุฒ <strong>API</strong>ุง ุงุณุชูุงุฏู ฺฉูุฏ ฺฉู ุฏุฑ ฺฉ ุฒุจุงู ูพูุง ููุดุชู ุดุฏู ู ูุนุงุฏู ุขู ุฏุฑ <strong>.NET</strong> ูุฌูุฏ ูุฏุงุฑุฏ.</p>
<hr>
<h3>ุงุฌุฑุง ฺฉุฏ C# ุจู ุดฺฉู ุฑุดุชู ุจุง Roslyn ๐งฉ</h3>
<p>ูพฺฉุฌ <strong>Microsoft.CodeAnalysis.CSharp.Scripting</strong> (ุงุฒ ูุฌููุนู Roslyn) ุงู ูุงุจูุช ุฑุง ูุฑุงูู ูโฺฉูุฏ ฺฉู ฺฉ ุฑุดุชู C# ุฑุง ุงุฌุฑุง ฺฉูุฏ. ุงูุจุชู ุงู ฺฉุงุฑ ุจุง <strong>ฺฉุงููพุงู</strong> ุฑุดุชู ุจู ฺฉ ุจุฑูุงูู ุงูุฌุงู ูโุดูุฏุ ุจูุงุจุฑุงู ุณุฑุจุงุฑ ุนููฺฉุฑุฏ ุจุดุชุฑ ูุณุจุช ุจู ุฒุจุงูโูุง ูุซู Python ุฏุงุฑุฏ (ูฺฏุฑ ุงูฺฉู ููุงู ุนุจุงุฑุช ุจุงุฑูุง ุชฺฉุฑุงุฑุงู ุงุฌุฑุง ุดูุฏ).</p>
<hr>
<h3>ูุซุงู ุจุง IronPython ๐</h3>
<p>ุฏุฑ ูุซุงู ุฒุฑุ ุงุฒ <strong>IronPython</strong> ุจุฑุง ุงุฑุฒุงุจ ฺฉ ุนุจุงุฑุช ุฏุฑ ุฒูุงู ุงุฌุฑุง ุงุฒ ุฏุฑูู C# ุงุณุชูุงุฏู ูโฺฉูู. ูโุชูุงู ุงุฒ ุงู ุฑูุด ุจุฑุง ุณุงุฎุช ฺฉ ูุงุดู ุญุณุงุจ ุณุงุฏู ุจูุฑู ุจุฑุฏ.</p>
<p>๐ ุจุฑุง ุงุฌุฑุง ุงู ฺฉุฏุ ุจุงุฏ ูพฺฉุฌโูุง <strong>DynamicLanguageRuntime</strong> (ุชูุฌู ฺฉูุฏ ุจุง System.Dynamic.Runtime ูุฑู ุฏุงุฑุฏ) ู <strong>IronPython</strong> ุฑุง ูุตุจ ฺฉูุฏ.</p>
<pre><code class="language-csharp">using System;
using IronPython.Hosting;
using Microsoft.Scripting;
using Microsoft.Scripting.Hosting;

int result = (int) Calculate (&quot;2 * 3&quot;);
Console.WriteLine (result);  // 6

object Calculate (string expression)
{
  ScriptEngine engine = Python.CreateEngine();
  return engine.Execute (expression);
}
</code></pre>
<p>โ ุชูุฌู ฺฉูุฏ: ฺูู ุฑุดุชู ุจู <strong>Python</strong> ูพุงุณ ุฏุงุฏู ูโุดูุฏุ ุนุจุงุฑุช ุจุฑ ุงุณุงุณ ููุงูู Python ุงุฑุฒุงุจ ุฎูุงูุฏ ุดุฏุ ูู C#.</p>
<p>ุจุฑุง ูุซุงูุ ูโุชูุงู ุงุฒ ุงูฺฉุงูุงุช ุฒุจุงู Python ูุซู <strong>ูุณุชโูุง</strong> ุงุณุชูุงุฏู ฺฉุฑุฏ:</p>
<pre><code class="language-csharp">var list = (IEnumerable) Calculate (&quot;[1, 2, 3] + [4, 5]&quot;);
foreach (int n in list) Console.Write (n);  // 12345
</code></pre>
<hr>
<h3>ุนุจูุฑ ูุถุนุช ุจู C# ู ุงุณฺฉุฑูพุช ๐</h3>
<p>ุจุฑุง ุงูุชูุงู ูุชุบุฑูุง ุงุฒ C# ุจู Pythonุ ูุฑุงุญู ุจุดุชุฑ ูุงุฒ ุงุณุช. ูุซุงู ุฒุฑ ุงู ููุถูุน ุฑุง ูุดุงู ูโุฏูุฏ ู ูโุชูุงูุฏ ูพุงูโุง ุจุฑุง ฺฉ <strong>rules engine</strong> ุจุงุดุฏ:</p>
<pre><code class="language-csharp">// ุงู ุฑุดุชู ูโุชูุงูุฏ ุงุฒ ฺฉ ูุงู ุง ุฏุชุงุจุณ ุจุงุฏ:
string auditRule = &quot;taxPaidLastYear / taxPaidThisYear &gt; 2&quot;;

ScriptEngine engine = Python.CreateEngine();    
ScriptScope scope = engine.CreateScope();       

scope.SetVariable (&quot;taxPaidLastYear&quot;, 20000m);
scope.SetVariable (&quot;taxPaidThisYear&quot;, 8000m);

ScriptSource source = engine.CreateScriptSourceFromString (
                      auditRule, SourceCodeKind.Expression);

bool auditRequired = (bool) source.Execute (scope);
Console.WriteLine (auditRequired);   // True
</code></pre>
<p>๐ฅ ููฺูู ูโุชูุงูุฏ ูุชุบุฑูุง ุฑุง ุงุฒ ุงุณฺฉุฑูพุช ุจู C# ุจุฑฺฏุฑุฏุงูุฏ:</p>
<pre><code class="language-csharp">string code = &quot;result = input * 3&quot;;

ScriptEngine engine = Python.CreateEngine();
ScriptScope scope = engine.CreateScope();
scope.SetVariable (&quot;input&quot;, 2);

ScriptSource source = engine.CreateScriptSourceFromString (
                      code, SourceCodeKind.SingleStatement);

source.Execute (scope);

Console.WriteLine (scope.GetVariable (&quot;result&quot;));   // 6
</code></pre>
<p>ุฏุฑ ุงู ูุซุงู ุฏููุ ุงุฒ <strong>SourceCodeKind.SingleStatement</strong> ุจูโุฌุง <strong>Expression</strong> ุงุณุชูุงุฏู ฺฉุฑุฏู ุชุง ุจู ููุชูุฑ ุจฺฏูู ูุตุฏ ุงุฌุฑุง ฺฉ <strong>statement</strong> ุฑุง ุฏุงุฑู.</p>
<hr>
<h3>ุชุจุงุฏู ุงููุงุน ุจู C# ู Python ๐</h3>
<p>๐น ููุนโูุง ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ุจู ุฏูุง <strong>.NET</strong> ู <strong>Python</strong> ููุชูู (marshal) ูโุดููุฏ.
๐น ุญุช ูโุชูุงูุฏ ุงุนุถุง ฺฉ ุดุก .NET ุฑุง ุงุฒ ุณูุช ุงุณฺฉุฑูพุช ูุฑุงุฎูุงู ฺฉูุฏ:</p>
<pre><code class="language-csharp">string code = @&quot;sb.Append (&quot;&quot;World&quot;&quot;)&quot;;

ScriptEngine engine = Python.CreateEngine();
ScriptScope scope = engine.CreateScope();

var sb = new StringBuilder (&quot;Hello&quot;);
scope.SetVariable (&quot;sb&quot;, sb);

ScriptSource source = engine.CreateScriptSourceFromString (
                      code, SourceCodeKind.SingleStatement);

source.Execute (scope);

Console.WriteLine (sb.ToString());   // HelloWorld
</code></pre>

  </main>

  <!-- ููุชุฑ ูุดุชุฑฺฉ -->
  <footer class="footer">
    <div class="container">
      <p>
        <img src="/icone/copyright.svg" alt="ฺฉูพโุฑุงุช" width="14" height="14"
             style="vertical-align:middle;margin-inline:4px">
        <span id="y"></span> Gitab โ ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู
      </p>
    </div>
  </footer>

  <!-- ุณุงู + ุงุณฺฉุฑูพุช ุชู -->
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    (() => {
      const root = document.documentElement;
      const btn = document.getElementById('themeToggle');
      const KEY = 'gitab-theme';
      const media = window.matchMedia('(prefers-color-scheme: dark)');
      const getEffective = s => s === 'auto' ? (media.matches ? 'dark' : 'light') : s;
      function updateTheme(s) {
        root.setAttribute('data-theme', s);
        const mode = getEffective(s);
        root.dataset.colorMode = mode;
        btn.dataset.icon = mode === 'dark' ? 'moon' : 'sun';
      }
      const saved = localStorage.getItem(KEY) || 'auto';
      updateTheme(saved);
      btn.addEventListener('click', () => {
        const curr = localStorage.getItem(KEY) || 'auto';
        const next = curr === 'auto' ? 'dark' : curr === 'dark' ? 'light' : 'auto';
        localStorage.setItem(KEY, next);
        updateTheme(next);
      });
      media.addEventListener('change', () => {
        if ((localStorage.getItem(KEY) || 'auto') === 'auto') updateTheme('auto');
      });
      window.addEventListener('DOMContentLoaded', () => updateTheme(saved));
    })();
  </script>
</body>
</html>
