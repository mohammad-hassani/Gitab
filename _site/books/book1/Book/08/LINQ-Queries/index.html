<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gitab | ฺฉุชุงุจุฎุงููู ุชุฑุฌููโูุง ุฏุงุชโูุช ู ุณ ุดุงุฑูพ</title>
  <meta name="description" content="ุชุฑุฌููโูุง ูุงุฑุณ ฺฉุชุงุจโูุง ูู โ ุณุฑุนุ ูููุงู ู ูุงุจู ุงุชฺฉุง.">
  <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
  <!-- ูุฏุฑ ูุดุชุฑฺฉ -->
  <header class="header">
    <div class="container nav-wrap">
      <a class="brand" href="/">
        <img src="/icone/logo.svg" alt="Gitab" width="28" height="28">
        <span>Gitab</span>
      </a>

      <nav class="nav">
        <a href="/">ุฎุงูู</a>
        <a href="/books/list-books">ฺฉุชุงุจโูุง</a>
        <a href="#">ููฺฉุงุฑ</a>
        <a href="#">ุฏุฑุจุงุฑูโูุง</a>
      </nav>

     <div class="nav-actions">
  <button id="themeToggle" class="icon-btn theme-btn" aria-label="ุชุบุฑ ุญุงูุช">
    <img class="icon-sun" src="/icone/sun.svg" alt="ุฑูุดู">
    <img class="icon-moon" src="/icone/moon.svg" alt="ุชุงุฑฺฉ">
  </button>

  <a class="icon-btn" href="https://github.com/hheydarian/Gitab" target="_blank" title="GitHub">
    <img src="/icone/github.svg" alt="GitHub">
  </a>
</div>

  </header>

  <!-- ูุญุชูุง ุตูุญู -->
  <main class="site-main">
    <h1>ูุตู ูุดุชู: ูพุฑุณโูุฌููุง LINQ</h1>
<p><strong>LINQ</strong> ุง <strong>Language Integrated Query</strong> ูุฌููุนูโุง ุงุฒ ูฺฺฏโูุง ุฒุจุงู ู ุฒูุงู ุงุฌุฑุงุณุช ฺฉู ุจุฑุง ููุดุชู ูพุฑุณโูุฌููุง ุณุงุฎุชุงุฑุงูุชู ู ููุน-ุงูู (<strong>type-safe</strong>) ุฑู ูุฌููุนูโูุง ูุญู ุงุฒ ุงุดุง ู ููุงุจุน ุฏุงุฏู ุฑุงู ุฏูุฑ ุงุณุชูุงุฏู ูโุดูุฏ.</p>
<p>LINQ ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุฑู ูุฑ ูุฌููุนูโุง ฺฉู <strong>IEnumerable<T></strong> ุฑุง ูพุงุฏูโุณุงุฒ ฺฉุฑุฏู ุงุณุช ูพุฑุณโูุฌู ฺฉูุฏุ ฺู ฺฉ ุขุฑุงูุ ูุณุชุ ุง <strong>XML Document Object Model (DOM)</strong> ุจุงุดุฏุ ู ฺู ููุงุจุน ุฏุงุฏู ุฑุงู ุฏูุฑ ูุงููุฏ ุฌุฏููโูุง ููุฌูุฏ ุฏุฑ ูพุงฺฏุงู ุฏุงุฏู <strong>SQL Server</strong>. LINQ ูุฒุงุง ุจุฑุฑุณ ููุน ุฏุฑ ุฒูุงู ฺฉุงููพุงู (<strong>compile-time type checking</strong>) ู ุชุฑฺฉุจ ูพุฑุณโูุฌููุง ูพูุง (<strong>dynamic query composition</strong>) ุฑุง ุงุฑุงุฆู ูโุฏูุฏ.</p>
<p>ุงู ูุตู ูุนูุงุฑ LINQ ู ุงุตูู ููุดุชู ูพุฑุณโูุฌููุง ุฑุง ุชูุถุญ ูโุฏูุฏ. ูููโ ููุนโูุง ุงุตู ุฏุฑ <strong>System.Linq</strong> ู <strong>System.Linq.Expressions</strong> ุชุนุฑู ุดุฏูโุงูุฏ.</p>
<p>ูุซุงูโูุง ุงู ูุตู ู ุฏู ูุตู ุจุนุฏ ุฏุฑ ฺฉ ุงุจุฒุงุฑ ุชุนุงูู ูพุฑุณโูุฌู ุจู ูุงู <strong>LINQPad</strong> ุจุงุฑฺฏุฐุงุฑ ุดุฏูโุงูุฏ. ูโุชูุงูุฏ <strong>LINQPad</strong> ุฑุง ุงุฒ <a href="http://www.linqpad.net">ุงู ููฺฉ</a> ุฏุงูููุฏ ฺฉูุฏ.</p>
<hr>
<h3>ุดุฑูุน ฺฉุงุฑ ๐</h3>
<p>ูุงุญุฏูุง ูพุงู ุฏุงุฏู ุฏุฑ LINQุ <strong>ุฏูุจุงููโูุง (sequences)</strong> ู <strong>ุนูุงุตุฑ (elements)</strong> ูุณุชูุฏ. ฺฉ ุฏูุจุงูู ูุฑ ุดุฆ ุงุณุช ฺฉู <strong>IEnumerable<T></strong> ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ ู ูุฑ ุนูุตุฑุ ฺฉ ุขุชู ุฏุฑ ุขู ุฏูุจุงูู ุงุณุช.</p>
<p>ูุซุงู ุฒุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ:</p>
<pre><code class="language-csharp">string[] names = { &quot;Tom&quot;, &quot;Dick&quot;, &quot;Harry&quot; };
</code></pre>
<p>ุฏุฑ ุงู ูุซุงูุ <code>names</code> ฺฉ ุฏูุจุงูู ุงุณุช ู <code>&quot;Tom&quot;</code>, <code>&quot;Dick&quot;</code>, ู <code>&quot;Harry&quot;</code> ุนูุงุตุฑ ุขู ูุณุชูุฏ.
ุจู ุงู ุฏูุจุงูู <strong>ูุญู (local sequence)</strong> ฺฏูุชู ูโุดูุฏ ฺูู ูุฌููุนูโุง ุงุฒ ุงุดุง ุฏุฑ ุญุงูุธู ูุญู ุฑุง ููุงุด ูโุฏูุฏ.</p>
<hr>
<h3>ุนููฺฏุฑูุง ูพุฑุณโูุฌู ๐๏ธ</h3>
<p>ฺฉ <strong>ุนููฺฏุฑ ูพุฑุณโูุฌู (query operator)</strong> ูุชุฏ ุงุณุช ฺฉู ฺฉ ุฏูุจุงูู ุฑุง ุชุบุฑ ูโุฏูุฏ. ฺฉ ุนููฺฏุฑ ูุนูููุ ฺฉ ุฏูุจุงูู ูุฑูุฏ ูโฺฏุฑุฏ ู ฺฉ ุฏูุจุงูู ุฎุฑูุฌ ุชุบุฑ ุงูุชู ุชููุฏ ูโฺฉูุฏ. ุฏุฑ ฺฉูุงุณ <strong>Enumerable</strong> ุฏุฑ <strong>System.Linq</strong> ุญุฏูุฏ ดฐ ุนููฺฏุฑ ูพุฑุณโูุฌู ุงุณุชุงูุฏุงุฑุฏ ูพุงุฏูโุณุงุฒ ุดุฏูโุงูุฏ ฺฉู ููฺฏ ุจูโุตูุฑุช <strong>ูุชุฏูุง ุชูุณุนูโุง (extension methods)</strong> ูุณุชูุฏ.</p>
<p>ูพุฑุณโูุฌููุง ฺฉู ุฑู ุฏูุจุงููโูุง ูุญู ฺฉุงุฑ ูโฺฉููุฏุ <strong>ูพุฑุณโูุฌููุง ูุญู</strong> ุง <strong>LINQ-to-objects</strong> ูุงูุฏู ูโุดููุฏ.</p>
<p>LINQ ููฺูู ุฏูุจุงููโูุง ุฑุง ูพุดุชุจุงู ูโฺฉูุฏ ฺฉู ูโุชูุงููุฏ ุจูโุทูุฑ ูพูุง ุงุฒ ฺฉ ููุจุน ุฏุงุฏู ุฑุงู ุฏูุฑ ูุงููุฏ <strong>SQL Server</strong> ุชุบุฐู ุดููุฏ. ุงู ุฏูุจุงููโูุง ุนูุงูู ุจุฑ <strong>IEnumerable<T></strong>ุ ุฑุงุจุท <strong>IQueryable<T></strong> ุฑุง ูุฒ ูพุงุฏูโุณุงุฒ ูโฺฉููุฏ ู ุงุฒ ุทุฑู ูุฌููุนูโุง ุงุฒ ุนููฺฏุฑูุง ูพุฑุณโูุฌู ุงุณุชุงูุฏุงุฑุฏ ุฏุฑ ฺฉูุงุณ <strong>Queryable</strong> ูพุดุชุจุงู ูโุดููุฏ. ุฌุฒุฆุงุช ุจุดุชุฑ ุฏุฑ ุจุฎุด ยซูพุฑุณโูุฌููุง ุชูุณุฑ ุดุฏู (Interpreted Queries)ยป ุฏุฑ ุตูุญู ดดธ ุขูุฏู ุงุณุช.</p>
<hr>
<h3>ููุดุชู ฺฉ ูพุฑุณโูุฌู ุณุงุฏู โจ</h3>
<p>ฺฉ ูพุฑุณโูุฌู ฺฉ <strong>ุนุจุงุฑุช (expression)</strong> ุงุณุช ฺฉู ููุช ุดูุงุฑุด ูโุดูุฏุ ุฏูุจุงููโูุง ุฑุง ุจุง ุนููฺฏุฑูุง ูพุฑุณโูุฌู ุชุบุฑ ูโุฏูุฏ. ุณุงุฏูโุชุฑู ูพุฑุณโูุฌู ุดุงูู ฺฉ ุฏูุจุงูู ูุฑูุฏ ู ฺฉ ุนููฺฏุฑ ุงุณุช.</p>
<p>ูุซุงู ุฒุฑ ุงุฒ ุนููฺฏุฑ <strong>Where</strong> ุจุฑุง ุงุณุชุฎุฑุงุฌ ุฑุดุชูโูุง ฺฉู ุทูู ุขูโูุง ุญุฏุงูู ฺูุงุฑ ฺฉุงุฑุงฺฉุชุฑ ุงุณุชุ ุงุณุชูุงุฏู ูโฺฉูุฏ:</p>
<pre><code class="language-csharp">string[] names = { &quot;Tom&quot;, &quot;Dick&quot;, &quot;Harry&quot; };
IEnumerable&lt;string&gt; filteredNames = System.Linq.Enumerable.Where(names, n =&gt; n.Length &gt;= 4);
foreach (string n in filteredNames)
    Console.WriteLine(n);
</code></pre>
<p>ุฎุฑูุฌ:</p>
<pre><code>Dick
Harry
</code></pre>
<p>ุงุฒ ุขูุฌุง ฺฉู ุนููฺฏุฑูุง ุงุณุชุงูุฏุงุฑุฏ ูพุฑุณโูุฌู ุจูโุตูุฑุช <strong>extension methods</strong> ูพุงุฏูโุณุงุฒ ุดุฏูโุงูุฏุ ูโุชูุงูู <strong>Where</strong> ุฑุง ูุณุชููุงู ุฑู <code>names</code> ูุฑุงุฎูุงู ฺฉููุ ุงูฺฏุงุฑ ฺฉู ฺฉ ูุชุฏ ููููู ุงุณุช:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; filteredNames = names.Where(n =&gt; n.Length &gt;= 4);
</code></pre>
<p>ุจุฑุง ุงูฺฉู ุงู ฺฉุฏ ฺฉุงููพุงู ุดูุฏุ ุจุงุฏ ูุถุง ูุงู <strong>System.Linq</strong> ุฑุง ูุงุฑุฏ ฺฉูุฏ. ูุซุงู ฺฉุงูู:</p>
<pre><code class="language-csharp">using System;
using System.Collections.Generic;
using System.Linq;

string[] names = { &quot;Tom&quot;, &quot;Dick&quot;, &quot;Harry&quot; };
IEnumerable&lt;string&gt; filteredNames = names.Where(n =&gt; n.Length &gt;= 4);
foreach (string name in filteredNames)
    Console.WriteLine(name);
</code></pre>
<p>ุฎุฑูุฌ:</p>
<pre><code>Dick
Harry
</code></pre>
<p>ูโุชูุงูู ฺฉุฏ ุฑุง ุจุง <strong>ููุนโุฏู ุถูู (implicit typing)</strong> ฺฉูุชุงูโุชุฑ ฺฉูู:</p>
<pre><code class="language-csharp">var filteredNames = names.Where(n =&gt; n.Length &gt;= 4);
</code></pre>
<p>ุงูุง ุงู ฺฉุงุฑ ูโุชูุงูุฏ ุฎูุงูุง ฺฉุฏ ุฑุง ุฏุฑ ุฎุงุฑุฌ ุงุฒ ูุญุท IDE ฺฉุงูุด ุฏูุฏุ ุฒุฑุง ุงุจุฒุงุฑูุง ุฑุงูููุง ูุฌูุฏ ูุฏุงุฑูุฏ. ุจู ููู ุฏูู ุฏุฑ ุงู ูุตู ฺฉูุชุฑ ุงุฒ ููุนโุฏู ุถูู ุงุณุชูุงุฏู ูโฺฉูู.</p>
<hr>
<h3>ุงุณุชูุงุฏู ุงุฒ ุนุจุงุฑุงุช ูุงูุจุฏุง ๐น</h3>
<p>ุงฺฉุซุฑ ุนููฺฏุฑูุง ูพุฑุณโูุฌู ฺฉ <strong>ุนุจุงุฑุช ูุงูุจุฏุง (lambda expression)</strong> ุจูโุนููุงู ุขุฑฺฏููุงู ูโูพุฐุฑูุฏ. ุงู ุนุจุงุฑุช ูุงูุจุฏุง ุจู ูุฏุงุช ู ุดฺฉูโุฏู ูพุฑุณโูุฌู ฺฉูฺฉ ูโฺฉูุฏ.</p>
<p>ุฏุฑ ูุซุงู ูุงุ ุนุจุงุฑุช ูุงูุจุฏุง ุจู ุดฺฉู ุฒุฑ ุงุณุช:</p>
<pre><code class="language-csharp">n =&gt; n.Length &gt;= 4
</code></pre>
<p>ุขุฑฺฏููุงู ูุฑูุฏ <code>n</code> ูุดุงูโุฏููุฏู ูุฑ ุนูุตุฑ ุฏุฑ ุฏูุจุงูู ุงุณุช ู ููุน ุขู <strong>string</strong> ุงุณุช. ุนููฺฏุฑ <strong>Where</strong> ูุงุฒ ุฏุงุฑุฏ ฺฉู ุนุจุงุฑุช ูุงูุจุฏุง ฺฉ ููุฏุงุฑ <strong>bool</strong> ุจุงุฒฺฏุฑุฏุงูุฏุ ุงฺฏุฑ <strong>true</strong> ุจุงุดุฏุ ุนูุตุฑ ุฏุฑ ุฏูุจุงูู ุฎุฑูุฌ ูุฑุงุฑ ูโฺฏุฑุฏ.</p>
<p>ุงูุถุง ุขู:</p>
<pre><code class="language-csharp">public static IEnumerable&lt;TSource&gt; Where&lt;TSource&gt;(
    this IEnumerable&lt;TSource&gt; source, 
    Func&lt;TSource,bool&gt; predicate
)
</code></pre>
<p>ูุซุงู ุจุนุฏุ ุงุณุชุฎุฑุงุฌ ุชูุงู ูุงูโูุง ฺฉู ุดุงูู ุญุฑู &quot;a&quot; ูุณุชูุฏ:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; filteredNames = names.Where(n =&gt; n.Contains(&quot;a&quot;));
foreach (string name in filteredNames)
    Console.WriteLine(name);  // Harry
</code></pre>
<hr>
<h3>ุชุฑฺฉุจ ูพุฑุณโูุฌููุง ู <strong>Fluent Syntax</strong> ๐</h3>
<p>ุชุงฺฉููู ูพุฑุณโูุฌููุง ุฑุง ุจุง <strong>ูุชุฏูุง ุชูุณุนูโุง</strong> ู <strong>ุนุจุงุฑุงุช ูุงูุจุฏุง</strong> ุณุงุฎุชูโุงู. ุงู ุฑูุด ุจุณุงุฑ ูุงุจู ุชุฑฺฉุจ ุงุณุช ู ุงูฺฉุงู ุฒูุฌุฑูโุง ฺฉุฑุฏู ุนููฺฏุฑูุง ูพุฑุณโูุฌู ุฑุง ูุฑุงูู ูโฺฉูุฏ. ุฏุฑ ุงู ฺฉุชุงุจ ุจู ุงู ุฑูุด <strong>Fluent Syntax</strong> ฺฏูุชู ูโุดูุฏ.</p>
<p>C# ููฺูู ฺฉ ูุญู ุฏฺฏุฑ ุจุฑุง ููุดุชู ูพุฑุณโูุฌููุง ุฏุงุฑุฏ ุจู ูุงู <strong>Query Expression Syntax</strong>. ูพุฑุณโูุฌู ูุจู ุจู ุดฺฉู ฺฉ <strong>Query Expression</strong>:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; filteredNames = from n in names
                                    where n.Contains(&quot;a&quot;)
                                    select n;
</code></pre>
<p><strong>Fluent Syntax</strong> ู <strong>Query Syntax</strong> ูฺฉูู ฺฉุฏฺฏุฑ ูุณุชูุฏ. ุฏุฑ ุฏู ุจุฎุด ุจุนุฏุ ูุฑ ฺฉุฏุงู ุฑุง ุจุง ุฌุฒุฆุงุช ุจุดุชุฑ ุจุฑุฑุณ ุฎูุงูู ฺฉุฑุฏ.</p>
<h3>ูุญู Fluent ๐</h3>
<p><strong>Fluent Syntax</strong> ููุนุทูโุชุฑู ู ุจูุงุฏโุชุฑู ูุญู ููุดุชู ูพุฑุณโูุฌููุงุณุช. ุฏุฑ ุงู ุจุฎุดุ ุชูุถุญ ูโุฏูู ฺฺฏููู ุนููฺฏุฑูุง ูพุฑุณโูุฌู ุฑุง ุฒูุฌุฑูโุง ฺฉูู ุชุง ูพุฑุณโูุฌููุง ูพฺุฏูโุชุฑ ุจุณุงุฒู ู ูุดุงู ูโุฏูู ฺุฑุง <strong>extension methods</strong> ุจุฑุง ุงู ูุฑุขูุฏ ุงููุช ุฏุงุฑูุฏ. ููฺูู ุชูุถุญ ูโุฏูู ฺฺฏููู <strong>ุนุจุงุฑุงุช ูุงูุจุฏุง</strong> ุฑุง ุจุฑุง ฺฉ ุนููฺฏุฑ ูพุฑุณโูุฌู ูุฑูููู ฺฉูู ู ฺูุฏ ุนููฺฏุฑ ูพุฑุณโูุฌู ุฌุฏุฏ ุฑุง ูุนุฑู ูโฺฉูู.</p>
<hr>
<h3>ุฒูุฌุฑูโุณุงุฒ ุนููฺฏุฑูุง ูพุฑุณโูุฌู ๐๏ธ</h3>
<p>ุฏุฑ ุจุฎุด ูุจูุ ุฏู ูพุฑุณโูุฌู ุณุงุฏู ูุดุงู ุฏุงุฏู ฺฉู ูุฑฺฉุฏุงู ุชููุง ุดุงูู ฺฉ ุนููฺฏุฑ ูพุฑุณโูุฌู ุจูุฏูุฏ. ุจุฑุง ุณุงุฎุช ูพุฑุณโูุฌููุง ูพฺุฏูโุชุฑุ ุนููฺฏุฑูุง ูพุฑุณโูุฌู ุจุดุชุฑ ุฑุง ุจู ุนุจุงุฑุช ุงุถุงูู ูโฺฉูู ู ฺฉ <strong>ุฒูุฌุฑู</strong> ุงุฌุงุฏ ูโฺฉูู.</p>
<p>ูุซุงู ุฒุฑ ุชูุงู ุฑุดุชูโูุง ฺฉู ุดุงูู ุญุฑู &quot;a&quot; ูุณุชูุฏ ุฑุง ุงุณุชุฎุฑุงุฌ ฺฉุฑุฏูุ ุจุฑ ุงุณุงุณ ุทูู ูุฑุชุจ ูโฺฉูุฏ ู ุณูพุณ ูุชุฌู ุฑุง ุจู ุญุฑูู ุจุฒุฑฺฏ ุชุจุฏู ูโฺฉูุฏ:</p>
<pre><code class="language-csharp">using System;
using System.Collections.Generic;
using System.Linq;

string[] names = { &quot;Tom&quot;, &quot;Dick&quot;, &quot;Harry&quot;, &quot;Mary&quot;, &quot;Jay&quot; };
IEnumerable&lt;string&gt; query = names
    .Where(n =&gt; n.Contains(&quot;a&quot;))
    .OrderBy(n =&gt; n.Length)
    .Select(n =&gt; n.ToUpper());

foreach (string name in query)
    Console.WriteLine(name);
</code></pre>
<p>ุฎุฑูุฌ:</p>
<pre><code>JAY
MARY
HARRY
</code></pre>
<hr>
<h3>ูุญุฏูุฏู ูุชุบุฑูุง ูุงูุจุฏุง ๐น</h3>
<p>ูุชุบุฑ <code>n</code> ุฏุฑ ูุซุงู ูุง ุจูโุตูุฑุช ุฎุตูุต ุฏุฑ ูุฑ ุนุจุงุฑุช ูุงูุจุฏุง ูุญุฏูุฏูโุจูุฏ ุดุฏู ุงุณุช. ูโุชูุงูู ููู ุดูุงุณู <code>n</code> ุฑุง ุฏูุจุงุฑู ุงุณุชูุงุฏู ฺฉููุ ูุดุงุจู ุงูฺฉู ูโุชูุงูู ุดูุงุณู <code>c</code> ุฑุง ุฏุฑ ูุซุงู ุฒุฑ ุฏูุจุงุฑู ุงุณุชูุงุฏู ฺฉูู:</p>
<pre><code class="language-csharp">void Test()
{
    foreach (char c in &quot;string1&quot;) Console.Write(c);
    foreach (char c in &quot;string2&quot;) Console.Write(c);
    foreach (char c in &quot;string3&quot;) Console.Write(c);
}
</code></pre>
<hr>
<h3>ุนููฺฉุฑุฏ ุนููฺฏุฑูุง ุงุณุชุงูุฏุงุฑุฏ ูพุฑุณโูุฌู โ๏ธ</h3>
<ul>
<li><strong>Where</strong>: ูุณุฎู ููุชุฑุดุฏู ุฏูุจุงูู ูุฑูุฏ ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ.</li>
<li><strong>OrderBy</strong>: ูุณุฎู ูุฑุชุจโุดุฏู ุฏูุจุงูู ูุฑูุฏ ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ.</li>
<li><strong>Select</strong>: ุฏูุจุงููโุง ุจุงุฒูโฺฏุฑุฏุงูุฏ ฺฉู ูุฑ ุนูุตุฑ ูุฑูุฏ ุจุง ุนุจุงุฑุช ูุงูุจุฏุง ุฏุงุฏู ุดุฏู ุชุจุฏู ุง ูฺฏุงุดุช ุดุฏู ุงุณุช (ุฏุฑ ุงู ูุซุงู <code>n.ToUpper()</code>).</li>
</ul>
<p>ุฏุงุฏูโูุง ุงุฒ ฺูพ ุจู ุฑุงุณุช ุงุฒ ุทุฑู ุฒูุฌุฑู ุนููฺฏุฑูุง ุฌุฑุงู ูโุงุจูุฏุ ุงุจุชุฏุง ููุชุฑ ูโุดููุฏุ ุณูพุณ ูุฑุชุจุ ู ุฏุฑ ููุงุช ูฺฏุงุดุช ูโุดููุฏ.</p>
<p>ฺฉ ุนููฺฏุฑ ูพุฑุณโูุฌู ูุฑฺฏุฒ ุฏูุจุงูู ูุฑูุฏ ุฑุง ุชุบุฑ ููโุฏูุฏุ ุจูฺฉู ฺฉ ุฏูุจุงูู ุฌุฏุฏ ุจุฑูโฺฏุฑุฏุงูุฏ. ุงู ุฑูุชุงุฑ ุจุง <strong>ุงูฺฏู ุจุฑูุงููโููุณ ุชุงุจุน (functional programming)</strong> ฺฉู ุงููุงูโุจุฎุด LINQ ุจูุฏูุ ููุฎูุงู ุฏุงุฑุฏ.</p>
<hr>
<h3>ุงูุถุง ูุชุฏูุง ุชูุณุนูโุง โ๏ธ</h3>
<p>ุงูุถุง ุงู ูุชุฏูุง ุชูุณุนูโุง ุจูโุตูุฑุช ุฒุฑ ุงุณุช (ุงูุถุง <strong>OrderBy</strong> ฺฉู ุณุงุฏู ุดุฏู):</p>
<pre><code class="language-csharp">public static IEnumerable&lt;TSource&gt; Where&lt;TSource&gt;(
    this IEnumerable&lt;TSource&gt; source, 
    Func&lt;TSource,bool&gt; predicate
)

public static IEnumerable&lt;TSource&gt; OrderBy&lt;TSource,TKey&gt;(
    this IEnumerable&lt;TSource&gt; source, 
    Func&lt;TSource,TKey&gt; keySelector
)

public static IEnumerable&lt;TResult&gt; Select&lt;TSource,TResult&gt;(
    this IEnumerable&lt;TSource&gt; source, 
    Func&lt;TSource,TResult&gt; selector
)
</code></pre>
<hr>
<p>ููุช ุนููฺฏุฑูุง ูพุฑุณโูุฌู ุจูโุตูุฑุช ุฒูุฌุฑูโุง ุงุณุชูุงุฏู ูโุดููุฏุ ุฏูุจุงูู ุฎุฑูุฌ ฺฉ ุนููฺฏุฑุ ุฏูุจุงูู ูุฑูุฏ ุนููฺฏุฑ ุจุนุฏ ุงุณุช. ูพุฑุณโูุฌู ฺฉุงูู ุดุจู ฺฉ <strong>ุฎุท ุชููุฏ ุจุง ููุงุฑ ููุงูู</strong> ุงุณุชุ ููุงูโุทูุฑ ฺฉู ุฏุฑ ุดฺฉู ธ-ฑ ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช.</p>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-1.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>ูโุชูุงูู ููุงู ูพุฑุณโูุฌู ูุจู ุฑุง ุจูโุตูุฑุช ูุฑุญููโุง ุจุณุงุฒูุ ุจู ุงู ุดฺฉู:</p>
<pre><code class="language-csharp">// ุจุฑุง ฺฉุงููพุงู ุดุฏูุ ุจุงุฏ ูุถุง ูุงู System.Linq ุฑุง ูุงุฑุฏ ฺฉูุฏ:
IEnumerable&lt;string&gt; filtered   = names   .Where   (n =&gt; n.Contains(&quot;a&quot;));
IEnumerable&lt;string&gt; sorted     = filtered.OrderBy (n =&gt; n.Length);
IEnumerable&lt;string&gt; finalQuery = sorted  .Select  (n =&gt; n.ToUpper());
</code></pre>
<p><code>finalQuery</code> ุงุฒ ูุธุฑ ุชุฑฺฉุจ <strong>ฺฉุงููุงู ูุดุงุจู</strong> ูพุฑุณโูุฌู ุงุณุช ฺฉู ูุจูุงู ุณุงุฎุชูโุงู.</p>
<p>ุนูุงูู ุจุฑ ุงูุ ูุฑ ูุฑุญูู ูุงู ูุฒ ฺฉ ูพุฑุณโูุฌู ูุนุชุจุฑ ุงุณุช ฺฉู ูโุชูุงูู ุงุฌุฑุง ฺฉูู:</p>
<pre><code class="language-csharp">foreach (string name in filtered)
    Console.Write(name + &quot;|&quot;);        // Harry|Mary|Jay|
Console.WriteLine();

foreach (string name in sorted)
    Console.Write(name + &quot;|&quot;);        // Jay|Mary|Harry|
Console.WriteLine();

foreach (string name in finalQuery)
    Console.Write(name + &quot;|&quot;);        // JAY|MARY|HARRY|
</code></pre>
<hr>
<h3>ุงููุช <strong>extension methods</strong> โญ</h3>
<p>ุจู ุฌุง ุงุณุชูุงุฏู ุงุฒ ูุญู <strong>extension method</strong>ุ ูโุชูุงู ุงุฒ ูุญู ูุชุฏ ุงุณุชุง (<strong>static method syntax</strong>) ุจุฑุง ูุฑุงุฎูุงู ุนููฺฏุฑูุง ูพุฑุณโูุฌู ุงุณุชูุงุฏู ฺฉุฑุฏ:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; filtered = Enumerable.Where(names, n =&gt; n.Contains(&quot;a&quot;));
IEnumerable&lt;string&gt; sorted   = Enumerable.OrderBy(filtered, n =&gt; n.Length);
IEnumerable&lt;string&gt; finalQuery = Enumerable.Select(sorted, n =&gt; n.ToUpper());
</code></pre>
<p>ุฏุฑ ูุงูุนุ <strong>ฺฉุงููพุงูุฑ</strong> ููู ุชุฑุฌูู ุฑุง ุจุฑุง ูุฑุงุฎูุงู ูุชุฏูุง ุชูุณุนูโุง ุงูุฌุงู ูโุฏูุฏ.</p>
<p>ุงูุง ุงฺฏุฑ ุจุฎูุงูุฏ ูพุฑุณโูุฌู ุฑุง ุฏุฑ ฺฉ <strong>ุนุจุงุฑุช ูุงุญุฏ</strong> ุจููุณุฏุ ุงุณุชูุงุฏู ูฺฉุฑุฏู ุงุฒ <strong>extension methods</strong> ูุฒููโุจุฑ ุฎูุงูุฏ ุจูุฏ.</p>
<hr>
<h4>ูพุฑุณโูุฌู ฺฉโุนุจุงุฑุช ุจุง <strong>extension method syntax</strong></h4>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query = names.Where(n =&gt; n.Contains(&quot;a&quot;))
                                 .OrderBy(n =&gt; n.Length)
                                 .Select(n =&gt; n.ToUpper());
</code></pre>
<p>ุดฺฉู ุทุจุน ู ุฎุท ุขู ุฌุฑุงู ุฏุงุฏู ุงุฒ <strong>ฺูพ ุจู ุฑุงุณุช</strong> ุฑุง ูุดุงู ูโุฏูุฏ ู ููฺูู ุนุจุงุฑุงุช ูุงูุจุฏุง ุฑุง ฺฉูุงุฑ ุนููฺฏุฑูุง ูพุฑุณโูุฌู ูฺฏู ูโุฏุงุฑุฏ (<strong>infix notation</strong>).</p>
<p>ุจุฏูู <strong>extension methods</strong>ุ ุฑูุงู ูพุฑุณโูุฌู ุงุฒ ุจู ูโุฑูุฏ:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query =
    Enumerable.Select(
        Enumerable.OrderBy(
            Enumerable.Where(
                names, n =&gt; n.Contains(&quot;a&quot;)
            ), n =&gt; n.Length
        ), n =&gt; n.ToUpper()
    );
</code></pre>
<hr>
<h3>ุชุฑฺฉุจ ุนุจุงุฑุงุช ูุงูุจุฏุง ๐น</h3>
<p>ุฏุฑ ูุซุงูโูุง ูุจูุ ุนุจุงุฑุช ูุงูุจุฏุง ุฒุฑ ุจู <strong>ุนููฺฏุฑ Where</strong> ุฏุงุฏู ุดุฏู ุจูุฏ:</p>
<pre><code class="language-csharp">n =&gt; n.Contains(&quot;a&quot;)   // ููุน ูุฑูุฏ = stringุ ููุน ุฎุฑูุฌ = bool
</code></pre>
<p>ฺฉ ุนุจุงุฑุช ูุงูุจุฏุง ฺฉู ฺฉ ููุฏุงุฑ ูโฺฏุฑุฏ ู <strong>bool</strong> ุจุฑูโฺฏุฑุฏุงูุฏุ <strong>predicate</strong> ูุงูุฏู ูโุดูุฏ.</p>
<p>ูุฏู ุนุจุงุฑุช ูุงูุจุฏุง ุจู ุนููฺฏุฑ ูพุฑุณโูุฌู ุจุณุชฺฏ ุฏุงุฑุฏ:</p>
<ul>
<li>ุจุง <strong>Where</strong>ุ ูุดุงู ูโุฏูุฏ ฺฉู ุขุง ฺฉ ุนูุตุฑ ุจุงุฏ ุฏุฑ ุฏูุจุงูู ุฎุฑูุฌ ุจุงุดุฏ ุง ูู.</li>
<li>ุจุง <strong>OrderBy</strong>ุ ุนูุตุฑ ูุฑูุฏ ุฑุง ุจู ฺฉูุฏ ูุฑุชุจโุณุงุฒ ุขู ูฺฏุงุดุช ูโฺฉูุฏ.</li>
<li>ุจุง <strong>Select</strong>ุ ุชุนู ูโฺฉูุฏ ูุฑ ุนูุตุฑ ูุฑูุฏ ูุจู ุงุฒ ุงุฑุณุงู ุจู ุฏูุจุงูู ุฎุฑูุฌ ฺฺฏููู ุชุจุฏู ุดูุฏ.</li>
</ul>
<p>ฺฉ ุนุจุงุฑุช ูุงูุจุฏุง ููุดู ุฑู <strong>ุนูุงุตุฑ ูุฑุฏ</strong> ุฏูุจุงูู ูุฑูุฏ ฺฉุงุฑ ูโฺฉูุฏุ ูู ุฑู ุฏูุจุงูู ุจูโุตูุฑุช ฺฉู.</p>
<hr>
<h3>ูุญูู ุงุฑุฒุงุจ ูุงูุจุฏุง</h3>
<p>ุนููฺฏุฑ ูพุฑุณโูุฌู ุนุจุงุฑุช ูุงูุจุฏุง ุดูุง ุฑุง <strong>ุจูโุตูุฑุช ุชูุจู ู ุฏุฑ ุฒูุงู ูุงุฒ</strong> ุงุฑุฒุงุจ ูโฺฉูุฏุ ูุนูููุงู ฺฉ ุจุงุฑ ุจุฑุง ูุฑ ุนูุตุฑ ุฏูุจุงูู ูุฑูุฏ.</p>
<p>ุนุจุงุฑุงุช ูุงูุจุฏุง ุจู ุดูุง ุงุฌุงุฒู ูโุฏููุฏ ููุทู ุฎูุฏ ุฑุง ุจู ุนููฺฏุฑูุง ูพุฑุณโูุฌู ููุชูู ฺฉูุฏุ ฺฉู ุจุงุนุซ ุงูุนุทุงูโูพุฐุฑ ุขูโูุง ูโุดูุฏุ ุฏุฑ ุญุงู ฺฉู ุณุงุฎุชุงุฑ ุฏุงุฎู ุณุงุฏู ุจุงู ูโูุงูุฏ.</p>
<p>ูููููโุง ุงุฒ ูพุงุฏูโุณุงุฒ ฺฉุงูู <strong>Enumerable.Where</strong> (ุจู ุฌุฒ ูุฏุฑุช ุงุณุชุซูุงูุง):</p>
<pre><code class="language-csharp">public static IEnumerable&lt;TSource&gt; Where&lt;TSource&gt;(
    this IEnumerable&lt;TSource&gt; source, 
    Func&lt;TSource,bool&gt; predicate
)
{
    foreach (TSource element in source)
        if (predicate(element))
            yield return element;
}
</code></pre>
<hr>
<h3>ุนุจุงุฑุงุช ูุงูุจุฏุง ู ุงูุถุง <strong>Func</strong> โ๏ธ</h3>
<p>ุนููฺฏุฑูุง ุงุณุชุงูุฏุงุฑุฏ ูพุฑุณโูุฌู ุงุฒ <strong>generic Func delegates</strong> ุงุณุชูุงุฏู ูโฺฉููุฏ.
<strong>Func</strong> ฺฉ ุฎุงููุงุฏู ุงุฒ ุฏูฺฏุชโูุง ุนููู ุฏุฑ ูุถุง ูุงู <strong>System</strong> ุงุณุช ฺฉู ุจุง ูุฏู ุฒุฑ ุชุนุฑู ุดุฏูโุงูุฏ:</p>
<ul>
<li>ุขุฑฺฏููุงูโูุง ููุน (<strong>type arguments</strong>) ุฏุฑ <strong>Func</strong> ููุงู ุชุฑุชุจ ุฑุง ุฏุงุฑูุฏ ฺฉู ุฏุฑ ุนุจุงุฑุงุช ูุงูุจุฏุง ุงุณุชูุงุฏู ูโุดููุฏ.</li>
<li>ุจูุงุจุฑุงูุ <strong>Func&lt;TSource,bool&gt;</strong> ุจุง ูุงูุจุฏุง <strong>TSource =&gt; bool</strong> ูุทุงุจูุช ุฏุงุฑุฏ: ฺฉ ุขุฑฺฏููุงู TSource ูโฺฏุฑุฏ ู ฺฉ ููุฏุงุฑ bool ุจุงุฒูโฺฏุฑุฏุงูุฏ.</li>
<li>ุจูโุทูุฑ ูุดุงุจูุ <strong>Func&lt;TSource,TResult&gt;</strong> ุจุง ูุงูุจุฏุง <strong>TSource =&gt; TResult</strong> ูุทุงุจูุช ุฏุงุฑุฏ.</li>
</ul>
<p>ูุณุช ุฏูฺฏุชโูุง <strong>Func</strong> ุฏุฑ ุจุฎุด ยซLambda Expressionsยป ุฏุฑ ุตูุญู ฑธธ ุขูุฏู ุงุณุช.</p>
<hr>
<h3>ุนุจุงุฑุงุช ูุงูุจุฏุง ู ููุนโุฏู ุนูุงุตุฑ</h3>
<p>ุนููฺฏุฑูุง ุงุณุชุงูุฏุงุฑุฏ ูพุฑุณโูุฌู ุงุฒ ูุงูโูุง ูพุงุฑุงูุชุฑ ููุน (<strong>type parameter names</strong>) ุฒุฑ ุงุณุชูุงุฏู ูโฺฉููุฏ:</p>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-2.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<h3>ููุนโุฏู ุนูุงุตุฑ ุฏุฑ ุนุจุงุฑุงุช ูุงูุจุฏุง ๐ฏ</h3>
<p><strong>TSource</strong> ุชูุณุท ุฏูุจุงูู ูุฑูุฏ ุชุนู ูโุดูุฏ. <strong>TResult</strong> ู <strong>TKey</strong> ูุนูููุงู ุงุฒ ุฑู ุนุจุงุฑุช ูุงูุจุฏุง ุดูุง ุงุณุชูุชุงุฌ ูโุดููุฏ.</p>
<p>ุจุฑุง ูุซุงูุ ุจู ุงูุถุง ุนููฺฏุฑ ูพุฑุณโูุฌู <strong>Select</strong> ุชูุฌู ฺฉูุฏ:</p>
<pre><code class="language-csharp">public static IEnumerable&lt;TResult&gt; Select&lt;TSource,TResult&gt;(
    this IEnumerable&lt;TSource&gt; source, 
    Func&lt;TSource,TResult&gt; selector
)
</code></pre>
<p>ุนุจุงุฑุช ูุงูุจุฏุง <strong>Func&lt;TSource,TResult&gt;</strong> ุจุง ูุงูุจุฏุง <strong>TSource =&gt; TResult</strong> ูุทุงุจูุช ุฏุงุฑุฏ: ุนูุตุฑ ุงุฒ ููุน ูุฑูุฏ ุฑุง ุจู ุนูุตุฑ ุงุฒ ููุน ุฎุฑูุฌ ูฺฏุงุดุช ูโฺฉูุฏ. <strong>TSource</strong> ู <strong>TResult</strong> ูโุชูุงููุฏ ููุนโูุง ูุชูุงูุช ุฏุงุดุชู ุจุงุดูุฏุ ุจูุงุจุฑุงู ูุงูุจุฏุง ูโุชูุงูุฏ ููุน ูุฑ ุนูุตุฑ ุฑุง ุชุบุฑ ุฏูุฏ. ุนูุงูู ุจุฑ ุงูุ ููุน ุฏูุจุงูู ุฎุฑูุฌ ุชูุณุท ูุงูุจุฏุง ุชุนู ูโุดูุฏ.</p>
<p>ูุซุงู ุฒุฑ ุงุฒ <strong>Select</strong> ุจุฑุง ุชุจุฏู ุนูุงุตุฑ ุฑุดุชูโุง ุจู ุนูุงุตุฑ ุนุฏุฏ ุตุญุญ ุงุณุชูุงุฏู ูโฺฉูุฏ:</p>
<pre><code class="language-csharp">string[] names = { &quot;Tom&quot;, &quot;Dick&quot;, &quot;Harry&quot;, &quot;Mary&quot;, &quot;Jay&quot; };
IEnumerable&lt;int&gt; query = names.Select(n =&gt; n.Length);

foreach (int length in query)
    Console.Write(length + &quot;|&quot;);   // 3|4|5|4|3|
</code></pre>
<p>ฺฉุงููพุงูุฑ ููุน <strong>TResult</strong> ุฑุง ุงุฒ ููุฏุงุฑ ุจุงุฒฺฏุดุช ูุงูุจุฏุง ุงุณุชูุชุงุฌ ูโฺฉูุฏ. ุฏุฑ ุงู ูุซุงูุ <code>n.Length</code> ฺฉ ููุฏุงุฑ <strong>int</strong> ุจุฑูโฺฏุฑุฏุงูุฏุ ุจูุงุจุฑุงู <strong>TResult</strong> ุจุฑุงุจุฑ ุจุง <strong>int</strong> ุงุณุช.</p>
<hr>
<p>ุนููฺฏุฑ <strong>Where</strong> ุณุงุฏูโุชุฑ ุงุณุช ู ูุงุฒ ุจู ุงุณุชูุชุงุฌ ููุน ุจุฑุง ุฎุฑูุฌ ูุฏุงุฑุฏุ ุฒุฑุง ุนูุงุตุฑ ูุฑูุฏ ู ุฎุฑูุฌ ุงุฒ ฺฉ ููุน ูุณุชูุฏ. ุงู ููุทู ุงุณุช ฺูู ุงู ุนููฺฏุฑ ููุท ุนูุงุตุฑ ุฑุง ููุชุฑ ูโฺฉูุฏ ู ุขูโูุง ุฑุง ุชุจุฏู ููโฺฉูุฏ:</p>
<pre><code class="language-csharp">public static IEnumerable&lt;TSource&gt; Where&lt;TSource&gt;(
    this IEnumerable&lt;TSource&gt; source, 
    Func&lt;TSource,bool&gt; predicate
)
</code></pre>
<hr>
<h3>ุงูุถุง ุนููฺฏุฑ <strong>OrderBy</strong> ๐</h3>
<pre><code class="language-csharp">// ฺฉู ุณุงุฏู ุดุฏู
public static IEnumerable&lt;TSource&gt; OrderBy&lt;TSource,TKey&gt;(
    this IEnumerable&lt;TSource&gt; source, 
    Func&lt;TSource,TKey&gt; keySelector
)
</code></pre>
<p>ุนุจุงุฑุช ูุงูุจุฏุง <strong>Func&lt;TSource,TKey&gt;</strong> ฺฉ ุนูุตุฑ ูุฑูุฏ ุฑุง ุจู <strong>ฺฉูุฏ ูุฑุชุจโุณุงุฒ (sorting key)</strong> ูฺฏุงุดุช ูโฺฉูุฏ. <strong>TKey</strong> ุงุฒ ุฑู ูุงูุจุฏุง ุงุณุชูุชุงุฌ ูโุดูุฏ ู ุงุฒ ููุน ุนูุตุฑ ูุฑูุฏ ู ุฎุฑูุฌ ุฌุฏุงุณุช.</p>
<p>ุจุฑุง ูุซุงูุ ูโุชูุงูู ูุณุช ูุงูโูุง ุฑุง ุจุฑ ุงุณุงุณ ุทูู (<strong>ฺฉูุฏ int</strong>) ุง ุจูโุตูุฑุช ุงููุจุง (<strong>ฺฉูุฏ string</strong>) ูุฑุชุจ ฺฉูู:</p>
<pre><code class="language-csharp">string[] names = { &quot;Tom&quot;, &quot;Dick&quot;, &quot;Harry&quot;, &quot;Mary&quot;, &quot;Jay&quot; };
IEnumerable&lt;string&gt; sortedByLength, sortedAlphabetically;

sortedByLength       = names.OrderBy(n =&gt; n.Length);   // int key
sortedAlphabetically = names.OrderBy(n =&gt; n);          // string key
</code></pre>
<p>ูโุชูุงู ุนููฺฏุฑูุง ูพุฑุณโูุฌู ุฏุฑ <strong>Enumerable</strong> ุฑุง ุจุง <strong>delegateูุง ุณูุช</strong> ฺฉู ุจู ูุชุฏูุง ุงุดุงุฑู ุฏุงุฑูุฏุ ูุฑุงุฎูุงู ฺฉุฑุฏ. ุงู ุฑูุด ุจุฑุง ุณุงุฏู ฺฉุฑุฏู ุจุฑุฎ ูพุฑุณโูุฌููุง ูุญูุ ุจูโูฺู ุฏุฑ <strong>LINQ to XML</strong> ููุฏ ุงุณุช ู ุฏุฑ ูุตู ฑฐ ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช.</p>
<p>ุงูุง ุงู ุฑูุด ุฏุฑ ุฏูุจุงููโูุง ูุจุชู ุจุฑ <strong>IQueryable<T></strong> (ูุซูุงู ููฺฏุงู ูพุฑุณโูุฌู ุงุฒ ูพุงฺฏุงู ุฏุงุฏู) ฺฉุงุฑ ููโฺฉูุฏุ ุฒุฑุง ุนููฺฏุฑูุง <strong>Queryable</strong> ูุงุฒ ุจู ุนุจุงุฑุงุช ูุงูุจุฏุง ุฏุงุฑูุฏ ุชุง ุจุชูุงููุฏ <strong>expression tree</strong> ุชููุฏ ฺฉููุฏ. ุงู ููุถูุน ุจุนุฏุงู ุฏุฑ ุจุฎุด ยซูพุฑุณโูุฌููุง ุชูุณุฑ ุดุฏูยป ุตูุญู ดดธ ุชูุถุญ ุฏุงุฏู ูโุดูุฏ.</p>
<hr>
<h3>ุชุฑุชุจ ุทุจุน ุนูุงุตุฑ ๐</h3>
<p>ุชุฑุชุจ ุงุตู ุนูุงุตุฑ ุฏุฑ ุฏูุจุงูู ูุฑูุฏ ุฏุฑ LINQ ุงููุช ุฏุงุฑุฏ. ุจุฑุฎ ุนููฺฏุฑูุง ุจู ุงู ุชุฑุชุจ ูุงุจุณุชูโุงูุฏุ ูุงููุฏ <strong>Take</strong>ุ <strong>Skip</strong> ู <strong>Reverse</strong>:</p>
<ul>
<li><strong>Take</strong>: ุงููู x ุนูุตุฑ ุฑุง ุฎุฑูุฌ ูโุฏูุฏ ู ุจูู ุฑุง ุญุฐู ูโฺฉูุฏ:</li>
</ul>
<pre><code class="language-csharp">int[] numbers = { 10, 9, 8, 7, 6 };
IEnumerable&lt;int&gt; firstThree = numbers.Take(3);   // {10, 9, 8}
</code></pre>
<ul>
<li><strong>Skip</strong>: x ุนูุตุฑ ุงูู ุฑุง ูุงุฏุฏู ูโฺฏุฑุฏ ู ุจูู ุฑุง ุฎุฑูุฌ ูโุฏูุฏ:</li>
</ul>
<pre><code class="language-csharp">IEnumerable&lt;int&gt; lastTwo = numbers.Skip(3);     // {7, 6}
</code></pre>
<ul>
<li><strong>Reverse</strong>: ุนูุงุตุฑ ุฑุง ุจุฑุนฺฉุณ ูโฺฉูุฏ:</li>
</ul>
<pre><code class="language-csharp">IEnumerable&lt;int&gt; reversed = numbers.Reverse();  // {6, 7, 8, 9, 10}
</code></pre>
<p>ุฏุฑ ูพุฑุณโูุฌููุง ูุญู (<strong>LINQ-to-objects</strong>)ุ ุนููฺฏุฑูุง ูุงููุฏ <strong>Where</strong> ู <strong>Select</strong> ุชุฑุชุจ ุงุตู ุฏูุจุงูู ูุฑูุฏ ุฑุง ุญูุธ ูโฺฉููุฏ (ููฺูู ููู ุนููฺฏุฑูุง ุฏฺฏุฑุ ูฺฏุฑ ุขูโูุง ฺฉู ุตุฑุงุญุชุงู ุชุฑุชุจ ุฑุง ุชุบุฑ ูโุฏููุฏ).</p>
<hr>
<h3>ุณุงุฑ ุนููฺฏุฑูุง ๐น</h3>
<p>ููู ุนููฺฏุฑูุง ูพุฑุณโูุฌู ฺฉ ุฏูุจุงูู ุจุฑููโฺฏุฑุฏุงููุฏ.</p>
<ul>
<li><strong>ุนููฺฏุฑูุง ุนูุตุฑ (element operators)</strong> ฺฉ ุนูุตุฑ ุงุฒ ุฏูุจุงูู ูุฑูุฏ ุงุณุชุฎุฑุงุฌ ูโฺฉููุฏุ ูุงููุฏ <strong>First</strong>ุ <strong>Last</strong> ู <strong>ElementAt</strong>:</li>
</ul>
<pre><code class="language-csharp">int[] numbers    = { 10, 9, 8, 7, 6 };
int firstNumber  = numbers.First();          // 10
int lastNumber   = numbers.Last();           // 6
int secondNumber = numbers.ElementAt(1);     // 9
int secondLowest = numbers.OrderBy(n =&gt; n).Skip(1).First(); // 7
</code></pre>
<p>ุงู ุนููฺฏุฑูุง ูุนูููุงู ุฎุฑูุฌ ุฎูุฏ ุฑุง ุจุฑุง ุงุฌุฑุง ุนููฺฏุฑูุง ุฏฺฏุฑ ูุฑุงุฎูุงู ููโฺฉููุ ูฺฏุฑ ุขู ุนูุตุฑ ุฎูุฏุด ฺฉ ูุฌููุนู ุจุงุดุฏ.</p>
<ul>
<li><strong>ุนููฺฏุฑูุง ุชุฌูุน (aggregation operators)</strong> ฺฉ ููุฏุงุฑ ุงุณฺฉุงูุฑุ ูุนูููุงู ุนุฏุฏุ ุจุฑูโฺฏุฑุฏุงููุฏ:</li>
</ul>
<pre><code class="language-csharp">int count = numbers.Count();   // 5
int min   = numbers.Min();     // 6
</code></pre>
<ul>
<li><strong>ุนููฺฏุฑูุง ฺฉู (quantifiers)</strong> ููุฏุงุฑ <strong>bool</strong> ุจุฑูโฺฏุฑุฏุงููุฏ:</li>
</ul>
<pre><code class="language-csharp">bool hasTheNumberNine     = numbers.Contains(9);          // true
bool hasMoreThanZeroElements = numbers.Any();            // true
bool hasAnOddElement      = numbers.Any(n =&gt; n % 2 != 0); // true
</code></pre>
<ul>
<li>ุจุฑุฎ ุนููฺฏุฑูุง ุฏู ุฏูุจุงูู ูุฑูุฏ ูโฺฏุฑูุฏุ ูุงููุฏ <strong>Concat</strong> ฺฉู ฺฉ ุฏูุจุงูู ุฑุง ุจู ุฏฺฏุฑ ุงุถุงูู ูโฺฉูุฏ ู <strong>Union</strong> ฺฉู ูุดุงุจู ุขู ุงุณุช ุงูุง ููุงุฏุฑ ุชฺฉุฑุงุฑ ุฑุง ุญุฐู ูโฺฉูุฏ:</li>
</ul>
<pre><code class="language-csharp">int[] seq1 = {1, 2, 3};
int[] seq2 = {3, 4, 5};
IEnumerable&lt;int&gt; concat = seq1.Concat(seq2);  // {1, 2, 3, 3, 4, 5}
IEnumerable&lt;int&gt; union  = seq1.Union(seq2);   // {1, 2, 3, 4, 5}
</code></pre>
<ul>
<li><strong>ุนููฺฏุฑูุง ุงุชุตุงู (joining operators)</strong> ูุฒ ุฏุฑ ููู ุฏุณุชู ูุฑุงุฑ ูโฺฏุฑูุฏ. ูุตู น ุชูุงู ุนููฺฏุฑูุง ูพุฑุณโูุฌู ุฑุง ุจูโุชูุตู ูพูุดุด ูโุฏูุฏ.</li>
</ul>
<h3>ุนุจุงุฑุงุช ูพุฑุณโูุฌู (Query Expressions) ๐</h3>
<p>C# ฺฉ <strong>ูุงูโุจุฑ ูุญู</strong> ุจุฑุง ููุดุชู ูพุฑุณโูุฌููุง LINQ ูุฑุงูู ูโฺฉูุฏ ฺฉู ุจู ุขู <strong>query expressions</strong> ฺฏูุชู ูโุดูุฏ. ุจุฑุฎูุงู ุชุตูุฑ ุฑุงุฌุ ุนุจุงุฑุช ูพุฑุณโูุฌู <strong>ุนู SQL ุฏุงุฎู C#</strong> ูุณุช. ุฏุฑ ูุงูุนุ ุทุฑุงุญ <strong>query expressions</strong> ุนูุฏุชุงู ุงุฒ <strong>list comprehensions</strong> ุฏุฑ ุฒุจุงูโูุง ุจุฑูุงููโููุณ ุชุงุจุน ูุงููุฏ <strong>LISP</strong> ู <strong>Haskell</strong> ุงููุงู ฺฏุฑูุชู ุดุฏู ุงุณุชุ ูุฑฺูุฏ SQL ูู ฺฉู ุชุฃุซุฑ ุธุงูุฑ ุฏุงุดุชู ุงุณุช.</p>
<p>ุฏุฑ ุงู ฺฉุชุงุจุ ูุญู <strong>query expressions</strong> ุฑุง ุจู ุณุงุฏฺฏ <strong>query syntax</strong> ูโูุงูู.</p>
<hr>
<p>ุฏุฑ ุจุฎุด ูุจูุ ูพุฑุณโูุฌู ุจุง <strong>Fluent Syntax</strong> ููุดุชู ุชุง ุฑุดุชูโูุง ฺฉู ุดุงูู ุญุฑู &quot;a&quot; ูุณุชูุฏ ุฑุง ุงุณุชุฎุฑุงุฌ ฺฉุฑุฏูุ ุจุฑ ุงุณุงุณ ุทูู ูุฑุชุจ ฺฉูู ู ุจู ุญุฑูู ุจุฒุฑฺฏ ุชุจุฏู ฺฉูู. ููุงู ูพุฑุณโูุฌู ุจู ุดฺฉู <strong>query syntax</strong> ุจู ุงู ุตูุฑุช ุงุณุช:</p>
<pre><code class="language-csharp">using System;
using System.Collections.Generic;
using System.Linq;

string[] names = { &quot;Tom&quot;, &quot;Dick&quot;, &quot;Harry&quot;, &quot;Mary&quot;, &quot;Jay&quot; };

IEnumerable&lt;string&gt; query =
    from    n in names
    where   n.Contains(&quot;a&quot;)     // ููุชุฑ ฺฉุฑุฏู ุนูุงุตุฑ
    orderby n.Length             // ูุฑุชุจโุณุงุฒ ุนูุงุตุฑ
    select  n.ToUpper();         // ุชุจุฏู ูุฑ ุนูุตุฑ (projection)

foreach (string name in query)
    Console.WriteLine(name);
</code></pre>
<p>ุฎุฑูุฌ:</p>
<pre><code>JAY
MARY
HARRY
</code></pre>
<hr>
<h3>ุณุงุฎุชุงุฑ ุนุจุงุฑุงุช ูพุฑุณโูุฌู ๐๏ธ</h3>
<p>ุนุจุงุฑุงุช ูพุฑุณโูุฌู ููุดู ุจุง <strong>from</strong> ุดุฑูุน ู ุจุง <strong>select</strong> ุง <strong>group</strong> ูพุงุงู ูโุงุจูุฏ.</p>
<ul>
<li><strong>from</strong> ฺฉ <strong>ูุชุบุฑ ุฏุงููู (range variable)</strong> ุชุนุฑู ูโฺฉูุฏ (ุฏุฑ ุงู ูุซุงู <code>n</code>) ฺฉู ูุงููุฏ ฺฉ ุญููู <code>foreach</code>ุ ุฏูุจุงูู ูุฑูุฏ ุฑุง ูพูุงุด ูโฺฉูุฏ.</li>
</ul>
<p>ุดฺฉู ฺฉุงูู ูุญูุ ููุงููุฏ <strong>ูููุฏุงุฑ ุฑุงูโุขูู (railroad diagram)</strong> ุฏุฑ ุดฺฉู ธ-ฒ ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช.</p>
<p>ุจุฑุง ุฎูุงูุฏู ุงู ูููุฏุงุฑุ ุงุฒ ุณูุช ฺูพ ุดุฑูุน ฺฉุฑุฏู ู ูุงููุฏ ฺฉ ูุทุงุฑ ูุณุฑ ุฑุง ุฏูุจุงู ฺฉูุฏ.</p>
<ul>
<li>ูพุณ ุงุฒ <strong>from</strong> ุงุฌุจุงุฑุ ูโุชูุงู ุจูโุตูุฑุช ุงุฎุชุงุฑ ุงุฒ <strong>orderby</strong>ุ <strong>where</strong>ุ <strong>let</strong> ุง <strong>join</strong> ุงุณุชูุงุฏู ฺฉุฑุฏ.</li>
<li>ุณูพุณ ูโุชูุงู ุจุง <strong>select</strong> ุง <strong>group</strong> ุงุฏุงูู ุฏุงุฏุ ุง ุฏูุจุงุฑู ฺฉ <strong>from</strong>ุ <strong>orderby</strong>ุ <strong>where</strong>ุ <strong>let</strong> ุง <strong>join</strong> ุงุถุงูู ฺฉุฑุฏ.</li>
</ul>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-3.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<h3>ูพุฑุฏุงุฒุด ุนุจุงุฑุงุช ูพุฑุณโูุฌู ุชูุณุท ฺฉุงููพุงูุฑ โ๏ธ</h3>
<p>ฺฉุงููพุงูุฑ ฺฉ <strong>query expression</strong> ุฑุง ุจุง ุชุฑุฌูู ุขู ุจู <strong>Fluent Syntax</strong> ูพุฑุฏุงุฒุด ูโฺฉูุฏ. ุงู ูุฑุขูุฏ ูุณุจุชุงู ูฺฉุงูฺฉ ุงุณุชโูุดุงุจู ุชุจุฏู ุญูููโูุง <code>foreach</code> ุจู ูุฑุงุฎูุงูโูุง <code>GetEnumerator</code> ู <code>MoveNext</code>.</p>
<p>ุงู ุนู ูุฑ ฺุฒ ฺฉู ุจุชูุงูุฏ ุฏุฑ <strong>query syntax</strong> ุจููุณุฏุ ูโุชูุงูุฏ ุจู ููุงู ุดฺฉู ุฏุฑ <strong>fluent syntax</strong> ูุฒ ุจููุณุฏ. ุจุฑุง ูุซุงูุ ูพุฑุณโูุฌู ูุจู ุชูุณุท ฺฉุงููพุงูุฑ ุจู ุงู ุดฺฉู ุชุฑุฌูู ูโุดูุฏ:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query = names.Where(n =&gt; n.Contains(&quot;a&quot;))
                                 .OrderBy(n =&gt; n.Length)
                                 .Select(n =&gt; n.ToUpper());
</code></pre>
<p>ุนููฺฏุฑูุง <strong>Where</strong>ุ <strong>OrderBy</strong> ู <strong>Select</strong> ููุงู ููุงุนุฏ ุฑุง ุฏูุจุงู ูโฺฉููุฏ ฺฉู ุงฺฏุฑ ูพุฑุณโูุฌู ุฑุง ุจุง <strong>fluent syntax</strong> ููุดุชู ุจูุฏุฏุ ุงุนูุงู ูโุดุฏ. ุฏุฑ ุงู ูุซุงูุ ุขูโูุง ุจู <strong>extension methods</strong> ุฏุฑ ฺฉูุงุณ <strong>Enumerable</strong> ูุชุตู ูโุดููุฏุ ุฒุฑุง ูุถุง ูุงู <strong>System.Linq</strong> ูุงุฑุฏ ุดุฏู ู <code>names</code> ูพุงุฏูโุณุงุฒโฺฉููุฏู <code>IEnumerable&lt;string&gt;</code> ุงุณุช.</p>
<p>ฺฉุงููพุงูุฑ ููฺฏุงู ุชุฑุฌูู ุนุจุงุฑุงุช ูพุฑุณโูุฌูุ ุจูโุทูุฑ ุฎุงุต ฺฉูุงุณ <strong>Enumerable</strong> ุฑุง ุชุฑุฌุญ ููโุฏูุฏ. ูโุชูุงู ุชุตูุฑ ฺฉุฑุฏ ฺฉู ฺฉุงููพุงูุฑ ฺฉููุงุช <strong>โWhereโ</strong>ุ <strong>โOrderByโ</strong> ู <strong>โSelectโ</strong> ุฑุง ุจูโุตูุฑุช ูฺฉุงูฺฉ ุฏุฑ ุนุจุงุฑุช ูุงุฑุฏ ฺฉุฑุฏู ู ุขู ุฑุง ุจูโุนููุงู ูุชุฏูุง ุนุงุฏ ฺฉุงููพุงู ูโฺฉูุฏ. ุงู ุงูุนุทุงูโูพุฐุฑ ุจุงุนุซ ูโุดูุฏ ฺฉู ุนููฺฏุฑูุง ูพุฑุณโูุฌู ูพุงฺฏุงู ุฏุงุฏูุ ุฏุฑ ุจุฎุดโูุง ุจุนุฏุ ุจู <strong>extension methods</strong> ุฏุฑ ฺฉูุงุณ <strong>Queryable</strong> ูุชุตู ุดููุฏ.</p>
<p>ุงฺฏุฑ ุฏุณุชูุฑ <code>using System.Linq</code> ุฑุง ุญุฐู ฺฉูุฏุ ูพุฑุณโูุฌู ฺฉุงููพุงู ูุฎูุงูุฏ ุดุฏุ ุฒุฑุง ูุชุฏูุง <strong>Where</strong>ุ <strong>OrderBy</strong> ู <strong>Select</strong> ุจู ุฌุง ุจุฑุง ุงุชุตุงู ูุฏุงุฑูุฏ. ุจูุงุจุฑุงู ุนุจุงุฑุงุช ูพุฑุณโูุฌู <strong>ุจุฏูู ูุงุฑุฏ ฺฉุฑุฏู System.Linq ุง ูุถุง ุจุง ูพุงุฏูโุณุงุฒ ุงู ูุชุฏูุงุ ฺฉุงููพุงู ููโุดููุฏ</strong>.</p>
<hr>
<h3>ูุชุบุฑูุง ุฏุงููู (Range Variables) ๐น</h3>
<p>ุดูุงุณูโุง ฺฉู ุจูุงูุงุตูู ูพุณ ุงุฒ <strong>from</strong> ูโุขุฏุ <strong>range variable</strong> ูุงูุฏู ูโุดูุฏ. ฺฉ ูุชุบุฑ ุฏุงููู ุจู <strong>ุนูุตุฑ ุฌุงุฑ ุฏุฑ ุฏูุจุงูู</strong> ฺฉู ุนููุงุช ุฑู ุขู ุงูุฌุงู ูโุดูุฏุ ุงุดุงุฑู ุฏุงุฑุฏ.</p>
<p>ุฏุฑ ูุซุงูโูุง ูุงุ ูุชุบุฑ ุฏุงููู <code>n</code> ุฏุฑ ูุฑ ุจุฎุด ูพุฑุณโูุฌู ุธุงูุฑ ูโุดูุฏ. ุจุง ุงู ุญุงูุ ุงู ูุชุบุฑ ุฏุฑ ูุฑ ุจุฎุด ุฑู ุฏูุจุงููโุง ูุชูุงูุช ุดูุงุฑุด ูโุดูุฏ:</p>
<pre><code class="language-csharp">from    n in names           // n ูุชุบุฑ ุฏุงููู ูุงุณุช
where   n.Contains(&quot;a&quot;)     // n = ูุณุชูู ุงุฒ ุขุฑุงู
orderby n.Length             // n = ูพุณ ุงุฒ ููุชุฑ ุดุฏู
select  n.ToUpper()          // n = ูพุณ ุงุฒ ูุฑุชุจโุณุงุฒ
</code></pre>
<p>ุงู ููุถูุน ุจุง ุชุฑุฌูู ูฺฉุงูฺฉ ฺฉุงููพุงูุฑ ุจู <strong>fluent syntax</strong> ูุงุถุญ ูโุดูุฏ:</p>
<pre><code class="language-csharp">names.Where(n =&gt; n.Contains(&quot;a&quot;))   // n ุจุง ุฏุงููู ูุญู
     .OrderBy(n =&gt; n.Length)         // n ุจุง ุฏุงููู ูุญู
     .Select(n =&gt; n.ToUpper())       // n ุจุง ุฏุงููู ูุญู
</code></pre>
<p>ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ูุฑ ููููู ุงุฒ <code>n</code> <strong>ุจูโุตูุฑุช ุฎุตูุต</strong> ุฏุฑ ูุงูุจุฏุง ุฎูุฏ ูุญุฏูุฏูโุจูุฏ ุดุฏู ุงุณุช.</p>
<hr>
<h3>ูุนุฑู ูุชุบุฑูุง ุฏุงููู ุฌุฏุฏ</h3>
<p>ุนุจุงุฑุงุช ูพุฑุณโูุฌู ุงุฌุงุฒู ูโุฏููุฏ ุชุง ูุชุบุฑูุง ุฏุงููู ุฌุฏุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุจุฎุดโูุง ุฒุฑ ูุนุฑู ุดููุฏ:</p>
<ul>
<li><strong>let</strong></li>
<li><strong>into</strong></li>
<li>ฺฉ <strong>from</strong> ุงุถุงู</li>
<li><strong>join</strong></li>
</ul>
<p>ุงู ููุงุฑุฏ ุฏุฑ ุงุฏุงูู ูุตู ุฏุฑ ุจุฎุด ยซComposition Strategiesยป ุตูุญู ดดฒ ู ููฺูู ุฏุฑ ูุตู นุ ุฏุฑ ุจุฎุดโูุง ยซProjectingยป ุตูุญู ดทณ ู ยซJoiningยป ุตูุญู ดทณ ุจุฑุฑุณ ูโุดููุฏ.</p>
<hr>
<h3>ููุงุณู Query Syntax ุจุง SQL Syntax โก</h3>
<p>ุนุจุงุฑุงุช ูพุฑุณโูุฌู ุงุฒ ูุธุฑ ุธุงูุฑ ุดุจู SQL ูุณุชูุฏุ ุงูุง ุฏุฑ ูุงูุน ุจุณุงุฑ ูุชูุงูุชโุงูุฏ:</p>
<ul>
<li>ฺฉ ูพุฑุณโูุฌู LINQ ุฏุฑ ููุงุช <strong>ฺฉ ุนุจุงุฑุช C#</strong> ุงุณุช ู ููุงูู ุงุณุชุงูุฏุงุฑุฏ C# ุฑุง ุฏูุจุงู ูโฺฉูุฏ.</li>
<li>ุฏุฑ LINQ ููโุชูุงูุฏ ุงุฒ ูุชุบุฑ ูุจู ุงุฒ ุชุนุฑู ุขู ุงุณุชูุงุฏู ฺฉูุฏุ ุฏุฑ ุญุงู ฺฉู ุฏุฑ SQL ูโุชูุงู ฺฉ <strong>table alias</strong> ุฑุง ุฏุฑ SELECT ูุจู ุงุฒ FROM ุงุณุชูุงุฏู ฺฉุฑุฏ.</li>
<li>ฺฉ <strong>Subquery</strong> ุฏุฑ LINQ ุตุฑูุงู ฺฉ ุนุจุงุฑุช C# ุฏฺฏุฑ ุงุณุช ู ูุงุฒ ุจู ูุญู ูฺู ูุฏุงุฑุฏุ ุงูุง ุฏุฑ SQL ููุงุนุฏ ุฎุงุต ุฏุงุฑุฏ.</li>
<li>ุฌุฑุงู ุฏุงุฏู ุฏุฑ LINQ ุงุฒ <strong>ฺูพ ุจู ุฑุงุณุช</strong> ุงุณุชุ ุฏุฑ ุญุงู ฺฉู ุฏุฑ SQL ุชุฑุชุจ ุฏุงุฏู ฺฉูุชุฑ ุณุงุฎุชุงุฑููุฏ ุงุณุช.</li>
<li>ูพุฑุณโูุฌู LINQ ฺฉ <strong>ุฎุท ุชููุฏ ุง pipeline</strong> ุงุฒ ุนููฺฏุฑูุงุณุช ฺฉู ุชุฑุชุจ ุนูุงุตุฑ ุฏุฑ ุขู ููู ุงุณุชุ ุงูุง SQL ุนูุฏุชุงู ุจุง ูุฌููุนูโูุง ุจุฏูู ุชุฑุชุจ ฺฉุงุฑ ูโฺฉูุฏ.</li>
</ul>
<hr>
<h3>ููุงุณู Query Syntax ุจุง Fluent Syntax ๐</h3>
<p>ูุฑ ุฏู ูุญู ูุฒุงุง ุฏุงุฑูุฏ:</p>
<ul>
<li>
<p><strong>Query syntax</strong> ุจุฑุง ูพุฑุณโูุฌููุง ฺฉู ุดุงูู ููุงุฑุฏ ุฒุฑ ูุณุชูุฏ ุณุงุฏูโุชุฑ ุงุณุช:</p>
<ul>
<li><strong>let clause</strong> ุจุฑุง ูุนุฑู ูุชุบุฑ ุฌุฏุฏ ุฏุฑ ฺฉูุงุฑ ูุชุบุฑ ุฏุงููู</li>
<li><strong>SelectMany</strong>ุ <strong>Join</strong> ุง <strong>GroupJoin</strong> ุจุง ุงุฑุฌุงุน ุจู ูุชุบุฑ ุฏุงููู ุจุฑูู</li>
</ul>
</li>
<li>
<p>ุจุฑุง ูพุฑุณโูุฌููุง ุณุงุฏู ุจุง <strong>Where</strong>ุ <strong>OrderBy</strong> ู <strong>Select</strong>ุ ูุฑ ุฏู ูุญู ุฎูุจ ฺฉุงุฑ ูโฺฉููุฏ ู ุงูุชุฎุงุจ ุจุดุชุฑ ุดุฎุต ุงุณุช.</p>
</li>
<li>
<p>ุจุฑุง ูพุฑุณโูุฌููุง ฺฉู ููุท ุดุงูู ฺฉ ุนููฺฏุฑ ูุณุชูุฏุ <strong>Fluent syntax</strong> ฺฉูุชุงูโุชุฑ ู ูุฑุชุจโุชุฑ ุงุณุช.</p>
</li>
<li>
<p>ุจุฑุฎ ุนููฺฏุฑูุง ุฏุฑ <strong>query syntax</strong> ฺฉูุฏูุงฺู ูุฏุงุฑูุฏ ู ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุขูโูุง ุญุฏุงูู ุจุฎุด ุงุฒ Fluent syntax ูุงุฒู ุงุณุช. ุงู ุนููฺฏุฑูุง ุฎุงุฑุฌ ุงุฒ ููุงุฑุฏ ุฒุฑ ูุณุชูุฏ:</p>
</li>
</ul>
<pre><code>Where, Select, SelectMany
OrderBy, ThenBy, OrderByDescending, ThenByDescending
GroupBy, Join, GroupJoin
</code></pre>
<hr>
<h3>ูพุฑุณโูุฌููุง ุชุฑฺฉุจ (Mixed-Syntax) โ๏ธ</h3>
<p>ุงฺฏุฑ ฺฉ ุนููฺฏุฑ ูพุฑุณโูุฌู ุฏุฑ <strong>query syntax</strong> ูพุดุชุจุงู ูุดูุฏุ ูโุชูุงูุฏ <strong>query syntax</strong> ู <strong>fluent syntax</strong> ุฑุง ุชุฑฺฉุจ ฺฉูุฏ. ุชููุง ูุญุฏูุฏุช ุงู ุงุณุช ฺฉู ูุฑ ุจุฎุด query syntax ุจุงุฏ <strong>ฺฉุงูู</strong> ุจุงุดุฏ (ุนู ุจุง from ุดุฑูุน ู ุจุง select ุง group ูพุงุงู ุงุจุฏ).</p>
<p>ุจุฑุง ูุซุงูุ ุจุง ุขุฑุงู ุฒุฑ:</p>
<pre><code class="language-csharp">string[] names = { &quot;Tom&quot;, &quot;Dick&quot;, &quot;Harry&quot;, &quot;Mary&quot;, &quot;Jay&quot; };
</code></pre>
<p>ูุซุงู ุชุฑฺฉุจ ุฒุฑ ุชุนุฏุงุฏ ูุงูโูุง ฺฉู ุดุงูู ุญุฑู &quot;a&quot; ูุณุชูุฏ ุฑุง ูโุดูุงุฑุฏ:</p>
<pre><code class="language-csharp">int matches = (from n in names
               where n.Contains(&quot;a&quot;)
               select n).Count();   // 3
</code></pre>
<p>ููฺูู ุงููู ูุงู ุจู ุชุฑุชุจ ุงููุจุง ุฑุง ูโฺฏุฑุฏ:</p>
<pre><code class="language-csharp">string first = (from n in names
                orderby n
                select n).First();   // Dick
</code></pre>
<p>ุฏุฑ ูพุฑุณโูุฌููุง ุณุงุฏูุ ูโุชูุงู ฺฉู ฺฉุงุฑ ุฑุง ุจุง Fluent syntax ุงูุฌุงู ุฏุงุฏ:</p>
<pre><code class="language-csharp">int matches = names.Where(n =&gt; n.Contains(&quot;a&quot;)).Count();   // 3
string first = names.OrderBy(n =&gt; n).First();              // Dick
</code></pre>
<p>ฺฏุงู ูพุฑุณโูุฌููุง ุชุฑฺฉุจ ุจุงูุงุชุฑู <strong>ฺฉุงุฑุง ู ุณุงุฏฺฏ</strong> ุฑุง ุงุฑุงุฆู ูโุฏููุฏ. ุจูุงุจุฑุงู ููู ุงุณุช ฺฉู ููุดู ุจูโุทูุฑ ฺฉโุฌุงูุจู ููุท ฺฉ ูุญู ุฑุง ุชุฑุฌุญ ูุฏูุฏุ ุชุง ููฺฏุงู ูุงุฒ ุจุชูุงูุฏ ุงุฒ ูพุฑุณโูุฌู ุชุฑฺฉุจ ุจูุฑู ุจุจุฑุฏ.</p>
<hr>
<p>ุฏุฑ ุงุฏุงูู ุงู ูุตูุ ููุงูู ฺฉูุฏ ุจุง ูุฑ ุฏู ูุญู <strong>fluent</strong> ู <strong>query syntax</strong> ูุดุงู ุฏุงุฏู ูโุดููุฏ.</p>
<h3>ุงุฌุฑุง ุจู ุชุนููโุงูุชุงุฏู (Deferred Execution) โณ</h3>
<p>ฺฉ ุงุฒ ูฺฺฏโูุง ููู ุจุดุชุฑ <strong>query operators</strong> ุงู ุงุณุช ฺฉู <strong>ุฏุฑ ุฒูุงู ุณุงุฎุช ูพุฑุณโูุฌู ุงุฌุฑุง ููโุดููุฏ</strong>ุ ุจูฺฉู ุฒูุงู ุงุฌุฑุง ูโุดููุฏ ฺฉู ุดูุงุฑุด ุดููุฏ (ุนู ููุช <code>MoveNext</code> ุฑู enumerator ูุฑุงุฎูุงู ุดูุฏ).</p>
<p>ูุซุงู ุฒุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ:</p>
<pre><code class="language-csharp">var numbers = new List&lt;int&gt; { 1 };
IEnumerable&lt;int&gt; query = numbers.Select(n =&gt; n * 10);   // ุณุงุฎุช ูพุฑุณโูุฌู
numbers.Add(2);                                         // ุงุถุงูู ฺฉุฑุฏู ุนูุตุฑ ุฌุฏุฏ
foreach (int n in query)
    Console.Write(n + &quot;|&quot;);                             // 10|20|
</code></pre>
<p>ุนูุตุฑ ุงุถุงููโุดุฏู ูพุณ ุงุฒ ุณุงุฎุช ูพุฑุณโูุฌู ุฏุฑ ูุชุฌู ูุญุงุธ ูโุดูุฏุ ุฒุฑุง <strong>ูฺ ููุชุฑ ุง ูุฑุชุจโุณุงุฒ ุชุง ุฒูุงู ุงุฌุฑุง <code>foreach</code> ุงูุฌุงู ููโุดูุฏ</strong>. ุจู ุงู ูฺฺฏ <strong>deferred ุง lazy execution</strong> ฺฏูุชู ูโุดูุฏุ ูุดุงุจู ุขูฺู ุจุง <strong>delegates</strong> ุฑุฎ ูโุฏูุฏ:</p>
<pre><code class="language-csharp">Action a = () =&gt; Console.WriteLine(&quot;Foo&quot;);
// ูููุฒ ฺุฒ ุจู Console ูููุดุชูโุงู. ุญุงูุง ุงุฌุฑุง ูโฺฉูู:
a();  // ุงุฌุฑุง ุจู ุชุนููโุงูุชุงุฏู!
</code></pre>
<p>ุชูุงู <strong>standard query operators</strong> ุงุฌุฑุง ุจู ุชุนููโุงูุชุงุฏู ุฏุงุฑูุฏุ ุจู ุฌุฒ ููุงุฑุฏ ุฒุฑ:</p>
<ul>
<li>
<p>ุนููฺฏุฑูุง ฺฉู <strong>ฺฉ ุนูุตุฑ ุง ููุฏุงุฑ scalar</strong> ุจุฑูโฺฏุฑุฏุงููุฏุ ูุซู <code>First</code> ุง <code>Count</code></p>
</li>
<li>
<p>ุนููฺฏุฑูุง ุชุจุฏู ูุงููุฏ:</p>
<ul>
<li><code>ToArray</code>, <code>ToList</code>, <code>ToDictionary</code>, <code>ToLookup</code>, <code>ToHashSet</code></li>
</ul>
</li>
</ul>
<p>ุงู ุนููฺฏุฑูุง <strong>ูพุฑุณโูุฌู ุฑุง ููุฑุงู ุงุฌุฑุง ูโฺฉููุฏ</strong> ุฒุฑุง ููุน ุฎุฑูุฌ ุขูโูุง ูฺฉุงูุฒู ุจุฑุง ุงุฌุฑุง ุจู ุชุนููโุงูุชุงุฏู ูุฏุงุฑุฏ. ุจู ุนููุงู ูุซุงูุ <code>Count</code> ฺฉ <strong>ุนุฏุฏ ุณุงุฏู</strong> ุจุฑูโฺฏุฑุฏุงูุฏ ู ุฏฺฏุฑ ุดูุงุฑุด ููโุดูุฏ:</p>
<pre><code class="language-csharp">int matches = numbers.Where(n =&gt; n &lt;= 2).Count();   // ุงุฌุฑุง ููุฑุงู ุงูุฌุงู ูโุดูุฏ
</code></pre>
<p><strong>ุงููุช ุงุฌุฑุง ุจู ุชุนููโุงูุชุงุฏู</strong> ุฏุฑ ุงู ุงุณุช ฺฉู <strong>ุณุงุฎุช ูพุฑุณโูุฌู ุฑุง ุงุฒ ุงุฌุฑุง ุขู ุฌุฏุง ูโฺฉูุฏ</strong>. ุงู ุงูฺฉุงู ุฑุง ูโุฏูุฏ ฺฉู ูพุฑุณโูุฌู ุฑุง ุฏุฑ ฺูุฏ ูุฑุญูู ุจุณุงุฒุฏ ู ููฺูู ูพุฑุณโูุฌููุง ูพุงฺฏุงู ุฏุงุฏู ุฑุง ููฺฉู ูโุณุงุฒุฏ.</p>
<hr>
<h3>ุงุฑุฒุงุจ ูุฌุฏุฏ (Reevaluation) ๐</h3>
<p><strong>Subqueries</strong> ุณุทุญ ุฏฺฏุฑ ุงุฒ <strong>indirection</strong> ุงุฌุงุฏ ูโฺฉููุฏ. ุชูุงู ูุญุชูุงุช ฺฉ subquery ูุฒ ุงุฒ deferred execution ูพุฑู ูโฺฉููุฏุ ุงุฒ ุฌููู <strong>aggregation</strong> ู <strong>conversion methods</strong>.</p>
<p>ุงุฌุฑุง ุจู ุชุนููโุงูุชุงุฏู ฺฉ ูพุงูุฏ ุฏฺฏุฑ ูู ุฏุงุฑุฏ: <strong>ูุฑ ุจุงุฑ ฺฉู ูพุฑุณโูุฌู ุฏูุจุงุฑู ุดูุงุฑุด ุดูุฏุ ุฏูุจุงุฑู ุงุฑุฒุงุจ ูโุดูุฏ</strong>:</p>
<pre><code class="language-csharp">var numbers = new List&lt;int&gt;() { 1, 2 };
IEnumerable&lt;int&gt; query = numbers.Select(n =&gt; n * 10);

foreach (int n in query) Console.Write(n + &quot;|&quot;);  // 10|20|
numbers.Clear();
foreach (int n in query) Console.Write(n + &quot;|&quot;);  // &lt;ฺุฒ ููุงุด ุฏุงุฏู ููโุดูุฏ&gt;
</code></pre>
<p>ฺฏุงู ุงุฑุฒุงุจ ูุฌุฏุฏ ููฺฉู ุงุณุช <strong>ูุฒุงุญูุชโุขูุฑู</strong> ุจุงุดุฏ:</p>
<ul>
<li>ููุช ูโุฎูุงูุฏ ูุชุงุฌ ุฑุง ุฏุฑ ฺฉ ููุทู ุฒูุงู ูุดุฎุต <strong>ุฐุฎุฑู ุง freeze</strong> ฺฉูุฏ</li>
<li>ููุช ูพุฑุณโูุฌู ูุญุงุณุจุงุช ุณูฺฏู ุฏุงุฑุฏ ุง ุจู ูพุงฺฏุงู ุฏุงุฏู ุฎุงุฑุฌ ูุงุจุณุชู ุงุณุชุ ุชฺฉุฑุงุฑ ุบุฑุถุฑูุฑ ุขู ููุทู ูุณุช</li>
</ul>
<p>ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงุฑุฒุงุจ ูุฌุฏุฏุ ูโุชูุงูุฏ ุงุฒ <strong>conversion operators</strong> ูุงููุฏ <code>ToArray</code> ุง <code>ToList</code> ุงุณุชูุงุฏู ฺฉูุฏ:</p>
<pre><code class="language-csharp">var numbers = new List&lt;int&gt;() { 1, 2 };
List&lt;int&gt; timesTen = numbers
    .Select(n =&gt; n * 10)
    .ToList();                // ููุฑุงู ุงุฌุฑุง ู ุฏุฑ List&lt;int&gt; ุฐุฎุฑู ุดุฏ
numbers.Clear();
Console.WriteLine(timesTen.Count);  // ูููุฒ 2
</code></pre>
<hr>
<h3>ูุชุบุฑูุง ฺฏุฑูุชูโุดุฏู (Captured Variables) โ๏ธ</h3>
<p>ุงฺฏุฑ <strong>lambda expressions</strong> ูพุฑุณโูุฌู ูุชุบุฑูุง ุจุฑูู ุฑุง ฺฏุฑูุชู ุจุงุดูุฏุ <strong>ููุฏุงุฑ ุขูโูุง ููฺฏุงู ุงุฌุฑุง ูพุฑุณโูุฌู ูุญุงุธ ูโุดูุฏ</strong>:</p>
<pre><code class="language-csharp">int[] numbers = { 1, 2 };
int factor = 10;
IEnumerable&lt;int&gt; query = numbers.Select(n =&gt; n * factor);
factor = 20;

foreach (int n in query) Console.Write(n + &quot;|&quot;);  // 20|40|
</code></pre>
<p>ุงู ูโุชูุงูุฏ <strong>ฺฉ ุชูู ุฏุฑ ุญูููโูุง</strong> ุงุฌุงุฏ ฺฉูุฏ. ูุซุงู ุญุฐู ุญุฑูู ุตุฏุงุฏุงุฑ ุงุฒ ฺฉ ุฑุดุชู:</p>
<pre><code class="language-csharp">IEnumerable&lt;char&gt; query = &quot;Not what you might expect&quot;;
query = query.Where(c =&gt; c != 'a');
query = query.Where(c =&gt; c != 'e');
query = query.Where(c =&gt; c != 'i');
query = query.Where(c =&gt; c != 'o');
query = query.Where(c =&gt; c != 'u');

foreach (char c in query) Console.Write(c);  // Nt wht y mght xpct
</code></pre>
<p>ุงฺฏุฑ ุจุฎูุงูู ุงุฒ <strong>for loop</strong> ุงุณุชูุงุฏู ฺฉูู:</p>
<pre><code class="language-csharp">IEnumerable&lt;char&gt; query = &quot;Not what you might expect&quot;;
string vowels = &quot;aeiou&quot;;
for (int i = 0; i &lt; vowels.Length; i++)
    query = query.Where(c =&gt; c != vowels[i]);

foreach (char c in query) Console.Write(c);
</code></pre>
<p>ฺฉ <strong>IndexOutOfRangeException</strong> ุฑุฎ ูโุฏูุฏุ ุฒุฑุง ูุชุบุฑ ุญููู <code>i</code> ุฏุฑ closure ฺฏุฑูุชู ุดุฏู ู ููฺฏุงู ุดูุงุฑุด ููุฏุงุฑ ุขู ุจุฑุงุจุฑ ต ุงุณุช.</p>
<p>ุฑุงู ุญูโูุง:</p>
<ol>
<li><strong>ุชุนุฑู ูุชุบุฑ ูุญู ุฏุงุฎู ุจููฺฉ</strong>:</li>
</ol>
<pre><code class="language-csharp">for (int i = 0; i &lt; vowels.Length; i++)
{
    char vowel = vowels[i];
    query = query.Where(c =&gt; c != vowel);
}
</code></pre>
<ol start="2">
<li>ุง ุงุณุชูุงุฏู ุงุฒ <strong>foreach</strong>:</li>
</ol>
<pre><code class="language-csharp">foreach (char vowel in vowels)
    query = query.Where(c =&gt; c != vowel);
</code></pre>
<hr>
<h3>ูุญูู ฺฉุงุฑ Deferred Execution ๐ง</h3>
<p>ุนููฺฏุฑูุง ูพุฑุณโูุฌู ุงุฌุฑุง ุจู ุชุนููโุงูุชุงุฏู ุฑุง ุจุง <strong>ุจุงุฒฺฏุฑุฏุงูุฏู decorator sequences</strong> ูุฑุงูู ูโฺฉููุฏ.</p>
<p>ุจุฑุฎูุงู ฺฉูุงุณโูุง ุณูุช ูุงููุฏ ุขุฑุงู ุง ูุณุช ูพููุฏุ ฺฉ <strong>decorator sequence</strong> ูุนูููุงู ุณุงุฎุชุงุฑ ุฏุงุฎู ุจุฑุง ุฐุฎุฑู ุนูุงุตุฑ ูุฏุงุฑุฏ. ุฏุฑ ุนูุถุ ฺฉ <strong>sequence ุฏฺฏุฑ</strong> ฺฉู ููฺฏุงู ุงุฌุฑุง ุชุฃูู ูโฺฉูุฏ ุฑุง ูพูุดุด ูโุฏูุฏ ู ูุงุจุณุชฺฏ ุฏุงุฆู ุจู ุขู ุฏุงุฑุฏ. ูุฑ ุจุงุฑ ฺฉู ุฏุงุฏู ุงุฒ decorator ุฏุฑุฎูุงุณุช ุดูุฏุ ุจุงุฏ ุฏุงุฏู ุฑุง ุงุฒ ุฏูุจุงูู ูุฑูุฏ ุฏุฑุงูุช ฺฉูุฏ.</p>
<p><strong>ุชุจุฏู ุง ุชุบุฑ ุนููฺฏุฑ ูพุฑุณโูุฌู ููุงู โdecorationโ ุงุณุช.</strong> ุงฺฏุฑ ุฏูุจุงูู ุฎุฑูุฌ ูฺ ุชุจุฏู ุงูุฌุงู ูุฏูุฏุ ฺฉ <strong>proxy</strong> ุงุณุช ูู decorator.</p>
<p>ูุฑุงุฎูุงู <code>Where</code> ุตุฑูุงู <strong>ุฏูุจุงูู wrapper</strong> ุฑุง ูโุณุงุฒุฏ ฺฉู ุดุงูู ุงุฑุฌุงุน ุจู <strong>input sequence</strong>ุ <strong>lambda expression</strong> ู ุณุงุฑ ุขุฑฺฏููุงูโูุง ุงุณุช. ุฏูุจุงูู ูุฑูุฏ <strong>ููุท ุฒูุงู ุดูุงุฑุด ูโุดูุฏ ฺฉู decorator ุดูุงุฑุด ุดูุฏ</strong>.</p>
<p>ูุซุงู:</p>
<pre><code class="language-csharp">IEnumerable&lt;int&gt; lessThanTen = new int[] { 5, 12, 3 }.Where(n =&gt; n &lt; 10);
</code></pre>
<p>ุงู ุณุงุฎุชุงุฑ ููุงููุฏ ุดฺฉู ธ-ณ ุชุฑฺฉุจ ูโุดูุฏ.</p>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-4.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>ููฺฏุงู ฺฉู <code>lessThanTen</code> ุฑุง ุดูุงุฑุด ูโฺฉูุฏุ ุฏุฑ ูุงูุน <strong>ุขุฑุงู ุฑุง ุงุฒ ุทุฑู decorator <code>Where</code> ูพุฑุณโูุฌู ูโฺฉูุฏ</strong>. โ</p>
<p>ุฎุจุฑ ุฎูุจ ุงู ุงุณุช ฺฉู ุงฺฏุฑ ุจุฎูุงูุฏ <strong>ฺฉ query operator ุดุฎุต ุจุณุงุฒุฏ</strong>ุ ูพุงุฏูโุณุงุฒ ฺฉ <strong>decorator sequence</strong> ุจุง <strong>C# iterator</strong> ุจุณุงุฑ ุณุงุฏู ุงุณุช. ูุซุงู ุณุงุฎุช ูุชุฏ <code>Select</code> ุฎูุฏุชุงู:</p>
<pre><code class="language-csharp">public static IEnumerable&lt;TResult&gt; MySelect&lt;TSource,TResult&gt;
    (this IEnumerable&lt;TSource&gt; source, Func&lt;TSource,TResult&gt; selector)
{
    foreach (TSource element in source)
        yield return selector(element);
}
</code></pre>
<p>ุงู ูุชุฏ ุจู ุฏูู ุงุณุชูุงุฏู ุงุฒ <strong><code>yield return</code></strong> ฺฉ <strong>iterator</strong> ุงุณุช. ุงุฒ ูุธุฑ ุนููฺฉุฑุฏุ ูุนุงุฏู ฺฉูุชุงูโุดุฏูโ ฺฉุฏ ุฒุฑ ุงุณุช:</p>
<pre><code class="language-csharp">public static IEnumerable&lt;TResult&gt; MySelect&lt;TSource,TResult&gt;
    (this IEnumerable&lt;TSource&gt; source, Func&lt;TSource,TResult&gt; selector)
{
    return new SelectSequence(source, selector);
}
</code></pre>
<p>ฺฉู ุฏุฑ ุขู <code>SelectSequence</code> ฺฉ <strong>ฺฉูุงุณ ููุดุชูโุดุฏู ุชูุณุท ฺฉุงููพุงูุฑ</strong> ุงุณุช ฺฉู <strong>enumerator ุขู ููุทู ููุฌูุฏ ุฏุฑ iterator ุฑุง encapsulate ูโฺฉูุฏ</strong>.</p>
<p>ุจูุงุจุฑุงูุ ููุช ุนููุงุช ูุงููุฏ <code>Select</code> ุง <code>Where</code> ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏุ ุฏุฑ ูุงูุน <strong>ุชููุง ฺฉ ฺฉูุงุณ enumerable ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู ุฏูุจุงูู ูุฑูุฏ ุฑุง decorate ูโฺฉูุฏ</strong>. ๐</p>
<hr>
<h3>ุฒูุฌุฑูโุณุงุฒ Decorators ๐</h3>
<p>ุฒูุฌุฑูโุณุงุฒ <strong>query operators</strong> ุจุงุนุซ <strong>ูุงูโูุงู ุดุฏู decorators</strong> ูโุดูุฏ. ูุซุงู:</p>
<pre><code class="language-csharp">IEnumerable&lt;int&gt; query = new int[] { 5, 12, 3 }
    .Where(n =&gt; n &lt; 10)
    .OrderBy(n =&gt; n)
    .Select(n =&gt; n * 10);
</code></pre>
<p>ูุฑ <strong>query operator</strong> ฺฉ decorator ุฌุฏุฏ ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู <strong>ุฏูุจุงูู ูุจู ุฑุง ูโูพูุดุงูุฏ</strong> (ูุงููุฏ <strong>ุนุฑูุณฺฉโูุง ุฑูุณ ุชู ุฏุฑ ุชู</strong>). ๐ช</p>
<p>ุดฺฉู ธ-ด <strong>ูุฏู ุดุก (object model)</strong> ุงู ูพุฑุณโูุฌู ุฑุง ูุดุงู ูโุฏูุฏ. ุชูุฌู ฺฉูุฏ ฺฉู <strong>ุงู ูุฏู ุดุก ฺฉุงููุงู ูุจู ุงุฒ ูุฑ ุดูุงุฑุด ุณุงุฎุชู ูโุดูุฏ</strong> ู ูฺ ุฏุงุฏูโุง ูููุฒ ูพุฑุฏุงุฒุด ูุดุฏู ุงุณุช.</p>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-5.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>ููุช <code>query</code> ุฑุง ุดูุงุฑุด ูโฺฉูุฏุ ุฏุฑ ูุงูุน <strong>ุขุฑุงู ุงุตู ุฑุง ุงุฒ ุทุฑู ฺฉ ุฒูุฌุฑู ุง ูุงูโุจูุฏ ุงุฒ decorators ูพุฑุณโูุฌู ูโฺฉูุฏ</strong>. ๐</p>
<p>ุงุถุงูู ฺฉุฑุฏู <code>ToList</code> ุฏุฑ ุงูุชูุง ุงู ูพุฑุณโูุฌู ุจุงุนุซ ูโุดูุฏ ฺฉู <strong>ุนููฺฏุฑูุง ูุจู ููุฑุงู ุงุฌุฑุง ุดููุฏ</strong> ู ฺฉู <strong>ูุฏู ุดุก (object model)</strong> ุจู ฺฉ <strong>ูุณุช ูุงุญุฏ</strong> ุชุจุฏู ุดูุฏ. ๐</p>
<p>ุดฺฉู ธ-ต ููุงู ุชุฑฺฉุจ ุดุก ุฑุง ุฏุฑ <strong>UML (Unified Modeling Language)</strong> ูุดุงู ูโุฏูุฏ:</p>
<ul>
<li>decorator <code>Select</code> ุจู decorator <code>OrderBy</code> ุงุฑุฌุงุน ูโุฏูุฏุ</li>
<li>decorator <code>OrderBy</code> ุจู decorator <code>Where</code> ุงุฑุฌุงุน ูโุฏูุฏุ</li>
<li>ู decorator <code>Where</code> ุจู ุขุฑุงู ุงุตู ุงุฑุฌุงุน ูโุฏูุฏ.</li>
</ul>
<p>ูฺฺฏ ุงุฌุฑุง ุจู ุชุนููโุงูุชุงุฏู ุงู ุงุณุช ฺฉู ุงฺฏุฑ <strong>ูพุฑุณโูุฌู ุฑุง ุจู ุตูุฑุช ูุฑุญููโุง ุจุณุงุฒุฏ</strong>ุ <strong>ููุงู ูุฏู ุดุก ุณุงุฎุชู ูโุดูุฏ</strong>:</p>
<pre><code class="language-csharp">IEnumerable&lt;int&gt;
    source    = new int[] { 5, 12, 3 },
    filtered  = source   .Where(n =&gt; n &lt; 10),
    sorted    = filtered .OrderBy(n =&gt; n),
    query     = sorted   .Select(n =&gt; n * 10);
</code></pre>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-6.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<h3>ูุญูู ุงุฌุฑุง ูพุฑุณโูุฌููุง โ๏ธ</h3>
<p>ูุชุงุฌ ุดูุงุฑุด ูพุฑุณโูุฌู ูุจู ุจู ุงู ุตูุฑุช ุงุณุช:</p>
<pre><code class="language-csharp">foreach (int n in query) Console.WriteLine(n);
</code></pre>
<p>ุฎุฑูุฌ:</p>
<pre><code>30
50
</code></pre>
<hr>
<p>ุฏุฑ ูพุดุช ุตุญููุ <code>foreach</code> ูุชุฏ <strong><code>GetEnumerator</code></strong> ุฑุง ุฑู decorator <code>Select</code> (ุขุฎุฑู ุง ุจุฑููโุชุฑู ุนููฺฏุฑ) ูุฑุงุฎูุงู ูโฺฉูุฏ ู ุงู <strong>ุชูุงู ุนููุงุช ุฑุง ุขุบุงุฒ ูโฺฉูุฏ</strong>. ๐</p>
<p>ูุชุฌูุ ฺฉ <strong>ุฒูุฌุฑู ุงุฒ enumeratorโูุง</strong> ุงุณุช ฺฉู <strong>ุจู ุทูุฑ ุณุงุฎุชุงุฑ ุดุจู ุฒูุฌุฑู decorator sequences</strong> ุงุณุช.</p>
<p>ุดฺฉู ธ-ถ <strong>ุฌุฑุงู ุงุฌุฑุง ูพุฑุณโูุฌู ุฏุฑ ุญู ุดูุงุฑุด</strong> ุฑุง ูุดุงู ูโุฏูุฏ.</p>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-7.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>ุฏุฑ ุจุฎุด ุงูู ุงู ูุตูุ ฺฉ ูพุฑุณโูุฌู ุฑุง ุจูโุนููุงู ฺฉ <strong>ุฎุท ุชููุฏ ุจุง ููุงุฑ ููุงูู</strong> ูุดุงู ุฏุงุฏู. ุจุง ฺฏุณุชุฑุด ุงู ูุงุณุ ูโุชูุงู ฺฏูุช ฺฉู ฺฉ ูพุฑุณโูุฌู LINQ ฺฉ <strong>ุฎุท ุชููุฏ ุชูุจู (lazy)</strong> ุงุณุชุ ุฌุง ฺฉู <strong>ููุงุฑูุง ููุงูู ุชููุง ููฺฏุงู ูุงุฒ ุนูุงุตุฑ ุฑุง ุญุฑฺฉุช ูโุฏููุฏ</strong>. ๐ญ</p>
<p>ุณุงุฎุชู ฺฉ ูพุฑุณโูุฌูุ <strong>ุณุงุฎุชู ุฎุท ุชููุฏ ุจุง ููู ุงุฌุฒุง</strong> ุงุณุชโุงูุง ูฺ ฺุฒ ูููุฒ ุญุฑฺฉุช ููโฺฉูุฏ. ุณูพุณุ ููุช <strong>ูุตุฑูโฺฉููุฏู ฺฉ ุนูุตุฑ ุฏุฑุฎูุงุณุช ูโฺฉูุฏ</strong> (ุนู ูพุฑุณโูุฌู ุฑุง ุดูุงุฑุด ูโฺฉูุฏ)ุ <strong>ููุงุฑ ููุงูู ุณูุช ุฑุงุณุช ูุนุงู ูโุดูุฏ</strong>ุ ุงู ุจู ููุจู ุฎูุฏ ุฏฺฏุฑ ููุงุฑูุง ุฑุง ุชุญุฑฺฉ ูโฺฉูุฏ ุชุง ุญุฑฺฉุช ฺฉููุฏโูุฑฺฏุงู ฺฉู ุนูุงุตุฑ ุฏูุจุงูู ูุฑูุฏ ูุงุฒ ุจุงุดูุฏ. LINQ ุงุฒ ูุฏู <strong>pull ูุจุชู ุจุฑ ุชูุงุถุง</strong> ูพุฑู ูโฺฉูุฏุ ูู ูุฏู push ูุจุชู ุจุฑ ุนุฑุถู. ุงู ูฺฺฏ ุงููุช ุฏุงุฑุฏโููุงูโุทูุฑ ฺฉู ุจุนุฏุงู ุฎูุงูุฏ ุฏุฏโฺุฑุง ฺฉู ุจู LINQ ุงุฌุงุฒู ูโุฏูุฏ <strong>ุจุฑุง ูพุฑุณโูุฌููุง SQL ููุงุณโูพุฐุฑ ุจุงุดุฏ</strong>. โก</p>
<hr>
<h3>Subqueries (ุฒุฑูพุฑุณโูุฌููุง) ๐</h3>
<p>ฺฉ <strong>ุฒุฑูพุฑุณโูุฌู</strong>ุ ูพุฑุณโูุฌู ุงุณุช ฺฉู ุฏุฑ <strong>lambda expression</strong> ฺฉ ูพุฑุณโูุฌู ุฏฺฏุฑ ูุฑุงุฑ ุฏุงุฑุฏ. ูุซุงู ุฒุฑุ ุงุฒ ฺฉ ุฒุฑูพุฑุณโูุฌู ุจุฑุง ูุฑุชุจ ฺฉุฑุฏู ููุณูโุฏุงูโูุง ุจุฑ ุงุณุงุณ <strong>ูุงู ุฎุงููุงุฏฺฏ</strong> ุงุณุชูุงุฏู ูโฺฉูุฏ:</p>
<pre><code class="language-csharp">string[] musos = { &quot;David Gilmour&quot;, &quot;Roger Waters&quot;, &quot;Rick Wright&quot;, &quot;Nick Mason&quot; };
IEnumerable&lt;string&gt; query = musos.OrderBy(m =&gt; m.Split().Last());
</code></pre>
<ul>
<li><code>m.Split</code> ูุฑ ุฑุดุชู ุฑุง ุจู ฺฉ ูุฌููุนู ุงุฒ ฺฉููุงุช ุชุจุฏู ูโฺฉูุฏุ ุณูพุณ <strong>ุนููฺฏุฑ <code>Last</code></strong> ุฑู ุขู ูุฑุงุฎูุงู ูโุดูุฏ.</li>
<li><code>m.Split().Last</code> ููุงู <strong>ุฒุฑูพุฑุณโูุฌู</strong> ุงุณุชุ ู <code>query</code> ูพุฑุณโูุฌู ุจุฑูู ุฑุง ูุดุงู ูโุฏูุฏ.</li>
</ul>
<hr>
<p>ุฒุฑูพุฑุณโูุฌููุง ูุฌุงุฒ ูุณุชูุฏ ุฒุฑุง <strong>ูโุชูุงู ูุฑ ุนุจุงุฑุช ูุนุชุจุฑ C# ุฑุง ุฏุฑ ุณูุช ุฑุงุณุช lambda ูุฑุงุฑ ุฏุงุฏ</strong>. ุฒุฑูพุฑุณโูุฌู ุตุฑูุงู ฺฉ <strong>ุนุจุงุฑุช C# ุฏฺฏุฑ</strong> ุงุณุช ู ููุงูู ุขู <strong>ุชุจุนุช ุงุฒ ููุงูู lambda expressions</strong> ู ุฑูุชุงุฑ ฺฉู query operators ุฏุงุฑุฏ.</p>
<p>ุฏุฑ ุงู ฺฉุชุงุจุ ููุช ุงุฒ ุงุตุทูุงุญ <strong>subquery</strong> ุงุณุชูุงุฏู ูโฺฉููุ ููุธูุฑ <strong>ูพุฑุณโูุฌู ุงุณุช ฺฉู ุฏุฑ lambda expression ฺฉ ูพุฑุณโูุฌู ุฏฺฏุฑ ุงุฑุฌุงุน ุดุฏู</strong>. ุฏุฑ <strong>query expressions</strong>ุ ฺฉ ุฒุฑูพุฑุณโูุฌู ูุนุงุฏู ูพุฑุณโูุฌู ุงุณุช ฺฉู ุงุฒ ฺฉ ุนุจุงุฑุช ุฏุฑ ูุฑ clause ุจู ุฌุฒ <strong>from</strong> ุงุฑุฌุงุน ุดุฏู ุจุงุดุฏ.</p>
<p>ุฒุฑูพุฑุณโูุฌู ุจู <strong>ุทูุฑ ุฎุตูุต ุฏุฑ ูุญุฏูุฏู ุนุจุงุฑุช ุงุญุงุทูโฺฉููุฏู</strong> ุงุณุช ู ูโุชูุงูุฏ ุจู <strong>ูพุงุฑุงูุชุฑูุง lambda ุจุฑูู</strong> ุง <strong>range variables ุฏุฑ query expression</strong> ุงุฑุฌุงุน ุฏูุฏ.</p>
<p>ูุซุงู ุณุงุฏู:</p>
<pre><code class="language-csharp">string[] names = { &quot;Tom&quot;, &quot;Dick&quot;, &quot;Harry&quot;, &quot;Mary&quot;, &quot;Jay&quot; };
IEnumerable&lt;string&gt; outerQuery = names
    .Where(n =&gt; n.Length == names.OrderBy(n2 =&gt; n2.Length)
                                .Select(n2 =&gt; n2.Length).First());
// Tom, Jay
</code></pre>
<p>ููุงู ูุซุงู ุจู ุตูุฑุช query expression:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; outerQuery =
    from n in names
    where n.Length ==
        (from n2 in names orderby n2.Length select n2.Length).First()
    select n;
</code></pre>
<ul>
<li><strong>ุชูุฌู:</strong> ฺูู <strong>range variable ุจุฑูู (n)</strong> ุฏุฑ ูุญุฏูุฏู ุฒุฑูพุฑุณโูุฌู ุฏุฑ ุฏุณุชุฑุณ ุงุณุชุ ููโุชูุงู ุงุฒ ููุงู ูุงู <code>n</code> ุจุฑุง ุฒุฑูพุฑุณโูุฌู ุงุณุชูุงุฏู ฺฉุฑุฏ.</li>
</ul>
<hr>
<p><strong>ุฒูุงู ุงุฌุฑุง ุฒุฑูพุฑุณโูุฌู:</strong>
ฺฉ ุฒุฑูพุฑุณโูุฌู <strong>ูุฑฺฏุงู lambda ุงุญุงุทูโฺฉููุฏู ุงุฑุฒุงุจ ุดูุฏุ ุงุฌุฑุง ูโุดูุฏ</strong>. ุจู ุนุจุงุฑุช ุฏฺฏุฑุ <strong>ุงุฌุฑุง ุงุฒ ุจุฑูู ุจู ุฏุงุฎู</strong> ุงูุฌุงู ูโุดูุฏ.</p>
<ul>
<li>ุจุฑุง <strong>ูพุฑุณโูุฌููุง ูุญู (local queries)</strong>ุ ุงู ูุฏู ุฏููุงู ุฑุนุงุช ูโุดูุฏ.</li>
<li>ุจุฑุง <strong>ูพุฑุณโูุฌููุง ุชูุณุฑุดุฏู (interpreted queries)</strong>ุ ูุงููุฏ ูพุฑุณโูุฌููุง ูพุงฺฏุงู ุฏุงุฏูุ ุงู ูุฏู <strong>ุจู ุตูุฑุช ููููู</strong> ุฑุนุงุช ูโุดูุฏ.</li>
</ul>
<hr>
<p>ุฒุฑูพุฑุณโูุฌู <strong>ูุฑ ุฒูุงู ฺฉู ูุงุฒ ุจุงุดุฏ ุงุฌุฑุง ูโุดูุฏ ุชุง ูพุฑุณโูุฌู ุจุฑูู ุฑุง ุชุบุฐู ฺฉูุฏ</strong>. ููุงูโุทูุฑ ฺฉู ุฏุฑ ุดฺฉูโูุง ธ-ท ู ธ-ธ ูุดุงู ุฏุงุฏู ุดุฏูุ <strong>ุฒุฑูพุฑุณโูุฌู (ููุงุฑ ููุงูู ุจุงูุง)</strong> ุจุฑุง ูุฑ ุชฺฉุฑุงุฑ ุญููู ุจุฑูู ฺฉ ุจุงุฑ ุงุฌุฑุง ูโุดูุฏ.</p>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-8.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>ูโุชูุงูู <strong>ุฒุฑูพุฑุณโูุฌู ูุจู</strong> ุฑุง ุจู ุดฺฉู ูุฎุชุตุฑุชุฑ ุงูโฺฏููู ุจุงู ฺฉูู:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query =
    from n in names
    where n.Length == names.OrderBy(n2 =&gt; n2.Length).First().Length
    select n;
</code></pre>
<p>ุจุง ุงุณุชูุงุฏู ุงุฒ <strong>ุชุงุจุน ุชุฌูุน <code>Min</code></strong> ูโุชูุงู ูพุฑุณโูุฌู ุฑุง ุญุช ุณุงุฏูโุชุฑ ฺฉุฑุฏ:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query =
    from n in names
    where n.Length == names.Min(n2 =&gt; n2.Length)
    select n;
</code></pre>
<hr>
<p>ุฏุฑ ุจุฎุด <strong>โInterpreted Queriesโ</strong> ุฏุฑ ุตูุญู 448ุ ุชูุถุญ ุฏุงุฏูโุงู ฺฉู ฺฺฏููู ูโุชูุงู ุงุฒ ููุงุจุน ุฑุงูโุฏูุฑ ูุงููุฏ ุฌุฏุงูู SQL ูพุฑุณโูุฌู ฺฏุฑูุช. ูุซุงู ุจุงูุง ุจุฑุง <strong>ูพุฑุณโูุฌู ูพุงฺฏุงู ุฏุงุฏู</strong> ุงุฏูโุขู ุงุณุชุ ุฒุฑุง ุจู ุตูุฑุช ฺฉ ูุงุญุฏ ูพุฑุฏุงุฒุด ูโุดูุฏ ู ููุท ฺฉ ุจุงุฑ ูุงุฒ ุจู ุงุฑุณุงู ุจู ุณุฑูุฑ ูพุงฺฏุงู ุฏุงุฏู ุฏุงุฑุฏ. ๐ฅ๏ธ</p>
<p>ุจุง ุงู ุญุงูุ ุจุฑุง ฺฉ ูุฌููุนู ูุญูุ ุงู ูพุฑุณโูุฌู <strong>ุจููู ูุณุช</strong>ุ ฺูู ุฒุฑูพุฑุณโูุฌู <strong>ุฏุฑ ูุฑ ุชฺฉุฑุงุฑ ุญููู ุจุฑูู ุฏูุจุงุฑู ูุญุงุณุจู ูโุดูุฏ</strong>.</p>
<p>ุจุฑุง ุงุฌุชูุงุจ ุงุฒ ุงู ูุงฺฉุงุฑุขูุฏุ ูโุชูุงูู ุฒุฑูพุฑุณโูุฌู ุฑุง <strong>ุจู ุตูุฑุช ุฌุฏุงฺฏุงูู ุงุฌุฑุง ฺฉูู</strong> ุชุง ุฏฺฏุฑ ุฒุฑูพุฑุณโูุฌู ูุจุงุดุฏ:</p>
<pre><code class="language-csharp">int shortest = names.Min(n =&gt; n.Length);
IEnumerable&lt;string&gt; query =
    from n in names
    where n.Length == shortest
    select n;
</code></pre>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-9.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>ุชูฺฉฺฉ ุฒุฑูพุฑุณโูุฌููุง ุจู ุงู ุตูุฑุช ุชูุฑุจุงู ููุดู ุฏุฑ <strong>ูพุฑุณโูุฌููุง ุฑู ูุฌููุนูโูุง ูุญู</strong> ุชูุตู ูโุดูุฏุ ุฒุฑุง ฺฉุงุฑุง ู ูุถูุญ ฺฉุฏ ุฑุง ุงูุฒุงุด ูโุฏูุฏ. ุชููุง ุงุณุชุซูุงุก ุฒูุงู ุงุณุช ฺฉู ุฒุฑูพุฑุณโูุฌู <strong>ูุฑุชุจุท (correlated)</strong> ุจุงุดุฏุ ุนู ุจู ูุชุบุฑูุง ูุญุฏูุฏูโ ูพุฑุณโูุฌู ุจุฑูู ุงุดุงุฑู ฺฉูุฏ. ุฒุฑูพุฑุณโูุฌููุง ูุฑุชุจุท ุฏุฑ ุจุฎุด ยซProjectingยป ุฏุฑ ุตูุญู 473 ุชูุถุญ ุฏุงุฏู ุดุฏูโุงูุฏ.
<strong>ุฒุฑูพุฑุณโูุฌููุง ู ุงุฌุฑุง ุชูุจู (Deferred Execution)</strong>
ฺฉ ุนููฺฏุฑ ุนูุตุฑ ุง ุชุฌูุน ูุงููุฏ <code>First</code> ุง <code>Count</code> ุฏุฑ ฺฉ ุฒุฑูพุฑุณโูุฌูุ ุจุงุนุซ ุงุฌุฑุง ููุฑ ูพุฑุณโูุฌู ุจุฑูู ููโุดูุฏโุงุฌุฑุง ุชูุจู ูููุฒ ุจุฑุง ูพุฑุณโูุฌู ุจุฑูู ุจุฑูุฑุงุฑ ุงุณุช. ุฏูู ุงู ุงุณุช ฺฉู ุฒุฑูพุฑุณโูุฌููุง ุจูโุตูุฑุช ุบุฑูุณุชูู ูุฑุงุฎูุงู ูโุดููุฏโุฏุฑ ููุฑุฏ ูพุฑุณโูุฌููุง ูุญูุ ุงุฒ ุทุฑู ฺฉ <strong>delegate</strong> ู ุฏุฑ ููุฑุฏ ูพุฑุณโูุฌููุง ุชูุณุฑุดุฏูุ ุงุฒ ุทุฑู ฺฉ <strong>expression tree</strong>.</p>
<p>ฺฉ ุญุงูุช ุฌุงูุจ ุฒูุงู ูพุด ูโุขุฏ ฺฉู ุฒุฑูพุฑุณโูุฌู ุฑุง ุฏุฑ ฺฉ ุนุจุงุฑุช <code>Select</code> ูุฑุงุฑ ุฏูุฏ. ุฏุฑ ูพุฑุณโูุฌููุง ูุญูุ ุดูุง ุฏุฑ ูุงูุน <strong>ฺฉ ุฏูุจุงูู ุงุฒ ูพุฑุณโูุฌููุง ุฑุง ูพุฑูุฌฺฉุช ูโฺฉูุฏ</strong>โูุฑ ฺฉุฏุงู ุฎูุฏ ุชุญุช ุงุฌุฑุง ุชูุจู ูุณุชูุฏ. ุงู ฺฉุงุฑ ูุนูููุงู ุดูุงู ุงุณุช ู <strong>ุจู ุจูุจูุฏ ฺฉุงุฑุง ฺฉูฺฉ ูโฺฉูุฏ</strong>. ูุซุงูโูุง ุฏููโุชุฑ ุจุฑุง ุฒุฑูพุฑุณโูุฌููุง <code>Select</code> ุฏุฑ ูุตู 9 ุจุฑุฑุณ ุดุฏูโุงูุฏ.</p>
<hr>
<h3><strong>ุงุณุชุฑุงุชฺโูุง ุชุฑฺฉุจ ูพุฑุณโูุฌููุง</strong></h3>
<p>ุณู ุงุณุชุฑุงุชฺ ุงุตู ุจุฑุง ุณุงุฎุช ูพุฑุณโูุฌููุง ูพฺุฏูโุชุฑ ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ููู ุขููุง <strong>ุฒูุฌุฑูโุง ุงุฒ ุนููฺฏุฑูุง</strong> ุงุฌุงุฏ ูโฺฉููุฏ ู ุฏุฑ ุฒูุงู ุงุฌุฑุง ูุชุฌูโุง ฺฉุณุงู ุฏุงุฑูุฏ:</p>
<ol>
<li><strong>ุณุงุฎุช ุชุฏุฑุฌ ูพุฑุณโูุฌู (Progressive query construction)</strong></li>
<li><strong>ุงุณุชูุงุฏู ุงุฒ ฺฉููู ฺฉูุฏ <code>into</code></strong></li>
<li><strong>ูพฺุงูุฏู ูพุฑุณโูุฌููุง (Wrapping queries)</strong></li>
</ol>
<hr>
<h3><strong>ุณุงุฎุช ุชุฏุฑุฌ ูพุฑุณโูุฌู (Progressive Query Building)</strong></h3>
<p>ุฏุฑ ุงุจุชุฏุง ูุตูุ ูุญูู ุณุงุฎุช ุชุฏุฑุฌ ฺฉ ูพุฑุณโูุฌู ุจุง <strong>syntax ููููุช</strong> ุฑุง ูุดุงูุฏู ฺฉุฑุฏู:</p>
<pre><code class="language-csharp">var filtered = names.Where(n =&gt; n.Contains(&quot;a&quot;));
var sorted   = filtered.OrderBy(n =&gt; n);
var query    = sorted.Select(n =&gt; n.ToUpper());
</code></pre>
<p>ูุฑ ุนููฺฏุฑ ูพุฑุณโูุฌู ฺฉ <strong>decorator sequence</strong> ุจุงุฒูโฺฏุฑุฏุงูุฏ ู ุฏุฑ ูุชุฌู ูพุฑุณโูุฌู ููุงู <strong>ุฒูุฌุฑูโ ูุงูโูุงูโุง ุงุฒ ุฏฺฉูุฑุชูุฑูุง</strong> ุฑุง ุฏุงุฑุฏ ฺฉู ุฏุฑ ฺฉ ูพุฑุณโูุฌู ุชฺฉโุนุจุงุฑุช ุงุฌุงุฏ ูโุดูุฏ.</p>
<p><strong>ูุฒุงุง ุณุงุฎุช ุชุฏุฑุฌ ูพุฑุณโูุฌู:</strong></p>
<ul>
<li>ููุดุชู ูพุฑุณโูุฌููุง ุขุณุงูโุชุฑ ูโุดูุฏ.</li>
<li>ุงูฺฉุงู ุงูุฒูุฏู ุนููฺฏุฑูุง ุจูโุตูุฑุช ุดุฑุท ูุฌูุฏ ุฏุงุฑุฏ. ูุซุงู:</li>
</ul>
<pre><code class="language-csharp">if (includeFilter) 
    query = query.Where(...);
</code></pre>
<p>ุงู ุฑูุด <strong>ุจูููโุชุฑ ุงุฒ ููุดุชู ุดุฑุท ุฏุงุฎู ูพุฑุณโูุฌู</strong> ุงุณุช:</p>
<pre><code class="language-csharp">query = query.Where(n =&gt; !includeFilter || &lt;expression&gt;);
</code></pre>
<p>ุฒุฑุง ุงฺฏุฑ <code>includeFilter</code> ุจุฑุงุจุฑ <code>false</code> ุจุงุดุฏุ ฺฉ ุนููฺฏุฑ ุงุถุงูู ุงุถุงูู ููโุดูุฏ.</p>
<hr>
<h3><strong>ูุซุงู ุนูู: ุญุฐู ุญุฑูู ุตุฏุงุฏุงุฑ ู ูุฑุชุจโุณุงุฒ</strong></h3>
<p>ูโุฎูุงูู ุงุฒ ฺฉ ูุณุช ุงุณุงู ุชูุงู <strong>ุญุฑูู ุตุฏุงุฏุงุฑ</strong> ุฑุง ุญุฐู ฺฉูู ู ุณูพุณ ุงุณุงู ุจุง ุทูู ุจุด ุงุฒ ุฏู ุญุฑู ุฑุง ุจู ุชุฑุชุจ ุงููุจุง ูุฑุชุจ ฺฉูู. ุจุง syntax ููููุช:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query = names
    .Select(n =&gt; n.Replace(&quot;a&quot;,&quot;&quot;).Replace(&quot;e&quot;,&quot;&quot;).Replace(&quot;i&quot;,&quot;&quot;)
                  .Replace(&quot;o&quot;,&quot;&quot;).Replace(&quot;u&quot;,&quot;&quot;))
    .Where(n =&gt; n.Length &gt; 2)
    .OrderBy(n =&gt; n);

// ุฎุฑูุฌ:
// Dck
// Hrry
// Mry
</code></pre>
<p>ุจู ุฌุง ูพูุฌ ุจุงุฑ ูุฑุงุฎูุงู <code>Replace</code> ูโุชูุงู ุงุฒ <strong>Regular Expression</strong> ูู ุงุณุชูุงุฏู ฺฉุฑุฏ:</p>
<pre><code class="language-csharp">n =&gt; Regex.Replace(n, &quot;[aeiou]&quot;, &quot;&quot;)
</code></pre>
<p>ูุฒุช <code>Replace</code> ุงู ุงุณุช ฺฉู ุฏุฑ <strong>ูพุฑุณโูุฌููุง ูพุงฺฏุงู ุฏุงุฏู</strong> ูุฒ ฺฉุงุฑ ูโฺฉูุฏ.</p>
<hr>
<h3><strong>ฺุงูุด ุฏุฑ ุชุฑุฌูู ูุณุชูู ุจู Query Syntax</strong></h3>
<p>ุฏุฑ <strong>query syntax</strong>ุ <code>select</code> ุจุงุฏ ุจุนุฏ ุงุฒ <code>where</code> ู <code>orderby</code> ุจุงุฏุ ู ุงฺฏุฑ ุชุฑุชุจ ุฑุง ุชุบุฑ ุฏููุ ูุชุฌู ูุชูุงูุช ุฎูุงูุฏ ุจูุฏ:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query =
    from n in names
    where n.Length &gt; 2
    orderby n
    select n.Replace(&quot;a&quot;,&quot;&quot;).Replace(&quot;e&quot;,&quot;&quot;).Replace(&quot;i&quot;,&quot;&quot;)
             .Replace(&quot;o&quot;,&quot;&quot;).Replace(&quot;u&quot;,&quot;&quot;);

// ุฎุฑูุฌ:
// Dck
// Hrry
// Jy
// Mry
// Tm
</code></pre>
<hr>
<h3><strong>ุฑุงู ุญู: ูพุฑุณโูุฌู ุชุฏุฑุฌ ุฏุฑ Query Syntax</strong></h3>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query =
    from n in names
    select n.Replace(&quot;a&quot;,&quot;&quot;).Replace(&quot;e&quot;,&quot;&quot;).Replace(&quot;i&quot;,&quot;&quot;)
            .Replace(&quot;o&quot;,&quot;&quot;).Replace(&quot;u&quot;,&quot;&quot;);

query = from n in query
        where n.Length &gt; 2
        orderby n
        select n;

// ุฎุฑูุฌ:
// Dck
// Hrry
// Mry
</code></pre>
<p>ุจุง ุงู ุฑูุดุ ูุชุฌู ููุงููุฏ ูพุฑุณโูุฌู ููููุช ุจุงู ูโูุงูุฏ ู <strong>ุฎูุงูุง ู ุงูุนุทุงู ุจุดุชุฑ</strong> ุฏุงุฑุฏ.</p>
<h3><strong>ฺฉููู ฺฉูุฏ <code>into</code> ุฏุฑ LINQ</strong></h3>
<p>ฺฉููู ฺฉูุฏ <code>into</code> ุฏุฑ <strong>query expressions</strong> ุจุณุชู ุจู ุฒูููุ ุฏู ูุนูุง ุฏุงุฑุฏ. ูุนูุง ฺฉู ุฏุฑ ุงูุฌุง ุจุฑุฑุณ ูโฺฉูู ุจุฑุง <strong>ุงุฏุงูู ุฏุงุฏู ูพุฑุณโูุฌู ุจุนุฏ ุงุฒ ฺฉ projection</strong> ุงุณุช (ูุนูุง ุฏฺฏุฑ ุจุฑุง <code>GroupJoin</code> ุงุณุช).</p>
<p>ุจุง <code>into</code> ูโุชูุงู ูพุฑุณโูุฌู ุฑุง <strong>ูพุณ ุงุฒ ฺฉ select ุงุฏุงูู ุฏุงุฏ</strong> ู ุงู ุฏุฑ ูุงูุน ฺฉ <strong>ูุงูุจุฑ ุจุฑุง ูพุฑุณโูุฌู ุชุฏุฑุฌ</strong> ุงุณุช. ุจุฑุง ูุซุงูุ ูพุฑุณโูุฌู ูุจู ุฑุง ูโุชูุงู ุจู ุดฺฉู ุฒุฑ ููุดุช:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query =
    from n in names
    select n.Replace(&quot;a&quot;,&quot;&quot;).Replace(&quot;e&quot;,&quot;&quot;).Replace(&quot;i&quot;,&quot;&quot;)
            .Replace(&quot;o&quot;,&quot;&quot;).Replace(&quot;u&quot;,&quot;&quot;)
    into noVowel
    where noVowel.Length &gt; 2
    orderby noVowel
    select noVowel;
</code></pre>
<ul>
<li><strong>ูุญุฏูุฏู ุงุณุชูุงุฏู</strong>: ุชููุง ุจุนุฏ ุงุฒ ฺฉ <code>select</code> ุง <code>group</code> ูโุชูุงู ุงุฒ <code>into</code> ุงุณุชูุงุฏู ฺฉุฑุฏ.</li>
<li><code>into</code> ูพุฑุณโูุฌู ุฑุง ยซุฑุณุชุงุฑุชยป ูโฺฉูุฏ ู ุงุฌุงุฒู ูโุฏูุฏ ฺฉู <strong>clauses ุฌุฏุฏ</strong> ูุซู <code>where</code>ุ <code>orderby</code> ู <code>select</code> ุงุถุงูู ุดููุฏ.</li>
<li>ุงุฒ ุฏุฏ <strong>fluent syntax</strong>ุ ุชูุงู ูพุฑุณโูุฌู ฺฉ ูพุฑุณโูุฌู ูุงุญุฏ ุงุณุช ู ุงุณุชูุงุฏู ุงุฒ <code>into</code> <strong>ูฺ ูุฒูู ุนููฺฉุฑุฏ ุงุถุงู</strong> ูุฏุงุฑุฏ.</li>
</ul>
<p><strong>ูุนุงุฏู ุฏุฑ Fluent Syntax</strong>: ุฏุฑ ูุงูุน ฺฉ <strong>ุฒูุฌุฑู ุทููุงูโุชุฑ ุงุฒ ุนููฺฏุฑูุง</strong> ุงุณุช.</p>
<hr>
<h3><strong>ููุงูู ูุญุฏูุฏู (Scoping Rules)</strong></h3>
<p>ุชูุงู <strong>range variables</strong> ูพุณ ุงุฒ <code>into</code> ุงุฒ ูุญุฏูุฏู ุฎุงุฑุฌ ูโุดููุฏ. ูุซุงู ูุงุฏุฑุณุช:</p>
<pre><code class="language-csharp">var query =
    from n1 in names
    select n1.ToUpper()
    into n2          // ููุท n2 ูุงุจู ุฏุณุชุฑุณ ุงุณุช
    where n1.Contains(&quot;x&quot;)  // ุฎุทุง: n1 ุงุฒ ูุญุฏูุฏู ุฎุงุฑุฌ ุดุฏู
    select n2;
</code></pre>
<p><strong>ุชูุถุญ:</strong> ุฏุฑ fluent syntax ูุนุงุฏู:</p>
<pre><code class="language-csharp">var query = names
    .Select(n1 =&gt; n1.ToUpper())
    .Where(n2 =&gt; n1.Contains(&quot;x&quot;)); // ุฎุทุง: n1 ุฏฺฏุฑ ุฏุฑ ุฏุณุชุฑุณ ูุณุช
</code></pre>
<hr>
<h3><strong>ูพฺุงูุฏู ูพุฑุณโูุฌููุง (Wrapping Queries)</strong></h3>
<p>ฺฉ ูพุฑุณโูุฌู ุชุฏุฑุฌ ูโุชูุงูุฏ ุจู ุดฺฉู <strong>ฺฉ statement ูุงุญุฏ</strong> ุจุง <strong>ูพฺุงูุฏู ฺฉ ูพุฑุณโูุฌู ุฏุฑ ูพุฑุณโูุฌู ุฏฺฏุฑ</strong> ููุดุชู ุดูุฏ:</p>
<pre><code class="language-csharp">var tempQuery = tempQueryExpr;
var finalQuery = from ... in tempQuery ...
</code></pre>
<p>ูุนุงุฏู <strong>ูุฑู ุจุฏูู ูุชุบุฑ ูุงุณุท</strong>:</p>
<pre><code class="language-csharp">var finalQuery = from ... in (tempQueryExpr)
                 ...
</code></pre>
<p><strong>ูุซุงู ุนูู:</strong></p>
<p>ูพุฑุณโูุฌู ุชุฏุฑุฌ:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query =
    from n in names
    select n.Replace(&quot;a&quot;,&quot;&quot;).Replace(&quot;e&quot;,&quot;&quot;).Replace(&quot;i&quot;,&quot;&quot;)
            .Replace(&quot;o&quot;,&quot;&quot;).Replace(&quot;u&quot;,&quot;&quot;);

query = from n in query
        where n.Length &gt; 2
        orderby n
        select n;
</code></pre>
<p>ููุงู ูพุฑุณโูุฌู ุจู ุตูุฑุช <strong>wrapped</strong>:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query =
    from n1 in
    (
        from n2 in names
        select n2.Replace(&quot;a&quot;,&quot;&quot;).Replace(&quot;e&quot;,&quot;&quot;).Replace(&quot;i&quot;,&quot;&quot;)
                 .Replace(&quot;o&quot;,&quot;&quot;).Replace(&quot;u&quot;,&quot;&quot;)
    )
    where n1.Length &gt; 2
    orderby n1
    select n1;
</code></pre>
<p>ุฏุฑ <strong>fluent syntax</strong>ุ ูุชุฌู ููุงู ุฒูุฌุฑู ุฎุท ุนููฺฏุฑูุง ุงุณุช:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query = names
    .Select(n =&gt; n.Replace(&quot;a&quot;,&quot;&quot;).Replace(&quot;e&quot;,&quot;&quot;).Replace(&quot;i&quot;,&quot;&quot;)
                   .Replace(&quot;o&quot;,&quot;&quot;).Replace(&quot;u&quot;,&quot;&quot;))
    .Where(n =&gt; n.Length &gt; 2)
    .OrderBy(n =&gt; n);
</code></pre>
<blockquote>
<p>ฺฉุงููพุงูุฑ <strong>ุขุฎุฑู <code>Select</code> ุฑุง ุญุฐู ูโฺฉูุฏ</strong> ฺูู ุงุถุงูู ู ุชฺฉุฑุงุฑ ุงุณุช.</p>
</blockquote>
<hr>
<h3><strong>ุชูุงูุช Wrapping ุจุง Subquery</strong></h3>
<ul>
<li><strong>Wrapping</strong>: ูพุฑุณโูุฌู ุฏุงุฎู ููุงู ูพุฑุณโูุฌู ูุจู ุงุณุช ู ููุท ุจู <strong>ุชุฑุชุจ ุนููฺฏุฑูุง</strong> ุฒูุฌุฑูโุง ุงุถุงูู ูโุดูุฏ.</li>
<li><strong>Subquery</strong>: ูพุฑุณโูุฌู ุฏุงุฎู <strong>ุฏุฑ Lambda ูพุฑุณโูุฌู ุจุฑูู</strong> ูุฑุงุฑ ุฏุงุฑุฏ ู <strong>ุจุฑ ุงุณุงุณ ุชูุงุถุง</strong> ุงุฌุฑุง ูโุดูุฏ.</li>
</ul>
<p>๐น ูุซุงู ูุงุณ:</p>
<ul>
<li>Wrapping โ ูพุฑุณโูุฌู ุฏุงุฎู = <strong>ููุงุฑ ููุงูู ูุจู</strong></li>
<li>Subquery โ ูพุฑุณโูุฌู ุฏุงุฎู = <strong>ุฑู ููุงุฑ ููุงูู ุณูุงุฑ ุงุณุช ู ููฺฏุงู ูุงุฒ ูุนุงู ูโุดูุฏ</strong></li>
</ul>
<h3><strong>Projection Strategies ุฏุฑ LINQ</strong></h3>
<p>ุฏุฑ ุงู ุจุฎุด ุจู <strong>ุฑูุดโูุง ูพุดุฑูุชูโ projection</strong> ุฏุฑ LINQ ูโูพุฑุฏุงุฒูุ ุนู ุชุจุฏู ุนูุงุตุฑ ูุฌููุนู ุจู ุดฺฉู ุฏูุฎูุงู ูุจู ุงุฒ ุจุงุฒฺฏุฑุฏุงูุฏู ุขูโูุง.</p>
<hr>
<h2><strong>Object Initializers</strong></h2>
<p>ุชุง ฺฉููู ุฏุฑ <code>select</code>ุ ููุท ุนูุงุตุฑ ุงุณฺฉุงูุฑ (ูุงููุฏ <code>int</code> ุง <code>string</code>) ุฑุง projection ฺฉุฑุฏูโุงู. ุจุง <strong>object initializers</strong> ูโุชูุงูู projection ุฑุง ุจู <strong>ุงููุงุน ูพฺุฏูโุชุฑ</strong> ุงูุฌุงู ุฏูู.</p>
<p>ูุซุงู: ูโุฎูุงูู ูุงูโูุง ุฑุง ุจุฏูู ุญุฑูู ุตุฏุงุฏุงุฑ ุฏุงุดุชู ุจุงุดูุ ูู ูุงู ุงุตู ูู ุญูุธ ุดูุฏ:</p>
<pre><code class="language-csharp">class TempProjectionItem
{
    public string Original;   // ูุงู ุงุตู
    public string Vowelless;  // ูุงู ุจุฏูู ุญุฑูู ุตุฏุงุฏุงุฑ
}
</code></pre>
<p>ุณูพุณ ุฏุฑ ูพุฑุณโูุฌู ูโุชูุงูู projection ฺฉูู:</p>
<pre><code class="language-csharp">string[] names = { &quot;Tom&quot;, &quot;Dick&quot;, &quot;Harry&quot;, &quot;Mary&quot;, &quot;Jay&quot; };

IEnumerable&lt;TempProjectionItem&gt; temp =
    from n in names
    select new TempProjectionItem
    {
        Original = n,
        Vowelless = n.Replace(&quot;a&quot;,&quot;&quot;).Replace(&quot;e&quot;,&quot;&quot;).Replace(&quot;i&quot;,&quot;&quot;)
                     .Replace(&quot;o&quot;,&quot;&quot;).Replace(&quot;u&quot;,&quot;&quot;)
    };
</code></pre>
<p>ูุชุฌู ููุน <code>IEnumerable&lt;TempProjectionItem&gt;</code> ุฎูุงูุฏ ุจูุฏ ู ูโุชูุงูู ูพุฑุณโูุฌู ุจุนุฏ ุฑู ุขู ุงูุฌุงู ุฏูู:</p>
<pre><code class="language-csharp">IEnumerable&lt;string&gt; query =
    from item in temp
    where item.Vowelless.Length &gt; 2
    select item.Original;

// ูุชุฌู:
// Dick
// Harry
// Mary
</code></pre>
<hr>
<h2><strong>Anonymous Types</strong></h2>
<p>ุจุฑุง ุญุฐู ูุงุฒ ุจู ููุดุชู ฺฉูุงุณ ูููุชุ ูโุชูุงู ุงุฒ <strong>anonymous types</strong> ุงุณุชูุงุฏู ฺฉุฑุฏ:</p>
<pre><code class="language-csharp">var intermediate =
    from n in names
    select new
    {
        Original = n,
        Vowelless = n.Replace(&quot;a&quot;,&quot;&quot;).Replace(&quot;e&quot;,&quot;&quot;).Replace(&quot;i&quot;,&quot;&quot;)
                     .Replace(&quot;o&quot;,&quot;&quot;).Replace(&quot;u&quot;,&quot;&quot;)
    };

IEnumerable&lt;string&gt; query =
    from item in intermediate
    where item.Vowelless.Length &gt; 2
    select item.Original;
</code></pre>
<ul>
<li>ูุชุฌู ููุงููุฏ ููููู ูุจู ุงุณุช.</li>
<li>ููุน <code>intermediate</code> ุชูุณุท ฺฉุงููพุงูุฑ ุณุงุฎุชู ูโุดูุฏ ู ูุงู ูุดุฎุต ูุฏุงุฑุฏุ ุจูุงุจุฑุงู ุชููุง ุจุง <code>var</code> ูโุชูุงู ุขู ุฑุง ูฺฏู ุฏุงุดุช.</li>
</ul>
<p>ูโุชูุงู ฺฉู ูพุฑุณโูุฌู ุฑุง ุจุง <code>into</code> ุจู ุตูุฑุช ฺฉูุชุงูโุชุฑ ููุดุช:</p>
<pre><code class="language-csharp">var query =
    from n in names
    select new
    {
        Original = n,
        Vowelless = n.Replace(&quot;a&quot;,&quot;&quot;).Replace(&quot;e&quot;,&quot;&quot;).Replace(&quot;i&quot;,&quot;&quot;)
                     .Replace(&quot;o&quot;,&quot;&quot;).Replace(&quot;u&quot;,&quot;&quot;)
    }
    into temp
    where temp.Vowelless.Length &gt; 2
    select temp.Original;
</code></pre>
<hr>
<h2><strong>ฺฉููู ฺฉูุฏ <code>let</code></strong></h2>
<p><code>let</code> ฺฉ <strong>ูุชุบุฑ ุฌุฏุฏ</strong> ุฏุฑ ฺฉูุงุฑ range variable ุงุฌุงุฏ ูโฺฉูุฏ ู ุจุงุนุซ ุณุงุฏูโุชุฑ ุดุฏู ูพุฑุณโูุฌู ูโุดูุฏ.</p>
<p>ูุซุงู ุงุณุชุฎุฑุงุฌ ูุงูโูุง ฺฉู ุทูู ุขูโูุง ุจุฏูู ุญุฑูู ุตุฏุงุฏุงุฑ ุจุดุชุฑ ุงุฒ ฒ ุงุณุช:</p>
<pre><code class="language-csharp">string[] names = { &quot;Tom&quot;, &quot;Dick&quot;, &quot;Harry&quot;, &quot;Mary&quot;, &quot;Jay&quot; };

IEnumerable&lt;string&gt; query =
    from n in names
    let vowelless = n.Replace(&quot;a&quot;,&quot;&quot;).Replace(&quot;e&quot;,&quot;&quot;).Replace(&quot;i&quot;,&quot;&quot;)
                     .Replace(&quot;o&quot;,&quot;&quot;).Replace(&quot;u&quot;,&quot;&quot;)
    where vowelless.Length &gt; 2
    orderby vowelless
    select n; // n ูููุฒ ุฏุฑ ุฏุณุชุฑุณ ุงุณุช
</code></pre>
<p><strong>ูฺฺฏโูุง let:</strong></p>
<ol>
<li>projection ุนูุงุตุฑ ุฌุฏุฏ ููุฑุงู ุจุง ุนูุงุตุฑ ููุฌูุฏ.</li>
<li>ุงูฺฉุงู ุงุณุชูุงุฏู ูุฌุฏุฏ ุงุฒ ฺฉ ุนุจุงุฑุช ุจุฏูู ูุงุฒ ุจู ููุดุชู ุฏูุจุงุฑู ุขู.</li>
</ol>
<ul>
<li>let ูโุชูุงูุฏ ูุจู ุง ุจุนุฏ ุงุฒ <code>where</code> ูุฑุงุฑ ฺฏุฑุฏ.</li>
<li>let ูโุชูุงูุฏ ุจู subsequence ูู ุงุดุงุฑู ฺฉูุฏุ ูู ููุท ุงุณฺฉุงูุฑ.</li>
</ul>
<blockquote>
<p>ุฏุฑ ูุงูุนุ let ุชูุณุท ฺฉุงููพุงูุฑ ุจู <strong>anonymous type</strong> ุชุจุฏู ูโุดูุฏ ฺฉู ุดุงูู ูุชุบุฑ range ุงุตู ู ูุชุบุฑ let ุงุณุช.</p>
</blockquote>
<h3><strong>Interpreted Queries ุฏุฑ LINQ</strong></h3>
<p>LINQ ุฏู ูุนูุงุฑ ููุงุฒ ุฏุงุฑุฏ:</p>
<ol>
<li><strong>Local Queries</strong>: ุจุฑุง ูุฌููุนูโูุง ูุญู (<code>IEnumerable&lt;T&gt;</code>).</li>
<li><strong>Interpreted Queries</strong>: ุจุฑุง ููุงุจุน ุฏุงุฏูโ ุฑุงู ุฏูุฑ ูุงููุฏ ูพุงฺฏุงู ุฏุงุฏู (<code>IQueryable&lt;T&gt;</code>).</li>
</ol>
<hr>
<h2><strong>Local vs Interpreted Queries</strong></h2>
<ul>
<li>
<p><strong>Local Queries</strong>:</p>
<ul>
<li>ุฑู ูุฌููุนูโูุง ูุญู ุงุฌุฑุง ูโุดููุฏ (<code>IEnumerable&lt;T&gt;</code>).</li>
<li>ุงุฒ ูุชุฏูุง ฺฉูุงุณ <code>Enumerable</code> ุงุณุชูุงุฏู ูโฺฉููุฏ.</li>
<li>delegateูุง ฺฉุงููุงู ูุญู ูุณุชูุฏ ู ูุซู ูุฑ ูุชุฏ C# ุฏฺฏุฑ ุงุฌุฑุง ูโุดููุฏ.</li>
<li>ูุชุงุฌ ุจู ุตูุฑุช ุฒูุฌุฑูโุง ุงุฒ decorator sequences ุชููุฏ ูโุดููุฏ.</li>
</ul>
</li>
<li>
<p><strong>Interpreted Queries</strong>:</p>
<ul>
<li>ุฑู ููุงุจุน ุฑุงู ุฏูุฑ ุงุฌุฑุง ูโุดููุฏ (<code>IQueryable&lt;T&gt;</code>).</li>
<li>ุงุฒ ูุชุฏูุง ฺฉูุงุณ <code>Queryable</code> ุงุณุชูุงุฏู ูโฺฉููุฏ.</li>
<li><strong>expression tree</strong> ุชููุฏ ูโฺฉููุฏ ฺฉู ุฏุฑ ุฒูุงู ุงุฌุฑุง ุชูุณุฑ ุดุฏู ู ูโุชูุงูุฏ ุจู SQL ุง ุฒุจุงู ุฏฺฏุฑ ุชุฑุฌูู ุดูุฏ.</li>
</ul>
</li>
</ul>
<blockquote>
<p>ุชูุฌู: ุงุณุชูุงุฏู ุงุฒ ูุชุฏูุง <code>Enumerable</code> ุฑู <code>IQueryable&lt;T&gt;</code> ุจุงุนุซ ุงุฌุฑุง ูุญู ุชูุงู ุฏุงุฏูโูุง ูโุดูุฏุ ุจูุงุจุฑุงู ุจุฑุง ูพุฑุณโูุฌููุง ุฑุงู ุฏูุฑุ ุจุงุฏ ุงุฒ <code>Queryable</code> ุงุณุชูุงุฏู ฺฉุฑุฏ.</p>
</blockquote>
<hr>
<h2><strong>ุงุฌุงุฏ ฺฉ Interpreted Query ุจุง EF Core</strong></h2>
<p>ูุซุงู: ุฌุฏูู <code>Customer</code> ุฏุฑ SQL Server:</p>
<pre><code class="language-sql">CREATE TABLE Customer
(
    ID int NOT NULL PRIMARY KEY,
    Name varchar(30)
);

INSERT Customer VALUES (1, 'Tom');
INSERT Customer VALUES (2, 'Dick');
INSERT Customer VALUES (3, 'Harry');
INSERT Customer VALUES (4, 'Mary');
INSERT Customer VALUES (5, 'Jay');
</code></pre>
<p>ูพุฑุณโูุฌู LINQ:</p>
<pre><code class="language-csharp">using System;
using System.Linq;
using Microsoft.EntityFrameworkCore;

using var dbContext = new NutshellContext();

IQueryable&lt;string&gt; query = 
    from c in dbContext.Customers
    where c.Name.Contains(&quot;a&quot;)
    orderby c.Name.Length
    select c.Name.ToUpper();

foreach (string name in query)
    Console.WriteLine(name);
</code></pre>
<ul>
<li>ฺฉูุงุณ <code>Customer</code>:</li>
</ul>
<pre><code class="language-csharp">public class Customer
{
    public int ID { get; set; }
    public string Name { get; set; }
}
</code></pre>
<ul>
<li>ฺฉูุงุณ <code>DbContext</code>:</li>
</ul>
<pre><code class="language-csharp">public class NutshellContext : DbContext
{
    public virtual DbSet&lt;Customer&gt; Customers { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder builder)
        =&gt; builder.UseSqlServer(&quot;...connection string...&quot;);

    protected override void OnModelCreating(ModelBuilder modelBuilder)
        =&gt; modelBuilder.Entity&lt;Customer&gt;()
                       .ToTable(&quot;Customer&quot;)
                       .HasKey(c =&gt; c.ID);
}
</code></pre>
<p>EF Core ุงู ูพุฑุณโูุฌู ุฑุง ุจู SQL ุฒุฑ ุชุฑุฌูู ูโฺฉูุฏ:</p>
<pre><code class="language-sql">SELECT UPPER([c].[Name])
FROM [Customers] AS [c]
WHERE CHARINDEX(N'a', [c].[Name]) &gt; 0
ORDER BY CAST(LEN([c].[Name]) AS int)
</code></pre>
<p>ูุชุฌู:</p>
<pre><code>JAY
MARY
HARRY
</code></pre>
<hr>
<h2><strong>ูุญูู ฺฉุงุฑ Interpreted Queries</strong></h2>
<ol>
<li><strong>ุชุจุฏู syntax ูพุฑุณโูุฌู</strong>:
query syntax ุจู fluent syntax ุชุจุฏู ูโุดูุฏ:</li>
</ol>
<pre><code class="language-csharp">IQueryable&lt;string&gt; query = dbContext.Customers
                                    .Where(n =&gt; n.Name.Contains(&quot;a&quot;))
                                    .OrderBy(n =&gt; n.Name.Length)
                                    .Select(n =&gt; n.Name.ToUpper());
</code></pre>
<ol start="2">
<li>
<p><strong>ุงูุชุฎุงุจ ูุชุฏ ููุงุณุจ</strong>:</p>
<ul>
<li><code>dbContext.Customers</code> ููุน <code>DbSet&lt;T&gt;</code> ุฏุงุฑุฏ ฺฉู <code>IQueryable&lt;T&gt;</code> ุงุณุช.</li>
<li>ุจูุงุจุฑุงูุ ูุชุฏูุง ฺฉูุงุณ <code>Queryable</code> ุงูุชุฎุงุจ ูโุดููุฏุ ูู <code>Enumerable</code>.</li>
</ul>
</li>
<li>
<p><strong>ุงุฌุงุฏ Expression Tree</strong>:</p>
<ul>
<li><code>Queryable.Where</code> ฺฉ predicate ุงุฒ ููุน <code>Expression&lt;Func&lt;TSource,bool&gt;&gt;</code> ูโฺฏุฑุฏ.</li>
<li>ูุงูุจุฏุง (<code>n =&gt; n.Name.Contains(&quot;a&quot;)</code>) ุจู <strong>expression tree</strong> ุชุจุฏู ูโุดูุฏ.</li>
<li>ุงู ุฏุฑ ุฒูุงู ุงุฌุฑุง ุชูุณุท EF Core ุจู SQL ุชุจุฏู ูโุดูุฏ.</li>
</ul>
</li>
<li>
<p><strong>ุชฺฉุฑุงุฑ ุจุฑุง ุณุงุฑ ุงูพุฑุงุชูุฑูุง</strong>:</p>
<ul>
<li><code>OrderBy</code> ู <code>Select</code> ูุฒ expression tree ุชููุฏ ูโฺฉููุฏ.</li>
<li>ุฏุฑ ููุงุช ฺฉ ุณุงุฎุชุงุฑ ุฏุงุฏู (expression tree) ุฏุงุฑู ฺฉู ุชูุตู ฺฉุงูู ูพุฑุณโูุฌู ุฑุง ุฏุฑ ุฎูุฏ ูฺฏู ูโุฏุงุฑุฏ ู ูโุชูุงูุฏ ุฏุฑ runtime ุงุฌุฑุง ุง ุจู SQL ุชุฑุฌูู ุดูุฏ.</li>
</ul>
</li>
</ol>
<blockquote>
<p>ุงู ุฑูุด ุจุงุนุซ ูโุดูุฏ LINQ ุจุชูุงูุฏ ูู ุฑู ุฏุงุฏูโูุง ูุญู ู ูู ุฑู ูพุงฺฏุงู ุฏุงุฏูโูุง ุจู ุดฺฉู ฺฉุณุงู ฺฉุงุฑ ฺฉูุฏ.</p>
</blockquote>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-10.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<h3><strong>Execution of Interpreted Queries in LINQ</strong></h3>
<p>Interpreted queries (<code>IQueryable&lt;T&gt;</code>) ูู ูุงููุฏ local queries (<code>IEnumerable&lt;T&gt;</code>) ุงุฒ ูุฏู <strong>deferred execution</strong> ูพุฑู ูโฺฉููุฏ.</p>
<hr>
<h2><strong>ูฺฺฏโูุง ฺฉูุฏ ุงุฌุฑุง Interpreted Queries</strong></h2>
<ol>
<li>
<p><strong>ุชููุฏ SQL ุฏุฑ ุฒูุงู ุงุฌุฑุง Enumeration</strong></p>
<ul>
<li>SQL statement ุชุง ุฒูุงู ฺฉู query ุฑุง enumerate ูฺฉูุฏุ ุณุงุฎุชู ููโุดูุฏ.</li>
<li>enumerate ฺฉุฑุฏู ููุงู query ุฏูุจุงุฑู ุจุงุนุซ ุงุฌุฑุง ุฏูุจุงุฑู SQL ุฑู ูพุงฺฏุงู ุฏุงุฏู ูโุดูุฏ.</li>
</ul>
</li>
<li>
<p><strong>ูพุฑุฏุงุฒุด Expression Tree</strong></p>
<ul>
<li>ููฺฏุงู ฺฉู ฺฉ interpreted query ุฑุง enumerate ูโฺฉูุฏุ outermost sequence ุจุฑูุงููโุง ุฑุง ุงุฌุฑุง ูโฺฉูุฏ ฺฉู <strong>ุชูุงู expression tree</strong> ุฑุง ุจู ุนููุงู ฺฉ ูุงุญุฏ ูพุฑุฏุงุฒุด ูโฺฉูุฏ.</li>
<li>EF Core ุงู expression tree ุฑุง ุจู ฺฉ SQL statement ุชุฑุฌูู ูโฺฉูุฏ ู ูุชุงุฌ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.</li>
<li>ุฏุฑ analogy ุฎุท ุชููุฏ: ุชููุง <strong>ฺฉ ููุงุฑ ููุงูู</strong> ุดุฑูุน ุจู ฺฉุงุฑ ูโฺฉูุฏ ู ุณุงุฑ ููุงุฑูุง ููุท &quot;shell&quot; ูุณุชูุฏ ฺฉู ุฏุณุชูุฑุงูุนููโูุง ุฑุง ุชูุตู ูโฺฉููุฏ.</li>
</ul>
</li>
<li>
<p><strong>ูุญุฏูุฏุช ุฏุฑ ุงูุฒูุฏู ูุชุฏูุง ุณูุงุฑุด</strong></p>
<ul>
<li>ุงุฌุงุฏ extension method ุจุฑุง <code>IQueryable&lt;T&gt;</code> ุฏุดูุงุฑ ุงุณุช ู ูโุชูุงูุฏ ุจุงุนุซ ุนุฏู ุณุงุฒฺฏุงุฑ ุจุง ุณุงุฑ providers ุดูุฏ.</li>
<li>ูุฒุช ฺฉูุงุณ <code>Queryable</code> ุงู ุงุณุช ฺฉู ูุฌููุนู ุงุณุชุงูุฏุงุฑุฏ ุงุฒ ูุชุฏูุง ุจุฑุง ููู remote collections ูุฑุงูู ูโฺฉูุฏ.</li>
</ul>
</li>
<li>
<p><strong>ูุญุฏูุฏุชโูุง Provider</strong></p>
<ul>
<li>ุจุฑุฎ LINQ queries ููฺฉู ุงุณุช ุชูุณุท ฺฉ provider ุฎุงุต (ูุซู EF Core) ุชุฑุฌูู ูุดููุฏ.</li>
<li>ุนูุช: ูุญุฏูุฏุชโูุง ูพุงฺฏุงู ุฏุงุฏู.</li>
<li>ุฏุฑ ุงู ุญุงูุชุ ููฺฉู ุงุณุช runtime exception ุฏุฑุงูุช ฺฉูุฏ.</li>
</ul>
</li>
</ol>
<hr>
<h2><strong>ุชุฑฺฉุจ Interpreted ู Local Queries</strong></h2>
<ul>
<li>ุงูฺฏู: <strong>operators ูุญู ุฏุฑ ุจุฑูู ู interpreted operators ุฏุฑ ุฏุงุฎู</strong></li>
<li>ูุซุงู: extension method ุณูุงุฑุด ุจุฑุง ุฌูุชโุณุงุฒ ุนูุงุตุฑ (<code>Pair</code>)</li>
</ul>
<pre><code class="language-csharp">public static IEnumerable&lt;string&gt; Pair(this IEnumerable&lt;string&gt; source)
{
    string firstHalf = null;
    foreach (string element in source)
    {
        if (firstHalf == null)
            firstHalf = element;
        else
        {
            yield return firstHalf + &quot;, &quot; + element;
            firstHalf = null;
        }
    }
}
</code></pre>
<p>ุชุฑฺฉุจ ุจุง EF Core:</p>
<pre><code class="language-csharp">using var dbContext = new NutshellContext();

IEnumerable&lt;string&gt; q = dbContext.Customers
    .Select(c =&gt; c.Name.ToUpper())  // Interpreted (IQueryable)
    .OrderBy(n =&gt; n)                // Interpreted
    .Pair()                          // Local (IEnumerable)
    .Select((n, i) =&gt; &quot;Pair &quot; + i + &quot; = &quot; + n);

foreach (string element in q)
    Console.WriteLine(element);

// Output:
// Pair 0 = DICK, HARRY
// Pair 1 = JAY, MARY
</code></pre>
<blockquote>
<p>ููุช ฺฉ operator ููุท ุจุฑุง <code>IEnumerable&lt;T&gt;</code> ุชุนุฑู ุดุฏู ุจุงุดุฏุ query ุจู local query ุชุจุฏู ูโุดูุฏ ู ุงุฏุงูู ูพุฑุฏุงุฒุด ุฑู client ุงูุฌุงู ูโุดูุฏ.</p>
</blockquote>
<hr>
<h2><strong>AsEnumerable</strong></h2>
<ul>
<li>ุณุงุฏูโุชุฑู query operator ุจุฑุง ุชุจุฏู <code>IQueryable&lt;T&gt;</code> ุจู <code>IEnumerable&lt;T&gt;</code>:</li>
</ul>
<pre><code class="language-csharp">public static IEnumerable&lt;TSource&gt; AsEnumerable&lt;TSource&gt;(this IEnumerable&lt;TSource&gt; source)
{
    return source;
}
</code></pre>
<ul>
<li>
<p>ฺฉุงุฑุจุฑุฏ:</p>
<ul>
<li>ุจุนุฏ ุงุฒ <code>AsEnumerable()</code>ุ ุชูุงู query operators ุจุนุฏ ุฑู <strong>Enumerable class</strong> ุงุฌุฑุง ูโุดููุฏ.</li>
<li>ุจุฑุฎูุงู <code>ToList</code> ุง <code>ToArray</code>ุ ุงุฌุฑุง query ุฑุง <strong>ููุฑ ููโฺฉูุฏ</strong> ู ูฺ ุญุงูุธู ุงุถุงู ุงุฌุงุฏ ููโฺฉูุฏ.</li>
</ul>
</li>
</ul>
<p>ูุซุงู ุจุง Regular Expression:</p>
<pre><code class="language-csharp">Regex wordCounter = new Regex(@&quot;\b(\w|[-'])+\b&quot;);

using var dbContext = new NutshellContext();

var query = dbContext.MedicalArticles
    .Where(article =&gt; article.Topic == &quot;influenza&quot;)
    .AsEnumerable()  // Force subsequent operators to execute locally
    .Where(article =&gt; wordCounter.Matches(article.Abstract).Count &lt; 100);
</code></pre>
<blockquote>
<p>ูฺฉุชู: ุงุฌุฑุง ุจุฎุด ุงุฒ query ุฑู client ูโุชูุงูุฏ performance ุฑุง ฺฉุงูุด ุฏูุฏุ ุฒุฑุง ููฺฉู ุงุณุช ุชุนุฏุงุฏ ุฑุฏูโูุง ุจุดุชุฑ ุงุฒ ูพุงฺฏุงู ุฏุงุฏู ุฏุฑุงูุช ุดูุฏ.</p>
</blockquote>
<h3>EF Core โก</h3>
<p>ุฏุฑ ุทูู ุงู ูุตู ู ูุตู นุ ูุง ุงุฒ <strong>EF Core</strong> ุจุฑุง ูุดุงู ุฏุงุฏู <strong>interpreted queries</strong> ุงุณุชูุงุฏู ูโฺฉูู.
ุงฺฉููู ุจุงุฏ ุจู ุจุฑุฑุณ ูฺฺฏโูุง ฺฉูุฏ ุงู ููุงูุฑ ุจูพุฑุฏุงุฒู.</p>
<hr>
<h3>ฺฉูุงุณโูุง Entity ุฏุฑ EF Core ๐ท๏ธ</h3>
<p>EF Core ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ุชุง ุงุฒ <strong>ูุฑ ฺฉูุงุณ</strong> ุจุฑุง ููุงุด ุฏุงุฏูโูุง ุงุณุชูุงุฏู ฺฉูุฏุ ุจู ุดุฑุท ฺฉู ุจุฑุง ูุฑ ุณุชูู ููุฑุฏ ูุธุฑ ฺฉ <strong>property ุนููู</strong> ุฏุงุดุชู ุจุงุดุฏ.</p>
<p>ุจูโุนููุงู ูุซุงูุ ูโุชูุงูู ฺฉูุงุณ ุฒุฑ ุฑุง ุจุฑุง <strong>query</strong> ู <strong>update</strong> ุฌุฏูู Customers ุฏุฑ ูพุงฺฏุงู ุฏุงุฏู ุชุนุฑู ฺฉูู:</p>
<pre><code class="language-csharp">public class Customer
{
    public int ID { get; set; } 
    public string Name { get; set; }
}
</code></pre>
<hr>
<h3>DbContext ๐ฆ</h3>
<p>ูพุณ ุงุฒ ุชุนุฑู ฺฉูุงุณโูุง entityุ ูุฑุญูู ุจุนุฏ <strong>subclass ฺฉุฑุฏู DbContext</strong> ุงุณุช.
ฺฉ ููููู ุงุฒ ุงู ฺฉูุงุณ ูุดุงูโุฏููุฏู ุฌูุณุงุช ุดูุง ุจุฑุง ฺฉุงุฑ ุจุง ูพุงฺฏุงู ุฏุงุฏู ุงุณุช. ูุนูููุงู subclass ุดูุง ุดุงูู <strong>ฺฉ property ุงุฒ ููุน DbSet<T></strong> ุจุฑุง ูุฑ entity ุฏุฑ ูุฏู ุดูุง ุฎูุงูุฏ ุจูุฏ:</p>
<pre><code class="language-csharp">public class NutshellContext : DbContext
{
    public DbSet&lt;Customer&gt; Customers { get; set; }
    ... properties ุจุฑุง ุฌุฏุงูู ุฏฺฏุฑ ...
}
</code></pre>
<p>ฺฉ <strong>ุดุก DbContext</strong> ุณู ฺฉุงุฑ ุงูุฌุงู ูโุฏูุฏ:</p>
<ul>
<li>๐น ุจูโุนููุงู <strong>factory</strong> ุจุฑุง ุชููุฏ ุงุดุงุก DbSet&lt;&gt; ฺฉู ูโุชูุงูุฏ ุฑู ุขูโูุง query ุจููุณุฏ.</li>
<li>๐น <strong>ุฑุฏุงุจ ุชุบุฑุงุช</strong> ุงุฌุงุฏ ุดุฏู ุฑู entityูุงุ ุชุง ุจุชูุงูุฏ ุขูโูุง ุฑุง ุฏูุจุงุฑู ุฏุฑ ูพุงฺฏุงู ุฏุงุฏู ุฐุฎุฑู ฺฉูุฏ (ูฺฏุงู ฺฉูุฏ ุจู โChange Trackingโ ุฏุฑ ุตูุญู 461).</li>
<li>๐น ุงุฑุงุฆู <strong>ูุชุฏูุง virtual</strong> ฺฉู ูโุชูุงูุฏ ุขูโูุง ุฑุง override ฺฉูุฏ ุชุง connection ู ูุฏู ุฑุง ูพฺฉุฑุจูุฏ ฺฉูุฏ.</li>
</ul>
<hr>
<h3>ูพฺฉุฑุจูุฏ Connection ๐ง</h3>
<p>ุจุง override ฺฉุฑุฏู ูุชุฏ <strong>OnConfiguring</strong>ุ ูโุชูุงูุฏ <strong>database provider</strong> ู <strong>connection string</strong> ุฑุง ูุดุฎุต ฺฉูุฏ:</p>
<pre><code class="language-csharp">public class NutshellContext : DbContext
{
    ...
    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder) =&gt;
        optionsBuilder.UseSqlServer(
            @&quot;Server=(local);Database=Nutshell;Trusted_Connection=True&quot;);
}
</code></pre>
<p>ุฏุฑ ุงู ูุซุงูุ <strong>connection string</strong> ุจูโุตูุฑุช <strong>string literal</strong> ูุดุฎุต ุดุฏู ุงุณุช.
ุฏุฑ ุจุฑูุงููโูุง ูุงูุนุ ูุนูููุงู ุขู ุฑุง ุงุฒ ฺฉ ูุงู ูพฺฉุฑุจูุฏ ูุงููุฏ <strong>appsettings.json</strong> ูโุฎูุงููุฏ.</p>
<p>ูุชุฏ <strong>UseSqlServer</strong> ฺฉ <strong>extension method</strong> ุงุณุช ฺฉู ุฏุฑ <strong>assembly ูุฑุจูุท ุจู Microsoft.EntityFramework.SqlServer NuGet package</strong> ุชุนุฑู ุดุฏู ุงุณุช.
ุจุฑุง ุณุงุฑ ูพุงฺฏุงูโูุง ุฏุงุฏู ูุงููุฏ Oracleุ MySQLุ PostgreSQL ู SQLite ูุฒ ูพฺฉุฌโูุง ูุดุงุจู ูุฌูุฏ ุฏุงุฑูุฏ.</p>
<hr>
<p>ุงฺฏุฑ ุงุฒ <strong>ASP.NET</strong> ุงุณุชูุงุฏู ูโฺฉูุฏุ ูโุชูุงูุฏ ุจู <strong>dependency injection framework</strong> ุงุฌุงุฒู ุฏูุฏ ฺฉู <strong>optionsBuilder</strong> ุฑุง ุงุฒ ูุจู ูพฺฉุฑุจูุฏ ฺฉูุฏุ ุฏุฑ ุงฺฉุซุฑ ููุงุฑุฏุ ุงู ฺฉุงุฑ ุจุงุนุซ ูโุดูุฏ ฺฉู ูุงุฒ ุจู override ฺฉุฑุฏู <strong>OnConfiguring</strong> ูุฏุงุดุชู ุจุงุดุฏ.</p>
<p>ุจุฑุง ูุนุงู ฺฉุฑุฏู ุงู ูุงุจูุชุ ูโุชูุงูุฏ ฺฉ <strong>constructor</strong> ุจุฑุง DbContext ุจู ุดฺฉู ุฒุฑ ุชุนุฑู ฺฉูุฏ:</p>
<pre><code class="language-csharp">public NutshellContext(DbContextOptions&lt;NutshellContext&gt; options)
    : base(options) { }
</code></pre>
<p>ุงฺฏุฑ ุจุฎูุงูุฏ <strong>OnConfiguring</strong> ุฑุง override ฺฉูุฏ (ูุซูุงู ุจุฑุง ูุฑุงูู ฺฉุฑุฏู ูพฺฉุฑุจูุฏ ุฏุฑ ุณูุงุฑููุง ุฏฺฏุฑ)ุ ูโุชูุงูุฏ ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุขุง ฺฏุฒููโูุง ุงุฒ ูุจู ูพฺฉุฑุจูุฏ ุดุฏูโุงูุฏ ุง ุฎุฑ:</p>
<pre><code class="language-csharp">protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
{
    if (!optionsBuilder.IsConfigured)
    {
        ...
    }
}
</code></pre>
<p>ุฏุฑ ูุชุฏ <strong>OnConfiguring</strong> ูโุชูุงูุฏ ฺฏุฒููโูุง ุฏฺฏุฑ ูุงููุฏ <strong>lazy loading</strong> ุฑุง ูุฒ ูุนุงู ฺฉูุฏ (ูฺฏุงู ฺฉูุฏ ุจู โLazy loadingโ ุฏุฑ ุตูุญู 464).</p>
<h3>ูพฺฉุฑุจูุฏ ูุฏู ๐๏ธ</h3>
<p>ุจูโุทูุฑ ูพุดโูุฑุถุ <strong>EF Core</strong> ุจุฑ ุงุณุงุณ <strong>convention</strong> ุนูู ูโฺฉูุฏุ ุนู <strong>schema ูพุงฺฏุงู ุฏุงุฏู</strong> ุฑุง ุงุฒ ุฑู ูุงู ฺฉูุงุณโูุง ู propertyูุง ุญุฏุณ ูโุฒูุฏ.</p>
<p>ูโุชูุงูุฏ ุงู ูพุดโูุฑุถโูุง ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ <strong>fluent API</strong> ู override ฺฉุฑุฏู <strong>OnModelCreating</strong> ู ูุฑุงุฎูุงู extension methodูุง ุฑู ูพุงุฑุงูุชุฑ <strong>ModelBuilder</strong> ุชุบุฑ ุฏูุฏ.
ุจูโุนููุงู ูุซุงูุ ูโุชูุงูู ูุงู ุฌุฏูู ูพุงฺฏุงู ุฏุงุฏู ุจุฑุง entity ฺฉูุงุณ <strong>Customer</strong> ุฑุง ุจูโุตูุฑุช ุตุฑุญ ูุดุฎุต ฺฉูู:</p>
<pre><code class="language-csharp">protected override void OnModelCreating(ModelBuilder modelBuilder) =&gt;
    modelBuilder.Entity&lt;Customer&gt;()
        .ToTable(&quot;Customer&quot;);   // ูุงู ุฌุฏูู 'Customer' ุงุณุช
</code></pre>
<p>ุจุฏูู ุงู ฺฉุฏุ EF Core ุงู entity ุฑุง ุจู ุฌุฏูู ุจุง ูุงู <strong>โCustomersโ</strong> ูฺฏุงุดุช ูโฺฉูุฏุ ูู โCustomerโุ ุฒุฑุง ูุง ุฏุฑ <strong>DbContext</strong> ุฎูุฏ ฺฉ property ุงุฒ ููุน <strong>DbSet<Customer></strong> ุฏุงุฑู ฺฉู ูุงู ุขู <strong>Customers</strong> ุงุณุช:</p>
<pre><code class="language-csharp">public DbSet&lt;Customer&gt; Customers { get; set; }
</code></pre>
<hr>
<p>ฺฉุฏ ุฒุฑ ุชูุงู entityูุง ุดูุง ุฑุง ุจู <strong>ูุงู ฺฉูุงุณ entity</strong> ูฺฏุงุดุช ูโฺฉูุฏ (ฺฉู ูุนูููุงู ููุฑุฏ ุงุณุช) ูู ุจู ูุงู propertyูุง <strong>DbSet<T></strong> (ฺฉู ูุนูููุงู ุฌูุน ูุณุชูุฏ):</p>
<pre><code class="language-csharp">protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    foreach (IMutableEntityType entityType in modelBuilder.Model.GetEntityTypes())
    {
        modelBuilder.Entity(entityType.Name)
                    .ToTable(entityType.ClrType.Name);
    }
}
</code></pre>
<hr>
<h3>Fluent API ุจุฑุง ุณุชููโูุง ๐</h3>
<p><strong>Fluent API</strong> ฺฉ ุณูุชฺฉุณ ูพุดุฑูุชูโุชุฑ ุจุฑุง ูพฺฉุฑุจูุฏ ุณุชููโูุง ุงุฑุงุฆู ูโุฏูุฏ.
ุฏุฑ ูุซุงู ุฒุฑ ุงุฒ ุฏู ูุชุฏ ูุญุจูุจ ุงุณุชูุงุฏู ูโฺฉูู:</p>
<ul>
<li><strong>HasColumnName</strong>: property ุฑุง ุจู ฺฉ ุณุชูู ุจุง ูุงู ูุชูุงูุช ูฺฏุงุดุช ูโฺฉูุฏ.</li>
<li><strong>IsRequired</strong>: ูุดุฎุต ูโฺฉูุฏ ฺฉู ุณุชูู <strong>nullable</strong> ูุณุช.</li>
</ul>
<pre><code class="language-csharp">protected override void OnModelCreating(ModelBuilder modelBuilder) =&gt;
    modelBuilder.Entity&lt;Customer&gt;(entity =&gt;
    {
        entity.ToTable(&quot;Customer&quot;);
        entity.Property(e =&gt; e.Name)
              .HasColumnName(&quot;Full Name&quot;)  // ูุงู ุณุชูู 'Full Name' ุงุณุช
              .IsRequired();                // ุณุชูู ููโุชูุงูุฏ null ุจุงุดุฏ
    });
</code></pre>
<p>ุฌุฏูู 8-1 ุจุฑุฎ ุงุฒ ูููโุชุฑู ูุชุฏูุง <strong>fluent API</strong> ุฑุง ููุฑุณุช ูโฺฉูุฏ.</p>
<hr>
<p>ุจู ุฌุง ุงุณุชูุงุฏู ุงุฒ <strong>fluent API</strong>ุ ูโุชูุงูุฏ ูุฏู ุฎูุฏ ุฑุง ุจุง ุงุนูุงู <strong>attributeูุง ุฎุงุต</strong> ุฑู ฺฉูุงุณโูุง ู propertyูุง (<strong>data annotations</strong>) ูพฺฉุฑุจูุฏ ฺฉูุฏ.
ุงู ุฑูุด <strong>ุงูุนุทุงูโูพุฐุฑ ฺฉูุชุฑ</strong> ุฏุงุฑุฏุ ุฒุฑุง ูพฺฉุฑุจูุฏ ุจุงุฏ ุฏุฑ ุฒูุงู ฺฉุงููพุงู ุซุงุจุช ุจุงุดุฏุ ู <strong>ูุฏุฑุช ฺฉูุชุฑ</strong> ุฏุงุฑุฏุ ฺุฑุง ฺฉู ุจุฑุฎ ฺฏุฒููโูุง ููุท ุงุฒ ุทุฑู <strong>fluent API</strong> ูุงุจู ูพฺฉุฑุจูุฏ ูุณุชูุฏ.</p>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-11.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<h3>ุงุฌุงุฏ ูพุงฺฏุงู ุฏุงุฏู ๐๏ธ๐๏ธ</h3>
<p><strong>EF Core</strong> ุงุฒ ุฑูฺฉุฑุฏ <strong>code-first</strong> ูพุดุชุจุงู ูโฺฉูุฏุ ุจู ุงู ูุนูุง ฺฉู ูโุชูุงูุฏ ุงุจุชุฏุง ฺฉูุงุณโูุง <strong>entity</strong> ุฎูุฏ ุฑุง ุชุนุฑู ฺฉูุฏ ู ุณูพุณ ุงุฒ <strong>EF Core</strong> ุจุฎูุงูุฏ ูพุงฺฏุงู ุฏุงุฏู ุฑุง ุงุฌุงุฏ ฺฉูุฏ. ุณุงุฏูโุชุฑู ุฑูุด ุจุฑุง ุงู ฺฉุงุฑ ูุฑุงุฎูุงู ูุชุฏ ุฒุฑ ุฑู ฺฉ ููููู ุงุฒ <strong>DbContext</strong> ุงุณุช:</p>
<pre><code class="language-csharp">dbContext.Database.EnsureCreated();
</code></pre>
<p>ุจุง ุงู ุญุงูุ ุฑูุด ุจูุชุฑ ุงุณุชูุงุฏู ุงุฒ ูุงุจูุช <strong>migrations</strong> ุฏุฑ EF Core ุงุณุช. ุงู ุฑูุด ูู ุชููุง ูพุงฺฏุงู ุฏุงุฏู ุฑุง ุงุฌุงุฏ ูโฺฉูุฏุ ุจูฺฉู ุขู ุฑุง ุทูุฑ ูพฺฉุฑุจูุฏ ูโฺฉูุฏ ฺฉู EF Core ุจุชูุงูุฏ ุฏุฑ ุขูุฏูุ ููฺฏุงู ุชุบุฑ ฺฉูุงุณโูุง entityุ <strong>schema</strong> ุฑุง ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ.</p>
<p>ุฏุฑ <strong>Visual Studio</strong>ุ ูโุชูุงูุฏ migrations ุฑุง ุงุฒ <strong>Package Manager Console</strong> ูุนุงู ฺฉูุฏ ู ูพุงฺฏุงู ุฏุงุฏู ุฑุง ุจุง ุฏุณุชูุฑุงุช ุฒุฑ ุงุฌุงุฏ ฺฉูุฏ:</p>
<pre><code class="language-powershell">Install-Package Microsoft.EntityFrameworkCore.Tools
Add-Migration InitialCreate
Update-Database
</code></pre>
<ul>
<li>ุฏุณุชูุฑ ุงูู ุงุจุฒุงุฑูุง ูุฏุฑุช EF Core ุฑุง ุฏุฑ Visual Studio ูุตุจ ูโฺฉูุฏ.</li>
<li>ุฏุณุชูุฑ ุฏูู ฺฉ ฺฉูุงุณ C# ูฺู ุจู ูุงู <strong>code migration</strong> ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู ุดุงูู ุฏุณุชูุฑุงูุนููโูุง ุงุฌุงุฏ ูพุงฺฏุงู ุฏุงุฏู ุงุณุช.</li>
<li>ุฏุณุชูุฑ ุขุฎุฑ ุขู ุฏุณุชูุฑุงูุนููโูุง ุฑุง ุฑู connection string ูุดุฎุตโุดุฏู ุฏุฑ ูุงู ูพฺฉุฑุจูุฏ ูพุฑูฺู ุงุฌุฑุง ูโฺฉูุฏ.</li>
</ul>
<hr>
<h3>ุงุณุชูุงุฏู ุงุฒ DbContext ๐งฉ</h3>
<p>ุจุนุฏ ุงุฒ ุชุนุฑู ฺฉูุงุณโูุง <strong>Entity</strong> ู ุงุฌุงุฏ ุฒุฑฺฉูุงุณ ุงุฒ <strong>DbContext</strong>ุ ูโุชูุงูุฏ ฺฉ ููููู ุงุฒ DbContext ุจุณุงุฒุฏ ู ูพุงฺฏุงู ุฏุงุฏู ุฑุง query ฺฉูุฏ:</p>
<pre><code class="language-csharp">using var dbContext = new NutshellContext();
Console.WriteLine(dbContext.Customers.Count());
// ุงุฌุฑุง ุฏุณุชูุฑ SQL: &quot;SELECT COUNT(*) FROM [Customer] AS [c]&quot;
</code></pre>
<p>ููฺูู ูโุชูุงูุฏ ุงุฒ <strong>DbContext</strong> ุจุฑุง ููุดุชู ุฏุงุฏู ุฏุฑ ูพุงฺฏุงู ุฏุงุฏู ุงุณุชูุงุฏู ฺฉูุฏ:</p>
<pre><code class="language-csharp">using var dbContext = new NutshellContext();
Customer cust = new Customer()
{
    Name = &quot;Sara Wells&quot;
};
dbContext.Customers.Add(cust);
dbContext.SaveChanges();    // ุชุบุฑุงุช ุฑุง ุจู ูพุงฺฏุงู ุฏุงุฏู ูโููุณุฏ
</code></pre>
<p>ุจุฑุง ุจุงุฒุงุจ ุฑฺฉูุฑุฏ ฺฉู ุชุงุฒู ุงุถุงูู ุดุฏู:</p>
<pre><code class="language-csharp">using var dbContext = new NutshellContext();
Customer cust = dbContext.Customers
    .Single(c =&gt; c.Name == &quot;Sara Wells&quot;);
</code></pre>
<p>ู ุจุฑุง ุจูโุฑูุฒุฑุณุงู ูุงู ูุดุชุฑ ู ุฐุฎุฑู ุชุบุฑุงุช:</p>
<pre><code class="language-csharp">cust.Name = &quot;Dr. Sara Wells&quot;;
dbContext.SaveChanges();
</code></pre>
<blockquote>
<p>ุชูุฌู: ูุชุฏ <strong>Single</strong> ุจุฑุง ุจุงุฒุงุจ ฺฉ ุฑฺฉูุฑุฏ ุจุง <strong>primary key</strong> ููุงุณุจ ุงุณุช. ุจุฑ ุฎูุงู <strong>First</strong>ุ ุงฺฏุฑ ุจุด ุงุฒ ฺฉ ุฑฺฉูุฑุฏ ุจุงุฒฺฏุฑุฏุงูุฏู ุดูุฏุ ุฎุทุง ูโุฏูุฏ.</p>
</blockquote>
<hr>
<h3>ุฑุฏุงุจ ุงุดุงุก (Object Tracking) ๐</h3>
<p>ฺฉ ููููู <strong>DbContext</strong> ุชูุงู entityูุง ฺฉู ุงุฌุงุฏ ูโฺฉูุฏ ุฑุง ุฑุฏุงุจ ูโฺฉูุฏ ุชุง ูุฑ ุจุงุฑ ฺฉู ููุงู ุฑฺฉูุฑุฏูุง ุฑุง ุฏุฑุฎูุงุณุช ฺฉูุฏุ ููุงู ุงุดุงุก ุฑุง ุจู ุดูุง ุจุงุฒฺฏุฑุฏุงูุฏ. ุจู ุนุจุงุฑุช ุฏฺฏุฑุ ุฏุฑ ุทูู ุนูุฑ ฺฉ contextุ ูฺ ุฏู entity ุฌุฏุงฺฏุงููโุง ุจุฑุง ฺฉ ุฑฺฉูุฑุฏ ูุดุฎุต (ุจุง primary key) ุงุฌุงุฏ ููโุดูุฏ. ุงู ูุงุจูุช <strong>object tracking</strong> ูุงู ุฏุงุฑุฏ.</p>
<p>ุจุฑุง ูุซุงูุ ูุฑุถ ฺฉูุฏ ูุดุชุฑโุง ฺฉู ุงุฒ ูุธุฑ ุญุฑูู ุงููุจุง ุงููู ุงุณุชุ ฺฉูุชุฑู <strong>ID</strong> ุฑุง ูุฒ ุฏุงุฑุฏ. ุฏุฑ ูุซุงู ุฒุฑุ <code>a</code> ู <code>b</code> ุจู ฺฉ <strong>object</strong> ุงุดุงุฑู ุฎูุงููุฏ ฺฉุฑุฏ:</p>
<pre><code class="language-csharp">using var dbContext = new NutshellContext();
Customer a = dbContext.Customers.OrderBy(c =&gt; c.Name).First();
Customer b = dbContext.Customers.OrderBy(c =&gt; c.ID).First();
</code></pre>
<h3>ูุฏุฑุช ููุงุจุน ู DbContext ๐๏ธ๐งฉ</h3>
<p>ุงฺฏุฑฺู <strong>DbContext</strong> ุงุฒ <strong>IDisposable</strong> ูพุฑู ูโฺฉูุฏุ ุงูุง ูุนูููุงู ูโุชูุงูุฏ ุจุฏูู ูุฑุงุฎูุงู <strong>Dispose</strong> ุงุฒ ูููููโูุง ุงุณุชูุงุฏู ฺฉูุฏ. ูุฑุงุฎูุงู <strong>Dispose</strong> ุจุงุนุซ ูโุดูุฏ ฺฉู <strong>connection</strong> ุฏุงุฎู context ูู ุจุณุชู ุดูุฏุ ุงูุง ุงู ูุนูููุงู ุถุฑูุฑ ูุณุช ุฒุฑุง <strong>EF Core</strong> ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ูพุณ ุงุฒ ูพุงุงู ุฏุฑุงูุช ูุชุงุฌ ุงุฒ ฺฉ queryุ <strong>connection</strong> ุฑุง ูโุจูุฏุฏ.</p>
<p>ูุฑุงุฎูุงู ุฒูุฏููฺฏุงู <strong>Dispose</strong> ูโุชูุงูุฏ ูุดฺฉูโุณุงุฒ ุจุงุดุฏุ ูุฎุตูุตุงู ุจู ุฏูู <strong>lazy evaluation</strong>. ูุซุงู ุฒุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ:</p>
<pre><code class="language-csharp">IQueryable&lt;Customer&gt; GetCustomers(string prefix)
{
    using (var dbContext = new NutshellContext())
        return dbContext.Customers
                        .Where(c =&gt; c.Name.StartsWith(prefix));
}

foreach (Customer c in GetCustomers(&quot;a&quot;))
    Console.WriteLine(c.Name);
</code></pre>
<p>ุงู ฺฉุฏ ุดฺฉุณุช ูโุฎูุฑุฏุ ุฒุฑุง query ุฒูุงู ุงุฑุฒุงุจ ูโุดูุฏ ฺฉู ุขู ุฑุง <strong>enumerate</strong> ูโฺฉููโู ุงู ุจุนุฏ ุงุฒ <strong>Dispose</strong> ุดุฏู <strong>DbContext</strong> ุงุณุช.</p>
<p>ฺูุฏ ูฺฉุชู ุฏุฑุจุงุฑู ุนุฏู ูุฑุงุฎูุงู <strong>Dispose</strong> ูุฌูุฏ ุฏุงุฑุฏ:</p>
<ul>
<li>ุงู ฺฉุงุฑ ูุชฺฉ ุจู ุงู ุงุณุช ฺฉู <strong>connection object</strong> ุชูุงู ููุงุจุน unmanaged ุฑุง ููฺฏุงู ูุฑุงุฎูุงู <strong>Close</strong> ุขุฒุงุฏ ฺฉูุฏ. ูุฑฺูุฏ ุงู ุฏุฑ <strong>SqlConnection</strong> ุตุงุฏู ุงุณุชุ ุงูุง ููฺฉู ุงุณุช ฺฉ connection ุดุฎุต ุซุงูุซ ููุงุจุน ุฑุง ุจุงุฒ ูฺฏู ุฏุงุฑุฏ ุงฺฏุฑ <strong>Close</strong> ุดูุฏ ุงูุง <strong>Dispose</strong> ูุฑุงุฎูุงู ูุดูุฏ.</li>
<li>ุงฺฏุฑ ุจูโุตูุฑุช ุฏุณุช <strong>GetEnumerator</strong> ุฑู query ูุฑุงุฎูุงู ฺฉูุฏ ู ุณูพุณ enumerator ุฑุง <strong>dispose</strong> ูฺฉูุฏ ุง ุชูุงู ุนูุงุตุฑ ุฑุง ูุตุฑู ูฺฉูุฏุ connection ุจุงุฒ ุฎูุงูุฏ ูุงูุฏ. ุฏุฑ ุงู ุณูุงุฑููุง <strong>Dispose</strong> ฺฉ backup ุงุณุช.</li>
<li>ุจุฑุฎ ุงูุฑุงุฏ ุงุญุณุงุณ ูโฺฉููุฏ ุชูุฒุชุฑ ุงุณุช ฺฉู contextูุง ู ุชูุงู ุงุดุงุก ูพุฑูโฺฉููุฏู ุงุฒ <strong>IDisposable</strong> ุฑุง <strong>dispose</strong> ฺฉููุฏ.</li>
</ul>
<p>ุงฺฏุฑ ูโุฎูุงูุฏ contextูุง ุฑุง ุตุฑุญุงู <strong>dispose</strong> ฺฉูุฏุ ุจุงุฏ ููููู <strong>DbContext</strong> ุฑุง ุจู ูุชุฏูุง ูุงููุฏ <strong>GetCustomers</strong> ููุชูู ฺฉูุฏ ุชุง ูุดฺฉู ููู ูพุด ูุงุฏ. ุฏุฑ ูุญุทโูุง ูุงููุฏ <strong>ASP.NET Core MVC</strong> ฺฉู context ุงุฒ ุทุฑู <strong>Dependency Injection (DI)</strong> ุงุฑุงุฆู ูโุดูุฏุ <strong>DI</strong> ูุฏุฑุช ุทูู ุนูุฑ context ุฑุง ุจุฑ ุนูุฏู ุฏุงุฑุฏ: ุงุฌุงุฏ ุขู ููฺฏุงู ุดุฑูุน ูุงุญุฏ ฺฉุงุฑ (ูุซูุงู HTTP request) ู <strong>Dispose</strong> ููฺฏุงู ูพุงุงู ูุงุญุฏ ฺฉุงุฑ.</p>
<hr>
<h3>ุชุงุซุฑ object tracking ุฏุฑ EF Core ๐</h3>
<p>ูุฑุถ ฺฉูุฏ ููุช EF Core ุฏููู query ุฑุง ุงุฌุฑุง ูโฺฉูุฏุ ุงุจุชุฏุง ฺฉ ุฑฺฉูุฑุฏ ุงุฒ ูพุงฺฏุงู ุฏุงุฏู ุฏุฑุงูุช ฺฉุฑุฏู ู <strong>primary key</strong> ุขู ุฑุง ูโุฎูุงูุฏุ ุณูพุณ ุฏุฑ <strong>entity cache</strong> context ุฌุณุชุฌู ูโฺฉูุฏ. ุงฺฏุฑ match ูพุฏุง ุดูุฏุ ููุงู <strong>object</strong> ููุฌูุฏ ุฑุง ุจุฏูู ุจุฑูุฒุฑุณุงู ููุงุฏุฑ ุจุฑูโฺฏุฑุฏุงูุฏ.</p>
<ul>
<li>ุงู ุฑูุชุงุฑ ุจุฑุง ุฌููฺฏุฑ ุงุฒ <strong>side effect</strong>ูุง ุบุฑููุชุธุฑู ุถุฑูุฑ ุงุณุช (ููฺฉู ุงุณุช <strong>Customer</strong> ุฏุฑ ุฌุง ุฏฺฏุฑ ุงุณุชูุงุฏู ุดูุฏ).</li>
<li>ููฺูู ูุฏุฑุช <strong>concurrency</strong> ุฑุง ุชุณูู ูโฺฉูุฏ. ุงฺฏุฑ ุดูุง ุชุบุฑุงุช ุฑู <strong>Customer</strong> ุฏุงุฏูโุงุฏ ู ูููุฒ <strong>SaveChanges</strong> ุฑุง ูุฑุงุฎูุงู ูฺฉุฑุฏูโุงุฏุ ููโุฎูุงูุฏ ููุงุฏุฑ ุดูุง ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุจุงุฒููุณ ุดูุฏ.</li>
</ul>
<p>ูโุชูุงูุฏ <strong>object tracking</strong> ุฑุง ุจุง ูุฑุงุฎูุงู <strong>AsNoTracking</strong> ุฑู query ุง ุจุง ุชูุธู <strong>ChangeTracker.QueryTrackingBehavior = QueryTrackingBehavior.NoTracking</strong> ุบุฑูุนุงู ฺฉูุฏ. ุงู queries ุจุฏูู tracking ุจุฑุง ุฏุงุฏูโูุง <strong>read-only</strong> ููุฏ ุงุณุช ุฒุฑุง ฺฉุงุฑุง ุฑุง ุงูุฒุงุด ู ูุตุฑู ุญุงูุธู ุฑุง ฺฉุงูุด ูโุฏูุฏ.</p>
<p>ุจุฑุง ุฏุฑุงูุช ุงุทูุงุนุงุช ุชุงุฒู ุงุฒ ูพุงฺฏุงู ุฏุงุฏูุ ุจุงุฏ ุง ฺฉ context ุฌุฏุฏ ุจุณุงุฒุฏ ุง ูุชุฏ <strong>Reload</strong> ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ:</p>
<pre><code class="language-csharp">dbContext.Entry(myCustomer).Reload();
</code></pre>
<p>ุจูุชุฑู ุฑูุด ุงู ุงุณุช ฺฉู ุจุฑุง ูุฑ <strong>unit of work</strong> ฺฉ <strong>DbContext</strong> ุฌุฏุฏ ุงุณุชูุงุฏู ฺฉูุฏ ุชุง ูุงุฒ ุจู <strong>Reload</strong> ุฏุณุช ุจู ุญุฏุงูู ุจุฑุณุฏ.</p>
<hr>
<h3>ุฑุฏุงุจ ุชุบุฑุงุช (Change Tracking) ๐</h3>
<p>ููฺฏุงู ฺฉู ููุฏุงุฑ ฺฉ property ุฏุฑ ฺฉ entity ุจุงุฑฺฏุฐุงุฑโุดุฏู ุชูุณุท <strong>DbContext</strong> ุชุบุฑ ฺฉูุฏุ EF Core ุงู ุชุบุฑ ุฑุง ุชุดุฎุต ุฏุงุฏู ู ููฺฏุงู ูุฑุงุฎูุงู <strong>SaveChanges</strong> ูพุงฺฏุงู ุฏุงุฏู ุฑุง ูุทุงุจู ุชุบุฑุงุช ุจูโุฑูุฒ ูโฺฉูุฏ.</p>
<p>EF Core ุจุฑุง ุงู ฺฉุงุฑุ <strong>snapshot</strong> ุงุฒ ูุถุนุช entityูุง ุงุฌุงุฏ ูโฺฉูุฏ ู ูุถุนุช ูุนู ุฑุง ุจุง ูุถุนุช ุงุตู ููฺฏุงู <strong>SaveChanges</strong> ููุงุณู ูโฺฉูุฏ.</p>
<p>ุจุฑุง ูุดุงูุฏู ุชุบุฑุงุช ุฑุฏุงุจโุดุฏู:</p>
<pre><code class="language-csharp">foreach (var e in dbContext.ChangeTracker.Entries())
{
    Console.WriteLine($&quot;{e.Entity.GetType().FullName} is {e.State}&quot;);
    foreach (var m in e.Members)
        Console.WriteLine(
            $&quot;  {m.Metadata.Name}: '{m.CurrentValue}' modified: {m.IsModified}&quot;);
}
</code></pre>
<p>ููฺฏุงู ูุฑุงุฎูุงู <strong>SaveChanges</strong>ุ EF Core ุจุง ุงุณุชูุงุฏู ุงุฒ ุงุทูุงุนุงุช <strong>ChangeTracker</strong>ุ ุฏุณุชูุฑุงุช SQL ุงุฌุงุฏ ูโฺฉูุฏ:</p>
<ul>
<li><strong>Insert</strong> ุจุฑุง ุงุถุงูู ฺฉุฑุฏู ุฑฺฉูุฑุฏ ุฌุฏุฏ</li>
<li><strong>Update</strong> ุจุฑุง ุชุบุฑ ุฏุงุฏูโูุง</li>
<li><strong>Delete</strong> ุจุฑุง ุญุฐู ุฑฺฉูุฑุฏูุง ุญุฐูโุดุฏู ุงุฒ ฺฏุฑุงู object</li>
</ul>
<p>ูุฑ <strong>TransactionScope</strong> ุงุญุชุฑุงู ฺฏุฐุงุดุชู ูโุดูุฏ ู ุฏุฑ ุตูุฑุช ุนุฏู ูุฌูุฏุ EF Core ุชูุงู ุฏุณุชูุฑุงุช ุฑุง ุฏุฑ ฺฉ ุชุฑุงฺฉูุด ุฌุฏุฏ ุงุฌุฑุง ูโฺฉูุฏ.</p>
<p>ุจุฑุง ุจูููโุณุงุฒ <strong>change tracking</strong> ูโุชูุงูุฏ ุงูุชุฑูุณโูุง <strong>INotifyPropertyChanged</strong> ู ุงุฎุชุงุฑ <strong>INotifyPropertyChanging</strong> ุฑุง ุฏุฑ entityูุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ. ุงู ฺฉุงุฑ ุจุงุนุซ ูโุดูุฏ EF Core ุงุฒ ููุงุณู state ุงููู ู ูุนู ุตุฑูโูุธุฑ ฺฉูุฏ ู ฺฉุงุฑุง ุงูุฒุงุด ุงุจุฏ. ุณูพุณ ุจุง ูุฑุงุฎูุงู <strong>HasChangeTrackingStrategy</strong> ุฏุฑ <strong>ModelBuilder</strong>ุ ุงู ุจูููโุณุงุฒ ูุนุงู ูโุดูุฏ.</p>
<hr>
<h3>Navigation Properties ๐</h3>
<p><strong>Navigation properties</strong> ุจู ุดูุง ุงูฺฉุงู ูโุฏููุฏ:</p>
<ul>
<li>ุฌุฏุงูู ูุฑุชุจุท ุฑุง ุจุฏูู ูุงุฒ ุจู join ุฏุณุช query ฺฉูุฏ</li>
<li>ุฑฺฉูุฑุฏูุง ูุฑุชุจุท ุฑุง ุฏุฑุฌุ ุญุฐู ุง ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ ุจุฏูู ุขูโฺฉู ฺฉูุฏ ุฎุงุฑุฌ ุฑุง ุจูโุตูุฑุช ุตุฑุญ ุชุบุฑ ุฏูุฏ</li>
</ul>
<p>ูุซุงู: ูุฑุถ ฺฉูุฏ ูุฑ ูุดุชุฑ ูโุชูุงูุฏ ฺูุฏ ุฎุฑุฏ ุฏุงุดุชู ุจุงุดุฏ. ุฑุงุจุทู <strong>one-to-many</strong> ุจู <strong>Customer</strong> ู <strong>Purchase</strong> ุฑุง ูโุชูุงู ุจู ุดฺฉู ุฒุฑ ููุงุด ุฏุงุฏ:</p>
<pre><code class="language-csharp">public class Customer
{
    public int ID { get; set; }
    public string Name { get; set; }
    public virtual List&lt;Purchase&gt; Purchases { get; set; } = new List&lt;Purchase&gt;();
}

public class Purchase
{
    public int ID { get; set; }
    public DateTime Date { get; set; }
    public string Description { get; set; }
    public decimal Price { get; set; }
    public int? CustomerID { get; set; }  // Foreign key
    public Customer Customer { get; set; } // Parent navigation
}
</code></pre>
<p>EF Core ุจุง ุชูุฌู ุจู ูุงู <strong>CustomerID</strong>ุ ุขู ุฑุง ุจู ุนููุงู <strong>foreign key</strong> ุจู ุฌุฏูู <strong>Customer</strong> ุชุดุฎุต ูโุฏูุฏ. ุงฺฏุฑ EF Core ูุชูุงูุฏ ุฑุงุจุทู ุฑุง ุงุณุชูุชุงุฌ ฺฉูุฏุ ูโุชูุงูุฏ ุขู ุฑุง ุตุฑุญุงู ุฏุฑ <strong>OnModelCreating</strong> ูพฺฉุฑุจูุฏ ฺฉูุฏ:</p>
<pre><code class="language-csharp">modelBuilder.Entity&lt;Purchase&gt;()
    .HasOne(e =&gt; e.Customer)
    .WithMany(e =&gt; e.Purchases)
    .HasForeignKey(e =&gt; e.CustomerID);
</code></pre>
<p>ุจุง ุงู navigation propertiesุ ูโุชูุงู queries ูุงููุฏ ุฒุฑ ููุดุช:</p>
<pre><code class="language-csharp">var customersWithPurchases = Customers.Where(c =&gt; c.Purchases.Any());
</code></pre>
<p>ุฏุฑ ูุตู ุจุนุฏุ ูุญูู ููุดุชู ุงู ููุน queryูุง ุฑุง ุจู ุชูุตู ุจุฑุฑุณ ุฎูุงูู ฺฉุฑุฏ.</p>
<h3>ุงูุฒูุฏู ู ุญุฐู ููุฌูุฏุชโูุง ุงุฒ ูุฌููุนูโูุง Navigation ๐โ</h3>
<p>ููุช ููุฌูุฏุชโูุง ุฌุฏุฏ ุจู ฺฉ <strong>collection navigation property</strong> ุงุถุงูู ูโฺฉูุฏุ <strong>EF Core</strong> ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ฺฉูุฏูุง ุฎุงุฑุฌ ุฑุง ููฺฏุงู ูุฑุงุฎูุงู <strong>SaveChanges</strong> ูพุฑ ูโฺฉูุฏ:</p>
<pre><code class="language-csharp">Customer cust = dbContext.Customers.Single(c =&gt; c.ID == 1);
Purchase p1 = new Purchase { Description=&quot;Bike&quot;, Price=500 };
Purchase p2 = new Purchase { Description=&quot;Tools&quot;, Price=100 };
cust.Purchases.Add(p1);
cust.Purchases.Add(p2);
dbContext.SaveChanges();
</code></pre>
<p>ุฏุฑ ุงู ูุซุงูุ <strong>EF Core</strong> ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ููุฏุงุฑ <code>1</code> ุฑุง ุฏุฑ ุณุชูู <strong>CustomerID</strong> ูุฑ ุฎุฑุฏ ุฌุฏุฏ ูโููุณุฏ ู <strong>ID</strong> ุชููุฏุดุฏู ุชูุณุท ูพุงฺฏุงู ุฏุงุฏู ุฑุง ุจู <strong>Purchase.ID</strong> ุงุฎุชุตุงุต ูโุฏูุฏ.</p>
<p>ุงฺฏุฑ ููุฌูุฏุช ุฑุง ุงุฒ ฺฉ <strong>collection navigation property</strong> ุญุฐู ฺฉุฑุฏู ู <strong>SaveChanges</strong> ุฑุง ูุฑุงุฎูุงู ฺฉูุฏุ EF Core ุจุณุชู ุจู ููุน ูพฺฉุฑุจูุฏ ุง ุงุณุชูุชุงุฌ ุฑุงุจุทูุ ฺฉ ุงุฒ ฺฉุงุฑูุง ุฒุฑ ุฑุง ุงูุฌุงู ูโุฏูุฏ:</p>
<ul>
<li>ูพุงฺฉ ฺฉุฑุฏู ููุฏุงุฑ <strong>foreign key</strong></li>
<li>ุญุฐู ุฑุฏู ูุฑุจูุทู ุงุฒ ูพุงฺฏุงู ุฏุงุฏู</li>
</ul>
<p>ุฏุฑ ุงู ูุซุงูุ ฺูู <strong>Purchase.CustomerID</strong> ุจู ุตูุฑุช nullable ุชุนุฑู ุดุฏู ุงุณุช (ุชุง ุฎุฑุฏ ุจุฏูู ูุดุชุฑ ุง ุชุฑุงฺฉูุด ููุฏ ุฑุง ุจุชูุงู ููุงุด ุฏุงุฏ)ุ ุญุฐู ฺฉ ุฎุฑุฏ ุงุฒ ูุดุชุฑุ ููุฏุงุฑ foreign key ุฑุง ูพุงฺฉ ูโฺฉูุฏ ู ุฑฺฉูุฑุฏ ุงุฒ ูพุงฺฏุงู ุฏุงุฏู ุญุฐู ููโุดูุฏ.</p>
<hr>
<h3>ุจุงุฑฺฏุฐุงุฑ Navigation Properties ๐ฆ</h3>
<p>ุฒูุงู ฺฉู <strong>EF Core</strong> ฺฉ entity ุฑุง populate ูโฺฉูุฏุ ุจูโุทูุฑ ูพุดโูุฑุถ navigation properties ุขู ุฑุง ูพุฑ ููโฺฉูุฏ:</p>
<pre><code class="language-csharp">using var dbContext = new NutshellContext();
var cust = dbContext.Customers.First();
Console.WriteLine(cust.Purchases.Count);    // ููุดู 0
</code></pre>
<p>ุฑุงูโุญูโูุง:</p>
<ol>
<li><strong>ุงุณุชูุงุฏู ุงุฒ Include:</strong> ุงู ุฑูุด ุจู EF Core ุฏุณุชูุฑ ูโุฏูุฏ ฺฉู navigation properties ุฑุง eager load ฺฉูุฏ:</li>
</ol>
<pre><code class="language-csharp">var cust = dbContext.Customers
    .Include(c =&gt; c.Purchases)
    .Where(c =&gt; c.ID == 2)
    .First();
</code></pre>
<ol start="2">
<li><strong>ุงุณุชูุงุฏู ุงุฒ Projection:</strong> ุงู ุชฺฉูฺฉ ุฒูุงู ููุฏ ุงุณุช ฺฉู ููุท ุจุฎุด ุงุฒ propertyูุง entity ูุงุฒ ุจุงุดุฏุ ุฒุฑุง ุญุฌู ุงูุชูุงู ุฏุงุฏู ฺฉุงูุด ูโุงุจุฏ:</li>
</ol>
<pre><code class="language-csharp">var custInfo = dbContext.Customers
    .Where(c =&gt; c.ID == 2)
    .Select(c =&gt; new
    {
        Name = c.Name,
        Purchases = c.Purchases.Select(p =&gt; new { p.Description, p.Price })
    })
    .First();
</code></pre>
<p>ูุฑ ุฏู ุฑูุด ุจู EF Core ุงุทูุงุน ูโุฏููุฏ ฺฉู ฺู ุฏุงุฏูโุง ูุงุฒ ุฏุงุฑุฏ ุชุง ุจุชูุงูุฏ ุขู ุฑุง ุฏุฑ ฺฉ query ุจูโุฏุณุช ุขูุฑุฏ.</p>
<ol start="3">
<li><strong>Explicit Loading:</strong> ูโุชูุงูุฏ EF Core ุฑุง ุจูโุตูุฑุช ุฏุณุช ูุงุฏุงุฑ ุจู populate ฺฉุฑุฏู navigation property ฺฉูุฏ:</li>
</ol>
<pre><code class="language-csharp">dbContext.Entry(cust).Collection(b =&gt; b.Purchases).Load();
// cust.Purchases ุงฺฉููู ูพุฑ ุดุฏู ุงุณุช
</code></pre>
<p>ุงู ุฑูุด ฺฉ round trip ุงุถุงู ุจู ูพุงฺฏุงู ุฏุงุฏู ุงุฌุงุฏ ูโฺฉูุฏ.</p>
<hr>
<h3>Lazy Loading ๐ค</h3>
<p>ุฑูุด ุฏฺฏุฑ ุจุฑุง ุจุงุฑฺฏุฐุงุฑ navigation propertiesุ <strong>lazy loading</strong> ุงุณุช. ุจุง ูุนุงู ุดุฏูุ EF Core navigation properties ุฑุง ุจูโุตูุฑุช demand-load ูพุฑ ูโฺฉูุฏ. ุจุฑุง ุงู ฺฉุงุฑ:</p>
<ul>
<li>ูุฑ navigation property ุจุงุฏ <strong>virtual</strong> ุจุงุดุฏ</li>
<li>ฺฉูุงุณ entity ุจุงุฏ ูุงุจูุช ุงุฑุซโุจุฑ ุฏุงุดุชู ุจุงุดุฏ (sealed ูุจุงุดุฏ)</li>
<li>context ูุจุงุฏ ูุจู ุงุฒ lazy load <strong>Dispose</strong> ุดุฏู ุจุงุดุฏ</li>
</ul>
<p>ูุนุงู ฺฉุฑุฏู lazy loading ุฏุฑ ูุชุฏ <strong>OnConfiguring</strong> DbContext ุจู ุดฺฉู ุฒุฑ ุงุณุช:</p>
<pre><code class="language-csharp">protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
{
    optionsBuilder
        .UseLazyLoadingProxies();
    ...
}
</code></pre>
<blockquote>
<p>ุชูุฌู: ุจุงุฏ ุจุณุชู <strong>Microsoft.EntityFrameworkCore.Proxies</strong> ุฑุง ูู ุงุถุงูู ฺฉูุฏ.</p>
</blockquote>
<p>ูุฒูู lazy loading ุงู ุงุณุช ฺฉู ูุฑ ุจุงุฑ ฺฉู ุจู navigation property ุจุงุฑฺฏุฐุงุฑโูุดุฏู ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏุ ฺฉ ุฏุฑุฎูุงุณุช ุงุถุงู ุจู ูพุงฺฏุงู ุฏุงุฏู ุงุฑุณุงู ูโุดูุฏ. ุงฺฏุฑ ุชุนุฏุงุฏ ุฒุงุฏ ุงุฒ ุงู ุฏุฑุฎูุงุณุชโูุง ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏุ ฺฉุงุฑุง ฺฉุงูุด ูโุงุจุฏ.</p>
<p>ุจุง ูุนุงู ุจูุฏู lazy loadingุ ููุน runtime ฺฉูุงุณโูุง ูพุฑูฺฉุณ ุงุณุช ฺฉู ุงุฒ ฺฉูุงุณ entity ูุดุชู ุดุฏู ุงุณุช:</p>
<pre><code class="language-csharp">using var dbContext = new NutshellContext();
var cust = dbContext.Customers.First();
Console.WriteLine(cust.GetType());
// ุฎุฑูุฌ: Castle.Proxies.CustomerProxy
</code></pre>
<h3>ุงุฌุฑุง ุจู ุชุฃุฎุฑ ุงูุชุงุฏู (Deferred Execution) โณ</h3>
<p>ฺฉูุฆุฑโูุง <strong>EF Core</strong> ูุฒ ูุงููุฏ ฺฉูุฆุฑโูุง ูุญู ุงุฒ ูุฏู <strong>deferred execution</strong> ูพุฑู ูโฺฉููุฏ. ุงู ูฺฺฏ ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ฺฉูุฆุฑโูุง ุฑุง ุจูโุชุฏุฑุฌ ุจุณุงุฒุฏ. ุจุง ุงู ุญุงูุ ฺฉ ูฺฉุชู ูฺู ุฏุฑ <strong>EF Core</strong> ูุฌูุฏ ุฏุงุฑุฏ ู ุขู ุฒูุงู ุงุณุช ฺฉู <strong>subquery</strong> ุฏุงุฎู ฺฉ <strong>Select expression</strong> ูุฑุงุฑ ฺฏุฑุฏ.</p>
<p>ุจุง ฺฉูุฆุฑโูุง ูุญูุ ุดูุง <strong>double-deferred execution</strong> ุฏุงุฑุฏุ ุฒุฑุง ุงุฒ ุฏุฏฺฏุงู ุชุงุจุนุ ุฏุฑ ุญุงู ุงูุชุฎุงุจ ฺฉ ุฏูุจุงูู ุงุฒ ฺฉูุฆุฑโูุง ูุณุชุฏ. ุจูุงุจุฑุงู ุงฺฏุฑ ุฏูุจุงูู ุจุฑูู ุฑุง ุดูุงุฑุด ฺฉูุฏ ุงูุง ุฏูุจุงููโูุง ุฏุงุฎู ูุฑฺฏุฒ ุดูุงุฑุด ูุดููุฏุ subquery ุงุฌุฑุง ูุฎูุงูุฏ ุดุฏ.</p>
<p>ุฏุฑ <strong>EF Core</strong>ุ subquery ููุฒูุงู ุจุง ุงุฌุฑุง ฺฉูุฆุฑ ุจุฑูู ุงุฌุฑุง ูโุดูุฏ ุชุง ุงุฒ ุงุฑุณุงู ุฏุฑุฎูุงุณุชโูุง ุงุถุงู ุฌููฺฏุฑ ุดูุฏ.</p>
<p>ูุซุงู: ุงู ฺฉูุฆุฑ ุชููุง ุฏุฑ ฺฉ round trip ุจู ูพุงฺฏุงู ุฏุงุฏู ุงุฌุฑุง ูโุดูุฏ:</p>
<pre><code class="language-csharp">using var dbContext = new NutshellContext();
var query = from c in dbContext.Customers
            select from p in c.Purchases
                   select new { c.Name, p.Price };

foreach (var customerPurchaseResults in query)
    foreach (var namePrice in customerPurchaseResults)
        Console.WriteLine($&quot;{namePrice.Name} spent {namePrice.Price}&quot;);
</code></pre>
<p>ุชูุงู <strong>navigation properties</strong> ฺฉู ุจูโุตูุฑุช ุตุฑุญ projection ุดุฏูโุงูุฏุ ุฏุฑ ฺฉ round trip ฺฉุงูู ูพุฑ ูโุดููุฏ:</p>
<pre><code class="language-csharp">var query = from c in dbContext.Customers
            select new { c.Name, c.Purchases };

foreach (var row in query)
    foreach (Purchase p in row.Purchases)   // ุจุฏูู round-trip ุงุถุงู
        Console.WriteLine(row.Name + &quot; spent &quot; + p.Price);
</code></pre>
<p>ุงูุง ุงฺฏุฑ ฺฉ navigation property ุฑุง ุจุฏูู eager load ุง projection ุดูุงุฑุด ฺฉูุฏุ ููุงูู deferred execution ุงุนูุงู ูโุดููุฏ:</p>
<pre><code class="language-csharp">foreach (Customer c in dbContext.Customers.ToArray())
    foreach (Purchase p in c.Purchases)    // SQL round-trip ุงุถุงู
        Console.WriteLine(c.Name + &quot; spent &quot; + p.Price);
</code></pre>
<p>ุงู ูุฏู ุฒูุงู ููุฏ ุงุณุช ฺฉู ุจุฎูุงูุฏ ุงุฌุฑุง ุญููู ุฏุงุฎู ุฑุง ุจูโุตูุฑุช ุงูุชุฎุงุจ ุงูุฌุงู ุฏูุฏ:</p>
<pre><code class="language-csharp">foreach (Customer c in dbContext.Customers.ToArray())
    if (myWebService.HasBadCreditHistory(c.ID))
        foreach (Purchase p in c.Purchases)   // SQL round-trip ุงุถุงู
            Console.WriteLine(c.Name + &quot; spent &quot; + p.Price);
</code></pre>
<blockquote>
<p>ุชูุฌู: ุงุณุชูุงุฏู ุงุฒ <strong>ToArray</strong> ุถุฑูุฑ ุงุณุชุ ุฒุฑุง SQL Server ุจูโุตูุฑุช ูพุดโูุฑุถ ููโุชูุงูุฏ ฺฉ ฺฉูุฆุฑ ุฌุฏุฏ ุฑุง ุฏุฑ ุญุงู ฺฉู ูุชุงุฌ ฺฉูุฆุฑ ูุนู ูููุฒ ูพุฑุฏุงุฒุด ูโุดููุฏุ ุขุบุงุฒ ฺฉูุฏ.
ูโุชูุงู ุจุง ุงุถุงูู ฺฉุฑุฏู <code>;MultipleActiveResultSets=True</code> ุจู connection stringุ ุงูฺฉุงู <strong>MARS</strong> ุฑุง ูุนุงู ฺฉุฑุฏุ ุงูุง ุจุง ุงุญุชุงุท ุงุณุชูุงุฏู ฺฉูุฏุ ุฒุฑุง ููฺฉู ุงุณุช ูุดฺฉูุงุช ุทุฑุงุญ ุฏุชุงุจุณ ฺฉู ูโุชูุงููุฏ ุจุง eager loading ุง projection ุจูุจูุฏ ุงุจูุฏุ ูพููุงู ุดููุฏ.</p>
</blockquote>
<hr>
<h3>ุณุงุฎุช Expressions ุจุฑุง ฺฉูุฆุฑโูุง ๐๏ธ</h3>
<p>ุชุงฺฉูููุ ููุช ูุงุฒ ุจู ุงุฌุงุฏ ฺฉูุฆุฑโูุง ุฏุงูุงูฺฉ ุฏุงุดุชูุ ุงู ฺฉุงุฑ ุฑุง ุจุง chaining ุดุฑุท <strong>query operators</strong> ุงูุฌุงู ูโุฏุงุฏู. ุงู ุฑูุด ุฏุฑ ุจุณุงุฑ ุงุฒ ุณูุงุฑููุง ฺฉุงู ุงุณุชุ ุงูุง ฺฏุงู ูุงุฒ ุฏุงุฑู ุจู ุณุทุญ ุฏููโุชุฑ ุฑูุชู ู <strong>lambda expression</strong>ูุง ฺฉู ุจู operatorูุง ุฏุงุฏู ูโุดููุฏ ุฑุง ุฏุงูุงูฺฉ ุจุณุงุฒู.</p>
<p>ูุฑุถ ฺฉูุฏ ฺฉูุงุณ ุฒุฑ ุฏุงุฑู:</p>
<pre><code class="language-csharp">public class Product
{
    public int ID { get; set; }
    public string Description { get; set; }
    public bool Discontinued { get; set; }
    public DateTime LastSale { get; set; }
}
</code></pre>
<hr>
<h3>Delegates ุฏุฑ ููุงุจู Expression Trees ๐งฉ</h3>
<p>ุจู ุงุฏ ุฏุงุดุชู ุจุงุดุฏ:</p>
<ul>
<li>ฺฉูุฆุฑโูุง ูุญู (<strong>Enumerable operators</strong>) ุงุฒ <strong>delegates</strong> ุงุณุชูุงุฏู ูโฺฉููุฏ.</li>
<li>ฺฉูุฆุฑโูุง ุชูุณุฑุดุฏู (<strong>Queryable operators</strong>) ุงุฒ <strong>expression trees</strong> ุงุณุชูุงุฏู ูโฺฉููุฏ.</li>
</ul>
<p>ูโุชูุงู ุงู ุฑุง ุจุง ููุงุณู signature ูุชุฏ <strong>Where</strong> ุฏุฑ Enumerable ู Queryable ุฏุฏ:</p>
<pre><code class="language-csharp">public static IEnumerable&lt;TSource&gt; Where&lt;TSource&gt;(this IEnumerable&lt;TSource&gt; source, Func&lt;TSource,bool&gt; predicate)
public static IQueryable&lt;TSource&gt; Where&lt;TSource&gt;(this IQueryable&lt;TSource&gt; source, Expression&lt;Func&lt;TSource,bool&gt;&gt; predicate)
</code></pre>
<p>ููุช ฺฉ lambda expression ุฏุฑูู ฺฉ ฺฉูุฆุฑ ูุฑุงุฑ ูโฺฏุฑุฏุ ุธุงูุฑ ุขู ุดุจู ูู ุงุณุชุ ฺู ุจู operatorูุง Enumerable ูุชุตู ุดูุฏ ู ฺู Queryable:</p>
<pre><code class="language-csharp">IEnumerable&lt;Product&gt; q1 = localProducts.Where(p =&gt; !p.Discontinued);
IQueryable&lt;Product&gt;  q2 = sqlProducts.Where(p =&gt; !p.Discontinued);
</code></pre>
<p>ุงูุง ุงฺฏุฑ lambda ุฑุง ุจู ฺฉ ูุชุบุฑ ูุงู ุงุฎุชุตุงุต ุฏูุฏุ ุจุงุฏ ูุดุฎุต ฺฉูุฏ ฺฉู <strong>delegate</strong> ูโุฎูุงูุฏ ุง <strong>expression tree</strong>. ูุซุงู:</p>
<pre><code class="language-csharp">Func&lt;Product, bool&gt; predicate1 = p =&gt; !p.Discontinued;
IEnumerable&lt;Product&gt; q1 = localProducts.Where(predicate1);

Expression&lt;Func&lt;Product, bool&gt;&gt; predicate2 = p =&gt; !p.Discontinued;
IQueryable&lt;Product&gt; q2 = sqlProducts.Where(predicate2);
</code></pre>
<blockquote>
<p>ุชูุฌู: <code>predicate1</code> ู <code>predicate2</code> ูุงุจู ุฌุงฺฏุฒู ูุณุชูุฏ.</p>
</blockquote>
<h3>ฺฉุงููพุงู ฺฉุฑุฏู Expression Treeูุง โ๏ธ</h3>
<p>ูโุชูุงูุฏ ฺฉ <strong>expression tree</strong> ุฑุง ุจุง ูุฑุงุฎูุงู ูุชุฏ <strong>Compile</strong> ุจู <strong>delegate</strong> ุชุจุฏู ฺฉูุฏ. ุงู ฺฉุงุฑ ุจูโูฺู ุฒูุงู ุงุฑุฒุดููุฏ ุงุณุช ฺฉู ุจุฎูุงูุฏ ูุชุฏูุง ุจููุณุฏ ฺฉู <strong>expressions ูุงุจู ุงุณุชูุงุฏู ูุฌุฏุฏ</strong> ุจุฑูโฺฏุฑุฏุงููุฏ.</p>
<p>ุจุฑุง ูุซุงูุ ูุฑุถ ฺฉูุฏ ฺฉ ูุชุฏ ุงุณุชุงุชฺฉ ุจู ฺฉูุงุณ <strong>Product</strong> ุงุถุงูู ฺฉูู ฺฉู ฺฉ predicate ุจุฑูโฺฏุฑุฏุงูุฏ ู ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ูุญุตูู <strong>discontinued</strong> ูุจุงุดุฏ ู ุฏุฑ ณฐ ุฑูุฒ ฺฏุฐุดุชู ูุฑูุฎุชู ุดุฏู ุจุงุดุฏ:</p>
<pre><code class="language-csharp">public class Product
{
    public static Expression&lt;Func&lt;Product, bool&gt;&gt; IsSelling()
    {
        return p =&gt; !p.Discontinued &amp;&amp; p.LastSale &gt; DateTime.Now.AddDays(-30);
    }
}
</code></pre>
<p>ุงู ูุชุฏ ูโุชูุงูุฏ ูู ุฏุฑ ฺฉูุฆุฑโูุง <strong>interpreted</strong> ู ูู <strong>local</strong> ุงุณุชูุงุฏู ุดูุฏ:</p>
<pre><code class="language-csharp">void Test()
{
    var dbContext = new NutshellContext();
    Product[] localProducts = dbContext.Products.ToArray();
    
    IQueryable&lt;Product&gt; sqlQuery = dbContext.Products.Where(Product.IsSelling());
    IEnumerable&lt;Product&gt; localQuery = localProducts.Where(Product.IsSelling().Compile());
}
</code></pre>
<hr>
<h3>AsQueryable ๐งต</h3>
<p>ุฏุฑ .NET API ูุณุชูู ุจุฑุง ุชุจุฏู <strong>delegate</strong> ุจู <strong>expression tree</strong> ูุฌูุฏ ูุฏุงุฑุฏ. ุงู ูฺฺฏุ <strong>expression tree</strong>ูุง ุฑุง ุงูุนุทุงูโูพุฐุฑุชุฑ ูโฺฉูุฏ.</p>
<p>ุนููฺฏุฑ <strong>AsQueryable</strong> ุงุฌุงุฒู ูโุฏูุฏ ฺฉู ฺฉ ฺฉูุฆุฑ ุฑุง ุทูุฑ ุจููุณุฏ ฺฉู ูู ุฑู ุฏูุจุงููโูุง ูุญู ู ูู ุฑู ุฏูุจุงููโูุง ุฑููุช ุงุฌุฑุง ุดูุฏ:</p>
<pre><code class="language-csharp">IQueryable&lt;Product&gt; FilterSortProducts(IQueryable&lt;Product&gt; input)
{
    return from p in input
           where ...
           orderby ...
           select p;
}

void Test()
{
    var dbContext = new NutshellContext();
    Product[] localProducts = dbContext.Products.ToArray();

    var sqlQuery   = FilterSortProducts(dbContext.Products);
    var localQuery = FilterSortProducts(localProducts.AsQueryable());
}
</code></pre>
<blockquote>
<p><strong>AsQueryable</strong> ุฏูุจุงูู ูุญู ุฑุง ุจู ฺฉ <code>IQueryable&lt;T&gt;</code> ุชุจุฏู ูโฺฉูุฏ ุชุง query operators ุจุนุฏ ุจู <strong>expression tree</strong>ูุง ูุชุตู ุดููุฏ. ููุช ุจุนุฏุงู ุฑู ูุชุฌู ุดูุงุฑุด ุงูุฌุงู ุดูุฏุ <strong>expression tree</strong>ูุง ุจูโุตูุฑุช ุถูู ฺฉุงููพุงู ูโุดููุฏ (ุจุง ูุฒูู ฺฉูฺฺฉ ุนููฺฉุฑุฏ)ุ ู ุฏูุจุงูู ูุญู ูุซู ุญุงูุช ุนุงุฏ ุดูุงุฑุด ูโุดูุฏ.</p>
</blockquote>
<hr>
<h3>Expression Trees ๐ณ</h3>
<p>ูุจูุงู ฺฏูุชู ฺฉู ุชุจุฏู ุถูู ฺฉ lambda expression ุจู <code>Expression&lt;TDelegate&gt;</code> ุจุงุนุซ ูโุดูุฏ ฺฉุงููพุงูุฑ <strong>C#</strong> ฺฉุฏ ุชููุฏ ฺฉูุฏ ฺฉู ฺฉ <strong>expression tree</strong> ูโุณุงุฒุฏ.</p>
<p>ุจุง ฺฉู ุชูุงุด ุจุฑูุงููโููุณุ ูโุชูุงูุฏ ุงู ฺฉุงุฑ ุฑุง <strong>ุฏูุงูฺฉ ู ุฏุฑ ุฒูุงู ุงุฌุฑุง</strong> ุงูุฌุงู ุฏูุฏุ ุนู ฺฉ <strong>expression tree</strong> ุฑุง ุงุฒ ุตูุฑ ุจุณุงุฒุฏ. ูุชุฌู ุฑุง ูโุชูุงู ุจู <code>Expression&lt;TDelegate&gt;</code> ุชุจุฏู ฺฉุฑุฏ ู ุฏุฑ ฺฉูุฆุฑโูุง <strong>EF Core</strong> ุงุณุชูุงุฏู ฺฉุฑุฏ ุง ุจุง ูุฑุงุฎูุงู <strong>Compile</strong> ุจู ฺฉ <strong>delegate</strong> ูุนููู ุชุจุฏู ูููุฏ.</p>
<hr>
<h3>Expression DOM ๐๏ธ</h3>
<p>ฺฉ <strong>expression tree</strong> ุฏุฑ ูุงูุน ฺฉ <strong>miniature code DOM</strong> ุงุณุช. ูุฑ ููุฏ ุฏุฑ ุงู ุฏุฑุฎุช ุจุง ฺฉ ููุน ุฏุฑ namespace <code>System.Linq.Expressions</code> ูุดุงู ุฏุงุฏู ูโุดูุฏ. ุดฺฉู ธ-ฑฐ ุงููุงุน ุงู ููุฏูุง ุฑุง ูุดุงู ูโุฏูุฏ.</p>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-12.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
<p>ฺฉูุงุณ ูพุงู ุจุฑุง ุชูุงู ููุฏูุงุ ฺฉูุงุณ <strong>Expression</strong> ุบุฑุฌูุฑฺฉ ุงุณุช.</p>
<p>ฺฉูุงุณ <strong>generic Expression<TDelegate></strong> ุฏุฑ ูุงูุน ุจู ูุนูุง &quot;<strong>typed lambda expression</strong>&quot; ุงุณุช ู ุงฺฏุฑ ูุณุฆูู ูพฺุฏฺฏ ุฒุฑ ูุจูุฏุ ูโุชูุงูุณุช ูุงูุด <strong>LambdaExpression<TDelegate></strong> ุจุงุดุฏ:</p>
<pre><code class="language-csharp">LambdaExpression&lt;Func&lt;Customer,bool&gt;&gt; f = ...
</code></pre>
<p>ฺฉูุงุณ ูพุงู <strong>Expression<T></strong> ููุงู ฺฉูุงุณ ุบุฑุฌูุฑฺฉ <strong>LambdaExpression</strong> ุงุณุช. <strong>LambdaExpression</strong> ููุนโุจูุฏ ฺฉููุงุฎุช ุจุฑุง <strong>lambda expression tree</strong>ูุง ุฑุง ูุฑุงูู ูโฺฉูุฏุ ุจู ุทูุฑ ฺฉู ูุฑ <strong>Expression<T></strong> ูุงุจู ุชุจุฏู ุจู <strong>LambdaExpression</strong> ุงุณุช.</p>
<p>ูฺฺฏ ูุชูุงุฒ <strong>LambdaExpression</strong> ุงุฒ <strong>Expression</strong>ูุง ูุนููู ุงู ุงุณุช ฺฉู <strong>lambda expression</strong>ูุง ุฏุงุฑุง ูพุงุฑุงูุชุฑ ูุณุชูุฏ.</p>
<p>ุจุฑุง ุณุงุฎุช ฺฉ <strong>expression tree</strong>ุ ูุจุงุฏ ูุณุชููุงู ููุฏูุง ุฑุง instantiate ฺฉูุฏุ ุจูฺฉู ุจุงุฏ ุงุฒ ูุชุฏูุง ุงุณุชุงุชฺฉ ุงุฑุงุฆูโุดุฏู ุฏุฑ ฺฉูุงุณ <strong>Expression</strong> ุงุณุชูุงุฏู ฺฉูุฏุ ูุงููุฏ: <code>Add</code>, <code>And</code>, <code>Call</code>, <code>Constant</code>, <code>LessThan</code> ู ุบุฑู.</p>
<p>ุดฺฉู ธ-ฑฑ ุฏุฑุฎุช <strong>expression</strong> ุงุฌุงุฏุดุฏู ุชูุณุท ุงูุชุณุงุจ ุฒุฑ ุฑุง ูุดุงู ูโุฏูุฏ:</p>
<pre><code class="language-csharp">Expression&lt;Func&lt;string, bool&gt;&gt; f = s =&gt; s.Length &lt; 5;
</code></pre>
<div align="center">
<p><img src="../../../assets/image/08/Table-8-13.jpeg" alt="Conventions-UsedThis-Book"></p>
</div>
ูโุชูุงูู ุงู ููุถูุน ุฑุง ุจู ุตูุฑุช ุฒุฑ ูุดุงู ุฏูู:
<pre><code class="language-csharp">Console.WriteLine(f.Body.NodeType);                     // LessThan
Console.WriteLine(((BinaryExpression) f.Body).Right);   // 5
</code></pre>
<p>ุญุงู ุจุงุฏ ุงู <strong>expression</strong> ุฑุง ุงุฒ ุตูุฑ ุจุณุงุฒู. ุงุตู ุงู ุงุณุช ฺฉู ุงุฒ ูพุงู ุฏุฑุฎุช ุดุฑูุน ฺฉุฑุฏู ู ุจู ุณูุช ุจุงูุง ูพุด ุจุฑูู. ูพุงูโุชุฑู ุนูุตุฑ ุฏุฑุฎุช ูุง ฺฉ <strong>ParameterExpression</strong> ุงุณุชุ ุนู ูพุงุฑุงูุชุฑ <strong>lambda expression</strong> ุจู ูุงู <code>&quot;s&quot;</code> ุงุฒ ููุน <code>string</code>:</p>
<pre><code class="language-csharp">ParameterExpression p = Expression.Parameter(typeof(string), &quot;s&quot;);
</code></pre>
<p>ฺฏุงู ุจุนุฏ ุณุงุฎุช <strong>MemberExpression</strong> ู <strong>ConstantExpression</strong> ุงุณุช. ุฏุฑ ููุฑุฏ ุงููุ ุจุงุฏ ุจู ุฎุงุตุช <code>Length</code> ูพุงุฑุงูุชุฑ <code>&quot;s&quot;</code> ุฏุณุชุฑุณ ูพุฏุง ฺฉูู:</p>
<pre><code class="language-csharp">MemberExpression stringLength = Expression.Property(p, &quot;Length&quot;);
ConstantExpression five = Expression.Constant(5);
</code></pre>
<p>ฺฏุงู ุจุนุฏ ููุงุณู <strong>LessThan</strong> ุงุณุช:</p>
<pre><code class="language-csharp">BinaryExpression comparison = Expression.LessThan(stringLength, five);
</code></pre>
<p>ุขุฎุฑู ฺฏุงูุ ุณุงุฎุช <strong>lambda expression</strong> ุงุณุช ฺฉู <strong>expression Body</strong> ุฑุง ุจู ูุฌููุนูโุง ุงุฒ ูพุงุฑุงูุชุฑูุง ูุชุตู ูโฺฉูุฏ:</p>
<pre><code class="language-csharp">Expression&lt;Func&lt;string, bool&gt;&gt; lambda
    = Expression.Lambda&lt;Func&lt;string, bool&gt;&gt;(comparison, p);
</code></pre>
<p>ุฑุงู ุณุงุฏู ุจุฑุง ุชุณุช <strong>lambda</strong> ุงู ุงุณุช ฺฉู ุขู ุฑุง ุจู ฺฉ <strong>delegate</strong> ฺฉุงููพุงู ฺฉูู:</p>
<pre><code class="language-csharp">Func&lt;string, bool&gt; runnable = lambda.Compile();
Console.WriteLine(runnable(&quot;kangaroo&quot;));   // False
Console.WriteLine(runnable(&quot;dog&quot;));        // True
</code></pre>
<p>ุณุงุฏูโุชุฑู ุฑูุด ุจุฑุง ุชุนู ุงูฺฉู ฺฉุฏุงู ููุน <strong>expression</strong> ุฑุง ุจุงุฏ ุงุณุชูุงุฏู ฺฉุฑุฏุ ุงู ุงุณุช ฺฉู ฺฉ <strong>lambda expression</strong> ููุฌูุฏ ุฑุง ุฏุฑ <strong>Visual Studio debugger</strong> ุจุฑุฑุณ ฺฉูุฏ.</p>
<p>ูุง ุงุฏุงูู ุงู ุจุญุซ ุฑุง ุขููุงู ุงุฑุงุฆู ุฏุงุฏูโุงู ุฏุฑ: <a href="http://www.albahari.com/expressions">http://www.albahari.com/expressions</a> โ</p>

  </main>

  <!-- ููุชุฑ ูุดุชุฑฺฉ -->
  <footer class="footer">
    <div class="container">
      <p>
        <img src="/icone/copyright.svg" alt="ฺฉูพโุฑุงุช" width="14" height="14"
             style="vertical-align:middle;margin-inline:4px">
        <span id="y"></span> Gitab โ ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู
      </p>
    </div>
  </footer>

  <!-- ุณุงู + ุงุณฺฉุฑูพุช ุชู -->
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    (() => {
      const root = document.documentElement;
      const btn = document.getElementById('themeToggle');
      const KEY = 'gitab-theme';
      const media = window.matchMedia('(prefers-color-scheme: dark)');
      const getEffective = s => s === 'auto' ? (media.matches ? 'dark' : 'light') : s;
      function updateTheme(s) {
        root.setAttribute('data-theme', s);
        const mode = getEffective(s);
        root.dataset.colorMode = mode;
        btn.dataset.icon = mode === 'dark' ? 'moon' : 'sun';
      }
      const saved = localStorage.getItem(KEY) || 'auto';
      updateTheme(saved);
      btn.addEventListener('click', () => {
        const curr = localStorage.getItem(KEY) || 'auto';
        const next = curr === 'auto' ? 'dark' : curr === 'dark' ? 'light' : 'auto';
        localStorage.setItem(KEY, next);
        updateTheme(next);
      });
      media.addEventListener('change', () => {
        if ((localStorage.getItem(KEY) || 'auto') === 'auto') updateTheme('auto');
      });
      window.addEventListener('DOMContentLoaded', () => updateTheme(saved));
    })();
  </script>
</body>
</html>
