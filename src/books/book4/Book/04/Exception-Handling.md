---
layout: layout.njk
title: Exception Handling
---
# ูุตู ฺูุงุฑู: ูุฏุฑุช ุงุณุชุซูุงูุง (Exception Handling) โ๏ธ

ุชุนุฌุจ ูุฏุงุฑุฏ ฺฉู ูุธุงู (tasks) ููฺฉู ุงุณุช ุจุง **ุงุณุชุซูุงูุง (exceptions)** ููุงุฌู ุดููุฏ. ููฺูู ุฏุฑุณุช ุงุณุช ฺฉู **ูุธุงู ูุฎุชูู ููฺฉู ุงุณุช ุงุณุชุซูุงูุง ูุชูุงูุช** ุงุฌุงุฏ ฺฉููุฏ. ุฏุฑ ฺฉ ูุญุท **ฺูุฏูุฎ (multithreaded)**ุ ูุฏุฑุช ุงู ุงุณุชุซูุงูุง ูู ูโุชูุงูุฏ **ูพฺุฏู ู ฺุงูุดโุจุฑุงูฺฏุฒ** ุจุงุดุฏ.

ุจุฑูุงูู ุดูุง ุจุงุฏ ุจู ุขูโูุง ุจูโุทูุฑ **ููุงู ู ฺฉูุชุฑูโุดุฏู** ูพุงุณุฎ ุฏูุฏ ุชุง ุงุฒ **ฺฉุฑุดโูุง ูุงุฎูุงุณุชู** ุฌููฺฏุฑ ฺฉุฑุฏู ู **ูพุงุฏุงุฑ** ุฎูุฏ ุฑุง ุญูุธ ฺฉูุฏ. ุจู ููู ุฏููุ **ูุฏุฑุช ุงุณุชุซูุงูุง ุจุฑุง ุณุงุฎุช ุจุฑูุงููโูุง ูุงุจู ุงุนุชูุงุฏ ู ููุงูู ุถุฑูุฑ ุงุณุช**. ุงู ูุตู ุจุฑ ุฑู ุงู ููุถูุน ุชูุฑฺฉุฒ ุฏุงุฑุฏ.

---

### ุฏุฑฺฉ ฺุงูุด ๐งฉ

ุงุฒ ุขูุฌุง ฺฉู ุดูุง ุฏุฑ ุญุงู ูุทุงูุนู ููุงูู ูพุดุฑูุชู ุจุฑูุงููโููุณ ูุณุชุฏุ ูุฑุถ ูโฺฉูู ุจุง **ูุจุงู ุงุณุชุซูุงูุง ู ูุญูู ูุฏุฑุช ุขูโูุง ุฏุฑ ุจุฑูุงููโูุง C#** ุขุดูุง ูุณุชุฏ. ุจูุงุจุฑุงูุ ุฏุฑ ุงู ฺฉุชุงุจ ุจู **ูุจุงุญุซ ูพุงูโุง ูพุฑุฏุงุฎุชู ููโุดูุฏ**. ุชูุฑฺฉุฒ ูุง ุจุฑ ุฑู **ุณูุงุฑููุง ุงุณุชุซูุง ุงุญุชูุงู** ุงุณุช ฺฉู ููฺฏุงู ุจุฑูุงููโููุณ ูุธููโุง ุฏุฑ ูุญุท ฺูุฏูุฎ ููฺฉู ุงุณุช ุฑุฎ ุฏูุฏ.

---

### ุจุฑูุงููโุง ฺฉู ุงุณุชุซูุง ุฑุง ูุดุงู ููโุฏูุฏ ๐ซ

ุงฺฏุฑ ุนูุงุฆู ูุงุถุญ ุจุงุดูุฏุ ูพุฒุดฺฉ ูโุชูุงูุฏ **ูุดฺฉู ุจูุงุฑ ุฑุง ุจู ุฑุงุญุช ุชุดุฎุต ุฏูุฏ**. ุงูุง ูุดฺฉูุงุช **ูุดุงูุฏูโูุดุฏู** ุจู ุณุฎุช ุดูุงุณุง ูโุดููุฏ.

ููู ููุถูุน ุฏุฑ ุจุฑูุงููโููุณ ูุฒ ุตุงุฏู ุงุณุช: **ฺฉ ุงุณุชุซูุง ูุดุงูุฏูโูุดุฏู ูโุชูุงูุฏ ูุดฺฉูุงุช ุฒุงุฏ ุงุฌุงุฏ ฺฉูุฏ**.

ุจุฑุง ูุซุงูุ ุจุฑูุงูู ุฒุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ ฺฉู **ูุฎ ุงุตู (main thread)** ฺฉ ูุธูู ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู **ุงุณุชุซูุง ุงุฌุงุฏ ูโฺฉูุฏุ ุงูุง ุฏุฑ ุฎุฑูุฌ ููุงุด ุฏุงุฏู ููโุดูุฏ**.

๐ ุชูุฌู: ุจุณุชู ุจู ุชูุธูุงุช **Visual Studio** ุดูุงุ ููฺฉู ุงุณุช ุฎุท ฺฉู ุงุณุชุซูุง ุงุฌุงุฏ ูโฺฉูุฏุ **ูุงูุงุช ุดูุฏ**. ุจุง ุงู ุญุงูุ ุงฺฏุฑ ุงุฏุงูู ุงุฌุฑุง ุจุฑูุงูู ุฑุง ุจุง **F5 ุง ุฏฺฉูู Continue** ุงูุฌุงู ุฏูุฏุ ูฺ ุงุทูุงุนุงุช ุฏุฑุจุงุฑู ุงู ุงุณุชุซูุง ุฏุฑ ุฎุฑูุฌ ูุดุงูุฏู ูุฎูุงูุฏ ฺฉุฑุฏ.

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/04/Table%204-1.jpeg)
</div>

ุงฺฏุฑ ุดูุง ฺฉุงุฑุจุฑ **Visual Studio** ูุณุชุฏ ู ุจุฑูุงููโูุง ูโููุณุฏ ฺฉู ุจุง **ฺูุฏู ุฏุฑุฎูุงุณุช ูุบู (cancellation)** ุณุฑ ู ฺฉุงุฑ ุฏุงุฑูุฏุ ูุงุฒู ุงุณุช ูฺฉุชู ุฒุฑ ุงุฒ ูุงฺฉุฑูุณุงูุช ุฑุง ุจู ุงุฏ ุฏุงุดุชู ุจุงุดุฏ (ููุจุน: [Microsoft Docs](https://learn.microsoft.com/en-us/dotnet/standard/threading/how-to-listen-for-multiple-cancellation-requests)):

> ุฒูุงู ฺฉู ฺฏุฒูู **โJust My Codeโ** ูุนุงู ุงุณุชุ ุฏุฑ ุจุฑุฎ ููุงุฑุฏ Visual Studio ุฑู ุฎุท ฺฉู **ุงุณุชุซูุง ุงุฌุงุฏ ูโฺฉูุฏ** ูุชููู ูโุดูุฏ ู ูพุบุงู ุฎุทุง ููุงุด ูโุฏูุฏ ฺฉู ูโฺฏูุฏ:
> โexception not handled by user code.โ
> ุงู ุฎุทุง **ุถุฑุฑ ูุฏุงุฑุฏ** ู ูโุชูุงูุฏ ุจุง ูุดุฑุฏู **F5** ุงุฏุงูู ุฏูุฏ.
> ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชููู Visual Studio ุฑู ุงููู ุฎุทุงุ ฺฉุงู ุงุณุช ฺฏุฒูู **โJust My Codeโ** ุฑุง ุงุฒ ูุณุฑ **Tools โ Options โ Debugging โ General** ุบุฑูุนุงู ฺฉูุฏ.

---

### ูุซุงู ุนูู ฑ ๐ฅ๏ธ

ุจุงุฏ ุจุฑูุงูู ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูู:

```csharp
using static System.Console;

WriteLine("The main thread starts executing.");

try
{
    var validateUserTask = Task.Run(() =>
        throw new UnauthorizedAccessException("Unauthorized user.")
    );
}
catch (Exception e)
{
    WriteLine($"Caught error: {e.Message}");
}

WriteLine("End of the program.");
```

#### ุฎุฑูุฌ

ุจุง ุงุฌุฑุง ุงู ุจุฑูุงููุ ุฎุฑูุฌ ุฒุฑ ูุดุงูุฏู ูโุดูุฏ:

```
The main thread starts executing.
End of the program.
```

๐น ูฺฉุชู: ุฎุฑูุฌ ูฺ ุงุทูุงุนุงุช ุฏุฑุจุงุฑู **ุงุณุชุซูุง** ูุดุงู ููโุฏูุฏ. ฺุฑุงุ
ุฒุฑุง ุฏุฑ ุงู ุจุฑูุงููุ **ูุฎ ุงุตู (main thread)** ุจุง ุงุณุชุซูุง ููุงุฌู ูุดุฏุ ุจูฺฉู ุงู ุงุณุชุซูุง ุชูุณุท **validateUserTask** ฺฉู ุชูุณุท ูุฎ ุงุตู ุงุฌุงุฏ ุดุฏู ุจูุฏุ ุฑุฎ ุฏุงุฏู ุงุณุช.

ฺูู ุงุณุชุซูุงูุง **ูุดุงูุฏูโูุดุฏู (unobserved)** ูโุชูุงููุฏ ุฏุฑ ูุฑุงุญู ุจุนุฏ ูุดฺฉู ุงุฌุงุฏ ฺฉููุฏุ ุจูุชุฑ ุงุณุช ุขูโูุง ุฑุง ูุดุงูุฏู ู **ูุฏุฑุช** ฺฉูู.

---

### ูุนุฑู AggregateException โก

ฺุทูุฑ ูโุชูุงู ุงุทูุงุนุงุช ูุฑุจูุท ุจู ุงุณุชุซูุง ุฑุง ุจู ุฏุณุช ุขูุฑุฏุ
ฺฉ ุฑูุด ูุงุถุญุ **ูุฏุฑุช ุงุณุชุซูุง ุฏุฑ ุฏุงุฎู ููุงู Task** ุงุณุช. ูุซุงู:

```csharp
var validateUserTask = Task.Run(() =>
{
    string msg = string.Empty;
    try
    {
        throw new UnauthorizedAccessException("Unauthorized user.");
    }
    catch (Exception e)
    {
        WriteLine($"Caught error inside the task: {e.Message}");
    }
    return msg;
});
```

ุงูุง ุงฺฏุฑ **Task ุงุณุชุซูุงูุง ุฑุง ูุฏุฑุช ูฺฉูุฏ**ุ ฺฺฏููู ูโุชูุงู ุฌุฒุฆุงุช ุฎุทุง ุฑุง ุฏุฑุงูุช ฺฉุฑุฏุ

---

### ูุซุงู ุนูู ฒ ๐

ุฏุฑ **ุจุฑูุงููโููุณ ูุจุชู ุจุฑ Task**ุ ุงุณุชุซูุงูุง **ุฏุฑูู ุดุก Task ุฐุฎุฑู ูโุดููุฏ** ู **ุจู ูุญุถ ูููุนุ ูพุฑุชุงุจ ููโุดููุฏ**.

ุงฺฏุฑ ุงุณุชุซูุง ุฏุฑ ุฏุงุฎู ฺฉ Task ุฑุฎ ุฏูุฏุ ุฏุฑูู ฺฉ **AggregateException** ูุฑุงุฑ ูโฺฏุฑุฏ ฺฉู ุดุงูู **ุชูุงู ุงุณุชุซูุงูุง ุงุณุช ฺฉู ุท ุงุฌุฑุง ุขู Task ุงุฌุงุฏ ุดุฏูโุงูุฏ**.
ุงู ูฺฺฏ ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุชุง ุงุณุชุซูุงูุง ุฑุง **ุจูโุตูุฑุช ุฌูุน ุง ุฌุฏุงฺฏุงูู ูุฏุฑุช ฺฉูุฏ**.
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/04/Table%204-2.jpeg)
</div>

โ๏ธ **ูฺฉุชู ููู**

ฺฉูุงุณ **AggregateException** ุจู **namespace System** ุชุนูู ุฏุงุฑุฏ ู ุงุฒ ฺฉูุงุณ **Exception** ุงุฑุซโุจุฑ ูโฺฉูุฏ.

AggregateException ูโุชูุงูุฏ ุฏุฑ ูุฑ ฺฉ ุงุฒ ุณูุงุฑููุง ุฒุฑ ูพุฑุชุงุจ ุดูุฏ:
โข ููุช ฺฉู ุดูุง ุณุน ูโฺฉูุฏ **ูุชุฌู ฺฉ Task** ุฑุง ุฏุฑุงูุช ฺฉูุฏ.
โข ููุช ฺฉู ุจูโุทูุฑ ุตุฑุญ ูุชุฏ **Wait** ุฑุง ุฑู Task ูุฑุงุฎูุงู ูโฺฉูุฏ.
โข ููุช ฺฉู Task ุฑุง ุจุง **await** ุงุฌุฑุง ูโฺฉูุฏ (ุงุฒ ุขูโุฌุง ฺฉู ุงู ฺฉุชุงุจ ุจู **async/await** ููโูพุฑุฏุงุฒุฏุ ูุนูุงู ุขู ุฑุง ุจุฑุฑุณ ููโฺฉูู).

ุงฺฉููู ูุชูุฌู ูุณุชุฏ ฺฉู ุฏุฑ ูุซุงู ูุจูุ ุงฺฏุฑ ฺฉ ุงุฒ ุฎุทูุท ุฒุฑ ุฑุง ุฏุงุฎู **try block** ุงุณุชูุงุฏู ฺฉูุฏุ ูโุชูุงูุฏ ุงุณุชุซูุง ุฑุง ูุดุงูุฏู ฺฉูุฏ:

```csharp
WriteLine(validateUserTask.Result);
```

ุง

```csharp
validateUserTask.Wait();
```

---

### ูุซุงู ุนูู ๐ฅ๏ธ

ุฏุฑ ุงู ูููููุ ุงุฒ ุฏุณุชูุฑ **validateUserTask.Wait();** ุฏุงุฎู try block ุงุณุชูุงุฏู ุดุฏู ุงุณุช (ุชุบุฑุงุช ุจุง **bold** ูุดุฎุต ุดุฏูโุงูุฏ):

```csharp
// ฺฉุฏ ูุจู ุจุฏูู ุชุบุฑ
try
{
    var validateUserTask = Task.Run(() =>
        throw new UnauthorizedAccessException("Unauthorized user.")
    );
    validateUserTask.Wait(); // ูุดุงูุฏู ุงุณุชุซูุง
}
// ุจูู ฺฉุฏ ุจุฏูู ุชุบุฑ
```

#### ุฎุฑูุฌ

ุจุง ุงุฌุฑุง ูุฌุฏุฏ ุจุฑูุงููุ ุฎุฑูุฌ ุฒุฑ ูุดุงูุฏู ูโุดูุฏ:

```
The main thread starts executing.
Caught error: One or more errors occurred. (Unauthorized user.)
End of the program.
```

๐น ูฺฉุชู: ุญุงูุง ุฎุทุง ููุงุด ุฏุงุฏู ูโุดูุฏุ ุงูุง ุงุทูุงุนุงุช ุฎุทุง **โUnauthorized user.โ** ุจูโุนููุงู ฺฉ **InnerException** ุฏุฑ AggregateException ุจุณุชูโุจูุฏ ุดุฏู ุงุณุช.

---

### ุฌูุณู ูพุฑุณุด ู ูพุงุณุฎ โ

**Q4.1** ฺุฑุง ุงุทูุงุนุงุช ุฎุทุง โUnauthorized user.โ ุจูโุตูุฑุช InnerException ููุงุด ุฏุงุฏู ุดุฏุ

ุงู ุจุฑูุงูู ฺฉ **AggregateException** ุฑุง ฺฏุฑูุชู ุงุณุชุ ฺฉู ุจุฑุง **ุชุฌูุน ฺูุฏู ุฎุทุง** ุฏุฑ ฺฉ ุดุก ุงุณุชุซูุง ูุงุจู ูพุฑุชุงุจ ุงุณุชูุงุฏู ูโุดูุฏ. ฺูู ุงุณุชุซูุง ุฏุฑ **ุจุฑูุงููโููุณ ูุจุชู ุจุฑ Task** ุจุณุงุฑ ุฑุงุฌ ุงุณุช.

ุจุฑุง ุจุฑุฑุณุ ูโุชูุงูุฏ **catch block** ุฑุง ุจู ุดฺฉู ุฒุฑ ุชุบุฑ ุฏูุฏ:

```csharp
catch (Exception e)
{
    WriteLine($"Caught error: {e.Message}");
    WriteLine($"Exception name: {e.GetType().Name}");
}
```

ุจุง ุงุฌุฑุง ูุฌุฏุฏ ุจุฑูุงููุ ุฎุฑูุฌ ุจู ุตูุฑุช ุฒุฑ ุฎูุงูุฏ ุจูุฏ:

```
The main thread starts executing.
Caught error: One or more errors occurred. (Unauthorized user.)
Exception name: AggregateException
End of the program.
```

๐ ููุงูโุทูุฑ ฺฉู ูุดุงูุฏู ูโฺฉูุฏุ ุจุฑูุงูู ฺฉ **AggregateException** ุฑุง ฺฏุฑูุชู ุงุณุช.
ูุทุงุจู ูุณุชูุฏุงุช ุฑุณู ูุงฺฉุฑูุณุงูุช:

> ุจุฑุง ุจุงุฒฺฏุฑุฏุงูุฏู ุชูุงู ุงุณุชุซูุงูุง ุจู ูุฎ ูุฑุงุฎูุงูุ ุฒุฑุณุงุฎุช Task ุขูโูุง ุฑุง ุฏุฑ ฺฉ ููููู AggregateException ุจุณุชูโุจูุฏ ูโฺฉูุฏ.
> ุฎุงุตุช **InnerExceptions** ุงู ฺฉูุงุณ ุงูฺฉุงู ุดูุงุฑุด ู ุจุฑุฑุณ ููู ุงุณุชุซูุงูุง ุงุตู ุฑุง ูุฑุงูู ูโฺฉูุฏุ ุชุง ุจุชูุงูุฏ ูุฑ ฺฉุฏุงู ุฑุง ุจูโุตูุฑุช ุฌุฏุงฺฏุงูู ูุฏุฑุช (ุง ูุงุฏุฏู) ฺฉูุฏ.

ุจูุงุจุฑุงูุ ููุงูโุทูุฑ ฺฉู ุฏุฑ ุฎุฑูุฌ ูุจู ูุดุงูุฏู ุดุฏุ ุฎุทุง ูุงูุน **Unauthorized user.** ุจูโุนููุงู ฺฉ **InnerException** ุจุณุชูโุจูุฏ ุดุฏู ุจูุฏ.
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/04/Table%204-3.jpeg)
</div>

โ๏ธ **ูฺฉุชู ููู**

ุงุฒ ุขูโุฌุง ฺฉู **AggregateException** ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ฺูุฏู ุฎุทุง ุง ุดฺฉุณุช ุฑุง ุฏุฑ ูุญุทโูุง ููโุฒูุงู ุชุฌูุน ฺฉูุฏุ ุฏุฑ **ุจุฑูุงููโููุณ ูุจุชู ุจุฑ Task** ุจุณุงุฑ ูพุฑฺฉุงุฑุจุฑุฏ ุงุณุช. ุงุฒ ุงู ูพุณุ ูู ูููุงุฑู ุงุฒ **AggregateException** ุฏุงุฎู ุจููฺฉโูุง **catch** ุงุณุชูุงุฏู ุฎูุงูู ฺฉุฑุฏ.

---

### ุงุณุชุฑุงุชฺโูุง ูุฏุฑุช ุงุณุชุซูุงูุง ๐๏ธ

ุชุง ุงู ูุฑุญููุ ููุท ฺฉ ุงุณุชุซูุง ุฑุง ูุฏุฑุช ฺฉุฑุฏูโุงู. ุจุฏู ุงุณุช ฺฉู ุจุฑูุงูู ุดูุง ุจุง ฺูุฏู Task ูุฎุชูู ุณุฑูฺฉุงุฑ ุฎูุงูุฏ ุฏุงุดุช ู ูุฑฺฉุฏุงู ููฺฉู ุงุณุช ุงุณุชุซูุง ูุชูุงูุช ูพุฑุชุงุจ ฺฉููุฏ. ุจูุงุจุฑุงูุ ุจุงุฏ ุฑู ูุญูู ูุฏุฑุช ุงุณุชุซูุงูุง ุชูุฑฺฉุฒ ฺฉูู ฺฉู ูโุชูุงููุฏ ุชูุณุท ฺฉ ุง ฺูุฏ Task ุงุฌุงุฏ ุดููุฏ.

ูพุด ุงุฒ ุดุฑูุนุ ูุงุฒู ุงุณุช ุจุฏุงูุฏ ฺฉู **ูุฏูโูุง ุจุฑูุงููโููุณ ูุฎุชูู** ุงุณุชุฑุงุชฺโูุง ูุชูุงูุช ุจุฑุง ูุฏุฑุช ุงุณุชุซูุง ุฏุงุฑูุฏ.
ุจู ุนููุงู ูุซุงู:

* ุฏุฑ **Object-Oriented Programming (OOP)** ูุนูููุงู ุงุฒ ุจููฺฉโูุง **try, catch, finally** ุงุณุชูุงุฏู ูโฺฉูู.
* ุงูุง ุฏุฑ **Functional Programming (FP)** ฺูู ุจููฺฉโูุง ูุนูููุงู ูุฌูุฏ ูุฏุงุฑูุฏ.

ุฏุฑ ุงูุฌุง ุชูุฑฺฉุฒ ูุง ุฑู OOP ุฎูุงูุฏ ุจูุฏ ู ุงุณุชุฑุงุชฺโูุง ุฑุง ุฏุฑ ุฏู ุฏุณุชู ุณุงุฏู ูโฺฉูู:
โข ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ฺฉ ูฺฉุงู ๐
โข ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ฺูุฏ ูฺฉุงู ๐ข

---

### ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ฺฉ ูฺฉุงู ๐

ุจุงุฏ ุจุง ุงููู ุฏุณุชู ุดุฑูุน ฺฉููุ ุนู **ฺฺฏููฺฏ ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ฺฉ ููุทู ูุงุญุฏ**.

#### ูุซุงู ุนูู โ Demonstration 3 ๐ฅ๏ธ

ุงู ุจุฑูุงูู ุฏู Task ูุฎุชูู ุฑุง ุฏุงุฎู Thread ุงุตู ุงุฌุงุฏ ูโฺฉูุฏ ู ูุฑ ฺฉุฏุงู ฺฉ ุงุณุชุซูุง ูพุฑุชุงุจ ูโฺฉููุฏ. ุฏุฑ ุงูุฌุง ุจุง ูพูุงุด **InnerExceptions**ุ ุฌุฒุฆุงุช ุฎุทุง ููุงุด ุฏุงุฏู ูโุดูุฏ:

```csharp
using static System.Console;
WriteLine("Exception handling demo.");

try
{
    var validateUserTask = Task.Run(
        () =>
        {
            // ฺฉุฏ Task ุงูู
        }
    );
    // ุณุงุฑ ฺฉุฏูุงุ ุฏุฑ ุตูุฑุช ูุฌูุฏ
    throw new UnauthorizedAccessException("Unauthorized user.");

    var storeDataTask = Task.Run(
        () =>
        {
            // ฺฉุฏ Task ุฏูู
        }
    );
    // ุณุงุฑ ฺฉุฏูุงุ ุฏุฑ ุตูุฑุช ูุฌูุฏ
    throw new InsufficientMemoryException("Insufficient memory.");

    Task.WaitAll(validateUserTask, storeDataTask);
}
catch (AggregateException ae)
{
    foreach (Exception e in ae.InnerExceptions)
    {
        WriteLine($"Caught error: {e.Message}");
    }
}
```

#### ุฎุฑูุฌ ููููู

```
Exception handling demo.
Caught error: Unauthorized user.
Caught error: Insufficient memory.
```

ุงู ฺฉ ุฑูุด ุจุณุงุฑ ุฑุงุฌ ุจุฑุง ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ **ุจุฑูุงููโููุณ ูุจุชู ุจุฑ Task** ุงุณุช.

---

### ุฑูุด ุฌุงฺฏุฒู ฑ ๐

ุจู ุจููฺฉ **catch** ุฏุฑ ูุซุงู ูุจู ุชูุฌู ฺฉูุฏ. ุฏุฑ ุขู ุงุฒ **ae.InnerExceptions** ุจุฑุง ููุงุด ุฎุทุงูุง ุงุณุชูุงุฏู ุดุฏ.
ุฏุฑ ุฑูุด ุฌุงฺฏุฒูุ ุงุจุชุฏุง **InnerExceptions** ุฑุง **Flatten** ูโฺฉูู ู ุณูพุณ ุงุณุชุซูุงูุง ุฑุง ูพูุงุด ูโฺฉูู:

```csharp
catch (AggregateException ae)
{
    // ุฑูุด ุฌุงฺฏุฒู ฑ
    var exceptions = ae.Flatten().InnerExceptions;
    foreach (Exception e in exceptions)
    {
        WriteLine($"Caught error: {e.Message}");
    }
}
```

ุงู ุฑูุด ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุชุง **ุงุณุชุซูุงูุง ุชู ุฏุฑ ุชู** ุฑุง ุจู ุตูุฑุช ฺฉ ูุณุช ูุณุทุญ ุจุฑุฑุณ ฺฉูุฏ ู ุจู ุฑุงุญุช ูุฏุฑุช ููุงุฏ.

### ุฑูุด ุฌุงฺฏุฒู ฒ ๐

ุฏุฑ ฺฉูุงุณ **AggregateException** ูุชุฏ ุจู ูุงู **Handle** ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุดฺฉู ุขู ุจู ุตูุฑุช ุฒุฑ ุงุณุช:

```csharp
public void Handle(Func<Exception, bool> predicate)
{
    // ุจุฏูู ูุชุฏ ููุงุด ุฏุงุฏู ูุดุฏู ุงุณุช
}
```

ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ูุชุฏุ ูโุชูุงูุฏ ฺฉ **Handler** ุจุฑุง ูุฑ ุงุณุชุซูุง ููุฌูุฏ ุฏุฑ **AggregateException** ูุฑุงุฎูุงู ฺฉูุฏ.
ุจุฑุง ูุซุงูุ ุจุงุฏ ุจููฺฉ **catch** ุฏุฑ **Demonstration 3** ุฑุง ุจู ุดฺฉู ุฒุฑ ุจุงุฒููุณ ฺฉูู (ุฑูุดโูุง ูุจู ุฏุงุฎู ฺฉุงููุช ุจุฑุง ูุฑุฌุน ุณุฑุน ุดูุง ุจุงู ูุงูุฏูโุงูุฏ):

```csharp
catch (AggregateException ae)
{
    //// ุฑูุด ุงููู
    //foreach (Exception e in ae.InnerExceptions)
    //{
    //    
    //}

    //// ุฑูุด ุฌุงฺฏุฒู ฑ
    //var exceptions = ae.Flatten().InnerExceptions;
    //foreach (Exception e in exceptions)
    //{
    //    
    //}

    // ุฑูุด ุฌุงฺฏุฒู ฒ
    ae.Handle(e =>
    {
        WriteLine($"Caught error: {e.Message}");
        return true;
    });
}
```

ุจุง ุงุฌุฑุง ุงู ุจุฑูุงููุ ุฎุฑูุฌ ูุดุงุจู ุฑูุดโูุง ูุจู ุฏุฑุงูุช ุฎูุงูุฏ ุดุฏ.

๐ก **ูฺฉุชู:** ุฏุฑ ูพุฑูฺู **Chapter4\_Demo3** ุชูุงู ุฑูุดโูุง ูุฎุชูู ฺฉู ุชุงฺฉููู ุจุญุซ ุดุฏ ููุฌูุฏ ุงุณุช ู ฺฉุฏูุง ุฌุงฺฏุฒู ุฏุงุฎู ฺฉุงููุช ุจุฑุง ููุงุณู ุณุฑุน ูุฑุงุฑ ุฏุงุฑูุฏ. ุจุง ุฏุงูููุฏ ุงู ูพุฑูฺู ูโุชูุงูุฏ ุงู ุฑูุดโูุง ุฑุง ุนูู ฺฉูุฏ ู ุชุณุช ฺฉูุฏ.

---

### ูพุฑุณุด ู ูพุงุณุฎ ๐

**Q4.2:** ูู ุฏู ุงุณุชุซูุง ุงุฒ ุฏู Task ูุฎุชูู ูพุฑุชุงุจ ฺฉุฑุฏูโุงู. ฺฺฏููู ูโุชูุงูู ุขูโูุง ุฑุง ุงุฒ ูู ุชุดุฎุต ุฏููุ

โ ุณุงุฏู ุงุณุช. ูโุชูุงูุฏ **ID** Task ุง ฺฉ ูพุงู ููุงุณุจ ุฑุง ุฏุฑ **Source** ุงุณุชุซูุง ูุฑุงุฑ ุฏูุฏ.
ููููู ุจุฑูุงูู ุจุง ุชุบุฑุงุช ฺฉูฺฺฉ ูุณุจุช ุจู **Demonstration 3**:

```csharp
using static System.Console;
WriteLine("Exception handling demo.");

try
{
    var validateUserTask = Task.Run(
        () =>
        {
            // ฺฉุฏ Task ุงูู
        }
    );
    throw new UnauthorizedAccessException("Unauthorized user.")
    { Source = "validateUserTask" };

    var storeDataTask = Task.Run(
        () =>
        {
            // ฺฉุฏ Task ุฏูู
        }
    );
    throw new InsufficientMemoryException("Insufficient memory.")
    { Source = "storeDataTask" };

    Task.WaitAll(validateUserTask, storeDataTask);
}
catch (AggregateException ae)
{
    foreach (Exception e in ae.InnerExceptions)
    {
        WriteLine($"The task: {e.Source} raised {e.GetType()}: {e.Message}");
    }
}
```

#### ุฎุฑูุฌ ููููู

```
Exception handling demo.
The task: validateUserTask raised System.UnauthorizedAccessException: Unauthorized user.
The task: storeDataTask raised System.InsufficientMemoryException: Insufficient memory.
```

**Q4.3:** ุขุง ูโุชูุงูู ููู ุฑูฺฉุฑุฏ ุฑุง ููุช ฺูุฏู Task ฺฉ ุงุณุชุซูุง ูุดุงุจู ูพุฑุชุงุจ ูโฺฉููุฏ ูู ุงุณุชูุงุฏู ฺฉููุ

โ ุจููุ ฺฉุงููุงู ุฏุฑุณุช ุงุณุช. ุงู ุฑูุด ุจุฑุง ูุฏุฑุช ููุฒูุงู ฺูุฏู ุงุณุชุซูุง ุญุช ุงุฒ ฺฉ ููุน ฺฉุณุงู ูุฒ ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ.

### ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ฺูุฏู ูฺฉุงู ๐๏ธ

ูุฑุถ ูโฺฉูู ฺฉู ุชุง ุงูุฌุง ุจุง ุงุฏูโ ูุฏุฑุช ฺูุฏู ุงุณุชุซูุง ุขุดูุง ุดุฏูโุงุฏ. ุงู ุฑูุด ฺฉุงููุงู ูพุฐุฑูุชูโุดุฏู ู ุงุญุชูุงูุงู ุฑุงุฌโุชุฑู ุฑูฺฉุฑุฏ ุงุณุช.

ุฏุฑ ุงุฏุงููุ ุฑูุด ุฑุง ูุดุงู ูโุฏูู ฺฉู ุจุฎุด ุงุฒ **AggregateException** ุฑุง ุฏุฑ ฺฉ ูฺฉุงู ูุฏุฑุช ูโฺฉูุฏ ู ุจุฎุด ุจุงูโูุงูุฏู ุฑุง ุจู ุณุทุญ ุจุงูุงุชุฑ ููุชูู ฺฉุฑุฏู ู ุฏุฑ ุขูุฌุง ูุฏุฑุช ูโฺฉูุฏ. ุจู ุจุงู ุฏฺฏุฑุ ูโุฎูุงูู ุงุซุฑุจุฎุด ูุชุฏ **Handle** ุฑุง ุจุจูู.

ุงุจุชุฏุง ุจู ูุทุนู ฺฉุฏ ุฒุฑ ุชูุฌู ฺฉูุฏ (ุงู ฺฉุฏ ุงุฒ **Demonstration 4** ฺฏุฑูุชู ุดุฏู ุงุณุช). ุงู ฺฉุฏ ูุดุงู ูโุฏูุฏ ฺฉู ุชููุง ูโุฎูุงูุฏ **InsufficientMemoryException** ุฑุง ุฏุฑ ุงู ูฺฉุงู ูุฏุฑุช ฺฉูุฏ ู ุจูู ุงุณุชุซูุงูุง ุจู ุณูุณููโูุฑุงุชุจ ุจุงูุงุชุฑ ููุชูู ูโุดููุฏ. ุจู ููู ุฏูู **if block** ููุฏุงุฑ **true** ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ:

```csharp
// Some code before
catch (AggregateException ae)
{
    //  Handling only InsufficientMemoryException, other
    // exceptions will be propagated up to the hierarchy
    ae.Handle(e =>
    {
        if (e is InsufficientMemoryException)
        {
            WriteLine($"Caught error inside InvokeTasks(): {e.Message}");
            return true;
        }
        else
        {
            return false;
        }
    });
}
```

---

### Demonstration 4 ๐ฅ๏ธ

ุฏุฑ ุงู ุจุฑูุงููุ **Main thread** ูุชุฏ **InvokeTasks** ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ ฺฉู ุจู ููุจู ุฎูุฏ ุณู Task ุงุฌุงุฏ ู ุงุฌุฑุง ูโฺฉูุฏ:

* **validateUserTask**
* **storeDataTask**
* **useDllTask** (ุจุฑุง ุจุญุซ ุงุถุงูู ุดุฏู ุงุณุช ุชุง ูุดุงู ุฏูุฏ ูุงุฒู ูุณุช ุชุนุฏุงุฏ ูุณุงู Task ุฏุฑ ูุฑ ูฺฉุงู ุฏุงุดุชู ุจุงุดู)

ุชูุงู ุงุณุชุซูุงูุง ููฺฉู ุฏุงุฎู **InvokeTasks** ฺฏุฑูุชู ูโุดููุฏุ ุงูุง ุชููุง **InsufficientMemoryException** ูุฏุฑุช ูโุดูุฏ. ุจูุงุจุฑุงู ุจูู ุงุณุชุซูุงูุง ุจู ุณุทุญ ุจุงูุงุชุฑ ููุชูู ูโุดููุฏ ู ุฏุฑ **Main thread** ูุฏุฑุช ูโุดููุฏ.

```csharp
using static System.Console;
WriteLine("Exception handling demo.");

try
{
    InvokeTasks();
}
catch (AggregateException ae)
{
    ae.Handle(e =>
    {
        WriteLine($"Caught error inside Main(): {e.Message}");
        return true;
    });
}

static void InvokeTasks()
{
    try
    {
        var validateUserTask = Task.Run(
            () =>
            {
                // Some other code, if any
                throw new UnauthorizedAccessException("Unauthorized user.");
            }
        );

        var storeDataTask = Task.Run(
            () =>
            {
                throw new InsufficientMemoryException("Insufficient memory.");
            }
        );

        var useDllTask = Task.Run(
            () =>
            {
                throw new DllNotFoundException("The required dll is missing!");
            }
        );

        Task.WaitAll(validateUserTask, storeDataTask, useDllTask);
    }
    // catch block ุฏุงุฎู InvokeTasks ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑ ููุงุด ุฏุงุฏู ูุดุฏู ุงุณุช
}
```

๐ก **ูฺฉุชู:** ุจุฑุง ุฏุฏู ฺฉุฏ ฺฉุงูู ูพุฑูฺู ูโุชูุงูุฏ ุงุฒ ูุจโุณุงุช **Apress** ูพุฑูฺู ุฑุง ุฏุงูููุฏ ฺฉูุฏ.

---

### ุฎุฑูุฌ ููููู ๐

```
Exception handling demo.
Caught error inside InvokeTasks(): Insufficient memory.
Caught error inside Main(): Unauthorized user.
Caught error inside Main(): The required dll is missing!
```

---

### ูพุฑุณุด ู ูพุงุณุฎ ๐

**Q4.4:** ูโุฏุงูู ฺฉู ูโุชูุงู ุงุณุชุซูุงูุง ุฑุง ุจู ุฑูุดโูุง ูุฎุชูู ูุฏุฑุช ฺฉุฑุฏุ ุงูุง ุขุง ุฏุณุชูุฑุงูุนูู ฺฉู ุจุฑุง ูุฏุฑุช ุงุณุชุซูุงูุง ุฏุฑ ูุญุทโูุง ููุฒูุงู ูุฌูุฏ ุฏุงุฑุฏุ

โ ูุนูููุงู ูุชุฎุตุตุงู ูพุดููุงุฏ ูโฺฉููุฏ ุงฺฏุฑ ุงุณุชุซูุงูุง ุฑุง ุฏุงุฎู Task ูุฏุฑุช ููโฺฉูุฏุ ุขูโูุง ุฑุง ุฏุฑ ูุฒุฏฺฉโุชุฑู ูฺฉุงู ุจู ุฌุง ฺฉู **ููุชุธุฑ ุชฺฉูู Task** ูุณุชุฏ ุง **ูุชุฌู Task** ุฑุง ุฏุฑุงูุช ูโฺฉูุฏุ ูุฏุฑุช ฺฉูุฏ. ุงู ุฑุงูููุง ุฑุง ูู ูู ุฑุนุงุช ูโฺฉูู.

---

### ุฎูุงุตู ูุตู ๐

ุงู ูุตู ุงุฏุงูู ุจุญุซ **Task Programming** ุจูุฏุ ุงูุง ุงู ุจุงุฑ ุชูุฑฺฉุฒ ุจุฑ **ูุฏุฑุช ุงุณุชุซูุงูุง** ุจุง ูุซุงูโูุง ู ูุทุงูุนูโูุง ููุฑุฏ ูุชูุงูุช ุจูุฏ. ุฏุฑ ุฎูุงุตูุ ูพุงุณุฎ ุงู ุณูุงูุงุช ุฏุงุฏู ุดุฏ:

* AggregateException ฺุณุช ู ฺุฑุง ุฏุฑ Task Programming ููู ุงุณุชุ
* ฺฺฏููู ูโุชูุงู ุงุณุชุซูุงูุง ูุฎุชูู Taskโูุง ุฑุง ููุงุด ุฏุงุฏุ
* ฺฺฏููู ูโุชูุงู InnerExceptions ุฑุง **Flatten** ฺฉุฑุฏุ
* ฺฺฏููู ูโุชูุงู ุชูุงู ุงุณุชุซูุงูุง ููฺฉู ุฑุง ุจุง ูู ูุฏุฑุช ฺฉุฑุฏุ
* ฺฺฏููู ูโุชูุงู ุงุณุชุซูุงูุง ููฺฉู ุฑุง ุฏุฑ ูฺฉุงูโูุง ุฌุฏุงฺฏุงูู ูุฏุฑุช ฺฉุฑุฏุ
ุชูุฑูโูุง ๐

ุจุฑุง ุณูุฌุด ุฏุฑฺฉ ุฎูุฏุ ุณุน ฺฉูุฏ ุชูุฑูโูุง ุฒุฑ ุฑุง ุงูุฌุงู ุฏูุฏ:
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/04/Table%204-4.jpeg)
</div>

ุงุฏุขูุฑ ๐
ููุงูโุทูุฑ ฺฉู ูพุดโุชุฑ ฺฏูุชู ุดุฏุ ูโุชูุงูุฏ ุจุง ุงุทููุงู ูุฑุถ ฺฉูุฏ ฺฉู ุชูุงู namespaceโูุง ููุฑุฏ ูุงุฒ ุจุฑุง ุงู ูุทุนุงุช ฺฉุฏ ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏ. ุงู ูฺฉุชู ุจุฑุง ููู ุชูุฑูโูุง ุงู ฺฉุชุงุจ ูุฒ ุตุฏู ูโฺฉูุฏ.

---

**ุชูุฑูโูุง ูุตู ด: ูุฏุฑุช ุงุณุชุซูุงูุง**

**E4.1**
ุงฺฏุฑ ฺฉุฏ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏุ ุขุง ูโุชูุงูุฏ ุฎุฑูุฌ ุขู ุฑุง ูพุดโุจู ฺฉูุฏุ

```csharp
using static System.Console;
WriteLine("Exercise 4.1");
try
{
    int b = 0;
    Task<int> value = Task.Run(() => 25 / b);
}
catch (Exception e)
{
    WriteLine($"Caught: {e.GetType()}, Message: {e.Message}");
}
WriteLine("End");
```

---

**E4.2**
ุงฺฏุฑ ฺฉุฏ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏุ ุขุง ูโุชูุงูุฏ ุฎุฑูุฌ ุขู ุฑุง ูพุดโุจู ฺฉูุฏุ

```csharp
using static System.Console;
WriteLine("Exercise 4.2 and Exercise 4.3");
try
{
    DoSomething();
}
catch (AggregateException ae)
{
    ae.Handle(
        e =>
        {
            WriteLine($"Caught inside main: {e.Message}");
            return true;
        }
    );
}

static void DoSomething()
{
    try
    {
        var task1 = Task.Run(() => throw new InvalidDataException("invalid data"));
        var task2 = Task.Run(() => throw new OutOfMemoryException("insufficient memory"));
        // For Exercise 4.2
        Task.WaitAll(task1, task2);
        // For Exercise 4.3
        // task1.Wait();
        // task2.Wait();
    }
    catch (AggregateException ae)
    {
        ae.Handle(
            e =>
            {
                if (e is InvalidDataException)
                {
                    WriteLine($"The DoSomething method encounters: {e.Message}");
                    return true;
                }
                else
                {
                    return false;
                }
            }
        );
    }
}
```

---

**E4.3**
ุฏุฑ ุจุฑูุงูู ูุจูุ ุฎุท ุฒุฑ:

```csharp
Task.WaitAll(task1, task2);
```

ุฑุง ุจุง ุฎุทูุท ุฒุฑ ุฌุงฺฏุฒู ฺฉูุฏ:

```csharp
task1.Wait();
task2.Wait();
```

ุขุง ูโุชูุงูุฏ ุฎุฑูุฌ ุขู ุฑุง ูพุดโุจู ฺฉูุฏุ

---

**E4.4**
ุงฺฏุฑ ฺฉุฏ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏุ ุขุง ูโุชูุงูุฏ ุฎุฑูุฌ ุขู ุฑุง ูพุดโุจู ฺฉูุฏุ

```csharp
using static System.Console;
WriteLine("Exercise 4.4");
try
{
    int b = 0;
    var task1 = Task.Run(() => throw new InvalidOperationException("invalid operation"));
    var task2 = Task.Run(() => 5/b);
    Task.WaitAny(task1, task2);
    WriteLine("End");
}
catch (AggregateException ae)
{
    ae.Handle(e =>
    {
        if (e is InvalidOperationException || e is DivideByZeroException)
        {
            WriteLine($"Caught error: {e.Message}");
            return true;
        }
        return false;
    });
}
```

---

**E4.5**
ุขุง ูโุชูุงูุฏ ุฎุฑูุฌ ุจุฑูุงูู ุฒุฑ ุฑุง ูพุดโุจู ฺฉูุฏุ

```csharp
using static System.Console;
WriteLine("Exercise 4.5");
var errorTask = Task.Run(() => throw new Exception("unwanted situation"));
var outerTask = Task.Factory.StartNew(() => errorTask);
while (!outerTask.IsCompleted) { Thread.Sleep(10); }
WriteLine($"The status of the outer task is: {outerTask.Status}");
while (!outerTask.Unwrap().IsCompleted) { Thread.Sleep(10); }
WriteLine($"The status of the inner task is: {outerTask.Unwrap().Status}");
```

ุฑุงูโุญู ุชูุฑูโูุง ๐
ุฏุฑ ุงุฏุงููุ ููููู ูพุงุณุฎ ุชูุฑูโูุง ูุตู ด ุขูุฑุฏู ุดุฏู ุงุณุช:

---

**E4.1**
ุงู ุจุฑูุงูู ุฎุฑูุฌ ุฒุฑ ุฑุง ุชููุฏ ูโฺฉูุฏ:

```
Exercise 4.1
End
```

๐ก **ุชูุถุญ ููุณูุฏู:** ุดูุง ุงุณุชุซูุง ุฑุง ูุดุงูุฏู ููโฺฉูุฏ ฺูู ูุฎ ุงุตู (main thread) ุจุง ุขู ููุงุฌู ูุดุฏูุ ุงุณุชุซูุง ุชูุณุท ุชุณฺฉ ฺฉู ุงู ูุฎ ุงุฌุงุฏ ฺฉุฑุฏู ุจูุฏ ุฑุฎ ุฏุงุฏู ุงุณุช.

ุจุฑุง ูุดุงูุฏู ุงุณุชุซูุงุ ูโุชูุงูุฏ ุจููฺฉ `try` ุฑุง ุจู ุดฺฉู ุฒุฑ ุชุบุฑ ุฏูุฏ (ุชุบุฑุงุช ุจุง **ูพุฑุฑูฺฏ** ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช):

```csharp
// There is no change in the previous code
try
{
}
int b = 0;
Task<int> value = Task.Run(() => 25 / b);
WriteLine(value.Result);  // ุชุบุฑ ูพุฑุฑูฺฏ
// There is no change in the remaining code as well
```

ุฎุฑูุฌ ุจุฑูุงูู ูพุณ ุงุฒ ุชุบุฑ:

```
Exercise 4.1
Caught: System.AggregateException, Message: One or more errors occurred. (Attempted to divide by zero.)
End
```

โ๏ธ ุชูุฌู ฺฉูุฏ ฺฉู ุจู ุฌุง ูุดุงูุฏู `System.DivideByZeroException`ุ `System.AggregateException` ุฏุฏู ูโุดูุฏ. ุงู ูุชุฌูโ ููุฑุฏ ุงูุชุธุงุฑ ุงู ุจุฑูุงูู ุงุณุช.

---

**E4.2**
ุฎุฑูุฌ ุจุฑูุงูู ุจู ุดฺฉู ุฒุฑ ุงุณุช:

```
Exercise 4.2 and Exercise 4.3
The DoSomething method encounters: invalid data
Caught inside main: insufficient memory
```

---

**E4.3**
ููุช ุงุฒ `task1.Wait();` ุงุณุชูุงุฏู ูโฺฉูุฏุ `InvalidDataException` ุฑุฎ ูโุฏูุฏ ู ฺฉูุชุฑู ุงุฒ ุจููฺฉ `try` ุฎุงุฑุฌ ูโุดูุฏ. ุฎุฑูุฌ ุจู ุดฺฉู ุฒุฑ ุฎูุงูุฏ ุจูุฏ:

```
Exercise 4.2 and Exercise 4.3
The DoSomething method encounters: invalid data
```

---

**E4.4**
ุงู ุจุฑูุงูู ุฎุฑูุฌ ุฒุฑ ุฑุง ุชููุฏ ูโฺฉูุฏ:

```
Exercise 4.4
End
```

๐ก ุฏูู ุนุฏู ูุดุงูุฏู ุงุณุชุซูุงูุง ุฏุฑ ุฎุฑูุฌ: ููุช ุงุฒ `WaitAny` ุงุณุชูุงุฏู ูโฺฉูุฏุ ุงุณุชุซูุง ุชุณฺฉโูุง ุจู `AggregateException` ููุชูู ููโุดูุฏ.

๐ ูพุดููุงุฏ ูุทุงูุนู: ุจูุงฺฏ ุงุณุชูู ฺฉูุฑ ุฏุฑ ููุฑุฏ ุชูุงูุช `WaitAny` ู `WaitAll`
[https://blog.stephencleary.com/2014/10/a-tour-of-task-part-5-wait.html](https://blog.stephencleary.com/2014/10/a-tour-of-task-part-5-wait.html)

ุฎูุงุตู ุชูุงูุช:

* `WaitAny` ููุท ููุชุธุฑ ุงููู ุชุณฺฉ ุชฺฉูู ูโูุงูุฏ ู ุงุณุชุซูุง ุฑุง ุจู `AggregateException` ููุชูู ููโฺฉูุฏ.
* ุจุงุฏ ุฎุทุงูุง ูุฑ ุชุณฺฉ ุฑุง ุจุนุฏ ุงุฒ ุจุงุฒฺฏุดุช `WaitAny` ุจุฑุฑุณ ฺฉูุฏ.

ุจุฑุง ูุดุงูุฏู ุฌุฒุฆุงุช ุงุณุชุซูุง ุฏุฑ ุฎุฑูุฌุ ุจููฺฉ `try` ุฑุง ุจู ุดฺฉู ุฒุฑ ุชุบุฑ ุฏูุฏ:

```csharp
int b = 0;
var task1 = Task.Run(() => throw new InvalidOperationException("invalid operation"));
var task2 = Task.Run(() => 5 / b);
// Task.WaitAny(task1, task2);
var tasks = new[]{ task1, task2 };
int taskIndex = Task.WaitAny(tasks);
tasks[taskIndex].Wait();
WriteLine("End");
```

ุฎุฑูุฌ ููููู ูพุณ ุงุฒ ุชุบุฑ:

```
Exercise 4.4
Caught error: invalid operation
```

---

**E4.5**
ุฎุฑูุฌ ุจุฑูุงูู ุจู ุดฺฉู ุฒุฑ ุงุณุช:

```
Exercise 4.5
The status of the outer task is: RanToCompletion
The status of the inner task is: Faulted
```
