---
layout: layout.njk
title: ููุงุฑุฏ ุงุถุงู
---
# ูุตู ุดุดู: ููุงุฑุฏ ุงุถุงู ๐

ุฏุฑ ุงู ูุตูุ ฺูุฏ ููุถูุน ุชฺฉูู ุฏุฑุจุงุฑู **ุจุฑูุงููโููุณ Task** ุจุฑุฑุณ ูโุดูุฏ.

---

### ฺฏุฒุงุฑุด ูพุดุฑูุช (Progress Reporting) ๐

ุญุชูุงู ุฏุฏูโุงุฏ ููฺฏุงู **ุจูโุฑูุฒุฑุณุงู ุณุณุชูโุนุงูู** ุง **ูุตุจ ูุณุฎู ุฌุฏุฏ Visual Studio** ุฑู ฺฉ ฺฉุงููพูุชุฑุ ูุถุนุช ูพุดุฑูุช ฺฉุงุฑ ููุงุด ุฏุงุฏู ูโุดูุฏ. ุญุงูุง ุจุงุฏ ุจุจูู ุขุง ูโุชูุงูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ **ุจุฑูุงููโููุณ Task** ฺฉ ุจุฑูุงูู ุจุง ูฺฺฏ ูุดุงุจู ุจุณุงุฒุฏุ

---

### ุฏุฑฺฉ ูุงุฒ (Understanding the Need) ๐ค

ูุฑุถ ฺฉูุฏ ุฏุฑ ุญุงู ูพุฑุฏุงุฒุด ุชุนุฏุงุฏ ุฒุงุฏ **ุฑฺฉูุฑุฏ (Record)** ูุฎุชูู ูุณุชุฏ. ุจุฑุง ุดุจูโุณุงุฒ ุดุฑุงุท ูุงูุนุ ุชุตูุฑ ฺฉูุฏ ฺฉู **ุฒูุงู ูพุฑุฏุงุฒุด ูุฑ ุฑฺฉูุฑุฏ ูุชูุงูุช ุงุณุช**. ุงุฒ ุขูโุฌุง ฺฉู ุงู ุนููุงุช ููฺฉู ุงุณุช **ุฒูุงูโุจุฑ** ุจุงุดุฏุ ููโุฎูุงูุฏ **ุฑุดุชู ุงุตู (Main Thread)** ูุณุฏูุฏ ุดูุฏ. ุฏุฑ ุนูุถ ุชุตูู ูโฺฏุฑุฏ ุงู ฺฉุงุฑ ุฑุง ุงุฒ ุทุฑู ฺฉ **Task ูพุณโุฒููู** ุงูุฌุงู ุฏูุฏ.

---

### ููุงุด ุงููู (Demonstration 1) ๐ฅ๏ธ

ุจุง ุงู ุญุงูุ ุงฺฏุฑ ููฺฏุงู ูพุฑุฏุงุฒุด ุงู ุฑฺฉูุฑุฏูุง **ูุถุนุช ูพุดุฑูุช ุฑุง ููุงุด ูุฏูุฏ**ุ ฺฉุงุฑุจุฑ ููฺฉู ุงุณุช **ุณุฑุฏุฑฺฏู ุดูุฏ**. ุจุฑุง ุณุงุฏูโุชุฑ ฺฉุฑุฏู ููุถูุนุ ุจุงุฏ ฺฉ ููููู ุขุฒูุงุด ุจุจูู ฺฉู ููุท ุจุง **ต ุฑฺฉูุฑุฏ** ฺฉุงุฑ ูโฺฉูุฏ:

```csharp
using static System.Console;

WriteLine("The main thread is initiating a task to process some records.");
var recordProcessingTask = Task.Run(ProcessRecords);

WriteLine("The main thread is doing other work now.");
recordProcessingTask.Wait();

static void ProcessRecords()
{
    WriteLine($"Starts processing the records...");
    for (int i = 1; i <= 5; i++)
    {
        // Varying the delay
        Thread.Sleep(i * 500);
    }
    WriteLine("All the records are processed.");
}
```

---

### ุฎุฑูุฌ (Output) ๐จ๏ธ

ูููููโุง ุงุฒ ุฎุฑูุฌ ฺฉู ุฌุง ุชุนุฌุจ ูุฏุงุฑุฏ ุจู ุงู ุตูุฑุช ุงุณุช:

```
The main thread is initiating a task to process some records.
The main thread is doing other work now.
Starts processing the records...
All the records are processed.
```

---

### ุชุญูู (Analysis) ๐

ููุงูโุทูุฑ ฺฉู ูุดุงูุฏู ูโฺฉูุฏุ ุฎุท **"All the records are processed."** ุจุนุฏ ุงุฒ **ูุฏุช ูุงุจู ุชูุฌู** ููุงุด ุฏุงุฏู ูโุดูุฏ. ุงุฒ ุฏุฏ ฺฉุงุฑุจุฑ ุงู ุฑูุชุงุฑ **ฺฏุฌโฺฉููุฏู** ุงุณุชุ ฺูู ุจุนุฏ ุงุฒ ุฏุฏู ุฌููู **"Starts processing the records..."** ููโุฏุงูุฏ ุฏุฑ ูพุณโุฒููู ฺู ุงุชูุงู ุฏุฑ ุญุงู ุฑุฎ ุฏุงุฏู ุงุณุช.

ุงูุฌุงุณุช ฺฉู ูุชูุฌู ูโุดูุฏ **ฺฏุฒุงุฑุด ูพุดุฑูุช (Progress Reporting)** ูโุชูุงูุฏ ุฏุฑ ฺูู ุดุฑุงุท ุจุณุงุฑ ููุฏ ุจุงุดุฏุ ุจูโูฺู ููฺฏุงู ุงุฌุฑุง **ฺฉ Task ุทููุงูโูุฏุช**.

---

### ฺฺฏููู ูพุดุฑูุช ุฑุง ฺฏุฒุงุฑุด ฺฉููุ

ุงู ููุถูุน ฺฉุงููุงู ุจู ุดูุง ุจุณุชฺฏ ุฏุงุฑุฏ. ุจูโุนููุงู ูุซุงู:

* ูโุชูุงูุฏ ุจูโุณุงุฏฺฏ ฺุงูพ ฺฉูุฏ ฺฉู **ฺฉุฏุงู ุฑฺฉูุฑุฏ ุฏุฑ ุญุงู ูพุฑุฏุงุฒุด ุงุณุช**.
* ุง ูโุชูุงูุฏ ูพุดุฑูุช ุฑุง ุจูโุตูุฑุช **ุฏุฑุตุฏ** ููุงุด ุฏูุฏุ ูุซู:

```
completed processing: 60%
```

ุฏุฑ ูุซุงู ุจุนุฏุ ูโุฎูุงูู ฺฉ **ููููู ุนูู** ุจุง ุงุณุชูุงุฏู ุงุฒ **ุณุงุฎุชุงุฑูุง ุฏุงุฎู ุจุฑุง ฺฏุฒุงุฑุด ูพุดุฑูุช** ุจู ุดูุง ูุดุงู ุฏูู. ุจุงุฏ ุจุญุซ ุฑุง ุดุฑูุน ฺฉูู.

---

### ุฑุงุจุท IProgress ู ฺฉูุงุณ Progress<T> ๐๏ธ

ฺฉ ุฑุงุจุท (**Interface**) ุจู ูุงู **IProgress** ุฏุฑ ูุถุง ูุงู **System** ูุฌูุฏ ุฏุงุฑุฏ. ุงู ุฑุงุจุท ฺฉ ูุชุฏ ุจู ูุงู **Report** ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ุจู ุดูุง ฺฉูฺฉ ฺฉูุฏ ูพุดุฑูุช ุฑุง ููุงุด ุฏูุฏ. ููุง ุงู ุฑุงุจุท ุฏุฑ Visual Studio ุจู ุดฺฉู ุฒุฑ ุงุณุช:

```csharp
public interface IProgress<in T>
{
    //
    // Summary:
    //     Reports a progress update.
    //
    // Parameters:
    //   value:
    //     The value of the updated progress.
    void Report(T value);
}
```

ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ุฑุงุจุทุ ูโุชูุงูุฏ ฺฉ **ูพุงุฏูโุณุงุฒ ุณูุงุฑุด** ุจุฑุง ฺฏุฒุงุฑุด ูพุดุฑูุช ุงุฌุงุฏ ฺฉูุฏ.

ููฺูู ฺฉ ฺฉูุงุณ ุฏุงุฎู ุจู ูุงู **Progress<T>** ูุฌูุฏ ุฏุงุฑุฏ ฺฉู **ุฑุงุจุท IProgress** ุฑุง ุงุฒ ูุจู ูพุงุฏูโุณุงุฒ ฺฉุฑุฏู ุงุณุช. ุจูุงุจุฑุงู ูโุชูุงูุฏ ุงุฒ ุงู ฺฉูุงุณ ุจุฑุง ุฑุณุฏู ุจู ูุฏู ุฎูุฏ ุงุณุชูุงุฏู ฺฉูุฏ.

ุงู ฺฉูุงุณ ฺฉ **ุฑูุฏุงุฏ (Event)** ุจู ูุงู **ProgressChanged** ุงุฑุงุฆู ูโุฏูุฏ ฺฉู ูโุชูุงูุฏ ุจุง ูุฑ ุจูโุฑูุฒุฑุณุงู ูพุดุฑูุช ุงุฒ ฺฉุฏ ูุงููุฒูุงู **ูุนุงู ุดูุฏ**.

---

### ุงุณุชูุงุฏู ุงุฒ Delegate ุฏุฑ Progress

ฺฉ ูฺฉุชู ุฌุงูุจ ุฏฺฏุฑ ุงู ุงุณุช ฺฉู ุงู ฺฉูุงุณ **Progress** ุฏุงุฑุง ุฏู **ุณุงุฒูุฏู (Constructor)** ุงุณุช ฺฉู ฺฉ ุงุฒ ุขูโูุง ุจู ุดฺฉู ุฒุฑ ุงุณุช:

```csharp
public Progress(Action<T> handler);
```

ุงู ูฺฉุชู ุจู ุดูุง ุณุฑูุฎ ูโุฏูุฏ ฺฉู ูโุชูุงูุฏ ฺฉ **Delegate** ุฑุง ุจู ุนููุงู **ูพุงุฑุงูุชุฑ ุณุงุฒูุฏู** ฺฉูุงุณ Progress ุงุฑุณุงู ฺฉูุฏ. ุงู Delegate ุนููุงู ููุด ฺฉ **Event Handler** ุฑุง ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ุงุฒ ุขู ุจุฑุง **ฺฏุฒุงุฑุด ูพุดุฑูุช** ุงุณุชูุงุฏู ฺฉูุฏ.

ุจุงุฏ **ฺฉุฏ ูุจู ุฑุง ุจูโุฑูุฒุฑุณุงู ฺฉูู** ุชุง ุจุจูู ุงู ฺฉุงุฑ ฺฺฏููู ุงูุฌุงู ูโุดูุฏ.

ุงุจุชุฏุง ุชุงุจุน **ProcessRecords** ุฑุง ุชุบุฑ ุฏุงุฏู ุชุง ุจุชูุงูุฏ **IProgress<int>** ุฑุง ุจู ุนููุงู ฺฉ **ูพุงุฑุงูุชุฑ** ุฏุฑุงูุช ฺฉูุฏ. ุจุงุฏ ูุณุฎู ุงุตูุงุญโุดุฏู ุงู ุชุงุจุน ุฑุง ุจุจูู ฺฉู ุชุบุฑุงุช ฺฉูุฏ ุขู **ูพุฑุฑูฺฏ** ุดุฏู ุงุณุช.

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/06/Table%206-1.jpeg)
</div>

### ูฺฉุงุช ููู (POINTS TO NOTE) ๐

ุจู ูฺฉุงุช ุฒุฑ ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ:

* ุจุฑุง ุณุงุฏูโุณุงุฒุ ูู ุงุฒ **ูพุงุฑุงูุชุฑ int** ุงุณุชูุงุฏู ฺฉุฑุฏูโุงู.
  ุจุง ุงู ุญุงูุ ุดูุง ูโุชูุงูุฏ ุงููุงุน ุฏุงุฏูโูุง ุฏฺฏุฑ ุฑุง ูุฒ ุงูุชุฎุงุจ ฺฉูุฏ.
* ุงุฒ ุขูโุฌุง ฺฉู **ต ุฑฺฉูุฑุฏ** ูุฌูุฏ ุฏุงุฑุฏุ ุจุนุฏ ุงุฒ ูพุฑุฏุงุฒุด ูุฑ ุฑฺฉูุฑุฏุ **ุฏุฑุตุฏ ูพุดุฑูุช ุฑุง ฒฐูช ุงูุฒุงุด ูโุฏูู**.

ููููู ฺฉุฏ:

```csharp
static void ProcessRecords(IProgress<int> progress)
{
    WriteLine($"Starts processing the records...");
    int progressPercentage = 0;
    for (int i = 1; i <= 5; i++)
    {
        // Varying the delay
        Thread.Sleep(i * 500);
        progressPercentage += 20;
        progress.Report(progressPercentage);
    }
    WriteLine("All the records are processed.");
}
```

---

### ุจูโุฑูุฒุฑุณุงู ฺฉุฏ ูุฑุงุฎูุงู (Calling Code) ๐

ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุงู ุชุงุจุน ุงุตูุงุญโุดุฏูุ ูุงุฒ ุฏุงุดุชู **ฺฉุฏ ูุฑุงุฎูุงูโฺฉููุฏู** ุฑุง ูู ุจูโุฑูุฒุฑุณุงู ฺฉูู. ุจูุงุจุฑุงู ุฎุท ุฒุฑ:

```csharp
var recordProcessingTask = Task.Run(ProcessRecords);
```

ุฑุง ุจุง ุฎุทูุท ุฒุฑ ุฌุงฺฏุฒู ฺฉุฑุฏู:

```csharp
IProgress<int> reportProgress = new Progress<int>(
    i => WriteLine($"Completed: {i}%")
);

var recordProcessingTask = Task.Run(() => ProcessRecords(reportProgress));
```

ูโุจูุฏ ฺฉู **ุณุงุฒูุฏู Progress<int>** ุญุงูุง ฺฉ **Delegate** ูโูพุฐุฑุฏ ฺฉู ุฏุงุฏูโูุง ูพุดุฑูุช ุฑุง ุจู ุนููุงู **ูพุงุฑุงูุชุฑ** ุฏุฑุงูุช ูโฺฉูุฏ. ุงู Delegate ูุฑ ุจุงุฑ ฺฉู ฺฏุฒุงุฑุด ูพุดุฑูุช ุงุฑุณุงู ูโุดูุฏุ **ุงุฌุฑุง ุฎูุงูุฏ ุดุฏ**.

---

### ููุงุด ุฏูู (Demonstration 2) ๐ฅ๏ธ

ุจุงุฏ ุงุฌุฑุง ุงุตูุงุญโุดุฏู ุฑุง ุจุจูู:

```csharp
using static System.Console;

WriteLine("The main thread is initiating a task to process some records.");
IProgress<int> reportProgress = new Progress<int>(
    i => WriteLine($"Completed: {i}%")
);

var recordProcessingTask = Task.Run(() => ProcessRecords(reportProgress));
WriteLine("The main thread is doing other work now.");
recordProcessingTask.Wait();

// The ProcessRecords function is placed here. It is not shown again to avoid repetition.
```

**ุชูุฌู:** ุจุฑุง ูุดุงูุฏู ููููู ฺฉุงููุ ูพุฑูฺู **Chapter6\_Demo2** ุฑุง ุฏุงูููุฏ ฺฉูุฏ.

---

### ุฎุฑูุฌ (Output) ๐จ๏ธ

ููููู ุฎุฑูุฌ:

```
The main thread is initiating a task to process some records.
The main thread is doing other work now.
Starts processing the records...
Completed: 20%
Completed: 40%
Completed: 60%
Completed: 80%
All the records are processed.
Completed: 100%
```

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ุจุฑูุงูู ุจูโุฎูุจ **ูุถุนุช ุจูโุฑูุฒุฑุณุงู ูพุดุฑูุช** ุฑุง ฺุงูพ ูโฺฉูุฏ.

---

### ุงุฌุงุฏ ู ุงุฌุฑุง Taskูุง ุจูโุตูุฑุช ุถูู (Creating and Running Tasks Implicitly) โ๏ธ

ุฏุฑ ุณุทุญ ุจุงูุงุ **TPL** (Task Parallel Library) ุดุงูู ุจุฎุดโูุง ุฒุฑ ุงุณุช:

* **ุณุงุฎุชุงุฑูุง ููุงุฒโุณุงุฒ Taskูุง (Task parallelism constructs)**
* **ฺฉูุงุณ Parallel**

**TPL** ุงุฒ **ููุงุฒโุณุงุฒ ุฏุงุฏูโูุง** ุงุฒ ุทุฑู ฺฉูุงุณ **Parallel** ูพุดุชุจุงู ูโฺฉูุฏ. ูโุชูุงูุฏ **ูุณุฎู ููุงุฒ ุญููู for** (ุจุง ุงุณุชูุงุฏู ุงุฒ **Parallel.For**) ู **ุญููู foreach** (ุจุง ุงุณุชูุงุฏู ุงุฒ **Parallel.ForEach**) ุฑุง ุฏุฑ ุงู ฺฉูุงุณ ุงุณุชูุงุฏู ฺฉูุฏ.

ุฌุฒุฆุงุช ฺฉุงูู ฺฉูุงุณ **Parallel** ุฎุงุฑุฌ ุงุฒ ูุญุฏูุฏู ุงู ฺฉุชุงุจ ุงุณุช. ุจุง ุงู ุญุงูุ ุจุฏ ูุณุช ุจุฏุงูุฏ ฺฉู ุงู ฺฉูุงุณ ฺฉ ูุชุฏ ููุฏ ุจู ูุงู **Invoke** ุฏุงุฑุฏ ฺฉู ุจู ุดูุง ฺฉูฺฉ ูโฺฉูุฏ **ฺูุฏู Task ุฑุง ุจูโุตูุฑุช ููโุฒูุงู ุงุฌุฑุง ฺฉูุฏ**.

**ุงุฏุฏุงุดุช ููุณูุฏู:** ุงุฒ ุขูโุฌุง ฺฉู ุจุฎุด ุงูู (**ุณุงุฎุชุงุฑูุง ููุงุฒโุณุงุฒ Taskูุง**) ูุจูุงู ุฏุฑ ุงู ฺฉุชุงุจ ูพูุดุด ุฏุงุฏู ุดุฏู ุงุณุชุ ุฏุฑ ุงู ุจุฎุด ุจู ุขู ููโูพุฑุฏุงุฒู.

---

### ุงุณุชูุงุฏู ุงุฒ Parallel.Invoke ๐งฉ

ููฺฉ ุขููุงู ุฒุฑ ุจุงู ูโฺฉูุฏ:
[https://learn.microsoft.com/en-us/previousversions/msp-n-p/ff963549(v=pandp.10)?redirectedfrom=MSDN](https://learn.microsoft.com/en-us/previousversions/msp-n-p/ff963549%28v=pandp.10%29?redirectedfrom=MSDN)

> **Parallel.Invoke** ุณุงุฏูโุชุฑู ุจุงู ุงูฺฏู Task ููุงุฒ ุงุณุช. ุงู ูุชุฏ ุจุฑุง ูุฑ **Delegate Method** ฺฉู ุฏุฑ ุขุฑุงู **params** ุขู ูุฑุงุฑ ุฏุงุฑุฏุ **Taskูุง ููุงุฒ ุฌุฏุฏ** ุงุฌุงุฏ ูโฺฉูุฏ. ูุชุฏ **Invoke** ุฒูุงู ุจุฑูโฺฏุฑุฏุฏ ฺฉู **ููู Taskูุง ุชูุงู ุดุฏู ุจุงุดูุฏ**.

ุฏุฑ ุฒูุงู ูฺฏุงุฑุด ุงู ฺฉุชุงุจุ ุฏู **ุจุงุฑฺฏุฐุงุฑ (Overload)** ุจุฑุง ูุชุฏ ููุงุฒ **Invoke** ูุฌูุฏ ุฏุงุฑุฏ. ุฏุฑ ุงูุฌุง ุณุงุฏูโุชุฑู ุขูโูุง ุฑุง ุฏุฑ ูุธุฑ ูโฺฏุฑู ฺฉู ุจู ุงู ุตูุฑุช ุงุณุช:

```csharp
public static void Invoke(params Action[] actions);
```

ูโุฏุงูุฏ ฺฉู ููฺฏุงู ุงุณุชูุงุฏู ุงุฒ ุงู ูุชุฏุ ูโุชูุงูุฏ ุชุนุฏุงุฏ ูุชุบุฑ ุงุฒ **Action Instance**ูุง ุฑุง ุจู ูุชุฏ **Invoke** ุงุฑุณุงู ฺฉูุฏ. ุจุงุฏ **ุณู ููููู Action** ุจุณุงุฒู ู ุขูโูุง ุฑุง ุฏุฑ ุจุฑูุงูู ุฒุฑ ุงุฑุณุงู ฺฉูู.

---

### ููุงุด ุณูู (Demonstration 3) ๐ฅ๏ธ

ููููู ฺฉุงูู ุจุฑูุงูู:

```csharp
using static System.Console;

#region Parallel.Invoke
WriteLine("Using Parallel.Invoke method.");

Action greet = new(() => WriteLine($"Task {Task.CurrentId} says: Hello reader!"));
Action printMsg = new(() => WriteLine($"Task {Task.CurrentId} says: This is a beautiful day."));
Action ask = new(() => WriteLine($"Task {Task.CurrentId} says: How are you?"));

Parallel.Invoke(greet, printMsg, ask);
WriteLine("End Parallel.Invoke");
#endregion
```

### ุฎุฑูุฌ (Output) ๐จ๏ธ

ููููู ุฎุฑูุฌ ุงุฌุฑุง **Parallel.Invoke**:

```
Using Parallel.Invoke method.
Task 3 says: Hello reader!
Task 1 says: This is a beautiful day.
Task 2 says: How are you?
End Parallel.Invoke
```

---

### ูพุดููุงุฏุงุช ุชฺฉูู (Additional Suggestions) ๐ก

ูุจู ุงุฒ ูพุงุงู ุงู ุจุฎุดุ ฺูุฏ ูพุดููุงุฏ ุจุฑุง ุดูุง ุฏุงุฑู:

* ุจุฑุง ฺฉูุชุฑู ุจุดุชุฑ ุจุฑ **ุงุฌุฑุง Taskูุง**ุ ุจูุชุฑ ุงุณุช ุขูโูุง ุฑุง ุจูโุตูุฑุช **ุตุฑุญ ุงุฌุงุฏ ู ุงุฌุฑุง ฺฉูุฏ**.
* ุฒูุงู ฺฉู ุงู ฺฉุชุงุจ ุฑุง ุจู ูพุงุงู ุฑุณุงูุฏุฏ ู ุฏุงูุด ุจุดุชุฑ ุฏุฑ ููุฑุฏ **ุจุฑูุงููโููุณ ูุงููุฒูุงู** ฺฉุณุจ ฺฉุฑุฏุฏุ ูโุชูุงูุฏ ูพุณุช ุขููุงู ุฒุฑ ุฑุง ูุทุงูุนู ฺฉูุฏ ฺฉู ุงู ุฑูฺฉุฑุฏูุง ุฑุง ููุงุณู ฺฉุฑุฏู ุงุณุช:
  [https://devblogs.microsoft.com/pfxteam/task-run-vs-task-factory-startnew/](https://devblogs.microsoft.com/pfxteam/task-run-vs-task-factory-startnew/)

ูุฑฺูุฏ ุงู ููุงูู ูุฏุชโูุง ูพุด ููุดุชู ุดุฏูุ ููฺูุงู ููุฏ ุงุณุช. ุงูุจุชู ุจุฑุง ุฏุฑฺฉ ุขู ุจุงุฏ ุจุง **ฺฉูุฏูุงฺูโูุง async ู await** ุขุดูุง ุจุงุดุฏ.

---

### ูพุฑุณุด ู ูพุงุณุฎ (Q\&A Session) โ๐ฌ

**ุณูุงู ถ.ฑ:**
ูโุจูู ฺฉู **Task ฒ** ุจุนุฏ ุงุฒ **Task ณ** ุฏุฑ ุฎุฑูุฌ ูุจู ุชูุงู ุดุฏู ุงุณุช. ุขุง ุงู ุฑูุชุงุฑ ุทุจุน ุงุณุชุ ููฺูู ูโุจูู ฺฉู ุดูุง ููุชุธุฑ ุงุชูุงู Taskูุง ูุดุฏุฏ. ุขุง ุงู ุฏุฑุณุช ุงุณุชุ

**ูพุงุณุฎ:**
ุจูู. ููฺฉ ุขููุงู ุฒุฑ ุจุงู ูโฺฉูุฏ:
[https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.parallel.invoke?view=net-9.0](https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.parallel.invoke?view=net-9.0)

> ุงู ูุชุฏ ุจุฑุง ุงุฌุฑุง ูุฌููุนูโุง ุงุฒ ุนููุงุช ุงุณุชูุงุฏู ูโุดูุฏุ ฺฉู ููฺฉู ุงุณุช ุจูโุตูุฑุช ููุงุฒ ุงุฌุฑุง ุดููุฏ. **ูฺ ุชุถูู ุฏุฑ ููุฑุฏ ุชุฑุชุจ ุงุฌุฑุง ุนููุงุช ุง ููุงุฒ ุจูุฏู ุขูโูุง ูุฌูุฏ ูุฏุงุฑุฏ**. ุงู ูุชุฏ ูุจู ุงุฒ ุงู ฺฉู ุชูุงู ุนููุงุช ุงุฑุงุฆูโุดุฏู ุชูุงู ุดููุฏ (ฺู ุจูโุทูุฑ ุนุงุฏ ู ฺู ุจุง ุฎุทุง)ุ **ุจุฑููโฺฏุฑุฏุฏ**.

---

**ุณูุงู ถ.ฒ:**
ุจู ูุธุฑ ูโุฑุณุฏ ฺฉู ูู ูโุชูุงูู **Taskูุง ุฌุฏุงฺฏุงูู ุจุณุงุฒู** ู ููุชุธุฑ ุจูุงูู ุชุง ุงุฌุฑุง ุขูโูุง ุชูุงู ุดูุฏุ ุจูโุฌุง ุงุณุชูุงุฏู ุงุฒ **Parallel.Invoke**. ุขุง ุฏุฑุณุช ุงุณุชุ

**ูพุงุณุฎ:**
ูุดุงูุฏู ุฎูุจ ุงุณุช. ููฺฉ ุขููุงู ุฒุฑ ูุฒ ุงู ููุถูุน ุฑุง ุชุฃุฏ ูโฺฉูุฏ:
[https://learn.microsoft.com/en-us/previous-versions/msp-n-p/ff963549(v=pandp.10)?redirectedfrom=MSDN](https://learn.microsoft.com/en-us/previous-versions/msp-n-p/ff963549%28v=pandp.10%29?redirectedfrom=MSDN)

> ุฏุฑููุ **Parallel.Invoke** Taskูุง ุฌุฏุฏ ุงุฌุงุฏ ฺฉุฑุฏู ู ููุชุธุฑ ุขูโูุง ูโูุงูุฏ. ุงู ฺฉุงุฑ ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ูุชุฏูุง ฺฉูุงุณ **Task** ุงูุฌุงู ูโุฏูุฏ.

ุงฺฏุฑ ุจู ููฺฉ ุจุงูุง ูุฑุงุฌุนู ฺฉูุฏุ ูุชูุฌู ูโุดูุฏ ฺฉู ูโุชูุงูู ุจุฑูุงูู ูุนุงุฏู ุฒุฑ ุฑุง ุจููุณู:

```csharp
using static System.Console;

Task greet2 = Task.Factory.StartNew(
    () => WriteLine($"Task {Task.CurrentId} says: Hello reader!")
);

Task printMsg2 = Task.Factory.StartNew(
    () => WriteLine($"Task {Task.CurrentId} says: This is a beautiful day.")
);

Task ask2 = Task.Factory.StartNew(
    () => WriteLine($"Task {Task.CurrentId} says: How are you?")
);

Task.WaitAll(greet2, printMsg2, ask2);
```

**ูฺฉุชู:** ุฒูุงู ฺฉู ุจุง ุชุนุฏุงุฏ ุฒุงุฏ **Delegate** ฺฉุงุฑ ูโฺฉูุฏุ ุงุฌุงุฏ Taskูุง ุฌุฏุงฺฏุงูู ุจุฑุง ูุฑฺฉุฏุงู ู ูุฏุฑุช ุขูโูุง **ุฑุงูโุญู ููุงุณุจ ูุณุช**. ุงุณุชูุงุฏู ุงุฒ **Parallel.Invoke** ุจุงุนุซ ุฑุงุญุช ู **ฺฉุงุฑุง ุจุดุชุฑ** ุฏุฑ ฺูู ููุงุฑุฏ ูโุดูุฏ.

---

**ุณูุงู ถ.ณ:**
ุชูุงูุช **ููุงุฒโุณุงุฒ ุฏุงุฏูโูุง (Data Parallelism)** ู **ููุงุฒโุณุงุฒ Taskูุง (Task Parallelism)** ฺุณุชุ

**ูพุงุณุฎ:**
ูุงฺฉุฑูุณุงูุช ุงู ุชูุงูุช ุฑุง ุจูโุฎูุจ ุงูโฺฏููู ุจุงู ูโฺฉูุฏ:

> **ููุงุฒโุณุงุฒ ุฏุงุฏูโูุง** ู **ููุงุฒโุณุงุฒ Taskูุง** ุฏู ุงูุชูุง ฺฉ ุทู ูุณุชูุฏ.
> ุฏุฑ ููุงุฒโุณุงุฒ ุฏุงุฏูโูุงุ ฺฉ ุนููุงุช ูุงุญุฏ ุฑู **ูุฑูุฏโูุง ูุชุนุฏุฏ** ุงุนูุงู ูโุดูุฏ.
> ุฏุฑ ููุงุฒโุณุงุฒ Taskูุงุ ุงุฒ **ุนููุงุช ูุฎุชูู** ุงุณุชูุงุฏู ูโุดูุฏ ฺฉู ูุฑฺฉุฏุงู **ูุฑูุฏ ุฎุงุต ุฎูุฏ ุฑุง ุฏุงุฑูุฏ**.

---

### Taskูุง ูพุดโูุญุงุณุจูโุดุฏู (Precomputed Tasks) โก

ฺฉ ุงุฒ ูุฒุงุง ุงุตู ุงูุฌุงู ุนููุงุช **ูุงููุฒูุงู (Asynchronous)**ุ **ุงุฌุฑุง ุณุฑุนโุชุฑ** ุงุณุช. ุจุง ุงู ุญุงูุ ุจุฑุฎ ุงุฒ ุนููุงุชโูุง ุญุช ุจุง ุชูุงุด ุฒุงุฏ ุดูุง ููฺูุงู **ุฒูุงูโุจุฑ** ูุณุชูุฏ. ุจุฑุง ููุงุจูู ุจุง ุงู ูุดฺฉู ูโุชูุงูุฏ ุงุฒ **ูฺฉุงูุณู ฺฉุด (Caching)** ุงุณุชูุงุฏู ฺฉูุฏ. ุจุงุฏ ุงู ููุถูุน ุฑุง ุฏููโุชุฑ ุจุฑุฑุณ ฺฉูู.

---

### ุจุฏูู ฺฉุด (Without Caching) ๐ซ

ุจุฑูุงูู ุฒุฑ ูุชุฏ **ุฒูุงูโุจุฑ** ุจู ูุงู **TimeConsumingMethod** ุฑุง ุงุฌุฑุง ูโฺฉูุฏ. ูุฑ ุจุงุฑ ฺฉู ุงู ูุชุฏ ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏุ ุจุงุฏ **ุจุด ุงุฒ ณ ุซุงูู ููุชุธุฑ ุจูุงูุฏ** ุชุง ฺฉ ุนุฏุฏ ุชุตุงุฏู ุชููุฏ ุดูุฏ. ุญุงูุง ุจุฑูุงููโุง ุจููุณู ฺฉู ุงู ูุชุฏ ุฑุง ฺูุฏู ุจุงุฑ ูุฑุงุฎูุงู ฺฉูุฏ:

---

### ููุงุด ฺูุงุฑู (Demonstration 4) ๐ฅ๏ธ

```csharp
using System.Diagnostics;
using static System.Console;

Stopwatch stopwatch = Stopwatch.StartNew();
WriteLine(Sample.TimeConsumingMethod().Result);
stopwatch.Stop();
WriteLine($"Elapsed time: {stopwatch.ElapsedMilliseconds} milliseconds");

stopwatch.Restart();
// Subsequent calls
WriteLine(Sample.TimeConsumingMethod().Result);
stopwatch.Stop();
WriteLine($"Elapsed time: {stopwatch.ElapsedMilliseconds} milliseconds");

class Sample
{
    static int flagValue = 0;

    public static Task<int> TimeConsumingMethod()
    {
        return Task.Run(
            () =>
            {
                WriteLine("Forming the value...");
                // Simulating a delay before forming the value
                Thread.Sleep(3000);
                flagValue = new Random().Next(0, 100);
                return flagValue;
            }
        );
    }
}
```

### ุฎุฑูุฌ (Output) ๐จ๏ธ

ููููู ุฎุฑูุฌ ุงุฌุฑุง ุจุฑูุงูู:

```
Forming the value...
87
Elapsed time: 3092 milliseconds
Forming the value...
45
Elapsed time: 3017 milliseconds
```

---

### ุชุญูู (Analysis) ๐

ูโุจูุฏ ฺฉู ูุฑ ุจุงุฑ ฺฉู **ูุชุฏ ุฒูุงูโุจุฑ** ูุฑุงุฎูุงู ูโุดูุฏุ **ุจุด ุงุฒ ณ ุซุงูู** ุทูู ูโฺฉุดุฏ ุชุง ฺฉ ุนุฏุฏ ุจุฑฺฏุฑุฏุงูุฏ.

---

### ุงุนูุงู ูฺฉุงูุฒู ฺฉุด (Applying Caching Mechanism) ๐พ

ุจุฑุง ุจูุจูุฏ ุจุฑูุงูู ูโุชูุงูุฏ ุงุฒ **ูฺฉุงูุฒู ฺฉุด (Cache)** ุงุณุชูุงุฏู ฺฉูุฏ. ุงุฏู ุจู ุงู ุตูุฑุช ุงุณุช:
ููุช ููุฏุงุฑ ฺฉโุจุงุฑ ูุญุงุณุจู ุดุฏุ ุขู ุฑุง ุฏุฑ **ฺฉุด ูฺฏู ูโุฏุงุฑู**ุ ุฏุฑ ูุชุฌูุ ุจุงุฑ ุจุนุฏ ฺฉู ฺฉุงุฑุจุฑ ูุชุฏ ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏุ ููุงู ููุฏุงุฑ ุฐุฎุฑูโุดุฏู ุฏุฑ ฺฉุด ุจู ุงู ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ.

ุฏุฑ ุงู ุฒููู ูโุชูุงูุฏ ุงุฒ ูุชุฏ **Task.FromResult** ุงุณุชูุงุฏู ฺฉูุฏ. ุงู ูุชุฏ ุจู ุดูุง ฺฉูฺฉ ูโฺฉูุฏ **ฺฉ ุดุก Task<TResult> ุขูุงุฏู** ุฑุง ุจุฑฺฏุฑุฏุงูุฏ ฺฉู ููุฏุงุฑ ููุฑุฏูุธุฑ ุฏุฑ ูฺฺฏ **Result** ุขู ูฺฏูโุฏุงุฑ ุดุฏู ุงุณุช.

ุงู ุฑูุด ุจูโูฺู ุฒูุงู ููุฏ ุงุณุช ฺฉู ฺฉ ุนููุงุช **ูุงููุฒูุงู (Asynchronous)** ุงูุฌุงู ูโุฏูุฏ ฺฉู **Task<TResult>** ุจุฑูโฺฏุฑุฏุงูุฏุ ุงูุง ูุชุฌู ุขู ูุจูุงู ุฏุฑ ุฏุณุชุฑุณ ุงุณุช.

---

### ููุงุด ูพูุฌู (Demonstration 5) ๐ฅ๏ธ

ุจุงุฏ ูุชุฏ ุฒูุงูโุจุฑ ฺฉูุงุณ Sample ุฑุง ุจู ุดฺฉู ุฒุฑ ุงุตูุงุญ ฺฉูู:

```csharp
// There is no other change in the previous code
class Sample
{
    static bool cacheFormed;
    static int flagValue = 0;

    public static Task<int> TimeConsumingMethod()
    {
        return Task.Run(() =>
        {
            if (!cacheFormed)
            {
                WriteLine("First call: forming the value...");
                // Simulating a delay before forming the value
                Thread.Sleep(3000);
                flagValue = new Random().Next(0, 100);
                cacheFormed = true;
            }
            else
            {
                WriteLine("Subsequent call(s): getting the value from the cache.");
                Task.FromResult(flagValue);
            }

            return flagValue;
        });
    }
}
```

---

### ุฎุฑูุฌ (Output) ๐จ๏ธ

ููููู ุฎุฑูุฌ:

```
First call: forming the value...
42
Elapsed time: 3026 milliseconds
Subsequent call(s): getting the value from the cache.
42
Elapsed time: 1 milliseconds
```

---

### ุชุญูู (Analysis) ๐

ูโุจูุฏ ฺฉู ูฺฉุงูุฒู ฺฉุด ุจุงุนุซ ุดุฏ ุฏุฑ ูุฑุงุฎูุงูโูุง ุจุนุฏ **ุฒูุงู ูพุงุณุฎโุฏู ุจูโุทูุฑ ฺุดูฺฏุฑ ฺฉุงูุด ูพุฏุง ฺฉูุฏ**.

---

### ูพุฑุณุด ู ูพุงุณุฎ (Q\&A Session) โ๐ฌ

**ุณูุงู ถ.ด:**
ูโุชูุงูุฏ ฺฉ ููููู ูุงูุน ุจฺฏูุฏ ฺฉู ุฏุฑ ุขู ุงุฒ **Taskูุง ูพุดโูุญุงุณุจูโุดุฏู (Precomputed Tasks)** ุงุณุชูุงุฏู ฺฉููุ

**ูพุงุณุฎ:**
ูุฑุถ ฺฉูุฏ ุจุฑูุงููโุง ุฏุงุฑุฏ ฺฉู ฺฉุงุฑุจุฑ ฺฉ **URL** ูุงุฑุฏ ูโฺฉูุฏุ ุณูพุณ ุจุฑูุงูู ุดุฑูุน ุจู **ุฏุงูููุฏ ุฏุงุฏูโูุง ุงุฒ ุขู URL** ุจุฑุง ูพุฑุฏุงุฒุดโูุง ุจุนุฏ ูโฺฉูุฏ. ุฏุฑ ุงู ุญุงูุชุ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฏุงูููุฏูุง ุชฺฉุฑุงุฑุ ูโุชูุงูุฏ **URL ู ุฏุงุฏูโูุง ูุฑุจูุทู ุฑุง ุฏุฑ ฺฉุด ุฐุฎุฑู ฺฉูุฏ**.

---

### ุงุณุชูุงุฏู ุงุฒ TaskCompletionSource ๐๏ธ

ุฏุฏุฏ ฺฉู **Taskูุง** ูโุชูุงููุฏ ุจู ุดูุง ฺฉูฺฉ ฺฉููุฏ ุชุง **ฺฉุงุฑูุง ูพุณโุฒููู** ุฑุง ุงูุฌุงู ุฏูุฏ. ููฺูู ุจุฑุง **ูุฏุฑุช ุขุชูโูุง ฺฉุงุฑ** ูุซู ุงูุฌุงู **ฺฉุงุฑูุง ุงุฏุงููโุฏุงุฑ (Continuation Works)**ุ ูุฏุฑุช **Taskูุง ูุฑุฒูุฏ (Child Tasks)** ุง **ูุฏุฑุช ุฎุทุงูุง (Exceptions)** ููุฏ ูุณุชูุฏ.

ุงูุง ฺฏุงู ูุงุฒู ุงุณุช **ฺฉูุชุฑู ุจุดุชุฑ ุจุฑ Taskูุง ุฏุงุดุชู ุจุงุดุฏ**. ุฏุฑ ฺูู ุดุฑุงุทุ ฺฉูุงุณ **TaskCompletionSource<TResult>** ูโุชูุงูุฏ ุจุณุงุฑ ููุฏ ุจุงุดุฏ. ุจุงุฏ ุงุณุชูุงุฏู ุงุฒ ุขู ุฑุง ุจุฑุฑุณ ฺฉูู.

ฺฉูุงุณ **TaskCompletionSource<TResult>** ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ **ฺฉ Task ุฑุง ุงุฒ ูุฑ ุนููุงุช ฺฉู ูุฑุงุฑ ุงุณุช ุฏุฑ ุขูุฏู ฺฉุงูู ุดูุฏ ุงุฌุงุฏ ฺฉูุฏ**.

ูุงฺฉุฑูุณุงูุช ุฏุฑ ููฺฉ ุฒุฑ ุงู ฺฉูุงุณ ุฑุง ุงูโฺฏููู ุชูุถุญ ุฏุงุฏู ุงุณุช:
[https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.taskcompletionsource-1?view=net-8.0](https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.taskcompletionsource-1?view=net-8.0)

> ููุงูุฏู ุณูุช ุชููุฏฺฉููุฏู ฺฉ **Task<TResult>** ุงุณุช ฺฉู ุจู ูฺ **Delegate** ุฎุงุต ูุชุตู ูุณุช ู **ุณูุช ูุตุฑูโฺฉููุฏู** ุงุฒ ุทุฑู ูฺฺฏ **Task** ุจู ุขู ุฏุณุชุฑุณ ุฏุงุฑุฏ.

ุจู ุจุงู ุณุงุฏูโุชุฑุ ุฏุฑ ูพุดุชโุตุญููุ ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ฺฉูุงุณุ ฺฉ **Task ูุงุจุณุชู (Slave Task)** ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ **ุจูโุตูุฑุช ุฏุณุช ุขู ุฑุง ฺฉุงูู ฺฉูุฏ**. ุงู ูุงุจูุช ุจุฑุง ฺฉุงุฑูุง **I/O ูุญูุฑ** ุจุณุงุฑ ุงุฏูโุขู ุงุณุชุ ฺูู ูโุชูุงูุฏ ุงุฒ **ูุฒุงุง Taskูุง** ุงุณุชูุงุฏู ฺฉูุฏ ุจุฏูู ุงูโฺฉู **ุฑุดุชู ูุฑุงุฎูุงูโฺฉููุฏู ุฑุง ูุณุฏูุฏ ฺฉูุฏ**.

### ูุญูู ุงุณุชูุงุฏู (How to Use?) ๐๏ธ

ุญุงูุง ุณุคุงู ุงู ุงุณุช: **ฺุทูุฑ ุจุงุฏ ุงุฒ ุงู ฺฉูุงุณ ุงุณุชูุงุฏู ฺฉููุ**

ุงููู ูุฏู ุงู ุงุณุช ฺฉู **ฺฉ ููููู (Instance)** ุงุฒ ุงู ฺฉูุงุณ ุงุฌุงุฏ ฺฉูุฏ.
ุจูโูุญุถ ูููููโุณุงุฒุ ฺูุฏ **ูุชุฏ ุฏุงุฎู (Built-in Methods)** ุฏุฑ ุงุฎุชุงุฑ ุดูุง ูุฑุงุฑ ูโฺฏุฑุฏ ฺฉู ูโุชูุงููุฏ ูุงุฒูุง ุดูุง ุฑุง ุจุฑุขูุฑุฏู ฺฉููุฏ.

ุฏุฑ ุชุตูุฑ ุฒุฑ (ููููู ุงุณฺฉุฑูโุดุงุช ุงุฒ Visual Studio) ุฌุฒุฆุงุช ุงู ฺฉูุงุณ ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช (ุดฺฉู **6-1** ุฑุง ุจุจูุฏ).

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/06/Table%206-2.jpeg)
</div>

### ุงุฒ ุฑู ุงู ุงุณฺฉุฑูโุดุงุช ฺู ูุชูุฌู ูโุดููุ

ุงุฒ ุชุตูุฑ ูุดุฎุต ุงุณุช ฺฉู **ูุงู ูุชุฏูุง ุง ุจุง โSetโ ุดุฑูุน ูโุดููุฏ ุง ุจุง โTrySetโ**.

* **ฺฏุฑูู ุงูู (Set)** ููุฏุงุฑ ุจุงุฒฺฏุดุช ูุฏุงุฑุฏ (**void**).
* **ฺฏุฑูู ุฏูู (TrySet)** ููุฏุงุฑ ุจุงุฒฺฏุดุช ุจูู (**bool**) ุฏุงุฑุฏ.

ูฺฉุงุช ููู ุฏุฑุจุงุฑู ุงู ูุชุฏูุง:

* ุฒูุงู ฺฉู ูุฑฺฉุฏุงู ุงุฒ ุงู ูุชุฏูุง ุฑุง ุตุฏุง ูโุฒูุฏุ **ุชุณฺฉ ูุงุฑุฏ ฺฉ ุงุฒ ุญุงูุงุช ููุง (RanToCompletionุ Faultedุ ุง Canceled)** ูโุดูุฏ.
* ูุชุฏูุง ฺฏุฑูู ุงูู (ุนู ูุชุฏูุง ฺฉู ุจุง **Set** ุดุฑูุน ูโุดููุฏ) **ุจุงุฏ ุฏููุงู ฺฉโุจุงุฑ ูุฑุงุฎูุงู ุดููุฏ**ุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ุจุง **Exception** ููุงุฌู ูโุดูุฏ. (ูพุงุณุฎ **ุณูุงู 6.5** ุจุดุชุฑ ุชูุถุญ ูโุฏูุฏ.)

---

### **ุฏูู 6 โ TaskCompletionSource ุฏุฑ ุนูู**

ุจุฑุง ุฏุฑฺฉ ุจูุชุฑุ ุงู ุจุฑูุงูู ุฑุง ุจุฑุฑุณ ฺฉูุฏ:

* ุฏุฑ ุงุจุชุฏุง ุจุฑูุงููุ ฺฉ ููููู ุงุฒ ฺฉูุงุณ **TaskCompletionSource<string>** ุจู ูุงู **tcs** ุงุฌุงุฏ ุดุฏู ุงุณุช. ุฏุฑ ูุชุฌู ูโุชูุงูู ุฏุฑ ูุฑุงุญู ุจุนุฏ ุงุฒ ูฺฺฏ **Task** ุขู ุงุณุชูุงุฏู ฺฉูู.
* ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ุจุง ูุดุฑุฏู ฺฉูุฏ **y** ุฌุฒุฆุงุช ุนููุงุช ูพุณโุฒููู ุฑุง ุฏุฑุงูุช ฺฉูุฏ. ุงฺฏุฑ ฺฉูุฏ ุฏฺฏุฑ ูุงุฑุฏ ฺฉูุฏุ ุจุฑูุงูู ุจุฏูู ููุงุด ุฌุฒุฆุงุช ูพุงุงู ูโุงุจุฏ.

**ฺฉุฏ ููููู:**

```csharp
using static System.Console;

WriteLine($"The TaskCompletionSource demo.");

TaskCompletionSource<string> tcs = new();
Task<string> collectInfoTask = tcs.Task;

// ุดุฑูุน ฺฉ ุชุณฺฉ ูพุณโุฒููู
var backgroundTask = Task.Run(() =>
{
    // ุนููุงุช ูพุณโุฒููู (ุฏุฑ ุงู ูุซุงู ุฎุงู ุงุณุช)
});

WriteLine("Monitoring the activity before setting the result.");

// ุดุจูโุณุงุฒ ุชุงุฎุฑ ูุจู ุงุฒ ุณุช ฺฉุฑุฏู ูุชุฌู
Thread.Sleep(3000);

bool isSuccess = tcs.TrySetResult("Everything went well.");
if (isSuccess)
{
    WriteLine("\nThe result is set successfully.");
}

WriteLine("\nEnter a key (if interested, press 'y' to get the details).");
var input = ReadKey();

if (input.KeyChar == 'y')
{
    WriteLine($"\nReceived: {collectInfoTask.Result}");
}

WriteLine("\nThank you!");
```

---

### **ููููู ุฎุฑูุฌโูุง:**

**ุญุงูุช 1 (ฺฉุงุฑุจุฑ ุฌุฒุฆุงุช ุฑุง ูโุฎูุงูุฏ):**

```
The TaskCompletionSource demo.
Enter a key (if interested, press 'y' to get the details).
Monitoring the activity before setting the result.
y
The result is set successfully.
Received: Everything went well.
Thank you!
```

**ุญุงูุช 2 (ฺฉุงุฑุจุฑ ุฌุฒุฆุงุช ุฑุง ููโุฎูุงูุฏ ู ูุซูุงู โnโ ูุงุฑุฏ ูโฺฉูุฏ):**

```
The TaskCompletionSource demo.
Enter a key (if interested, press 'y' to get the details).
Monitoring the activity before setting the result.
n
Thank you!
```

---

### **ูพุฑุณุด ู ูพุงุณุฎ**

**ุณูุงู 6.5 โ ฺุฑุง ฺฏูุชุฏ ูุชุฏูุง Set ุฑุง ููุท ฺฉโุจุงุฑ ุจุงุฏ ูุฑุงุฎูุงู ฺฉุฑุฏุ**

ุงฺฏุฑ ุงู ูุชุฏูุง ุฑุง ุจุด ุงุฒ ฺฉโุจุงุฑ ูุฑุงุฎูุงู ฺฉูุฏุ ุจุง Exception ููุงุฌู ูโุดูุฏ:

```csharp
tcs.SetResult("Everything went well.");
tcs.SetResult("The result is set for the second time."); // Exception!
```

**ุฎุฑูุฌ ุฎุทุง:**

```
Unhandled exception. System.AggregateException:
One or more errors occurred.
(An attempt was made to transition a task to a final state when it had already completed.)
```

ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงู ูุดฺฉูุ **TrySetResult** ุจูุชุฑ ุงุณุช ฺูู **true ุง false ุจุฑูโฺฏุฑุฏุงูุฏ** ู Exception ููโุฏูุฏ.

---

**ุณูุงู 6.6 โ ฺฉุฌุง ูโุชูุงูู ุงุฒ TaskCompletionSource ุงุณุชูุงุฏู ฺฉููุ**

ฺฉ ุณูุงุฑู ูุงูุน: ูุฑุถ ฺฉูุฏ ุจุฑูุงููโุง ุฑูุฏุงุฏูุญูุฑ ุฏุงุฑุฏ ฺฉู ฺฉุงุฑุจุฑ ุจุงุฏ **ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ ุง Credential** ูุงุฑุฏ ฺฉูุฏ.

* ุงฺฏุฑ ุงุทูุงุนุงุช ุฏุฑุณุช ุจุงุดุฏุ ุจุฑูุงูู ูุนุงูุช ฺฉุงุฑุจุฑ ุฑุง ุฏุฑ ูพุงฺฏุงู ุฏุงุฏู ุฐุฎุฑู ูโฺฉูุฏ.
* ุงฺฏุฑ ุงุทูุงุนุงุช ุงุดุชุจุงู ุจุงุดุฏุ ุจุฑูุงูู **Exception** ุงุฌุงุฏ ฺฉุฑุฏู ู ุฎุทุง ุฑุง ููุงุด ูโุฏูุฏ.

ุฏุฑ ฺูู ููุงุฑุฏ ูโุชูุงูุฏ ุงุฒ **TaskCompletionSource<TResult>** ุจุฑุง ฺฉูุชุฑู ุฑููุฏ ฺฉุงุฑ ุงุณุชูุงุฏู ฺฉูุฏ.

### ุฎูุงุตู

ุงู ูุตู ูุทุงูุจ ุชฺฉููโุง ุฑุง ุงุฑุงุฆู ูโุฏูุฏ ฺฉู ูโุชูุงูุฏ ุฏุฑ ุจุฑูุงููโููุณ ุจุง **Task** ุจู ุดูุง ฺฉูฺฉ ฺฉูุฏ. ูพุณ ุงุฒ ูุทุงูุนู ุงู ูุตูุ ูุงุฏุฑ ุฎูุงูุฏ ุจูุฏ ุจู ูพุฑุณุดโูุง ุฒุฑ ูพุงุณุฎ ุฏูุฏ:

* **ฺฺฏููู ูโุชูุงู ููฺฏุงู ุงุฌุฑุง ฺฉ ูุธูู ุทููุงูุ ูุฒุงู ูพุดุฑูุช ุฑุง ฺฏุฒุงุฑุด ฺฉุฑุฏุ**
* **ฺฺฏููู ูโุชูุงู ูุธุงู ุฑุง ุจูโุตูุฑุช ุถูู (Implicitly) ุงุฌุงุฏ ฺฉุฑุฏุ**
* **ฺฺฏููู ูโุชูุงู ุงุฒ ฺฉ ูุธูู ุงุฒ ูพุด ูุญุงุณุจูโุดุฏู (Precomputed Task) ุจูุฑู ุจุฑุฏุ**
* **ฺฉูุงุณ `TaskCompletionSource` ฺฺฏููู ูโุชูุงูุฏ ุจู ุดูุง ุฏุฑ ูุฏุฑุช ฺฉ ูุธูู I/O-ูุญูุฑ ฺฉูฺฉ ฺฉูุฏุ**

### ุชูุฑูโูุง โ๏ธ

ุฏุงูุณุชูโูุง ุฎูุฏ ุฑุง ุจุง ุงูุฌุงู ุชูุฑูโูุง ุฒุฑ ุจุณูุฌุฏ:
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/06/Table%206-3.jpeg)
</div>

### ุงุฏุขูุฑ ๐

ููุงูโุทูุฑ ฺฉู ูุจูุงู ฺฏูุชู ุดุฏุ ูโุชูุงูุฏ ุจุง ุฎุงู ุฑุงุญุช ูุฑุถ ฺฉูุฏ ฺฉู ุชูุงู **namespace**โูุง ูุงุฒู ุจุฑุง ุงู ูุทุนูโฺฉุฏูุง ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏ. ุงู ุชูุถุญ ุจุฑุง ุชูุงู ุชูุฑูโูุง ุงู ฺฉุชุงุจ ูู ุตุฏู ูโฺฉูุฏ.

---

### **ุชูุฑู 6.1**

ุงฺฏุฑ ฺฉุฏ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏุ ูโุชูุงูุฏ ุฎุฑูุฌ ุฑุง ูพุดโุจู ฺฉูุฏุ

```csharp
using static System.Console;
TaskCompletionSource<int> tcs = new();
int value = 10;
var task1 = Task.Run(() => value++);
task1.Wait();
var task2 = Task.Run(() =>
{
    tcs.SetResult(value * 10);
});
WriteLine($"The final result is: {tcs.Task.Result}");
```

---

### **ุชูุฑู 6.2**

ูโุชูุงูุฏ ุฎุฑูุฌ ุจุฑูุงูู ุฒุฑ ุฑุง ูพุดโุจู ฺฉูุฏุ

```csharp
using static System.Console;
var task = Task.Run(() => "Thanks God!");
string msg = string.Concat(task.Result, " What a beautiful day!");
var task2 = Task.FromResult(msg);
WriteLine(task2.Result);
```

---

### **ุชูุฑู 6.3**

ูโุชูุงูุฏ ุฎุฑูุฌ ุจุฑูุงูู ุฒุฑ ุฑุง ูพุดโุจู ฺฉูุฏุ

```csharp
using static System.Console;
try
{
    Action greet = new(() => WriteLine($"Hello reader!"));
    Action raiseError = new(
        () => throw new Exception("There is a problem."));
    Parallel.Invoke(greet, raiseError);
}
catch (AggregateException ae)
{
    foreach (Exception ex in ae.InnerExceptions)
    {
        WriteLine(ex.Message);
    }
}
```

---

## **ูพุงุณุฎ ุชูุฑูโูุง** โ

**ุชูุฑู 6.1**
ุฎุฑูุฌ ุฒุฑ ุฑุง ูุดุงูุฏู ุฎูุงูุฏ ฺฉุฑุฏ:

```
The final result is: 110
```

๐ **ูฺฉุชู:** ุฏูุช ฺฉูุฏ ฺฉู `task1` ููุฏุงุฑ ุงููู ุฑุง ุจู **11** ุชุบุฑ ูโุฏูุฏุ ู ุณูพุณ `task2` ุขู ุฑุง ุจู **11ร10=110** ุชูุธู ูโฺฉูุฏ. ุฏุณุชูุฑ `Wait` ุจุฑุง ุญูุธ ุชุฑุชุจ ุงุฌุฑุง ูุฑุงุฑ ุฏุงุฏู ุดุฏู ุงุณุช.

---

**ุชูุฑู 6.2**
ุฎุฑูุฌ ุฒุฑ ุฑุง ูุดุงูุฏู ุฎูุงูุฏ ฺฉุฑุฏ:

```
Thanks God! What a beautiful day!
```

---

**ุชูุฑู 6.3**
ุฎุฑูุฌ ุฒุฑ ุฑุง ูุดุงูุฏู ุฎูุงูุฏ ฺฉุฑุฏ:

```
Hello reader!
There is a problem.
```

โ๏ธ **ุงุฏุฏุงุดุช ููุณูุฏู:** ุงู ุฎุฑูุฌ ูุงุจู ูพุดโุจู ุงุณุช. ฺุฑุงุ ฺูู ููุดู ูพุงู ุฎุทุง **"There is a problem."** ุจุนุฏ ุงุฒ ุฎุท **"Hello reader!"** ููุงุด ุฏุงุฏู ูโุดูุฏ.

ููฺฉ ุฑุณู ุจุฑุง ุชุฃุฏ ุงู ููุถูุน:
[Parallel.Invoke exceptions โ Microsoft Docs](https://learn.microsoft.com/en-us/previous-versions/msp-n-p/ff963549%28v=pandp.10%29?redirectedfrom=MSDN)

ูุชู ูโฺฏูุฏ:

> ูุฑ ุงุณุชุซูุง ฺฉู ููฺฏุงู ุงุฌุฑุง `Parallel.Invoke` ุฑุฎ ุฏูุฏุ **ุจู ุชุนูู ูโุงูุชุฏ** ู ูพุณ ุงุฒ ุงุชูุงู ุชูุงู ูุธุงู ุฏูุจุงุฑู ูพุฑุชุงุจ ูโุดูุฏ. ุชูุงู ุงุณุชุซูุงูุง ุจูโุตูุฑุช **inner exception**โูุง ฺฉ ูููููโ **AggregateException** ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดููุฏ.
