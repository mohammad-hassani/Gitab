# ูุตู ุณูู: ุงุฏุงูู ู Taskูุง ุชู ุฏุฑ ุชู ๐งต

ุงู ูุตู ูุฑูุฑ ุจุฑ Task Continuationsุ Taskูุง ุชู ุฏุฑ ุชู (Nested Tasks) ู ููุถูุนุงุช ูุฑุชุจุท ุงุฑุงุฆู ูโุฏูุฏ.

ุดูุง ุฎูุงูุฏ ุขููุฎุช ฺฺฏููู ูโุชูุงู ฺฉุงุฑูุง ุฑุง ูพุณ ุงุฒ ุงุชูุงู ฺฉ Task ุงุฏุงูู ุฏุงุฏ ู ฺฺฏููู Taskูุง ูโุชูุงููุฏ ุฏุงุฎู ฺฉุฏฺฏุฑ ุงุฌุฑุง ุดููุฏ ุชุง ุณุงุฎุชุงุฑ ุจุฑูุงูู ููุธู ู ุจููู ุจุงู ุจูุงูุฏ.

## ูุธุงู ุงุฏุงููโุฏููุฏู (Continuation Tasks) ๐

ูุฑุถ ฺฉูุฏ ุฏู ูุธูู ุฏุงุฑู ุจู ูุงู Task A ู Task B. ุงฺฏุฑ ุจุฎูุงูุฏ ุงุฌุฑุง Task B ุฑุง ุชููุง ุจุนุฏ ุงุฒ Task A ุดุฑูุน ฺฉูุฏุ ุงุญุชูุงูุงู ูโุฎูุงูุฏ ุงุฒ callbackูุง ุงุณุชูุงุฏู ฺฉูุฏ. ุงูุง TPL ุงู ฺฉุงุฑ ุฑุง ุจุณุงุฑ ุณุงุฏู ูโฺฉูุฏ. ุงู ูุงุจูุช ุงุฒ ุทุฑู ฺฉ **ูุธูู ุงุฏุงููโุฏููุฏู (continuation task)** ูุฑุงูู ูโุดูุฏ ฺฉู ฺุฒ ุฌุฒ ฺฉ **ูุธูู ุบุฑููุฒูุงู (asynchronous task)** ูุณุช. ุงุฏู ููุงู ุงุณุช: ููุช ฺฉ **ูุธูู ูพุดู (antecedent task)** ุจู ูพุงุงู ุฑุณุฏุ ูุธูู ุจุนุฏ ฺฉู ูโุฎูุงูุฏ ุงุฏุงูู ุฏูุฏุ ูุฑุงุฎูุงู ูโุดูุฏ. ุฏุฑ ูุซุงู ูุงุ Task A ููุงู **ูุธูู ูพุดู** ู Task B ููุงู **ูุธูู ุงุฏุงููโุฏููุฏู** ุงุณุช.

ุงุฌุงุฒู ุฏูุฏ ูฺฺฏโูุง ููู ฺฉ **ูุธูู ุงุฏุงููโุฏููุฏู** ุฑุง ุฎูุงุตู ฺฉูู:
โข ฺฉ **ูุธูู ุงุฏุงููโุฏููุฏู** ุชูุณุท ฺฉ ูุธูู ุฏฺฏุฑ ูุฑุงุฎูุงู ูโุดูุฏ. ูโุชูุงูุฏ ุฒูุงู ุดุฑูุน ุดูุฏ ฺฉู ูุธูู ูุจู (ุนู **ูุธูู ูพุดู**) ฺฉุงูู ุดุฏู ุจุงุดุฏ. ุงู ุนู ุงุฏุงููโูุง ฺุฒ ุฌุฒ **ุฒูุฌุฑูโุณุงุฒ ูุธุงู** ูุณุชูุฏ.
โข ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ูููููุ ูโุชูุงูุฏ **ุฏุงุฏูโูุง (ู ุญุช ุงุณุชุซูุงูุง)** ุฑุง ุงุฒ ฺฉ ูุธูู ูพุดู ุจู ูุธูู ุงุฏุงููโุฏููุฏู ููุชูู ฺฉูุฏ.
โข ุงฺฏุฑ ฺฉ ูุธูู ุบุฑููุฒูุงู ุฏุงุฏูโุง ุจุฑฺฏุฑุฏุงูุฏุ ูโุชูุงูุฏ ุงุฒ ูุธูู ุงุฏุงููโุฏููุฏู ุจุฑุง **ุฏุฑุงูุช ู/ุง ูพุฑุฏุงุฒุด ุขู ุฏุงุฏูโูุง ุจุฏูู ูุณุฏูุฏ ฺฉุฑุฏู ูุฎ ุงุตู** ุงุณุชูุงุฏู ฺฉูุฏ. ุงู ูฺฺฏุ **ุงูุนุทุงูโูพุฐุฑ ุจุงูุง ูุธุงู ุงุฏุงููโุฏููุฏู** ุฑุง ูุดุงู ูโุฏูุฏ.
โข ุงุฏุงููโูุง ูโุชูุงููุฏ ุจู ฺฉ ุง ฺูุฏ **ูุธูู ูพุดู** ูุชุตู ุดููุฏ.
โข ูโุชูุงูุฏ ฺฉ ุง ฺูุฏ **ูุธูู ุงุฏุงููโุฏููุฏู** ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ.
โข ูโุชูุงูุฏ **ฺฉูุชุฑู ูุธูู ุงุฏุงููโุฏููุฏู** ุฑุง ุฏุฑ ุฏุณุช ุจฺฏุฑุฏ. ุจุฑุง ูุซุงูุ ุงฺฏุฑ ุณู ูุธูู ุจู ูุงูโูุง Task Aุ Task B ู Task C ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏุ ูโุชูุงูุฏ ุชุตูู ุจฺฏุฑุฏ ฺฉู Task C ุชููุง ุจุนุฏ ุงุฒ ุงุชูุงู ูุฑ ุฏู Task A ู Task B ุงุฏุงูู ุงุจุฏ. ุง ูโุชูุงูุฏ ุชุนู ฺฉูุฏ ฺฉู Task C ูุงุฒู ูุณุช ููุชุธุฑ ูุฑ ุฏู ุจุงุดุฏ ู ุจู ูุญุถ ุงุชูุงู ูุฑ ฺฉุฏุงูุ ุงุฏุงูู ุงุจุฏ.
โข ููฺูู ูโุชูุงูุฏ ฺฉ **ูุธูู ุงุฏุงููโุฏููุฏู ุฑุง ูุบู (cancel)** ฺฉูุฏ. ุงู ูฺฺฏ ุงุบูุจ ุฏุฑ ุดุฑุงุท ุงุถุทุฑุงุฑ ุง ุฒูุงู ฺฉู ุจุง ฺฉ ุจุงฺฏ ูฺฉุฑุฑ ุฏุฑ ุงุฌุฑุง ุจุฑูุงูู ููุงุฌู ูโุดูุฏุ ููุฏ ุงุณุช.

---

### ุงุฏุงูู ุณุงุฏู (Simple Continuation) ๐ฝ๏ธ

ูุฑุถ ฺฉูุฏ ูุฑุฏ ุจู ูุงู Jack ูโุฎูุงูุฏ ุฏูุณุชุงูุด ุฑุง ุจู ฺฉ **ูููุงู ุดุงู** ุฏุนูุช ฺฉูุฏ. ุฏุฑ ุณุทุญ ุจุงูุงุ ูุนุงูุช ฺฉู ุฑุง ูโุชูุงู ุจู ุฏู ูุธูู ุชูุณู ฺฉุฑุฏ:
โข ุฏุนูุช ุงุฒ ุฏูุณุชุงู
โข ุณูุงุฑุด ุบุฐุง

ูุฑุถ ฺฉูู Jack ุงุจุชุฏุง ุฏูุณุชุงูุด ุฑุง ุงุฒ ุทุฑู ุชููู ุฏุนูุช ูโฺฉูุฏ. ูพุณ ุงุฒ ุงุชูุงู ุฏุนูุชุ ุงู ูโุฏุงูุฏ ฺูุฏ ููุฑ ูุฑุงุฑ ุงุณุช ุฏุฑ ูููุงู ุดุฑฺฉุช ฺฉููุฏ. ุจุฑ ุงุณุงุณ ุงู ุงุทูุงุนุงุชุ ุญุงูุง ุบุฐุง ุฑุง ุณูุงุฑุด ูโุฏูุฏ. ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ **ุฏุนูุช ุงุฒ ุฏูุณุชุงู** ููุงู **ูุธูู ูพุดู** ู **ุณูุงุฑุด ุบุฐุง** ููุงู **ูุธูู ุงุฏุงููโุฏููุฏู** ุงุณุช.

ุจุงุฏ ุจุฑูุงููโุง ุจููุณู ุชุง ุงู ุณูุงุฑู ุฑุง ุดุจูโุณุงุฒ ฺฉูุฏ.

ุจุฑุง **ูุธูู ุงุฏุงููโุฏููุฏู**ุ ุดูุง ุงุณุชูุงุฏู ุงุฒ ูุชุฏ `ContinueWith` ุฑุง ูุดุงูุฏู ุฎูุงูุฏ ฺฉุฑุฏ. ุงู ูุชุฏ ฺฉ **ูุธูู ุงุฏุงููโุฏููุฏู** ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู ุฒูุงู ุงุฌุฑุง ูโุดูุฏ ฺฉู **ูุธูู ูุฏู** ฺฉุงูู ุดุฏู ุจุงุดุฏ. ุงู ูุชุฏ ฺูุฏู **ุจุงุฑฺฏุฐุงุฑ ุงุถุงู (overload)** ุฏุงุฑุฏ. ุฏุฑ ุงู ูุซุงูุ ูู ุณุงุฏูโุชุฑู ูุณุฎูโ `ContinueWith` ุฑุง ุงุณุชูุงุฏู ฺฉุฑุฏูโุงู ฺฉู ฺฉ **Action<Task>** ุจู ุนููุงู ูพุงุฑุงูุชุฑ ูโูพุฐุฑุฏ. ุจู ููู ุฏูู ุดูุง ฺฉุฏ ุฒุฑ ุฑุง ูุดุงูุฏู ูโฺฉูุฏ:

```csharp
var orderTask = inviteTask.ContinueWith(previousTask =>
{
    WriteLine(previousTask.Result);
    // ุดุจูโุณุงุฒ ฺฉ ุชุฃุฎุฑ ุจุฑุง ุชููุฏ ุงุฒ ฺฉ ูููุนุช ูุงูุน
    Thread.Sleep(1000);
    WriteLine("Food is ordered now.");
}
);
```

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ฺฉ ุชููู ฺฉ ุซุงููโุง ุฏุงุฎู `orderTask` ฺฏุฐุงุดุชู ุดุฏู ุงุณุช. ุงฺฏุฑฺู ุงู ฺฉุงุฑ ูุงุฒู ูุจูุฏุ ุงูุง ุงู ุฎุท ฺฉุฏ ุจุฑุง ุดุจูโุณุงุฒ **ุชุฃุฎุฑ ุจู ูุธูู ุฏุนูุช ุงุฒ ุฏูุณุชุงู ู ุณูุงุฑุด ุบุฐุง** ูฺฏู ุฏุงุดุชู ุดุฏู ุงุณุช.

<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/03/Table%203-1.jpeg) 
</div>

ูฺฉุชู ููู โ๏ธ

ุจุฑุง ุงูฺฉู ุฎุฑูุฌ ฺฉุงูู ุจุฑูุงูู ุฑุง ูุดุงู ุฏููุ ุฏุฑ ุงู ูุซุงู ุงุฒ ูุชุฏ `ReadLine` ุงุณุชูุงุฏู ฺฉุฑุฏูโุงู ุชุง ุงุฒ ูพุงุงู ุฒูุฏููฺฏุงู ุจุฑูุงูู ฺฉูุณูู ุฌููฺฏุฑ ุดูุฏ. ููู ูฺฉุชู ุฒูุงู ฺฉู ูู ุงุฒ `ReadKey` ุง `ReadLine` ุฏุฑ ูุซุงูโูุง ุฏฺฏุฑ ุงู ฺฉุชุงุจ ุงุณุชูุงุฏู ูโฺฉูู ูุฒ ุตุฏู ูโฺฉูุฏ.

---

### ููุงุด 1 (Demonstration 1) ๐ป

ุฏุฑ ุงูุฌุง ููุงุด ฺฉุงูู ุจุฑูุงูู ุขูุฏู ุงุณุช:

```csharp
using static System.Console;

WriteLine("The host is planning a party.");

var inviteTask = Task.Run(() => "Invitation is done.");

var orderTask = inviteTask.ContinueWith(previousTask =>
{
    WriteLine(previousTask.Result);
    // ุดุจูโุณุงุฒ ุชุฃุฎุฑ ุจุฑุง ุชููุฏ ุงุฒ ฺฉ ูููุนุช ูุงูุน
    Thread.Sleep(1000);
    WriteLine("Food is ordered now.");
});

WriteLine("The host is decorating the house.");

ReadLine();
```

#### ุฎุฑูุฌ (Output) ๐ฅ๏ธ

ููููู ุฎุฑูุฌ ุจุฑุง ุดูุง ุจู ุงู ุดฺฉู ุฎูุงูุฏ ุจูุฏ:

```
The host is planning a party.
The host is decorating the house.
Invitation is done.
Food is ordered now.
```

---

### ุชุญูู (Analysis) ๐

ุฎุฑูุฌ ุจุงูุง ูฺฺฏโูุง ุฒุฑ ุฑุง ุชุฃุฏ ูโฺฉูุฏ:
โข **ูุฎ ุงุตู (main thread)** ุฏุฑ ููฺฏุงู ุงุฌุฑุง **ูุธูู ุงุฏุงููโุฏููุฏู** ูุณุฏูุฏ ูุดุฏู ุจูุฏ. ุจู ููู ุฏูู ุฎุท `"The host is decorating the house."` ูุจู ุงุฒ ุฎุท `"Invitation is done."` ููุงุด ุฏุงุฏู ุดุฏ.
โข ูโุชูุงู ุฏุฏ ฺฉู **ูุธูู ุงุฏุงููโุฏููุฏู** ุจุนุฏ ุงุฒ ุงุชูุงู **ูุธูู ูพุดู** ุขุบุงุฒ ุดุฏ ู ููฺูู **ุฏุงุฏูโูุง ุจุฑฺฏุดุช ุงุฒ ูุธูู ูุงูุฏ/ูพุดู** ุฑุง ุจู ุฏุฑุณุช ูพุฑุฏุงุฒุด ฺฉุฑุฏ.
โข ุฏุฑ ุงู ูุซุงูุ ุฒูุงู ฺฉู ูุธูู ุงุฏุงููโุฏููุฏู ุฎุท `WriteLine(previousTask.Result);` ุฑุง ูพุฑุฏุงุฒุด ฺฉุฑุฏุ ุบุฑูุณุฏูุฏ ฺฉููุฏู ุจูุฏ. ฺุฑุงุ ุฒุฑุง ูุธูู ูุจู ุงุฒ ูุจู ฺฉุงูู ุดุฏู ุจูุฏ ู ูุชุฌู ุขู ููุฑุงู ุฏุฑ ุฏุณุชุฑุณ ุจูุฏ.

---

### ุงุฏุงููโูุง ุดุฑุท (Conditional Continuations) โ๏ธ

ููุงุด 1 ฺฉ ููููู ุณุงุฏู ุงุฒ **ูุธูู ุงุฏุงููโุฏููุฏู** ุฑุง ูุดุงู ุฏุงุฏ. ุจุง ุงู ุญุงูุ ุดูุง ูโุชูุงูุฏ ฺฉูุชุฑู ุจุดุชุฑ ุจุฑ ูุฑุขูุฏ ุงุฏุงูู ุฏุงุดุชู ุจุงุดุฏ. ุจุงุฏ ุงู ููููู ุฑุง ุจุง ุจุฑุฎ **ูุทุงูุนุงุช ููุฑุฏ (case studies)** ุจุฑุฑุณ ฺฉูู.

#### ูุทุงูุนู ููุฑุฏ 1 (Case Study 1) ๐

ุญุช ูพุณ ุงุฒ ุฏุนูุช ูููุงูโูุงุ ููฺฉู ุงุณุช ูุฒุจุงู ุจู ุฏูุงู ูุงฺฏุฒุฑ ูุฌุจูุฑ ุดูุฏ **ุชุงุฑุฎ ูููุงู ุฑุง ุชุบุฑ ุฏูุฏ**. ุฏุฑ ุงู ุญุงูุชุ ุจู ุฌุง ุณูุงุฑุด ุบุฐุงุ ูุฑุถ ฺฉูู ูุฒุจุงู **ุจู ูููุงู ุงุทูุงุน ูโุฏูุฏ** ู ุชุงุฑุฎ ูููุงู ุฑุง ุฌุงุจูโุฌุง ูโฺฉูุฏ. ุขุง ูโุชูุงูุฏ ุจุฑูุงููโุง ุจููุณุฏ ฺฉู ุงู ูุถุนุช ุฑุง ุดุจูโุณุงุฒ ฺฉูุฏุ

ูุทุนุงู ูโุชูุงูุฏ. ุงูุง ุงุฌุงุฒู ุฏูุฏ **ุชฺฉูฺฉ ุจุง ุงุณุชูุงุฏู ุงุฒ enumeration ุจู ูุงู `TaskContinuationOptions`** ุจู ุดูุง ูุดุงู ุฏูู ฺฉู ุงู ูุถุนุช ุฑุง ูุฏุฑุช ูโฺฉูุฏ. ุชุตูุฑ ุฒุฑ (Figure 3-1) ุงุฒ Visual Studio **ุงุนุถุง ูุฎุชูู `TaskContinuationOptions`** ุฑุง ูุดุงู ูโุฏูุฏ:

<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/03/Table%203-2.jpeg) 
</div>

ูฺฉุชู ููู โ๏ธ

ุจุญุซ ุฏุฑ ููุฑุฏ ูููโ ุงุนุถุง `TaskContinuationOptions` ุจุงุนุซ ุญุฌู ุดุฏู ุจโููุฑุฏ ฺฉุชุงุจ ูโุดูุฏ. ุงฺฏุฑ ุนูุงููโููุฏ ูุณุชุฏุ ูโุชูุงูุฏ ุจุง ุจุงุฒ ฺฉุฑุฏู ุขูโูุง ุฏุฑ Visual Studio ุง ุงุฒ ููฺฉ ุขููุงู ุฒุฑ ุงุทูุงุนุงุช ุจุดุชุฑ ฺฉุณุจ ฺฉูุฏ:
[TaskContinuationOptions โ Microsoft Docs](https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.taskcontinuationoptions?view=net-8.0)
ุจุง ุงู ุญุงูุ ูฺฉุฑ ูโฺฉูู ุจุง ุฏุฏู ูุงู ุงู ุงุนุถุง ูุฒ ูโุชูุงูุฏ **ุชุตูุฑ ฺฉู ุงุฒ ุนููฺฉุฑุฏ ุขูโูุง** ุจู ุฏุณุช ุขูุฑุฏ.

---

ฺูู ูุซุงู ูุง ุจุง ฺฉ **ูุถุนุช ุงุณุชุซูุง (exceptional situation)** ุณุฑูฺฉุงุฑ ุฏุงุฑุฏุ ูุตุฏ ุฏุงุฑู ุงุฒ ฺฏุฒููโูุง `NotOnFaulted` ู `OnlyOnFaulted` ุงุณุชูุงุฏู ฺฉูู. ุดูุง ูโุชูุงูุฏ ุจูโุทูุฑ ุงูู ูุฑุถ ฺฉูุฏ ฺฉู ฺฏุฒููโ `NotOnFaulted` ุจุฑุง ูุถุนุช **ุนุงุฏ** ู ฺฏุฒููโ ุฏฺฏุฑ ุจุฑุง ูุถุนุช **ุงุณุชุซูุง** ุงุณุชูุงุฏู ุฎูุงูุฏ ุดุฏ.

ูุจู ุงุฒ ุงูฺฉู ุจุฑูุงูู ฺฉุงูู ุฑุง ุจุจูุฏุ ุจุงุฏ ุจฺฏูู ุจุฑุง ุงุฌุงุฏ ฺฉ **ูุถุนุช ุงุณุชุซูุง**ุ ุงุฒ ฺฉ ููุทู ุณุงุฏู (dummy logic) ุงุณุชูุงุฏู ฺฉุฑุฏูโุงู. ุงู ููุทู ุจู ุงู ุตูุฑุช ุงุณุช: **ูุธูู ูพุดู (inviteTask)** ฺฉ ุนุฏุฏ ุชููุฏ ูโฺฉูุฏ. ุงฺฏุฑ ุนุฏุฏ **ุฒูุฌ** ุจุงุดุฏุ ฺฉ **ุงุณุชุซูุง (exception)** ุฑุฎ ูโุฏูุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ูพุงู ูุจู ุจุฑ ุงูฺฉู ุฏุนูุช ุงูุฌุงู ุดุฏู ุงุณุชุ ุงุฑุณุงู ูโุดูุฏ.

---

### ููุงุด 2 (Demonstration 2) ๐ป

ุจุงุฏ ุจุฑูุงูู ฺฉุงูู ุฑุง ุจุจูู:

```csharp
using static System.Console;

WriteLine("The host is planning a party.");

var inviteTask = Task.Run(() =>
{
    string msg = "Invitation is done.";
    // ููุทู ุณุงุฏู ุจุฑุง ุงุฌุงุฏ ุงุณุชุซูุง
    int random = new Random().Next(10);
    if (random % 2 == 0)
    {
        throw new Exception("Some problem occurs.");
    }
    return msg;
});

var orderTask = inviteTask.ContinueWith(previousTask =>
{
    WriteLine(previousTask.Result);
    // ุดุจูโุณุงุฒ ุชุฃุฎุฑ ุจุฑุง ุชููุฏ ุงุฒ ฺฉ ูููุนุช ูุงูุน
    Thread.Sleep(1000);
    WriteLine("Food is ordered now.");
}, TaskContinuationOptions.NotOnFaulted);

var changePartyDateTask = inviteTask.ContinueWith(previousTask =>
{
    WriteLine("Party date is shifted due to some unavoidable circumstances.");
}, TaskContinuationOptions.OnlyOnFaulted);

WriteLine("The host is decorating the house.");

ReadLine();
```

#### ุฎุฑูุฌ (Output) ๐ฅ๏ธ

ูููููโุง ุงุฒ ุฎุฑูุฌ ููฺฉู ุจุฏูู ุงุณุชุซูุง:

```
The host is planning a party.
The host is decorating the house.
Invitation is done.
Food is ordered now.
```

ูููููโุง ุงุฒ ุฎุฑูุฌ ููฺฉู ููุช ูุฒุจุงู ูุฌุจูุฑ ุดุฏ **ุชุงุฑุฎ ูููุงู ุฑุง ุชุบุฑ ุฏูุฏ**:

```
The host is planning a party.
The host is decorating the house.
Party date is shifted due to some unavoidable circumstances.
```

---

### ูุทุงูุนู ููุฑุฏ 2 (Case Study 2) ๐

ูุธุงู ุงุฏุงููโุฏููุฏู ุจู ุดูุง ฺฉูฺฉ ูโฺฉููุฏ ุจุง **ูุถุนุชโูุง ูุฎุชูู** ุจูโุฎูุจ ฺฉูุงุฑ ุจุงุฏ. ุงุฌุงุฒู ุฏูุฏ ฺฉ **ูุทุงูุนู ููุฑุฏ ุฏฺฏุฑ** ุฑุง ุจุฑุฑุณ ฺฉูู. ูุจูุงู ฺฏูุชู ฺฉู **ุงุฏุงููโูุง ูโุชูุงููุฏ ุจู ฺฉ ุง ฺูุฏ ูุธูู ูพุดู ูุชุตู ุดููุฏ**. ุจุงุฏ ฺฉ ูุซุงู ุจุจูู.

ุงู ุจุงุฑ ุงุฒ ูุชุฏ `ContinueWhenAll` ุงุณุชูุงุฏู ูโฺฉูู. ููุงููุฏ ููุดูุ ุงู ูุชุฏ ฺูุฏู overload ุฏุงุฑุฏ. ูู ูุตุฏ ุฏุงุฑู ูุณุฎูโุง ุฑุง ุงุณุชูุงุฏู ฺฉูู ฺฉู **ุฏู ูพุงุฑุงูุชุฑ ูโูพุฐุฑุฏ**:

```csharp
public Task ContinueWhenAll<TAntecedentResult>(
    Task<TAntecedentResult>[] tasks,
    Action<Task<TAntecedentResult>[]> continuationAction
)
{
    // ุจุฏูู ูุชุฏ ูุดุงู ุฏุงุฏู ูุดุฏู ุงุณุช
}
```

ูพุงุฑุงูุชุฑ ุงูู **ฺฉ ุขุฑุงู ุงุฒ ูุธุงู ูพุดู** ูโูพุฐุฑุฏ (ุงู ุนู ุชูุงู ุขูโูุง ุจุงุฏ ุชฺฉูู ุดููุฏ ุชุง ุงุฏุงูู ุขุบุงุฒ ุดูุฏ) ู ูพุงุฑุงูุชุฑ ุจุนุฏ ุจุฑุง **delegate ุงุฒ ููุน Action** ุงุณุช ฺฉู ุฒูุงู ุงุฌุฑุง ูโุดูุฏ ฺฉู **ุชูุงู ูุธุงู ููุฌูุฏ ุฏุฑ ุขุฑุงู ุชฺฉูู ุดููุฏ**.

ุจู ููู ุฏููุ ุดูุง ฺฉุฏ ุฒุฑ ุฑุง ุฎูุงูุฏ ุฏุฏ ฺฉู ูุดุงู ูโุฏูุฏ **orderTask** ู **inviteTask** ุจุงุฏ ุชฺฉูู ุดููุฏ ุชุง **ูุธูู ุงุฏุงููโุฏููุฏู (continuation task)** ุขุบุงุฒ ุดูุฏ:

```csharp
var arrangeDinnerTask = Task.Factory.ContinueWhenAll(
    [orderTask, inviteTask],
    tasks =>
    {
         WriteLine("Arranging dinner.");
    }
);
```

<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/03/Table%203-3.jpeg) 
</div>

ูฺฉุชู ููู โ๏ธ

ุดุงุฏ ุชูุฌู ฺฉุฑุฏู ุจุงุดุฏ ฺฉู ูฺฺฏ **โCollection expressionsโ** ุฏุฑ C# 12 ุงุฌุงุฒู ูโุฏูุฏ `arrangeDinnerTask` ุฑุง ุจู ุงู ุดฺฉู ุจููุณู. ุงฺฏุฑ ุงุฒ ูุณุฎู ูุฏูโุชุฑ C# ุงุณุชูุงุฏู ูโฺฉูุฏุ ูุงุฒู ุงุณุช ุขู ุฑุง ุจู ุตูุฑุช ุฒุฑ ุจููุณุฏ (ุชุบุฑ ููู ุจุง **bold** ูุดุฎุต ุดุฏู ุงุณุช):

```csharp
var arrangeDinnerTask = Task.Factory.ContinueWhenAll(
    new[] { orderTask, inviteTask },
    //[orderTask,inviteTask],  // ุงุฒ C#12 ุจู ุจุนุฏ
    tasks =>
    {
    }
);
```

---

### ููุงุด 3 (Demonstration 3) ๐ป

ุจุงุฏ ุจุฑูุงูู ฺฉุงูู ุฑุง ุจุจูู:

```csharp
using static System.Console;

var orderTask = Task.Run(() => WriteLine("Food is ordered."));
var inviteTask = Task.Run(() => WriteLine("Invitation is done."));

var arrangeDinnerTask = Task.Factory.ContinueWhenAll(
    //[new[] { orderTask,inviteTask }],
    [orderTask, inviteTask],  // ุงุฒ C#12 ุจู ุจุนุฏ
    tasks =>
    {
        WriteLine("Arranging dinner.");
    }
);

ReadLine();
```

#### ุฎุฑูุฌ (Output) ๐ฅ๏ธ

ูููููโุง ุงุฒ ุฎุฑูุฌ ููฺฉู ููุช ุงุจุชุฏุง ุบุฐุง ุณูุงุฑุด ุฏุงุฏู ูโุดูุฏ:

```
Food is ordered.
Invitation is done.
Arranging dinner.
```

ูููููโุง ุงุฒ ุฎุฑูุฌ ููฺฉู ููุช ุงุจุชุฏุง ุฏุนูุชโูุง ุงูุฌุงู ูโุดูุฏ:

```
Invitation is done.
Food is ordered.
Arranging dinner.
```

---

### ุชุญูู (Analysis) ๐

ุฏุฑ ูุฑ ุญุงูุช ูโุชูุงู ูุดุงูุฏู ฺฉุฑุฏ ฺฉู **ุดุงู ุชููุง ูพุณ ุงุฒ ุชฺฉูู ูุธูู ุณูุงุฑุด ุบุฐุง ู ุงูุฌุงู ุฏุนูุชโูุง** ฺุฏู ุดุฏู ุงุณุช.

---

### ูุทุงูุนู ููุฑุฏ 3 (Case Study 3) ๐ฝ๏ธ

ุจุงุฏ ฺฉ ูุทุงูุนู ููุฑุฏ ุฏฺฏุฑ ุฑุง ุจุฑุฑุณ ฺฉูู ฺฉู ุฏุฑ ุขู **ูุธูู ุงุฏุงููโุฏููุฏู ุฒูุงู ุงุฌุฑุง ูโุดูุฏ ฺฉู ูุฑ ฺฉ ุงุฒ ูุธุงู ูุจู ุชฺฉูู ุดููุฏ**. ุฏุฑ ุงู ุญุงูุช ูโุชูุงูุฏ ุงุฒ ูุชุฏ `ContinueWhenAny` ุจู ุฌุง `ContinueWhenAll` ุงุณุชูุงุฏู ฺฉูุฏ.

ุจู ุนููุงู ูุซุงูุ ููููู ุฎุฑูุฌ ุฒุฑ ุฒูุงู ุจู ุฏุณุช ุขูุฏ ฺฉู ูู ูุชุฏ `ContinueWhenAll` ุฑุง ุจุง `ContinueWhenAny` ุฌุงฺฏุฒู ฺฉุฑุฏู:

```
Food is ordered.
Arranging dinner.
Invitation is done.
```

ุงู ุฎุฑูุฌ ูุดุงู ูโุฏูุฏ ฺฉู **ุดุงู ุญุช ูุจู ุงุฒ ุชฺฉูู ุฏุนูุชโูุง ฺุฏู ุดุฏู ุงุณุช**. ุดูุง ูโุชูุงูุฏ ุงุญุชูุงู ูุดุงูุฏู ฺูู ุฎุฑูุฌโุง ุฑุง ุจุง ุงุถุงูู ฺฉุฑุฏู ฺฉ **ุฏุณุชูุฑ sleep ุฏุฑ `inviteTask`** ุงูุฒุงุด ุฏูุฏุ ูุงููุฏ:

```csharp
var inviteTask = Task.Run(() =>
{
    Thread.Sleep(3000);
    WriteLine("Invitation is done.");
});
```

๐ก ูฺฉุชู: ุดูุง ููฺูู ูโุชูุงูุฏ ูพุฑูฺู **Chapter3\_Demo3\_CaseStudy3** ุฑุง ุฏุงูููุฏ ฺฉูุฏ ุชุง ุงู ูุทุงูุนู ููุฑุฏ ุฑุง ุชูุฑู ฺฉูุฏ.

ุดูุงุณุง ฺฉ ูุธูู ู ูุถุนุช ุขู ๐

ููุช ุฏุฑ ฺฉ ูุญุท **ฺูุฏูุฎ (multithreaded)** ุจุง ฺูุฏู ูุธูู ฺฉุงุฑ ูโฺฉูุฏุ ุถุฑูุฑ ุงุณุช ฺฉู **ูุธุงู ููุฑุงู ุจุง ูุถุนุช ุขูโูุง ุดูุงุณุง ุดููุฏ**. ุจุง ุงุณุชูุงุฏู ุงุฒ `Task.CurrentId` ูโุชูุงูุฏ **ุดูุงุณู (ID) ูุธููโุง ฺฉู ุฏุฑ ุญุงู ุงุฌุฑุงุณุช** ุฑุง ุฏุฑุงูุช ฺฉูุฏ.
<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/03/Table%203-4.jpeg) 
</div>

ูฺฉุชู ููู โ๏ธ

`CurrentId` ุจุฑุง ุฏุฑุงูุช **ุดูุงุณู ูุธููโุง ฺฉู ุฏุฑ ุญุงู ุงุฌุฑุงุณุช** ุงุฒ ุฏุงุฎู ฺฉุฏ ฺฉู ูุธูู ุงุฌุฑุง ูโฺฉูุฏ ุงุณุชูุงุฏู ูโุดูุฏ. ุจุง ุงู ุญุงูุ ุงู ฺฉ **ูฺฺฏ ุงุณุชุง (static property)** ุงุณุช ู ุจุง ูฺฺฏ `Id` ูุชูุงูุช ุงุณุช. ูฺฺฏ `Id` **ุดูุงุณู ฺฉ ููููู ูุดุฎุต ุงุฒ Task** ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ุชูุงุด ุจุฑุง ุฏุฑุงูุช ููุฏุงุฑ `CurrentId` ุงุฒ ุฎุงุฑุฌ ฺฉุฏ ฺฉู ูุธูู ุฏุฑ ุญุงู ุงุฌุฑุงุณุชุ **ููุฏุงุฑ null** ุจุงุฒูโฺฏุฑุฏุงูุฏ.

ฺุฑุฎู ุนูุฑ ฺฉ **ููููู Task** ุงุฒ ูุฑุงุญู ูุฎุชูู ุนุจูุฑ ูโฺฉูุฏ. ูฺฺฏ `Status` ุจุฑุง ุจุฑุฑุณ **ูุถุนุช ูุนู** ุงุณุชูุงุฏู ูโุดูุฏ. ููฺฏุงู ุจุฑุฑุณุ ุฎูุงูุฏ ุฏุฏ ฺฉู ุงู ูฺฺฏ **ููุน enum ุจู ูุงู TaskStatus** ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู ุงุนุถุง ุฒุงุฏ ุฏุงุฑุฏ. ุงุฌุงุฒู ุฏูุฏ ฺฉ **ุชุตูุฑ ุงุฒ Visual Studio** ุจุฑุง ููุงุด ุขูโูุง ุงุฑุงุฆู ฺฉูู (Figure 3-2).
<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/03/Table%203-5.jpeg) 
</div>

### ูุถุนุช ููุง ฺฉ Task ู ุชุญูู ุขู ๐

ุฏุฑ ฺฉ ูุญุท **ููุฒูุงู (concurrent)** ููฺฉู ุงุณุช ุฒูุงู ฺฉู ููุฏุงุฑ ูุถุนุช ฺฉ ูุธูู ุฑุง ุฏุฑุงูุช ูโฺฉูุฏุ ูุถุนุช ุขู ุชุบุฑ ฺฉุฑุฏู ุจุงุดุฏ. ุงูุง ูฺฉุชู ุฌุงูุจ ุงู ุงุณุช ฺฉู **ุฒูุงู ฺฉู ฺฉ ูุถุนุช ุจู ุฏุณุช ุขูุฏุ ููโุชูุงูุฏ ุจู ูุถุนุช ูุจู ุจุงุฒฺฏุฑุฏุฏ**. ุจุฑุง ูุซุงูุ ููุช ฺฉ ูุธูู ุจู **ูุถุนุช ููุง (final state)** ุจุฑุณุฏุ ููโุชูุงูุฏ ุจู ูุถุนุช `Created` ุจุงุฒฺฏุฑุฏุฏ.

ุณู ูุถุนุช ููุง ููฺฉู ูุฌูุฏ ุฏุงุฑุฏ:
โข `RanToCompletion` โ โ ูุดุงู ูโุฏูุฏ ูุธูู ุจุง ููููุช ฺฉุงูู ุดุฏู ุงุณุช.
โข `Canceled` โ โ ูุดุงู ูโุฏูุฏ ูุธูู ูุบู ุดุฏู ุงุณุชุ ฺฉู ูโุชูุงูุฏ ุจู ุฏูุงู ูุซู ุฏุฎุงูุช ฺฉุงุฑุจุฑุ ุชุงูโุงูุชโูุงุ ุง ููุทู ุจุฑูุงูู ุฑุฎ ุฏูุฏ.
โข `Faulted` โ๏ธ โ ูุดุงู ูโุฏูุฏ ูุธูู ุจู ุฏูู ฺฉ **ุงุณุชุซูุง ูุฏุฑุชโูุดุฏู** ฺฉุงูู ุดุฏู ุงุณุช.

ุชูุถุญุงุช ุจุดุชุฑ ุฏุฑุจุงุฑู ุงุณุชุซูุงูุง ู ูุบู ูุธุงู ุฏุฑ **ูุตู ด ู ูุตู ต** ุงุฑุงุฆู ุฎูุงูุฏ ุดุฏ.

---

### ููุงุด 4 (Demonstration 4) ๐ป

ุฏุฑ ุจุฑูุงูู ุฒุฑุ ุฏู ูุธูู ุฏุงุฑู:

1. `doSomethingTask` โ ูโุชูุงูุฏ ุจุง ููููุช ุชฺฉูู ุดูุฏ ุง ุจุง ฺฉ ุงุณุชุซูุง ููุงุฌู ุดูุฏ.
2. `statusCheckerTask` โ ฺฉ **ูุธูู ุงุฏุงููโุฏููุฏู** ุงุณุช ฺฉู ูุถุนุช ูุธูู ูุงูุฏ ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ูฺฺฏ `Status` ุจุฑุฑุณ ูโฺฉูุฏ ู `TaskStatus` ุขู ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ.

```csharp
using static System.Console;

var doSomethingTask = Task.Run(() =>
{
    WriteLine($"The task [id:{Task.CurrentId}] starts...");
    // ุงูุฌุงู ฺฉุงุฑ ุฏฺฏุฑุ ุฏุฑ ุตูุฑุช ูุงุฒ
    int random = new Random().Next(2);
    WriteLine($"The random number is:{random}");
    // ุนุฏุฏ ุชุตุงุฏู 0 ุจุงุนุซ ุงุฌุงุฏ ุงุณุชุซูุง ูโุดูุฏ
    if (random == 0)
    {
        throw new Exception("Got a zero");
    }
    WriteLine($"The task [id:{Task.CurrentId}] has finished.");
});

var statusCheckerTask = doSomethingTask.ContinueWith(previousTask =>
{
    WriteLine($"The task {previousTask.Id}'s status is: {previousTask.Status}");
}, TaskContinuationOptions.AttachedToParent);

ReadKey();
```

#### ุฎุฑูุฌ (Output) ๐ฅ๏ธ

ูููููโุง ุงุฒ ุฎุฑูุฌ ููุช ุงุณุชุซูุง ุฑุฎ ุฏุงุฏู ุงุณุช:

```
The task [id:8] starts...
The random number is:0
The task 8's status is: Faulted
```

ูููููโุง ุงุฒ ุฎุฑูุฌ ููุช ุงุณุชุซูุง ุฑุฎ ูุฏุงุฏู ุงุณุช:

```
The task [id:8] starts...
The random number is:1
The task [id:8] has finished.
The task 8's status is: RanToCompletion
```

---

### ุชุญูู ู ูุฏุฑุช ุดุงุฎูโูุง ูุฎุชูู ๐

ุฏุฑ ุตูุฑุช ูุงุฒุ ูโุชูุงูุฏ ุจุฑูุงูู ุฑุง ุทูุฑ ุชุบุฑ ุฏูุฏ ฺฉู **ุดุงุฎูโูุง ุฌุฏุงฺฏุงูู ุจุฑุง ูุฏุฑุช ุณูุงุฑููุง ูุฎุชูู** ุงุฌุงุฏ ฺฉูุฏุ ูุดุงุจู ููุงุด 2. ุจุฑุง ูุซุงูุ ูโุชูุงู `statusCheckerTask` ุฑุง ุจุง ุฏู ุดุงุฎู ุฒุฑ ุฌุงฺฏุฒู ฺฉุฑุฏ:

```csharp
var normalHandlerTask = doSomethingTask.ContinueWith(previousTask =>
{
    WriteLine($"The task {previousTask.Id}'s status is: {previousTask.Status}");
}, TaskContinuationOptions.AttachedToParent | TaskContinuationOptions.NotOnFaulted);

var faultHandlerTask = doSomethingTask.ContinueWith(previousTask =>
{
    WriteLine($"The parent task was not completed due to an exception.");
}, TaskContinuationOptions.AttachedToParent | TaskContinuationOptions.OnlyOnFaulted);
```

ุจุง ุงุฌุฑุง ุงู ุจุฑูุงููุ ูพุงูโูุง **ุจุฑ ุงุณุงุณ ูุถุนุช ุชฺฉูู ูุธูู ูุงูุฏ** ููุงุด ุฏุงุฏู ูโุดููุฏ.

* ููุช ุงุณุชุซูุง ุฑุฎ ุฏูุฏ:

```
The task [id:7] starts...
The random number is:0
The parent task was not completed due to an exception.
```

* ููุช ุงุณุชุซูุง ุฑุฎ ูุฏูุฏ:

```
The task [id:8] starts...
The random number is:1
The task [id:8] has finished.
The task 8's status is: RanToCompletion
```

---

### ูพุฑุณุด ู ูพุงุณุฎ (Q\&A) โ

**Q3.1:** ุฏุฑ ุฎุฑูุฌโูุงุ ุดูุงุณู ูุธูู ูุงูุฏ 7 ุง 8 ุจูุฏ. ุขุง ุฏุฑุณุช ุงุณุช ฺฉู ูุธุงู ุฏฺฏุฑ ูุฒ ููุฒูุงู ุงุฌุฑุง ูโุดุฏูุฏุ

**ูพุงุณุฎ:** ุจููุ ุงู ฺฉุฏ ุฏุฑ VS2022 ุจุง ุชูุธูุงุช ูพุดโูุฑุถ **Debug** ู ูุนุงู ุจูุฏู **Hot Reload** ุงุฌุฑุง ุดุฏ. ุงฺฏุฑ ููู ฺฉุฏ ุฑุง ุฏุฑ **Release configuration** ุง ุจุง ุบุฑูุนุงู ฺฉุฑุฏู Hot Reload ุงุฌุฑุง ฺฉูุฏุ ุดูุงุณู ูพุงูโุชุฑ ูุงููุฏ 1 ุฎูุงูุฏ ุฏุฏ:

```
The task [id:1] started doing something...
The random number is:0
The task 1's status is: Faulted
```

๐ ุจุฑุง ุงูุชุฎุงุจ ุชูุธูุงุช ููุฑุฏูุธุฑ: ุฑู **Solution Explorer** ุฑุงุณุชโฺฉูฺฉ ฺฉูุฏ โค **Configuration Managerโฆ** โค **Debug ุง Release** ุฑุง ุจุฑุง ูพุฑูฺู ุงูุชุฎุงุจ ฺฉูุฏ.
<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/03/Table%203-6.jpeg) 
</div>

ูฺฉุชู ููู โ๏ธ

ูู ุงุบูุจ ุจุฑูุงููโูุงู ุฑุง ุฏุฑ **ุญุงูุช Debug** ุงุฌุฑุง ูโฺฉูู. ุจูุงุจุฑุงูุ ุจุฑุง ุฏุฏู **ุดูุงุณูโูุง ูพุงูโุชุฑ ูุธุงู** ูุงููุฏ 1ุ 2ุ 3 ูโฆ ุฏุฑ ุฎุฑูุฌุ ูุนูููุงู ุขู ุจุฑูุงููโูุง ุฑุง ุจุง **ุบุฑูุนุงู ฺฉุฑุฏู ุชูุธู โHot Reloadโ** ุงุฌุฑุง ูโฺฉูู.

**Q3.2 ุขุง ุดูุงุณูโูุง ูุธุงู ฺฉุชุง ูุณุชูุฏุ**

ูุงฺฉุฑูุณุงูุช ุงู ููุถูุน ุฑุง ุชุถูู ููโฺฉูุฏ. ุฏุฑ ููฺฉ ุขููุงู ุฒุฑ ุฐฺฉุฑ ุดุฏู ุงุณุช:
[Task.CurrentId โ Microsoft Docs](https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.task.currentid?view=net-9.0)

> ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ูุฑฺูุฏ ุจุฑุฎูุฑุฏ ุดูุงุณูโูุง ุจุณุงุฑ ูุงุฏุฑ ุงุณุชุ ุงูุง **ุดูุงุณูโูุง ูุธุงู ุชุถูู ุดุฏู ูุณุชูุฏ ฺฉู ฺฉุชุง ุจุงุดูุฏ**.

---

### ูุธุงู ุชู ุฏุฑ ุชู (Nested Tasks) ๐

ูุธุงู ูโุชูุงููุฏ **ุชู ุฏุฑ ุชู** ุจุงุดูุฏ. ุนู ูโุชูุงู ฺฉ **ูุธูู ุฑุง ุฏุฑ ุฏูฺฏุช ฺฉุงุฑุจุฑ ฺฉ ูุธูู ุฏฺฏุฑ** ุงุฌุงุฏ ฺฉุฑุฏ. **ูุธูู ุจุฑูู** ฺฉู ูุธูู ูุฑุฒูุฏ ุฏุฑ ุขู ุงุฌุงุฏ ูโุดูุฏุ ูุนูููุงู ุจู ุนููุงู **ูุธูู ูุงูุฏ (parent task)** ุดูุงุฎุชู ูโุดูุฏ.

ฺฉ **ูุธูู ูุฑุฒูุฏ** ูโุชูุงูุฏ ฺฉ ุงุฒ ุงููุงุน ุฒุฑ ุจุงุดุฏ:
โข **Attached** ๐ โ ุจุง ฺฏุฒูู `TaskCreationOptions.AttachedToParent` ุงุฌุงุฏ ูโุดูุฏ (ุฏุฑ ุตูุฑุช ฺฉู ูุงูุฏ ุงุฌุงุฒู ุงุชุตุงู ุฏุงุดุชู ุจุงุดุฏ).
โข **Detached** ๐ โ ุจู ุทูุฑ ูุณุชูู ุงุฌุฑุง ูโุดูุฏ.

#### ูุธูู ูุฑุฒูุฏ Detached

ุจุงุฏ ุจุญุซ ุฎูุฏ ุฑุง ุจุง **ูุธุงู ูุฑุฒูุฏ Detached** ุดุฑูุน ฺฉูู.

---

### ููุงุด 5 (Demonstration 5) ๐ป

ฺฉุฏ ุฒุฑ ุฏู ููููู Task ุจู ูุงูโูุง **parent** ู **child** ุงุฌุงุฏ ูโฺฉูุฏ. ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู **ูุธูู ูุฑุฒูุฏ ุฏุงุฎู ูุธูู ูุงูุฏ ุงุฌุงุฏ ุดุฏู ุงุณุช**. ุจุง ุงู ุญุงูุ ูู **ูุธูู ูุฑุฒูุฏ ุฑุง ุจู ูุงูุฏ ูุชุตู ูฺฉุฑุฏู**. ุจู ููู ุฏููุ ุฎุท `TaskCreationOptions.AttachedToParent` ุฏุฑ ฺฉุฏ ุฒุฑ **ฺฉุงููุช ุดุฏู ุงุณุช**.
<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/03/Table%203-7.jpeg) 
</div>

ูฺฉุชู ููู โ๏ธ

ูุชุฏ `Task.Factory.StartNew` ฺฉ **ุจุงุฑฺฏุฐุงุฑ ุงุถุงู (overload)** ุฏุงุฑุฏ ฺฉู **`TaskCreationOptions`** ุฑุง ุจู ุนููุงู ูพุงุฑุงูุชุฑ ูโูพุฐุฑุฏ. ุงู ุงูฺฉุงู ุจุฑุง ูุชุฏ `Task.Run` ูุฌูุฏ ูุฏุงุฑุฏ.

---

### ูุซุงู Detached Nested Task ๐ป

```csharp
using static System.Console;

var parent = Task.Factory.StartNew(() =>
{
    // ฺฉุงุฑ ูุงูุฏ
});

WriteLine($"The parent task has started.");

var child = Task.Factory.StartNew(() =>
{
    WriteLine("The child task has started.");
    // ุงุฌุงุฏ ุชุฃุฎุฑ
    Thread.Sleep(1000);
    WriteLine("The child task has finished.");
    // ,TaskCreationOptions.AttachedToParent
});

Thread.Sleep(5);
parent.Wait();

WriteLine($"The parent task has finished now.");
```

#### ุฎุฑูุฌ ููููู ๐ฅ๏ธ

```
The parent task has started.
The child task has started.
The parent task has finished now.
```

ููุงูโุทูุฑ ฺฉู ูุดุงูุฏู ูโฺฉูุฏุ ุฎุฑูุฌ ูุดุงู ูโุฏูุฏ **ูุธูู ูุฑุฒูุฏ ุดุฑูุน ุดุฏู ุงุณุช**ุ ุงูุง ูุดุงู ููโุฏูุฏ ฺฉู **ุชฺฉูู ุดุฏู ุงุณุช ุง ุฎุฑ**. ุฏูู ุงู ุงุณุช ฺฉู **ูุธูู ูุฑุฒูุฏ ุจุฏูู ฺฏุฒูู `TaskCreationOptions.AttachedToParent` ุงุฌุงุฏ ุดุฏู** ู ุจูุงุจุฑุงู **ฺฉ ูุธูู Detached** ุงุณุช ฺฉู ุจู ุทูุฑ ูุณุชูู ุงุฒ ูุงูุฏ ุงุฌุฑุง ูโุดูุฏ. ุจู ููู ุฏูู ูุธูู ูุงูุฏ **ูุงุฒ ูุฏุงุฑุฏ ฺฉู ููุชุธุฑ ุชฺฉูู ูุธูู ูุฑุฒูุฏ ุจุงุดุฏ**.

---

### ูพุฑุณุด ู ูพุงุณุฎ (Q\&A) โ

**Q3.3:** ุงฺฏุฑ ุจุฎูุงูู ุฎุท `parent.Wait();` ุฑุง ุจุง `Task.WaitAll(parent, child);` ุฌุงฺฏุฒู ฺฉูู ุชุง ูุทูุฆู ุดูู ูุธูู ูุฑุฒูุฏ ูู ุงุฌุฑุง ุดุฏู ุงุณุชุ ุขุง ุฏุฑุณุช ุงุณุชุ

**ูพุงุณุฎ:** ุฎุฑ. ุฏุฑ ุขู ููููู ฺฉุฏุ **ูุธูู ูุฑุฒูุฏ ุฏุฑ ูุญุฏูุฏู (scope) ูุฌูุฏ ูุฏุงุฑุฏ**. ุจูุงุจุฑุงูุ ฺฉุฏ ูพุดููุงุฏ ุดูุง ุจุงุนุซ **ุฎุทุง ุฒูุงู ฺฉุงููพุงู** ูโุดูุฏ:

```
CS0103 The name 'child' does not exist in the current context
```

**Q3.4:** ุขุง ุงุณุชูุงุฏู ุงุฒ ุฏุณุชูุฑ `Sleep` ุฏุฑ ูุฎ ุงุตู ุถุฑูุฑ ุจูุฏุ

**ูพุงุณุฎ:** ููุ ุถุฑูุฑ ูุจูุฏ. ุงูุง ุจุง ูุฑุงุฑ ุฏุงุฏู ุงู ุฏุณุชูุฑุ ุงุญุชูุงู ููุงุด ุฎุท `"The child task has started."` ุฏุฑ ุฎุฑูุฌ ุงูุฒุงุด ูโุงุจุฏ.

---

### Attached Nested Task ๐

ุญุงูุง ุฎุท

```csharp
// ,TaskCreationOptions.AttachedToParent
```

ุฑุง ุงุฒ ฺฉุงููุช ุฎุงุฑุฌ ฺฉุฑุฏู ู ุจุฑูุงูู ุฑุง ุฏูุจุงุฑู ุงุฌุฑุง ูโฺฉูู. ุงู ุจุงุฑุ **ูุถุนุช ุชฺฉูู ูุธูู ูุฑุฒูุฏ** ูุฒ ููุงุด ุฏุงุฏู ุฎูุงูุฏ ุดุฏ.

#### ุฎุฑูุฌ ููููู ๐ฅ๏ธ

```
The parent task has started.
The child task has started.
The child task has finished.
The parent task has finished now.
```
<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/03/Table%203-8.jpeg) 
</div>

ูฺฉุงุช ููู โ๏ธ

ูโุชูุงูุฏ ฺฉ **ูุธูู ูุฑุฒูุฏ (child task)** ุฑุง ุจู **ูุธูู ูุงูุฏ (parent task)** ูุชุตู ฺฉูุฏุ **ููุท ุฏุฑ ุตูุฑุช ฺฉู ูุงูุฏ ุงุฌุงุฒู ุงู ฺฉุงุฑ ุฑุง ุจุฏูุฏ**. ุฏุฑ ุงู ุฒูููุ ุฏู ูฺฉุชู ููู ุงุฒ ูุณุชูุฏุงุช ุฑุณู ([ููฺฉ](https://learn.microsoft.com/en-us/dotnet/standard/parallel-programming/attached-and-detached-child-tasks)) ูุงุจู ุฐฺฉุฑ ุงุณุช:

1. ูุงูุฏู ูโุชูุงููุฏ ุจู ุทูุฑ ุตุฑุญ ุงุฒ ุงุชุตุงู ูุธุงู ูุฑุฒูุฏ ุฌููฺฏุฑ ฺฉููุฏุ ุจุง ูุดุฎุต ฺฉุฑุฏู ฺฏุฒูู `TaskCreationOptions.DenyChildAttach` ุฏุฑ **ุณุงุฒูุฏู ฺฉูุงุณ ูุงูุฏ** ุง ุฏุฑ ูุชุฏ `TaskFactory.StartNew`.
2. ูุงูุฏู ุจู ุทูุฑ ุถูู ุงุฒ ุงุชุตุงู ูุธุงู ูุฑุฒูุฏ ุฌููฺฏุฑ ูโฺฉููุฏ ุงฺฏุฑ ุขูโูุง ุจุง ุงุณุชูุงุฏู ุงุฒ ูุชุฏ `Task.Run` ุงุฌุงุฏ ุดููุฏ.

---

### ูพุฑุณุด ู ูพุงุณุฎ (Q\&A) โ

**Q3.5:** ุฏุฑ ููุงุด ูุจู (Demonstration 5)ุ ููุท `parent.Wait();` ููุดุชู ุดุฏู ุจูุฏ. ุงู ุนู ุดูุง ููุท ููุชุธุฑ ุชฺฉูู ูุธูู ูุงูุฏ ูุณุชุฏ ู ุจุฑุง ูุธูู ูุฑุฒูุฏ ฺูู ูุณุช. ุจูุงุจุฑุงู ูฺ ุชุถูู ูุฌูุฏ ูุฏุงุฑุฏ ฺฉู ุฎุฑูุฌ ูุดุงู ุฏูุฏ ูุธูู ูุฑุฒูุฏ ุชฺฉูู ุดุฏู ุงุณุช. ุขุง ุงู ุฏุฑฺฉ ุตุญุญ ุงุณุชุ

**ูพุงุณุฎ:** ุฎุฑ. ูุงฺฉุฑูุณุงูุช ูุนูุงุฑ ุฑุง ุจู ฺฏูููโุง ุทุฑุงุญ ฺฉุฑุฏู ุงุณุช ฺฉู ุงฺฏุฑ ุฑุงุจุทู ูุงูุฏโูุฑุฒูุฏ ุงุฌุงุฏ ฺฉูุฏุ **ููุชุธุฑ ูุงูุฏู ุจุฑุง ูุธูู ูุงูุฏ ุจุงุนุซ ูโุดูุฏ ูุธูู ูุฑุฒูุฏ ูุฒ ุชฺฉูู ุดูุฏ**.

---

### ูุงุฏุงุฑ ฺฉุฑุฏู ูุงูุฏ ุจู ุงูุชุธุงุฑ ุจุฑุง ูุฑุฒูุฏ ๐จโ๐ฉโ๐ง

ูโุชูุงูุฏ **ูุธูู ูุงูุฏ ุฑุง ูุงุฏุงุฑ ฺฉูุฏ ุชุง ููุชุธุฑ ุชฺฉูู ูุธูู ูุฑุฒูุฏ ุดูุฏ** (ุญุช ุงฺฏุฑ ฺฉ ูุธูู ูุฑุฒูุฏ Detached ุจุงุดุฏ) ุจุง ุฏุณุชุฑุณ ุจู ูฺฺฏ `Task<TResult>.Result` ูุธูู ูุฑุฒูุฏ.

---

### ููุงุด 6 (Demonstration 6) ๐ป

ุฏุฑ ุงู ูุซุงูุ ุจุฑูุงูู ูุจู ฺฉู ุชุบุฑ ฺฉุฑุฏู ุงุณุช. ฺฉุฏ ุฌุฏุฏ ุจุง **bold** ูุดุฎุต ุดุฏู ู ฺฉุฏ ูุฏู ฺฉุงููุช ุดุฏู ุงุณุช:

```csharp
using static System.Console;

var parent = Task.Factory.StartNew(() =>
{
    // ฺฉุงุฑ ูุงูุฏ
});

WriteLine($"The parent task has started.");

var child = Task.Factory.StartNew(() =>
{
    WriteLine("The child task has started.");
    // ุงุฌุงุฏ ุชุฃุฎุฑ
    Thread.Sleep(1000);
    // WriteLine("The child task has finished.");
    return "the child task has finished.";
    // , TaskCreationOptions.AttachedToParent
});

// ูุงูุฏ ุงฺฉููู ููุชุธุฑ ุงู ูุธูู ูุฑุฒูุฏ Detached ุงุณุช
return child.Result;

// Thread.Sleep(5);
// parent.Wait();
// WriteLine($"The parent task has finished now.");

WriteLine($"The parent task confirms that {parent.Result}");
```

#### ุฎุฑูุฌ ๐ฅ๏ธ

```
The parent task has started.
The child task has started.
The parent task confirms that the child task has finished.
```

---

### ุจุงุฒ ฺฉุฑุฏู ูุธุงู ุชู ุฏุฑ ุชู (Unwrapping Nested Tasks) ๐

ุฏุฑ ููุฑุฏ ูุธุงู ุชู ุฏุฑ ุชูุ ูุซุงู ุฒุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ:

```csharp
var someTask = Task.Factory.StartNew(
    () => Task.Factory.StartNew(() => 200)
);
```

ุฏุฑ ุงู ฺฉุฏุ `someTask` ุงุฒ ููุน `Task<Task<int>>` ุงุณุช. ุงฺฏุฑ ุญุงูุง ฺฉุฏ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```csharp
WriteLine(someTask.Result);
```

ุฎุฑูุฌ ุจู ุดฺฉู ุฒุฑ ุฎูุงูุฏ ุจูุฏ:

```
System.Threading.Tasks.Task`1[System.Int32]
```

ุงุฒ **.NET 4 ุจู ุจุนุฏ**ุ ูโุชูุงูุฏ ุงุฒ ฺฉ ุงุฒ **ูุชุฏูุง Extension ุจู ูุงู `Unwrap`** ุงุณุชูุงุฏู ฺฉูุฏ ุชุง ูุฑ `Task<Task<TResult>>` ุฑุง ุจู `Task<TResult>` ุชุจุฏู ฺฉูุฏ (ุง `Task<Task>` ุจู `Task`). ุงู ูุธูู ุฌุฏุฏ ููุงูุฏู **ูุธูู ุฏุงุฎู (inner nested task)** ุฎูุงูุฏ ุจูุฏ ู **ูุถุนุช ูุบู ู ุงุณุชุซูุงูุง** ุฑุง ูุฒ ุดุงูู ูโุดูุฏ.
<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/03/Table%203-9.jpeg) 
</div>

### ูุชุฏ Unwrap ๐

ูุชุฏ `Unwrap` ุฏู ุจุงุฑฺฏุฐุงุฑ (overload) ุฏุงุฑุฏ:

```csharp
public static Task Unwrap(this Task<Task> task);
public static Task<TResult> Unwrap<TResult>(this Task<Task<TResult>> task);
```

ููุงูโุทูุฑ ฺฉู ูุดุงูุฏู ูโฺฉูุฏุ ูุฑ ุฏู **ูุชุฏูุง Extension** ูุณุชูุฏ. ุฒูุงู ฺฉู ฺฉ `Task<Task>` (ุง `Task<Task<TResult>>`) ุฑุง unwrap ูโฺฉูุฏุ ฺฉ **ูุธูู ุฌุฏุฏ (ูุนูููุงู ุจู ุขู proxy ฺฏูุชู ูโุดูุฏ)** ุฏุฑุงูุช ูโฺฉูุฏ.

---

### ูุซุงู ๐ป

```csharp
var someTask1 = Task.Factory.StartNew(
    () => Task.Factory.StartNew(() => 200)
).Unwrap();

WriteLine($"Received: {someTask1.Result}");
```

#### ุฎุฑูุฌ ๐ฅ๏ธ

```
Received: 200
```

ุฌุงูุจ ุงุณุช ฺฉู ุงฺฏุฑ ุงุฒ ูุชุฏ `Run` ุงุณุชูุงุฏู ฺฉูุฏุ ุงู ฺฉุงุฑ **ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุจุฑุง ุดูุง ุงูุฌุงู ูโุดูุฏ**. ูุซุงู ูุนุงุฏู:

```csharp
var someTask2 = Task.Run(
    () => Task.Run(() => 200)
);

WriteLine($"Received: {someTask2.Result}");
```

ุฎุฑูุฌ ููู ุฎูุงูุฏ ุจูุฏ:

```
Received: 200
```

---

### ูฺฉุชู ูฺู โญ

ุฏุฑ ุงู ฺฉุชุงุจุ ูุง **ฺฉููุงุช ฺฉูุฏ `async` ู `await`** ุฑุง ุจุฑุฑุณ ูฺฉุฑุฏูโุงู. ุจุง ุงู ุญุงูุ ูโุชูุงูุฏ ุงุฒ `await` ุจุฑุง **unwrap ฺฉุฑุฏู ฺฉ ูุงู** ุงุณุชูุงุฏู ฺฉูุฏ. ูุซุงู:

```csharp
var someTask3 = Task.Factory.StartNew(
    () => Task.Factory.StartNew(() => 200)
);

WriteLine($"Received: {await someTask3.Result}");
```

ุงู ฺฉุฏ ูุฒ ฺฉุงููพุงู ูโุดูุฏ ู ุฎุฑูุฌ ูุดุงุจู ุฏุงุฑุฏ.

๐ก ูฺฉุชู: ูพุฑูฺู **Chapter3\_demo\_unwrappingnestedtasks** ุฑุง ุฏุงูููุฏ ฺฉูุฏ ุชุง ุงู ูุทุนุงุช ฺฉุฏ ุฑุง ุชูุฑู ฺฉูุฏ. ุงู ูพุฑูฺู ุฏุฑ ูพูุดู **Chapter3** ูุฑุงุฑ ุฏุงุฑุฏ.

---

### ุฎูุงุตู ูุตู ๐

ุงู ูุตู ุจู **ุงุฏุงูู ูุธุงู (task continuations)** ู **ูุธุงู ุชู ุฏุฑ ุชู (nested tasks)** ูพุฑุฏุงุฎุชู ุงุณุช ู ุจู ุทูุฑ ุฎูุงุตู ุจู ุณูุงูุงุช ุฒุฑ ูพุงุณุฎ ุฏุงุฏู ุงุณุช:

โข ฺฺฏููู ูโุชูุงู ฺฉ ูฺฉุงูุฒู ุณุงุฏู ุจุฑุง **ุงุฏุงูู ูุธูู** ูพุงุฏูโุณุงุฒ ฺฉุฑุฏุ
โข ฺฺฏููู ูโุชูุงู ุดุงุฎูโูุง ูุฎุชูู ุงุฌุงุฏ ฺฉุฑุฏ ุชุง ุงุฒ **ุงุฏุงูู ุดุฑุท ูุธูู** ุงุณุชูุงุฏู ุดูุฏุ
โข ฺฺฏููู ูโุชูุงู **ูุถุนุช ูุธูู ูุนู** ุฑุง ุจุฑุฑุณ ฺฉุฑุฏุ
โข ฺฺฏููู ูโุชูุงู ฺฉ **ูุธูู ุชู ุฏุฑ ุชู ุงุฌุงุฏุ ูุฏุฑุช ู unwrap** ฺฉุฑุฏุ
### ุชูุฑูโูุง ๐

ุจุฑุง ุจุฑุฑุณ ูุฒุงู ุฏุฑฺฉ ุฎูุฏุ **ุชูุฑูโูุง ุฒุฑ ุฑุง ุงูุฌุงู ุฏูุฏ** (ุจุฑุง ุงู ุชูุฑูโูุง ูุงุฒ ุจู ูุฏุฑุช ุงุณุชุซูุงูุง ุง ูุบู ูุธุงู ูุณุช):
<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/03/Table%203-10.jpeg) 
</div>

### ุงุฏุขูุฑ โ๏ธ

ููุงูโุทูุฑ ฺฉู ูุจูุงู ฺฏูุชู ุดุฏุ ูโุชูุงูุฏ ุจุง ุงุทููุงู ูุฑุถ ฺฉูุฏ ฺฉู **ุชูุงู namespaceูุง ูุงุฒู** ุจุฑุง ุงู ูุทุนุงุช ฺฉุฏ ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏ. ุงู ูฺฉุชู ุจุฑุง **ุชูุงู ุชูุฑูโูุง ุงู ฺฉุชุงุจ** ูุฒ ุตุฏู ูโฺฉูุฏ.

---

## ุชูุฑูโูุง ู ููููู ุฑุงูโุญูโูุง ๐๐ป

### E3.1

ุดุฑูุน ุจุง **C# 12**ุ ูโุชูุงูู **Primary Constructor** ุฑุง ุจู ุนููุงู ุจุฎุด ุงุฒ ุชุนุฑู ฺฉูุงุณ ูุดุฎุต ฺฉูู. ูุซุงู:

```csharp
class Employee (string name, int id)
{
    private string _name = name;
    private int _id = id;

    public override string ToString()
    {
        return $"Name:{_name} Id:{_id}";
    }
}

// ุงุฌุงุฏ ูููููโุง ุงุฒ ฺฉูุงุณ Employee
Employee emp = new("Bob", 1);
```

ูุฑุถ ฺฉูุฏ ุฏู ูุธูู ุฏุงุฑู:
1๏ธโฃ ุงููู ูุธููุ ฺฉ ููููู Employee ุงุฌุงุฏ ูโฺฉูุฏ.
2๏ธโฃ ูุธูู ุฏููุ ูพุณ ุงุฒ ุงุชูุงู ูุธูู ุงูู ุงุฌุฑุง ุดุฏู ู ุงุจุชุฏุง ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ูุธูู ุงูู ุจุง ููููุช ุชฺฉูู ุดุฏู ุงุณุช ุง ุฎุฑุ ุณูพุณ **ุชุงุฑุฎ ู ุฒูุงู ุฌุงุฑ** ุฑุง ฺุงูพ ูโฺฉูุฏ.

#### ููููู ุจุฑูุงูู ๐ป

```csharp
using static System.Console;

var createEmp = Task.Factory.StartNew(() => { })
    .ContinueWith(task =>
    {
        Employee emp = new("Bob", 1);
        WriteLine($"Created an employee with {emp}");
        WriteLine($"Was the previous task completed? {task.IsCompletedSuccessfully}");
        WriteLine($"Current time:{DateTime.Now}");
    });

createEmp.Wait();

class Employee (string name, int id)
{
    private string _name = name;
    private int _id = id;

    public override string ToString()
    {
        return $"Name: {_name} Id: {_id}";
    }
}
```

#### ุฎุฑูุฌ ููููู ๐ฅ๏ธ

```
Created an employee with Name: Bob Id: 1
Was the previous task completed? True
Current time:10/16/2024 9:58:08 AM
```

---

### E3.2

ุงุฌุงุฏ ฺฉ **ูุธูู ูพุณโุฒููู** ฺฉู ฺฉ URL ุฑุง ping ูโฺฉูุฏ (ูุซูุงู `www.google.com`) ู ุณูพุณ ุงุฌุงุฏ ฺฉ **ูุธูู ุงุฏุงูู** ฺฉู ูุชุฌู ุฑุง ุฏุฑ ฺฉูุณูู ููุงุด ุฏูุฏ.

#### ููููู ุจุฑูุงูู ๐ป

```csharp
using static System.Console;
using System.Net.NetworkInformation;

string url = "www.google.com";

WriteLine($"The main thread initiates a task that starts pinging {url}");

var pingTask = Task.Run(() => new Ping().Send(url));

var statusTask = pingTask.ContinueWith(previousTask =>
{
    WriteLine($"Ping Status of {url}: {pingTask.Result.Status}");
});

WriteLine($"The main thread is ready to do other work.");

statusTask.Wait();
```

#### ุฎุฑูุฌ ููููู ๐ฅ๏ธ

```
The main thread initiates a task that starts pinging www.google.com
The main thread is ready to do other work.
Ping Status of www.google.com: Success
```

๐ **ูุณุฎู ุฌุงฺฏุฒู ุจุฏูู ูุชุบุฑ statusTask:**

```csharp
var pingTask = Task.Run(() => new Ping().Send(url))
    .ContinueWith(previousTask => previousTask.Result.Status);

WriteLine($"Ping Status of {url}: {pingTask.Result}");
```

> ูฺฉุชู ููุณูุฏู: ูุฎ ุงุตู ุฏุฑ ุญู ุงุฌุฑุง ูุธูู ูพุณโุฒููู **ูุณุฏูุฏ ูุดุฏู ุจูุฏ** ู ููุท ุฏุฑ ูพุงุงู ุจุฑุง ููุงุด ุฎุฑูุฌ ููุชุธุฑ ูโูุงูุฏ.

---

### E3.3

ูพุดโุจู ุฎุฑูุฌ ุจุฑูุงูู ุฒุฑ:

```csharp
using static System.Console;

var helloTask = Task.Run(() =>
{
    WriteLine("Hello reader!");
    var aboutTask = Task.Factory.StartNew(() =>
    {
        Task.Delay(1000);
        WriteLine("How are you?");
    }, TaskCreationOptions.AttachedToParent);
});

helloTask.Wait();
```

#### ุฎุฑูุฌ ูุนููู ๐ฅ๏ธ

```
Hello reader!
```

โ ุฏูู: ุจุฑูุงูู ูุจู ุงุฒ ุงุชูุงู aboutTask ุฎุงุชูู ุงูุชู ุงุณุช.

ุจุง ุงุณุชูุงุฏู ุงุฒ `ReadKey()` ุง `ReadLine()` ุฏุฑ ูพุงุงู ูุฎ ุงุตูุ ูโุชูุงูุฏ ุจุฑูุงูู ุฑุง ุชุง ูุดุงูุฏู ุฎุฑูุฌ ฺฉุงูู ูฺฏู ุฏุงุฑุฏ:

```
Hello reader!
How are you?
```

> ูฺฉุชู: `Task.Run(someAction)` ุจู ุทูุฑ ูพุดโูุฑุถ **ุงุฌุงุฒู ุงุชุตุงู ูุธุงู ูุฑุฒูุฏ ุจู ูุงูุฏ ุฑุง ููโุฏูุฏ**ุ ุงูุง `Task.Factory.StartNew` ุงู ุงูฺฉุงู ุฑุง ูุฑุงูู ูโฺฉูุฏ.

---

### E3.4

ุขุง ูโุชูุงูุฏ ฺฉุฏ ุฒุฑ ุฑุง ฺฉุงููพุงู ฺฉูุฏุ

```csharp
using static System.Console;

var someTask = Task.Factory.StartNew(() => Task.Run(() => 300)).Unwrap();

WriteLine($"Received: {someTask.Result}");
```

โ ุจููุ ุฎุฑูุฌ:

```
Received: 300
```

---

### E3.5

ูพุดโุจู ุฎุฑูุฌ ุจุฑูุงูู ุฒุฑ:

```csharp
using static System.Console;

var getGift = Task.Factory.StartNew(() => "Sunny wins a book")
    .ContinueWith(previousTask =>
        Task.Run(() => previousTask.Result + " and a laptop.")
    )
    .Unwrap();

WriteLine(getGift.Result);
```

#### ุฎุฑูุฌ ๐ฅ๏ธ

```
Sunny wins a book and a laptop.
```

