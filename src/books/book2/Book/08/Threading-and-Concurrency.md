---
layout: layout.njk
title: Threading and Concurrency
---
# ูุตู ูุดุชู:  **Threading ู Concurrency**

ฺฉ **Process (ูุฑุขูุฏ)** ุฏุฑ ุงุตู ููุงู ุจุฑูุงููโุง ุงุณุช ฺฉู ุฑู ฺฉ ุณุณุชูโุนุงูู ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช. ุงู ูุฑุขูุฏ ุงุฒ ฺูุฏู **Thread (ุฑุดุชูโ ุงุฌุฑุง)** ุณุงุฎุชู ูโุดูุฏ.
**Thread of execution (ุฑุดุชูโ ุงุฌุฑุง)** ูุฌููุนูโุง ุงุฒ ุฏุณุชูุฑูุงุณุช ฺฉู ุชูุณุท ฺฉ Process ุตุงุฏุฑ ูโุดูุฏ.

ูุงุจูุช ุงุฌุฑุง ุจุด ุงุฒ ฺฉ Thread ุจูโุตูุฑุช ููโุฒูุงูุ **Multi-Threading (ฺูุฏุฑุณูุงู)** ูุงูุฏู ูโุดูุฏ.
ุฏุฑ ุงู ูุตู ูุฑุงุฑ ุงุณุช ุจู ููุถูุน **Multi-Threading** ู **Concurrency (ููโุฒูุงู)** ุจูพุฑุฏุงุฒู.

ูุฑ Thread ุจุฑุง ุงุฌุฑุงุ ฺฉ ููุฏุงุฑ ูุดุฎุต ุฒูุงู ุฏุฑุงูุช ูโฺฉูุฏ ู ุงู ุงุฌุฑุง ุชูุณุท **Thread Scheduler (ุฒูุงูโุจูุฏ ุฑุดุชูโูุง)** ุจู ุตูุฑุช ฺุฑุฎุด ูุฏุฑุช ูโุดูุฏ. ุฒูุงูโุจูุฏุ ุจุง ุงุณุชูุงุฏู ุงุฒ ุชฺฉูฺฉ ุจู ูุงู **Time Slicing** ุฒูุงู ุงุฌุฑุง ุฑุง ุจู Threadูุง ุชูุณู ูโฺฉูุฏ ู ูุฑ Thread ุฑุง ุฏุฑ ุฒูุงู ุชุนูโุดุฏู ุจุฑุง ุงุฌุฑุง ุจู CPU ูโูุฑุณุชุฏ. โ๏ธ

**Concurrency** ุนู ุชูุงูุง ุงุฌุฑุง ุจุด ุงุฒ ฺฉ Thread ุฏููุงู ุฏุฑ ฺฉ ูุญุธู. ุงู ููุถูุน ุชููุง ุฏุฑ ฺฉุงููพูุชุฑูุง ููฺฉู ุงุณุช ฺฉู ุจุด ุงุฒ ฺฉ **Processor Core (ูุณุชู ูพุฑุฏุงุฒูุฏู)** ุฏุงุดุชู ุจุงุดูุฏ. ูุฑฺู ุชุนุฏุงุฏ ูุณุชูโูุง ุจุดุชุฑ ุจุงุดุฏุ ุชุนุฏุงุฏ ุจุดุชุฑ ุงุฒ Threadูุง ูโุชูุงููุฏ ุจูโุทูุฑ ููโุฒูุงู ุงุฌุฑุง ุดููุฏ. ๐ฅ๏ธ๐ก

ุฏุฑ ุทูู ุจุฑุฑุณ **Concurrency** ู **Threading** ุฏุฑ ุงู ูุตูุ ุจุง ูุดฺฉูุงุช ูุซู **Blocking (ุงูุณุฏุงุฏ)**ุ **Deadlock (ุจูโุจุณุช)** ู **Race Condition (ุดุฑุงุท ุฑูุงุจุช)** ุฑูุจูโุฑู ูโุดูู. ููฺูู ุงุฏ ูโฺฏุฑู ฺุทูุฑ ุจุง ุงุณุชูุงุฏู ุงุฒ ุงุตูู **Clean Code** ุงู ูุดฺฉูุงุช ุฑุง ุญู ฺฉูู. โ

---

### โจ ูุจุงุญุซ ฺฉู ุฏุฑ ุงู ูุตู ูพูุดุด ุฏุงุฏู ุฎูุงููุฏ ุดุฏ

1. ุฏุฑฺฉ **ฺุฑุฎู ุญุงุช Thread**
2. ุงูุฒูุฏู **ูพุงุฑุงูุชุฑ ุจู Thread**
3. ุงุณุชูุงุฏู ุงุฒ **Thread Pool**
4. ุงุณุชูุงุฏู ุงุฒ **Mutual Exclusion Object** ุจุง Threadูุง ููฺฏุงู (Synchronous)
5. ฺฉุงุฑ ุจุง Threadูุง ููุงุฒ ุจุง ุงุณุชูุงุฏู ุงุฒ **Semaphore**
6. ูุญุฏูุฏ ฺฉุฑุฏู ุชุนุฏุงุฏ **ูพุฑุฏุงุฒูุฏูโูุง ู Threadูุง** ุฏุฑ **Thread Pool**
7. ุฌููฺฏุฑ ุงุฒ **Deadlock**
8. ุฌููฺฏุฑ ุงุฒ **Race Condition**
9. ุฏุฑฺฉ **Static Constructorูุง ู Methodูุง**
10. ุขุดูุง ุจุง **Mutability (ูุงุจูุช ุชุบุฑูพุฐุฑ)**ุ **Immutability (ุชุบุฑูุงูพุฐุฑ)** ู **Thread Safety**
11. **Synchronized Method Dependencies**
12. ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณ **Interlocked** ุจุฑุง ุชุบุฑ ูุถุนุชโูุง ุณุงุฏู
13. ุชูุตูโูุง ุนููู ๐

---

### ๐ฏ ูพุณ ุงุฒ ูพุงุงู ุงู ูุตู ุดูุง ุชูุงูุงโูุง ุฒุฑ ุฑุง ฺฉุณุจ ุฎูุงูุฏ ฺฉุฑุฏ

* ุฏุฑฺฉ ู ุชูุถุญ **ฺุฑุฎู ุญุงุช Thread**
* ุขุดูุง ุจุง **Foreground Thread** ู **Background Thread** ู ุชูุงูุง ุงุณุชูุงุฏู ุงุฒ ุขูโูุง
* ูุฏุฑุช ู ฺฉูุชุฑู ุณุฑุนุช ุงุฌุฑุง Threadูุง (**Throttle**) ู ุชุนู ุชุนุฏุงุฏ ูพุฑุฏุงุฒูุฏูโูุง ููโุฒูุงู ุจุง ุงุณุชูุงุฏู ุงุฒ **Thread Pool**
* ุฏุฑฺฉ ุงุซุฑ **Static Constructorูุง** ู **Methodูุง** ุฏุฑ ุงุฑุชุจุงุท ุจุง **Multi-Threading** ู **Concurrency**
* ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุชุฃุซุฑ **Mutability** ู **Immutability** ุจุฑ **Thread Safety**
* ุฏุฑฺฉ ุนูุช ุจุฑูุฒ **Race Condition** ู ุฑูุดโูุง ุฌููฺฏุฑ ุงุฒ ุขู
* ุฏุฑฺฉ ุนูุช ูููุน **Deadlock** ู ุฑุงูโูุง ูพุดฺฏุฑ ุงุฒ ุขู
* ุชูุงูุง ุงูุฌุงู ุชุบุฑุงุช ุณุงุฏู ุฏุฑ ูุถุนุชโูุง ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณ **Interlocked**

---

### โก ูพุดโูุงุฒ ุงุฌุฑุง ฺฉุฏูุง ุงู ูุตู

ุจุฑุง ุงุฌุฑุง ฺฉุฏูุง ุงู ูุตู ุจู ฺฉ **.NET Framework Console Application** ูุงุฒ ุฏุงุฑุฏ.
ูฺฏุฑ ุฏุฑ ููุงูุน ฺฉู ุจูโุทูุฑ ุฎุงุต ุฐฺฉุฑ ุดุฏู ุจุงุดุฏุ ุชูุงู ฺฉุฏูุง ุฏุฑูู ฺฉูุงุณ **Program** ูุฑุงุฑ ุฎูุงููุฏ ฺฏุฑูุช. ๐๏ธ

### ๐ ุฏุฑฺฉ **ฺุฑุฎูโ ุญุงุช Thread**

ุฏุฑ ุฒุจุงู **C#**ุ ูุฑ **Thread** (ุฑุดุชูโ ุงุฌุฑุง) ุฏุงุฑุง ฺฉ **ฺุฑุฎูโ ุญุงุช** ูุดุฎุต ุงุณุช.
ุงู ฺุฑุฎูุ ูุฑุงุญู ุฑุง ูุดุงู ูโุฏูุฏ ฺฉู ฺฉ Thread ุงุฒ ุฒูุงู ุงุฌุงุฏ ุดุฏู ุชุง ูพุงุงู ฺฉุงุฑุด ุท ูโฺฉูุฏ.

ฺุฑุฎูโ ุญุงุช Thread ุจู ุตูุฑุช ุฒุฑ ุงุณุช: ๐งฉ

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-1.jpeg)
</div>

ููุช ฺฉ **Thread (ุฑุดุชู)** ุดุฑูุน ุจู ฺฉุงุฑ ูโฺฉูุฏุ ูุงุฑุฏ ุญุงูุช **Running (ุฏุฑ ุญุงู ุงุฌุฑุง)** ูโุดูุฏ. ุฏุฑ ุงู ุญุงูุชุ ุฑุดุชู ูโุชูุงูุฏ ูุงุฑุฏ ุญุงูุชโูุง **Wait (ุงูุชุธุงุฑ)**ุ **Sleep (ุฎูุงุจ)**ุ **Join (ูพูุณุชู)**ุ **Stop (ุชููู)** ุง **Suspended (ูุนูู)** ุดูุฏ. ููฺูู ุฑุดุชูโูุง ูโุชูุงููุฏ **Aborted (ูุชูููโุดุฏู)** ุดููุฏ. ุฑุดุชูโูุง ูุชูููโุดุฏู ูุงุฑุฏ ุญุงูุช **Stop** ูโุดููุฏ. ุดูุง ูโุชูุงูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ูุชุฏูุง **Suspend()** ู **Resume()** ฺฉ ุฑุดุชู ุฑุง ุจู ุชุฑุชุจ ูุนูู ฺฉุฑุฏู ู ุฏูุจุงุฑู ุงุฏุงูู ุฏูุฏ.

ฺฉ ุฑุดุชู ุฒูุงู ูุงุฑุฏ ุญุงูุช **Wait** ูโุดูุฏ ฺฉู ูุชุฏ **Monitor.Wait(object obj)** ูุฑุงุฎูุงู ุดูุฏ. ุณูพุณ ุงู ุฑุดุชู ุฒูุงู ุงุฏุงูู ูพุฏุง ูโฺฉูุฏ ฺฉู ูุชุฏ **Monitor.Pulse(object obj)** ูุฑุงุฎูุงู ุดูุฏ.
ุฑุดุชูโูุง ุจุง ูุฑุงุฎูุงู ูุชุฏ **Thread.Sleep(int millisecondsTimeout)** ุจู ุญุงูุช ุฎูุงุจ ูโุฑููุฏ. ูพุณ ุงุฒ ฺฏุฐุดุช ุฒูุงู ูุดุฎุตโุดุฏูุ ุฑุดุชู ุฏูุจุงุฑู ุจู ุญุงูุช ุงุฌุฑุง ุจุงุฒูโฺฏุฑุฏุฏ.

ูุชุฏ **Thread.Join()** ุจุงุนุซ ูโุดูุฏ ฺฉ ุฑุดุชู ูุงุฑุฏ ุญุงูุช ุงูุชุธุงุฑ ุดูุฏ. ุฑุดุชูโุง ฺฉู Join ุดุฏู ุงุณุช ุฏุฑ ุญุงูุช ุงูุชุธุงุฑ ุจุงู ูโูุงูุฏ ุชุง ุชูุงู ุฑุดุชูโูุง ูุงุจุณุชู ุจู ุขู ุงุฌุฑุง ุดููุฏ ู ุณูพุณ ุจู ุญุงูุช ุงุฌุฑุง ุจุงุฒูโฺฏุฑุฏุฏ. ุจุง ุงู ุญุงูุ ุงฺฏุฑ ูุฑ ฺฉ ุงุฒ ุฑุดุชูโูุง ูุงุจุณุชู ูุชููู ุดููุฏ (**Aborted**)ุ ุงู ุฑุดุชู ูู ูุชููู ุดุฏู ู ูุงุฑุฏ ุญุงูุช **Stop** ูโุดูุฏ.
ุฑุดุชูโูุง ฺฉู ฺฉุงูู ุงุฌุฑุง ุดุฏูโุงูุฏ ุง ูุชููู ุดุฏูโุงูุฏุ ุฏฺฏุฑ ูุงุจู ุดุฑูุน ูุฌุฏุฏ ูุณุชูุฏ.

ุฑุดุชูโูุง ูโุชูุงููุฏ ุฏุฑ **Foreground (ูพุดโุฒููู)** ุง **Background (ูพุณโุฒููู)** ุงุฌุฑุง ุดููุฏ. ุจุงุฏ ุจุง ุฑุดุชูโูุง ูพุดโุฒููู ุดุฑูุน ฺฉูู:

### ๐ต ุฑุดุชูโูุง ูพุดโุฒููู (Foreground Threads)

ุจูโุตูุฑุช ูพุดโูุฑุถุ ุฑุดุชูโูุง ุฏุฑ ูพุดโุฒููู ุงุฌุฑุง ูโุดููุฏ. ฺฉ **Process (ูุฑุขูุฏ)** ุฒูุงู ฺฉู ุญุฏุงูู ฺฉ ุฑุดุชู ูพุดโุฒููู ุฏุฑ ุญุงู ุงุฌุฑุง ุจุงุดุฏุ ููฺูุงู ูุนุงู ุจุงู ูโูุงูุฏ. ุญุช ุงฺฏุฑ ูุชุฏ **Main()** ุชูุงู ุดูุฏ ุงูุง ูููุฒ ฺฉ ุฑุดุชู ูพุดโุฒููู ุฏุฑ ุญุงู ุงุฌุฑุง ุจุงุดุฏุ ูุฑุขูุฏ ุจุฑูุงูู ุชุง ูพุงุงู ฺฉุงุฑ ุขู ุฑุดุชู ูุนุงู ุฎูุงูุฏ ูุงูุฏ. ุงุฌุงุฏ ฺฉ ุฑุดุชู ูพุดโุฒููู ุจุณุงุฑ ุณุงุฏู ุงุณุชุ ููุงูโุทูุฑ ฺฉู ุฏุฑ ฺฉุฏ ุฒุฑ ูโุจูุฏ:

```csharp
var foregroundThread = new Thread(SomeMethodName);
foregroundThread.Start();
```

### ๐ข ุฑุดุชูโูุง ูพุณโุฒููู (Background Threads)

ุงุฌุงุฏ ุฑุดุชู ูพุณโุฒููู ูุดุงุจู ุฑุดุชูโูุง ูพุดโุฒููู ุงุณุชุ ุจุง ุงู ุชูุงูุช ฺฉู ุดูุง ุจุงุฏ ุจูโุตูุฑุช ุตุฑุญ ูุดุฎุต ฺฉูุฏ ฺฉู ุฑุดุชู ุฏุฑ ูพุณโุฒููู ุงุฌุฑุง ุดูุฏุ ููุงูโุทูุฑ ฺฉู ุฏุฑ ูุซุงู ุฒุฑ ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช:

```csharp
var backgroundThread = new Thread(SomeMethodName);
backgroundThread.IsBackground = true;
backgroundThread.Start();
```

ุฑุดุชูโูุง ูพุณโุฒููู ุจุฑุง ุงูุฌุงู ฺฉุงุฑูุง ุฌุงูุจ ู ุญูุธ **ูุงฺฉูุดโูพุฐุฑ ุฑุงุจุท ฺฉุงุฑุจุฑ** ุงุณุชูุงุฏู ูโุดููุฏ. ุฒูุงู ฺฉู ูุฑุขูุฏ ุงุตู ูพุงุงู ุงุจุฏุ ูุฑ ุฑุดุชู ูพุณโุฒูููโุง ฺฉู ุฏุฑ ุญุงู ุงุฌุฑุง ุจุงุดุฏ ูุฒ ุฎุงุชูู ูพุฏุง ูโฺฉูุฏ. ุงูุง ุญุช ุงฺฏุฑ ูุฑุขูุฏ ุงุตู ูพุงุงู ุงุจุฏุ ุฑุดุชูโูุง ูพุดโุฒูููโุง ฺฉู ุฏุฑ ุญุงู ุงุฌุฑุง ูุณุชูุฏุ ุชุง ุฒูุงู ฺฉุงูู ุดุฏูุดุงู ุงุฌุฑุง ุฎูุงููุฏ ุดุฏ.

---

### โ ุงูุฒูุฏู ูพุงุฑุงูุชุฑ ุจู ุฑุดุชูโูุง (Adding Thread Parameters)

ุฑูุดโูุง ฺฉู ุฏุฑ ุฑุดุชูโูุง ุงุฌุฑุง ูโุดููุฏ ูุนูููุงู ูพุงุฑุงูุชุฑ ุฏุงุฑูุฏ. ุจูุงุจุฑุงู ููฺฏุงู ุงุฌุฑุง ฺฉ ูุชุฏ ุฏุฑูู ฺฉ ุฑุดุชูุ ุจุงุฏ ุจุฏุงูู ฺฺฏููู ูพุงุฑุงูุชุฑูุง ุขู ูุชุฏ ุฑุง ุจู ุฑุดุชู ุงุฑุณุงู ฺฉูู.

ูุฑุถ ฺฉูุฏ ูุชุฏ ุฒุฑ ุฑุง ุฏุงุฑู ฺฉู ุฏู ุนุฏุฏ ุตุญุญ (**int**) ุฑุง ุจุง ูู ุฌูุน ฺฉุฑุฏู ู ูุชุฌู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ:

```csharp
private static int Add(int a, int b)
{
    return a + b;
}
```

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ุงู ูุชุฏ ุณุงุฏู ุงุณุช. ุฏู ูพุงุฑุงูุชุฑ ุจู ูุงูโูุง **a** ู **b** ุฏุงุฑุฏ. ุงู ุฏู ูพุงุฑุงูุชุฑ ุจุงุฏ ุจู ุฑุดุชู ุงุฑุณุงู ุดููุฏ ุชุง ูุชุฏ **Add()** ุจูโุฏุฑุณุช ุงุฌุฑุง ุดูุฏ.

ุฏุฑ ุงุฏุงูู ฺฉ ูุชุฏ ููููู ุงุถุงูู ูโฺฉูู ฺฉู ููู ฺฉุงุฑ ุฑุง ุงูุฌุงู ูโุฏูุฏ:

```csharp
private static void ThreadParametersExample()
{
    int result = 0;
    Thread thread = new Thread(() => { result = Add(1, 2); });
    thread.Start();
    thread.Join();
    Message($"The addition of 1 plus 2 is {result}.");
}
```

ุฏุฑ ุงู ูุชุฏุ ุงุจุชุฏุง ฺฉ ูุชุบุฑ **int** ุจุง ููุฏุงุฑ ุงููู 0 ุชุนุฑู ูโฺฉูู. ุณูพุณ ฺฉ ุฑุดุชู ุฌุฏุฏ ุงุฌุงุฏ ูโฺฉูู ฺฉู ูุชุฏ **Add()** ุฑุง ุจุง ููุงุฏุฑ **1** ู **2** ูุฑุงุฎูุงู ฺฉุฑุฏู ู ูุชุฌู ุฑุง ุฏุฑ ูุชุบุฑ ุฐุฎุฑู ูโฺฉูุฏ. ุฑุดุชู ุฑุง ุงุฌุฑุง ูโฺฉูู ู ุจุง ูุชุฏ **Join()** ููุชุธุฑ ูโูุงูู ุชุง ุงุฌุฑุง ุฑุดุชู ุชูุงู ุดูุฏ. ุฏุฑ ููุงุชุ ูุชุฌู ุฑุง ุฏุฑ ูพูุฌุฑู **Console** ฺุงูพ ูโฺฉูู.

ุจุฑุง ุงู ฺฉุงุฑุ ูุชุฏ **Message()** ุฑุง ุงุถุงูู ูโฺฉูู:

```csharp
internal static void Message(string message)
{
    Console.WriteLine(message);
}
```

ูุชุฏ **Message()** ฺฉ ุฑุดุชู ูุชู ุฑุง ุฏุฑุงูุช ฺฉุฑุฏู ู ุฏุฑ ูพูุฌุฑู ฺฉูุณูู ููุงุด ูโุฏูุฏ. ุญุงูุง ฺฉุงู ุงุณุช ูุชุฏ **Main()** ุฑุง ุจูโุฑูุฒุฑุณุงู ฺฉูู:

```csharp
static void Main(string[] args)
{
    ThreadParametersExample();
    Message("=== Press any Key to exit ===");
    Console.ReadKey();
}
```

ุฏุฑ ูุชุฏ **Main()**ุ ุงุจุชุฏุง ูุชุฏ ููููู ุฎูุฏ ุฑุง ูุฑุงุฎูุงู ูโฺฉูู ู ุณูพุณ ููุชุธุฑ ูโูุงูู ุชุง ฺฉุงุฑุจุฑ ฺฉูุฏ ุฑุง ูุดุงุฑ ุฏูุฏ ุชุง ุจุฑูุงูู ุจุณุชู ุดูุฏ. ุฎุฑูุฌ ฺฉู ุจุงุฏ ูุดุงูุฏู ฺฉูุฏ ุจูโุตูุฑุช ุฒุฑ ุฎูุงูุฏ ุจูุฏ: ๐
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-2.jpeg)
</div>

ููุงูโุทูุฑ ฺฉู ูุดุงูุฏู ฺฉุฑุฏุฏุ ุงุนุฏุงุฏ **1** ู **2** ูพุงุฑุงูุชุฑูุง ูุชุฏ ุจูุฏูุฏ ฺฉู ุจู ูุชุฏ ุฌูุน ุงุฑุณุงู ุดุฏูุฏ ู ููุฏุงุฑ **3** ุฎุฑูุฌโุง ุจูุฏ ฺฉู ุฑุดุชู ุจุฑฺฏุฑุฏุงูุฏ.

---

## ๐ ุงุณุชูุงุฏู ุงุฒ **Thread Pool (ุงุณุชุฎุฑ ุฑุดุชู)**

ฺฉ **Thread Pool** ุจุงุนุซ ุจูุจูุฏ ุนููฺฉุฑุฏ ุจุฑูุงูู ูโุดูุฏุ ฺูู ุฏุฑ ููฺฏุงู ุดุฑูุน ุจุฑูุงูู ูุฌููุนูโุง ุงุฒ ุฑุดุชูโูุง ุงุฌุงุฏ ูโฺฉูุฏ. ูุฑ ุฒูุงู ฺฉ ุฑุดุชู ูุงุฒ ุจุงุดุฏุ ฺฉ ุงุฒ ุฑุดุชูโูุง ููุฌูุฏ ุฏุฑ ุงุณุชุฎุฑ ุจุฑุง ุงูุฌุงู ฺฉ ฺฉุงุฑ ุงุฎุชุตุงุต ุฏุงุฏู ูโุดูุฏ. ูพุณ ุงุฒ ุงูุฌุงู ุขู ฺฉุงุฑุ ุฑุดุชู ุฏูุจุงุฑู ุจู ุงุณุชุฎุฑ ุจุฑฺฏุฑุฏุงูุฏู ุดุฏู ู ูุงุจู ุงุณุชูุงุฏู ูุฌุฏุฏ ุฎูุงูุฏ ุจูุฏ.

ุงุฒ ุขูุฌุง ฺฉู ุงุฌุงุฏ ุฑุดุชู ุฏุฑ **.NET** ูุฒููโุจุฑ ุงุณุชุ ูโุชูุงู ุจุง ุงุณุชูุงุฏู ุงุฒ **Thread Pool** ุนููฺฉุฑุฏ ุฑุง ุจูุจูุฏ ุจุฎุดุฏ. ูุฑ ูุฑุขูุฏ ุฏุงุฑุง ุชุนุฏุงุฏ ูุดุฎุต ุฑุดุชู ุงุณุช ฺฉู ุจุฑุงุณุงุณ ููุงุจุน ุณุณุชู (ูุซู ุญุงูุธู ู CPU) ุชุนู ูโุดูุฏ. ุงูุจุชู ูโุชูุงู ุชุนุฏุงุฏ ุฑุดุชูโูุง ุงุณุชูุงุฏูโุดุฏู ุฏุฑ ุงุณุชุฎุฑ ุฑุง ฺฉู ุง ุฒุงุฏ ฺฉุฑุฏุ ุงูุง ูุนูููุงู ุจูุชุฑ ุงุณุช ุงู ูุฏุฑุช ุฑุง ุจู ุฎูุฏ ุงุณุชุฎุฑ ุจุณูพุงุฑู ู ุจูโุตูุฑุช ุฏุณุช ุชูุธูุงุช ุงูุฌุงู ูุฏูู.

ุฑูุดโูุง ูุฎุชูู ุจุฑุง ุงุฌุงุฏ ฺฉ **Thread Pool** ุนุจุงุฑุชโุงูุฏ ุงุฒ:

* ุงุณุชูุงุฏู ุงุฒ **Task Parallel Library (TPL)** (ุฏุฑ **.NET Framework 4.0** ู ุจุงูุงุชุฑ)
* ุงุณุชูุงุฏู ุงุฒ **ThreadPool.QueueUserWorkItem()**
* ุงุณุชูุงุฏู ุงุฒ **Asynchronous Delegates (ููุงูุฏูโูุง ูุงููุฒูุงู)**
* ุงุณุชูุงุฏู ุงุฒ **BackgroundWorker**

> **ูฺฉุชู ููู:** ุจูโุทูุฑ ฺฉูุ **Thread Pool** ูุนูููุงู ุจุฑุง ุจุฑูุงููโูุง **Server-side (ุณูุช ุณุฑูุฑ)** ุงุณุชูุงุฏู ูโุดูุฏ. ุจุฑุง ุจุฑูุงููโูุง **Client-side (ุณูุช ฺฉุงุฑุจุฑ)**ุ ุจูุชุฑ ุงุณุช ุงุฒ ุฑุดุชูโูุง **Foreground** ู **Background** ุจุณุชู ุจู ูุงุฒ ุงุณุชูุงุฏู ฺฉูุฏ.

ุฏุฑ ุงู ฺฉุชุงุจุ ูุง ููุท ุจู **TPL** ู ูุชุฏ **QueueUserWorkItem()** ูโูพุฑุฏุงุฒู. ุจุฑุง ุงุฏฺฏุฑ ุฑูุดโูุง ุฏฺฏุฑ ูโุชูุงูุฏ ุจู ููฺฉ ุฒุฑ ูุฑุงุฌุนู ฺฉูุฏ:
[http://www.albahari.com/threading/](http://www.albahari.com/threading/)

---

## โก ฺฉุชุงุจุฎุงูู **Task Parallel Library (TPL)**

ุฏุฑ C#ุ ฺฉ ุนููุงุช ูุงููุฒูุงู ุชูุณุท ฺฉ **Task (ูุธูู)** ููุงุด ุฏุงุฏู ูโุดูุฏ. ูุฑ **Task** ุฏุฑ C# ุชูุณุท ฺฉูุงุณ **Task** ุฏุฑ **TPL** ููุงุด ุฏุงุฏู ูโุดูุฏ. ููุงูโุทูุฑ ฺฉู ุงุฒ ูุงูุด ูพุฏุงุณุชุ **Task Parallelism** ุงูฺฉุงู ุงุฌุฑุง ููโุฒูุงู ฺูุฏ **Task** ุฑุง ูุฑุงูู ูโฺฉูุฏ ฺฉู ุฏุฑ ุจุฎุดโูุง ุจุนุฏ ุฏุฑุจุงุฑู ุขู ุงุฏ ูโฺฏุฑู.

ุงููู ูุชุฏ ฺฉู ุงุฒ ฺฉูุงุณ **Parallel** ุจุฑุฑุณ ูโฺฉููุ ูุชุฏ **Invoke()** ุงุณุช.

---

### ๐ **Parallel.Invoke()**

ุฏุฑ ุงููู ูุซุงูุ ุณู ูุชุฏ ูุฎุชูู ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ **Parallel.Invoke()** ูุฑุงุฎูุงู ูโฺฉูู. ุณู ูุชุฏ ุฒุฑ ุฑุง ุงุถุงูู ฺฉูุฏ:

```csharp
private static void MethodOne()
{
    Message($"MethodOne Executed: Thread Id({Thread.CurrentThread.ManagedThreadId})");
}

private static void MethodTwo()
{
    Message($"MethodTwo Executed: Thread Id({Thread.CurrentThread.ManagedThreadId})");
}

private static void MethodThree()
{
    Message($"MethodThree Executed: Thread Id({Thread.CurrentThread.ManagedThreadId})");
}
```

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ุงู ุณู ูุชุฏ ุชูุฑุจุงู ูุดุงุจู ูุณุชูุฏ ู ุชููุง ูุงูโูุง ู ูพุงู ฺุงูพโุดุฏู ุฏุฑ ฺฉูุณูู ูุชูุงูุช ุงุณุช ฺฉู ุชูุณุท ูุชุฏ **Message()** (ฺฉู ูุจูุงู ููุดุชู) ููุงุด ุฏุงุฏู ูโุดูุฏ.

ุญุงูุง ูุชุฏ **UsingTaskParallelLibrary()** ุฑุง ุงุถุงูู ูโฺฉูู ุชุง ุงู ุณู ูุชุฏ ุฑุง ุจูโุตูุฑุช ููุงุฒ ุงุฌุฑุง ฺฉูู:

```csharp
private static void UsingTaskParallelLibrary()
{
    Message($"UsingTaskParallelLibrary Started: Thread Id = ({Thread.CurrentThread.ManagedThreadId})");
    Parallel.Invoke(MethodOne, MethodTwo, MethodThree);
    Message("UsingTaskParallelLibrary Completed.");
}
```

ุฏุฑ ุงู ูุชุฏุ ุงุจุชุฏุง ูพุงู ุฏุฑ ูพูุฌุฑู **Console** ฺุงูพ ูโฺฉูู ุชุง ูุดุงู ุฏูุฏ ุดุฑูุน ูุชุฏ ุขุบุงุฒ ุดุฏู ุงุณุช. ุณูพุณ ูุชุฏูุง **MethodOne**ุ **MethodTwo** ู **MethodThree** ุฑุง ุจูโุตูุฑุช ููุงุฒ ุงุฌุฑุง ูโฺฉูู. ูพุณ ุงุฒ ุขูุ ูพุงู ุฏุฑ **Console** ฺุงูพ ูโฺฉูู ุชุง ูุดุฎุต ุดูุฏ ูุชุฏ ุจู ุงูุชูุง ุงุฌุฑุง ุฎูุฏ ุฑุณุฏู ุงุณุช ู ุณูพุณ ููุชุธุฑ ูโูุงูู ุชุง ฺฉุงุฑุจุฑ ฺฉูุฏ ุฑุง ูุดุงุฑ ุฏูุฏ ู ุฏุฑ ููุงุช ูุชุฏ ุฎุงุชูู ูพุฏุง ฺฉูุฏ.

ฺฉุฏ ุฑุง ุงุฌุฑุง ฺฉูุฏ ู ุจุงุฏ ุฎุฑูุฌ ุฒุฑ ุฑุง ูุดุงูุฏู ฺฉูุฏ: ๐
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-3.jpeg)
</div>

ุฏุฑ ุชุตูุฑ ูุจูุ ูุดุงูุฏู ูโฺฉูุฏ ฺฉู **ุฑุดุชู ุดูุงุฑู 1** ุฏูุจุงุฑู ุงุณุชูุงุฏู ุดุฏู ุงุณุช. ุญุงูุง ุจุงุฏ ุจู ุณุฑุงุบ ุญููู **Parallel.For()** ุจุฑูู.

---

## ๐ **Parallel.For()**

ุฏุฑ ูุซุงู ุจุนุฏ ูุฑุจูุท ุจู **TPL**ุ ุจู ฺฉ ุญููู ุณุงุฏู **Parallel.For()** ูฺฏุงู ูโฺฉูู. ูุชุฏ ุฒุฑ ุฑุง ุจู ฺฉูุงุณ **Program** ุฏุฑ ฺฉ ุจุฑูุงูู **Console** ุฌุฏุฏ ุจุง **.NET Framework** ุงุถุงูู ฺฉูุฏ:

```csharp
private static void Method()
{
    Message($"Method Executed: Thread Id({Thread.CurrentThread.ManagedThreadId})");
}
```

ุงู ูุชุฏ ุชููุง ฺฉ ุฑุดุชู ูุชู ุฑุง ุฏุฑ ูพูุฌุฑู **Console** ฺุงูพ ูโฺฉูุฏ.

ุญุงูุง ูุชุฏ ุงุฌุงุฏ ูโฺฉูู ฺฉู ุญููู **Parallel.For()** ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```csharp
private static void UsingTaskParallelLibraryFor()
{
    Message($"UsingTaskParallelLibraryFor Started: Thread Id = ({Thread.CurrentThread.ManagedThreadId})");
    Parallel.For(0, 1000, X => Method());
    Message("UsingTaskParallelLibraryFor Completed.");
}
```

ุฏุฑ ุงู ูุชุฏุ ุงุฒ ุนุฏุฏ **0 ุชุง 1000** ุญููู ูโุฒูู ู ุฏุฑ ูุฑ ุชฺฉุฑุงุฑุ ูุชุฏ **Method()** ุฑุง ูุฑุงุฎูุงู ูโฺฉูู. ุฏุฑ ุทูู ุงุฌุฑุง ุงู ุญูููุ ุฎูุงูุฏ ุฏุฏ ฺฉู ุฑุดุชูโูุง ุฏุฑ ูุฑุงุฎูุงูโูุง ูุฎุชูู ุฏูุจุงุฑู ุงุณุชูุงุฏู ูโุดููุฏุ ููุงูโุทูุฑ ฺฉู ุฏุฑ ุชุตูุฑ ุฒุฑ ูุดุฎุต ุงุณุช: ๐
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-4.jpeg)
</div>

ุญุงูุง ูโุฎูุงูู ุจู ุณุฑุงุบ ุงุณุชูุงุฏู ุงุฒ ูุชุฏ **ThreadPool.QueueUserWorkItem()** ุจุฑูู.

---

## ๐งต **ThreadPool.QueueUserWorkItem()**

ูุชุฏ **ThreadPool.QueueUserWorkItem()** ฺฉ ูุชุฏ **WaitCallback** ุฑุง ุฏุฑุงูุช ฺฉุฑุฏู ู ุขู ุฑุง ุจุฑุง ุงุฌุฑุง ุฏุฑ ุตู ูุฑุงุฑ ูโุฏูุฏ.
**WaitCallback** ฺฉ **Delegate (ููุงูุฏู)** ุงุณุช ฺฉู ูุดุงูโุฏููุฏู ูุชุฏ ุงุณุช ฺฉู ุจุงุฏ ุชูุณุท ฺฉ ุฑุดุชู ุฏุฑ **Thread Pool** ุงุฌุฑุง ุดูุฏ. ููุช ฺฉ ุฑุดุชู ุขุฒุงุฏ ุดูุฏุ ุงู ูุชุฏ ุงุฌุฑุง ุฎูุงูุฏ ุดุฏ.

ุจุงุฏ ฺฉ ูุซุงู ุณุงุฏู ุงุถุงูู ฺฉูู. ุงุจุชุฏุง ูุชุฏ ุฒุฑ ุฑุง ุชุนุฑู ูโฺฉูู:

```csharp
private static void WaitCallbackMethod(Object _)
{
    Message("Hello from WaitCallBackMethod!");
}
```

ุงู ูุชุฏ ฺฉ ูพุงุฑุงูุชุฑ ุงุฒ ููุน **Object** ุฏุฑุงูุช ูโฺฉูุฏุ ุงูุง ฺูู ุงุฒ ุขู ุงุณุชูุงุฏู ููโฺฉููุ ุงุฒ ูุชุบุฑ **discard (\_)** ุงุณุชูุงุฏู ุดุฏู ุงุณุช. ุณูพุณ ูพุงู ุฏุฑ ูพูุฌุฑู **Console** ฺุงูพ ูโุดูุฏ.

ุญุงูุง ฺฉุฏ ูุฑุงุฎูุงู ุงู ูุชุฏ ุฑุง ุงุถุงูู ูโฺฉูู:

```csharp
private static void ThreadPoolQueueUserWorkItem()
{
    ThreadPool.QueueUserWorkItem(WaitCallbackMethod);
    Message("Main thread does some work, then sleeps.");
    Thread.Sleep(1000);
    Message("Main thread exits.");
}
```

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ุงุฒ ฺฉูุงุณ **ThreadPool** ุจุฑุง ูุฑุงุฑ ุฏุงุฏู **WaitCallbackMethod()** ุฏุฑ ุตู **Thread Pool** ุงุณุชูุงุฏู ฺฉุฑุฏู. ุณูพุณ ุฑุดุชู ุงุตู (Main thread) ฺฉู ฺฉุงุฑ ุงูุฌุงู ุฏุงุฏู ู ุจู ุฎูุงุจ ูโุฑูุฏ. ุฏุฑ ุงู ุฒูุงูุ ฺฉ ุฑุดุชู ุขุฒุงุฏ ุงุฒ ุงุณุชุฎุฑ ุฑุดุชูโูุง ุงูุชุฎุงุจ ุดุฏู ู ูุชุฏ **WaitCallbackMethod()** ุงุฌุฑุง ูโุดูุฏ. ุณูพุณ ุฑุดุชู ุจู ุงุณุชุฎุฑ ุจุฑฺฏุฑุฏุงูุฏู ุดุฏู ู ูุงุจู ุงุณุชูุงุฏู ูุฌุฏุฏ ุฎูุงูุฏ ุจูุฏ. ุงุฌุฑุง ุจุฑูุงูู ุจู ุฑุดุชู ุงุตู ุจุงุฒูโฺฏุฑุฏุฏ ู ุฏุฑ ููุงุช ุจุฑูุงูู ุฎุงุชูู ูพุฏุง ูโฺฉูุฏ.

---

## ๐ ุงุณุชูุงุฏู ุงุฒ **Mutex** ุจุง ุฑุดุชูโูุง ููุฒูุงู

ุฏุฑ ุจุฎุด ุจุนุฏุ ุจู ุณุฑุงุบ **Mutex (ุดุก ูููโฺฉููุฏู)** ูโุฑูู.

ุฏุฑ C#ุ ฺฉ **Mutex** ฺฉ ุดุก ูููโฺฉููุฏู ุฑุดุชู ุงุณุช ฺฉู ูโุชูุงูุฏ ุจู ฺูุฏู ูุฑุขูุฏ ฺฉุงุฑ ฺฉูุฏ. ุชููุง ูุฑุขูุฏ ฺฉู ุฏุฑุฎูุงุณุช ุง ุขุฒุงุฏุณุงุฒ ฺฉ ููุจุน ุฑุง ุฏุงุฑุฏุ ูโุชูุงูุฏ **Mutex** ุฑุง ุชุบุฑ ุฏูุฏ. ุฒูุงู ฺฉู ฺฉ **Mutex** ููู ุดูุฏุ ุจูู ูุฑุขูุฏูุง ุจุงุฏ ุฏุฑ ุตู ููุชุธุฑ ุจูุงููุฏ. ููุช ููู ุขุฒุงุฏ ุดุฏุ ุจูู ูโุชูุงููุฏ ุจู ููุจุน ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏ. ฺูุฏู ุฑุดุชู ูโุชูุงููุฏ ุงุฒ ฺฉ **Mutex** ุงุณุชูุงุฏู ฺฉููุฏุ ุงูุง ููุท ุจูโุตูุฑุช **ููุฒูุงูโุณุงุฒ ุดุฏู (Synchronous)**.

### ูุฒุงุง ุงุณุชูุงุฏู ุงุฒ Mutex

* **Mutex** ฺฉ ููู ุณุงุฏู ุงุณุช ฺฉู ูุจู ุงุฒ ูุฑูุฏ ุจู ุจุฎุด ุญุณุงุณ ุงุฒ ฺฉุฏ ฺฏุฑูุชู ูโุดูุฏ ู ููฺฏุงู ุฎุฑูุฌ ุงุฒ ุขู ุขุฒุงุฏ ูโุดูุฏ.
* ฺูู ุฏุฑ ูุฑ ูุญุธู ุชููุง ฺฉ ุฑุดุชู ูุงุฑุฏ ุจุฎุด ุญุณุงุณ ูโุดูุฏุ ุฏุงุฏูโูุง ุฏุฑ ุญุงูุช ุณุงุฒฺฏุงุฑ ุจุงู ูโูุงููุฏ ู **Race Condition (ุชุฏุงุฎู ุฏุงุฏูโูุง)** ุฑุฎ ููโุฏูุฏ.

### ูุนุงุจ ุงุณุชูุงุฏู ุงุฒ Mutex

* **Starvation (ฺฏุฑุณูฺฏ ุฑุดุชู)**: ุงฺฏุฑ ุฑุดุชูโุง ููู ุฑุง ุฏุฑ ุงุฎุชุงุฑ ุฏุงุดุชู ุจุงุดุฏ ู ุจู ุฎูุงุจ ุจุฑูุฏ ุง ูุชููู ุดูุฏุ ุฑุดุชูโูุง ุฏฺฏุฑ ููโุชูุงููุฏ ุงุฏุงูู ุฏููุฏ.
* ููุช ฺฉ **Mutex** ููู ุดุฏู ุงุณุชุ ููุท ููุงู ุฑุดุชูโุง ฺฉู ููู ุฑุง ฺฏุฑูุชู ูโุชูุงูุฏ ุขู ุฑุง ุขุฒุงุฏ ฺฉูุฏ. ูฺ ุฑุดุชู ุฏฺฏุฑ ููโุชูุงูุฏ ููู ุฑุง ุจฺฏุฑุฏ ุง ุขุฒุงุฏ ฺฉูุฏ.
* ุฏุฑ ูุฑ ูุญุธู ููุท ฺฉ ุฑุดุชู ุงุฌุงุฒู ูุฑูุฏ ุจู ุจุฎุด ุญุณุงุณ ุฑุง ุฏุงุฑุฏ. ุงู ููุถูุน ูโุชูุงูุฏ ุจุงุนุซ ูุฏุฑ ุฑูุช ุฒูุงู **CPU** ุดูุฏุ ุฒุฑุง ูพุงุฏูโุณุงุฒ Mutex ููฺฉู ุงุณุช ุจู ุญุงูุช **Busy Waiting (ุงูุชุธุงุฑ ูุนุงู)** ููุฌุฑ ุดูุฏ.

---

### โ๏ธ ุจุฑูุงูู ููููู ุจุฑุง ุงุณุชูุงุฏู ุงุฒ Mutex

ุงุจุชุฏุง ุฏุฑ ุจุงูุง ฺฉูุงุณุ ูุชุบุฑ ุฒุฑ ุฑุง ุงุถุงูู ฺฉูุฏ:

```csharp
private static readonly Mutex _mutex = new Mutex();
```

ุฏุฑ ุงูุฌุงุ ฺฉ ุดุก ุงุจุชุฏุง ุจู ูุงู **\_mutex** ุชุนุฑู ฺฉุฑุฏูโุงู ฺฉู ุจุฑุง ููฺฏุงูโุณุงุฒ ุจู ูุฑุขูุฏูุง ุงุณุชูุงุฏู ุฎูุงูุฏ ุดุฏ.

ุญุงูุง ูุชุฏ ุจุฑุง ููุงุด ููฺฏุงูโุณุงุฒ ุฑุดุชูโูุง ุจุง ุงุณุชูุงุฏู ุงุฒ Mutex ุงุถุงูู ูโฺฉูู:

```csharp
private static void ThreadSynchronisationUsingMutex()
{
    try
    {
        _mutex.WaitOne();
        Message($"Domain Entered By: {Thread.CurrentThread.Name}");
        Thread.Sleep(500);
        Message($"Domain Left By: {Thread.CurrentThread.Name}");
    }
    finally
    {
        _mutex.ReleaseMutex();
    }
}
```

ุฏุฑ ุงู ูุชุฏุ ุฑุดุชู ุฌุงุฑ ุชุง ุฒูุงู ฺฉู **Wait Handle** (ุฏุณุชฺฏุฑู ุงูุชุธุงุฑ) ุณฺฏูุงู ุฏุฑุงูุช ฺฉูุฏุ ุจููฺฉู ูโุดูุฏ. ููุช ุณฺฏูุงู ุฏุงุฏู ุดูุฏุ ุฑุดุชู ุจุนุฏ ูโุชูุงูุฏ ูุงุฑุฏ ุดูุฏ. ูพุณ ุงุฒ ูพุงุงู ฺฉุงุฑุ ุณุงุฑ ุฑุดุชูโูุง ุงุฒ ุญุงูุช ุงูุชุธุงุฑ ุขุฒุงุฏ ุดุฏู ู ุงูฺฉุงู ุฏุณุชุฑุณ ุจู Mutex ุฑุง ุฎูุงููุฏ ุฏุงุดุช.

ูุชุฏ ุจุนุฏ ุจุฑุง ุงุฌุฑุง ููููู Mutex:

```csharp
private static void MutexExample()
{
    for (var i = 1; i <= 10; i++)
    {
        var thread = new Thread(ThreadSynchronisationUsingMutex)
        {
            Name = $"Mutex Example Thread: {i}"
        };
        thread.Start();
    }
}
```

ุฏุฑ ุงู ูุชุฏุ 10 ุฑุดุชู ุงุฌุงุฏ ฺฉุฑุฏู ู ุขูโูุง ุฑุง ุดุฑูุน ูโฺฉูู. ูุฑ ุฑุดุชู ูุชุฏ **ThreadSynchronisationUsingMutex()** ุฑุง ุงุฌุฑุง ูโฺฉูุฏ.

ุฏุฑ ููุงุชุ ูุชุฏ **Main()** ุฑุง ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ:

```csharp
static void Main(string[] args)
{
    SemaphoreExample();
    Console.ReadKey();
}
```

ูุชุฏ **Main()** ูููููโ ุงุณุชูุงุฏู ุงุฒ **Mutex** ูุง ุฑุง ุงุฌุฑุง ูโฺฉูุฏ. ุฎุฑูุฌ ุจุงุฏ ูุดุงุจู ุชุตูุฑ ุฒุฑ ุจุงุดุฏ: ๐

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-5.jpeg)
</div>

ูุซุงู ฺฉู ุงุฌุฑุง ฺฉุฑุฏู ููฺฉู ุงุณุช ูุฑ ุจุงุฑ ุงุนุฏุงุฏ ูุฎุชูู ุจุฑุง ุฑุดุชูโูุง ูุดุงู ุฏูุฏ. ุญุช ุงฺฏุฑ ุงุนุฏุงุฏ ูุดุงุจู ุจุงุดูุฏุ ููฺฉู ุงุณุช ุชุฑุชุจ ููุงุด ุขูโูุง ูุชูุงูุช ุจุงุดุฏ.

ุญุงูุง ฺฉู ุจุง **Mutex** ุขุดูุง ุดุฏูุ ุจุงุฏ ุจู **Semaphore (ุณููุงููุฑ)** ุจูพุฑุฏุงุฒู.

---

## ๐ก ฺฉุงุฑ ุจุง ุฑุดุชูโูุง ููุงุฒ ุจุง ุงุณุชูุงุฏู ุงุฒ **Semaphore**

ุฏุฑ ุจุฑูุงููโูุง ฺูุฏุฑุดุชูโุง (**Multi-threaded Applications**)ุ ฺฉ ุนุฏุฏ ุบุฑููู ุจู ูุงู **Semaphore** ุจู ุฑุดุชูโูุง ุจู ุงุดุชุฑุงฺฉ ฺฏุฐุงุดุชู ูโุดูุฏ. ุงู ููุฏุงุฑ ูโุชูุงูุฏ **ฑ** ุง **ฒ** ุจุงุดุฏ ฺฉู ุฏุฑ ููฺฏุงูโุณุงุฒ ุจูโุชุฑุชุจ ุจู ูุนู **ุงูุชุธุงุฑ (Wait)** ู **ุณฺฏูุงู (Signal)** ุงุณุช.
ูโุชูุงู ฺฉ Semaphore ุฑุง ุจู ุชุนุฏุงุฏ **Buffer (ุญุงูุธู ูููุช)** ูุฑุชุจุท ฺฉุฑุฏ ุชุง ูุฑุขูุฏูุง ูุฎุชูู ุจูโุตูุฑุช ููโุฒูุงู ุฑู ูุฑฺฉุฏุงู ฺฉุงุฑ ฺฉููุฏ.

ุจูโุทูุฑ ุฎูุงุตูุ **Semaphore** ฺฉ ูฺฉุงูุฒู ุณฺฏูุงูโุฏู ุงุณุช ฺฉู ุงุฒ ุงููุงุน **Integer** ู **Binary** ุจูุฏู ู ุจุง ุนููุงุช **Wait** ู **Signal** ูุงุจู ุชุบุฑ ุงุณุช. ุงฺฏุฑ ููุงุจุน ุขุฒุงุฏ ููุฌูุฏ ูุจุงุดูุฏุ ูุฑุขูุฏูุง ฺฉู ูุงุฒ ุจู ููุจุน ุฏุงุฑูุฏ ุจุงุฏ ุนููุงุช **Wait** ุฑุง ุงุฌุฑุง ฺฉููุฏ ุชุง ุฒูุงู ฺฉู ููุฏุงุฑ Semaphore ุจุฒุฑฺฏโุชุฑ ุงุฒ ุตูุฑ ุดูุฏ. Semaphore ูโุชูุงูุฏ ฺูุฏู ุฑุดุชู ุจุฑูุงูู ุฑุง ูุฏุฑุช ฺฉูุฏ ู ูุฑ ุดุก ูโุชูุงูุฏ ุขู ุฑุง ุชุบุฑ ุฏูุฏุ ููุจุน ุจฺฏุฑุฏ ุง ุขุฒุงุฏ ฺฉูุฏ.

### ูุฒุงุง Semaphore

* ฺูุฏู ุฑุดุชู ูโุชูุงููุฏ ุจูโุทูุฑ ููโุฒูุงู ุจู ุจุฎุด ุญุณุงุณ ุงุฒ ฺฉุฏ ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏ.
* Semaphore ุฏุฑ ุณุทุญ ูุณุชู (**Kernel**) ุงุฌุฑุง ูโุดูุฏ ู ูุงุจุณุชู ุจู ูุงุดู ูุณุช.
* ุจุฎุด ุญุณุงุณ ฺฉุฏ ุฏุฑ ุจุฑุงุจุฑ ฺูุฏู ูุฑุขูุฏ ูุญุงูุธุช ูโุดูุฏ ู ุจุฑุฎูุงู Mutexุ Semaphore ุฒูุงู ูพุฑุฏุงุฒุด ู ููุงุจุน ุฑุง ูุฏุฑ ููโุฏูุฏ.

### ูุนุงุจ Semaphore

* **Priority Inversion (ูุงุฑููฺฏ ุงูููุช)**: ุฒูุงู ุฑุฎ ูโุฏูุฏ ฺฉู ฺฉ ุฑุดุชู ุจุง ุงูููุช ุจุงูุง ูุฌุจูุฑ ุจุงุดุฏ ููุชุธุฑ ุขุฒุงุฏ ุดุฏู Semaphore ุชูุณุท ฺฉ ุฑุดุชู ุจุง ุงูููุช ูพุงู ุจูุงูุฏ.
* ุงฺฏุฑ ุฑุดุชูโูุง ุจุง ุงูููุช ูุชูุณุท ุฌูู ุชฺฉูู ุดุฏู ุฑุดุชูโูุง ุจุง ุงูููุช ูพุงู ุฑุง ุจฺฏุฑูุฏุ ูุดฺฉู **Unbounded Priority Inversion** ูพุด ูโุขุฏ ฺฉู ุฏุฑ ุขู ููโุชูุงู ุชุฃุฎุฑ ุฑุดุชูโูุง ุงูููุช ุจุงูุง ุฑุง ูพุดโุจู ฺฉุฑุฏ.
* ุณุณุชูโุนุงูู ุจุงุฏ ููู ุนููุงุช **Wait** ู **Signal** ุฑุง ูพฺฏุฑ ฺฉูุฏ ฺฉู ูพฺุฏฺฏ ุงุฌุงุฏ ูโฺฉูุฏ.
* ุงุณุชูุงุฏู ุงุฒ Semaphore ูุฑุงุฑุฏุงุฏ ุงุณุช ู ุงุฌุจุงุฑ ูุณุชุ ุงูุง ุงฺฏุฑ ุนููุงุช **Wait** ู **Signal** ุฑุง ุฏุฑ ุชุฑุชุจ ุฏุฑุณุช ุงูุฌุงู ูุฏูุฏุ ุฎุทุฑ **Deadlock (ููู ุจูโุจุณุช)** ูุฌูุฏ ุฏุงุฑุฏ.
* ุฏุฑ ุณุณุชูโูุง ุจุฒุฑฺฏุ ููฺฉู ุงุณุช **Modularity (ูุงฺููุงุฑ ุจูุฏู)** ฺฉุงูุด ุงุจุฏ ู ฺฉุฏ ุฏุฑ ูุนุฑุถ ุฎุทุงูุง ุจุฑูุงููโููุณ ู ููุถ ูููโูุง ูุฑุงุฑ ฺฏุฑุฏ.

---

### โ๏ธ ุจุฑูุงูู ููููู ุจุง ุงุณุชูุงุฏู ุงุฒ Semaphore

ุงุจุชุฏุง ฺฉ ูุชุบุฑ Semaphore ุชุนุฑู ูโฺฉูู:

```csharp
private static readonly Semaphore _semaphore = new Semaphore(2, 4);
```

ูพุงุฑุงูุชุฑ ุงูู ูุดุฎุต ูโฺฉูุฏ ฺูุฏ ุฏุฑุฎูุงุณุช ูโุชูุงููุฏ ุจูโุทูุฑ ููโุฒูุงู ูพุฐุฑูุชู ุดููุฏ.
ูพุงุฑุงูุชุฑ ุฏูู ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง ุฑุง ฺฉู ูโุชูุงู ููโุฒูุงู ูพุฐุฑูุช ูุดุฎุต ูโฺฉูุฏ.

ุญุงูุง ูุชุฏ **StartSemaphore()** ุฑุง ุงุถุงูู ูโฺฉูู:

```csharp
private static void StartSemaphore(object id)
{
    Console.WriteLine($"Object {id} wants semaphore access.");
    try
    {
        _semaphore.WaitOne();
        Console.WriteLine($"Object {id} gained semaphore access.");
        Thread.Sleep(1000);
        Console.WriteLine($"Object {id} has exited semaphore.");
    }
    finally
    {
        _semaphore.Release();
    }
}
```

ุฏุฑ ุงู ูุชุฏุ ุฑุดุชู ุฌุงุฑ ุชุง ุฒูุงู ฺฉู **Wait Handle** ุณฺฏูุงู ุฏุฑุงูุช ฺฉูุฏ ุจููฺฉู ูโุดูุฏ. ุณูพุณ ุฑุดุชู ฺฉุงุฑ ุฎูุฏ ุฑุง ุงูุฌุงู ูโุฏูุฏ ู ุฏุฑ ูพุงุงู Semaphore ุขุฒุงุฏ ูโุดูุฏ ู ููุฏุงุฑุด ุจู ุญุงูุช ูุจู ุจุฑูโฺฏุฑุฏุฏ.

ุญุงูุง ูุชุฏ **SemaphoreExample()** ุฑุง ุงุถุงูู ฺฉูุฏ:

```csharp
private static void SemaphoreExample()
{
    for (int i = 1; i <= 10; i++)
    {
        Thread t = new Thread(StartSemaphore);
        t.Start(i);
    }
}
```

ุงู ูุซุงู ฑฐ ุฑุดุชู ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู ูุชุฏ **StartSemaphore()** ุฑุง ุงุฌุฑุง ูโฺฉููุฏ.

ุฏุฑ ููุงุชุ ูุชุฏ **Main()** ุฑุง ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ:

```csharp
static void Main(string[] args)
{
    SemaphoreExample();
    Console.ReadKey();
}
```

ูุชุฏ **Main()** ูุชุฏ **SemaphoreExample()** ุฑุง ูุฑุงุฎูุงู ฺฉุฑุฏู ู ุณูพุณ ููุชุธุฑ ูโูุงูุฏ ุชุง ฺฉุงุฑุจุฑ ฺฉูุฏ ุฑุง ูุดุงุฑ ุฏูุฏ ุชุง ุจุฑูุงูู ุฎุงุชูู ูพุฏุง ฺฉูุฏ. ุฎุฑูุฌ ุจุงุฏ ูุดุงุจู ุชุตูุฑ ุฒุฑ ุจุงุดุฏ: ๐
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-6.jpeg)
</div>

ุจุงุฏ ุจู ูุญูู ูุญุฏูุฏ ฺฉุฑุฏู ุชุนุฏุงุฏ **ูพุฑุฏุงุฒูุฏูโูุง ู ุฑุดุชูโูุง ุฏุฑ Thread Pool** ุจูพุฑุฏุงุฒู.

---

## โ๏ธ ูุญุฏูุฏ ฺฉุฑุฏู ุชุนุฏุงุฏ ูพุฑุฏุงุฒูุฏูโูุง ู ุฑุดุชูโูุง ุฏุฑ **Thread Pool**

ฺฏุงู ุงููุงุช ูุงุฒ ุงุณุช ฺฉู ุชุนุฏุงุฏ ูพุฑุฏุงุฒูุฏูโูุง ู ุฑุดุชูโูุง ููุฑุฏ ุงุณุชูุงุฏู ุชูุณุท ุจุฑูุงูู ุฎูุฏ ุฑุง ูุญุฏูุฏ ฺฉูุฏ.

### ูุญุฏูุฏ ฺฉุฑุฏู ูพุฑุฏุงุฒูุฏูโูุง

ุจุฑุง ฺฉุงูุด ุชุนุฏุงุฏ ูพุฑุฏุงุฒูุฏูโูุง ููุฑุฏ ุงุณุชูุงุฏูุ ุงุจุชุฏุง ูพุฑุฏุงุฒุด ุฌุงุฑ ุฑุง ุฏุฑุงูุช ฺฉุฑุฏู ู ููุฏุงุฑ **ProcessorAffinity** ุขู ุฑุง ุชูุธู ูโฺฉูู.
ูุซูุงู ูุฑุถ ฺฉูุฏ ฺฉ ฺฉุงููพูุชุฑ ฺูุงุฑ ูุณุชูโุง ุฏุงุฑู ู ูโุฎูุงูู ููุท ุงุฒ ุฏู ูุณุชู ุงูู ุงุณุชูุงุฏู ฺฉูู. ููุฏุงุฑ ุจุงูุฑ ุฏู ูุณุชู ุงูู ุจุฑุงุจุฑ ุงุณุช ุจุง `11` ฺฉู ุฏุฑ ุญุงูุช ุนุฏุฏ ุตุญุญ ุจุฑุงุจุฑ ุจุง **3** ุงุณุช.

ูุชุฏ ุฏุฑ ฺฉ ุจุฑูุงูู ุฌุฏุฏ **.NET Framework Console** ุงุฌุงุฏ ูโฺฉูู ู ูุงู ุขู ุฑุง **AssignCores()** ูโฺฏุฐุงุฑู:

```csharp
private static void AssignCores(int cores)
{
    Process.GetCurrentProcess().ProcessorAffinity = new IntPtr(cores);
}
```

ุฏุฑ ุงู ูุชุฏุ ฺฉ ุนุฏุฏ ุตุญุญ ุจู ุนููุงู ูุฑูุฏ ูโุฏูู. ุงู ุนุฏุฏ ุชูุณุท **.NET Framework** ุจู ููุฏุงุฑ ุจุงูุฑ ุชุจุฏู ูโุดูุฏ ู ูพุฑุฏุงุฒูุฏูโูุง ฺฉู ููุฏุงุฑ ฑ ุฏุงุฑูุฏ ุงุณุชูุงุฏู ูโุดููุฏุ ุฏุฑ ุญุงู ฺฉู ูพุฑุฏุงุฒูุฏูโูุง ฺฉู ููุฏุงุฑุดุงู ฐ ุงุณุชุ ุงุณุชูุงุฏู ูุฎูุงููุฏ ุดุฏ.
ูุซุงูโูุง:

* `0110 (6)` โ ุงุณุชูุงุฏู ุงุฒ ูุณุชูโูุง 2 ู 3
* `1100 (3)` โ ุงุณุชูุงุฏู ุงุฒ ูุณุชูโูุง 1 ู 2
* `0011 (12)` โ ุงุณุชูุงุฏู ุงุฒ ูุณุชูโูุง 3 ู 4

> ุงฺฏุฑ ูุงุฒ ุจู ุงุฏุขูุฑ ุจุงูุฑ ุฏุงุฑุฏุ ูโุชูุงูุฏ ุจู [ุงู ููฺฉ](https://www.computerhope.com/jargon/b/binary.htm) ูุฑุงุฌุนู ฺฉูุฏ.

---

### ุชูุธู ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุฑุดุชูโูุง

ุจุฑุง ุชูุธู ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุฑุดุชูโูุงุ ูุชุฏ **SetMaxThreads()** ุงุฒ ฺฉูุงุณ **ThreadPool** ุฑุง ูุฑุงุฎูุงู ูโฺฉูู. ุงู ูุชุฏ ุฏู ูพุงุฑุงูุชุฑ ูโฺฏุฑุฏ:

1. ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ **Worker Threads** ุฏุฑ Thread Pool
2. ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ **Asynchronous I/O Threads** ุฏุฑ Thread Pool

ูุชุฏ ุฒุฑ ุฑุง ุจุฑุง ุชูุธู ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุฑุดุชูโูุง ุงุถุงูู ูโฺฉูู:

```csharp
private static void SetMaxThreads(int workerThreads, int asyncIoThreads)
{
    ThreadPool.SetMaxThreads(workerThreads, asyncIoThreads);
}
```

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ุชูุธู ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุฑุดุชูโูุง ู ูพุฑุฏุงุฒูุฏูโูุง ุจุณุงุฑ ุณุงุฏู ุงุณุช. ุฏุฑ ุงุบูุจ ููุงูุน ูุงุฒ ุจู ุงูุฌุงู ุงู ฺฉุงุฑ ุฏุฑ ุจุฑูุงููโูุง ูุณุชุ ูฺฏุฑ ุงูฺฉู ุจุฑูุงูู ุดูุง ุจุง ูุดฺฉูุงุช ุนููฺฉุฑุฏ ููุงุฌู ุดูุฏ. ุงฺฏุฑ ุจุฑูุงูู ูุดฺฉู ุฏุฑ ุนููฺฉุฑุฏ ูุฏุงุฑุฏุ ุจูุชุฑ ุงุณุช ุชุนุฏุงุฏ ุฑุดุชูโูุง ู ูพุฑุฏุงุฒูุฏูโูุง ุฑุง ุชูุธู ูฺฉูุฏ.

---

## ๐ ุฌููฺฏุฑ ุงุฒ **Deadlocks (ููู ุจูโุจุณุช)**

ฺฉ **Deadlock** ุฒูุงู ุฑุฎ ูโุฏูุฏ ฺฉู ุฏู ุง ฺูุฏ ุฑุดุชู ุฏุฑ ุญุงู ุงุฌุฑุง ูุณุชูุฏ ู ููุชุธุฑ ฺฉุฏฺฏุฑ ุจุฑุง ุชฺฉูู ูุณุชูุฏ. ุงู ูุดฺฉู ุฏุฑ ุจุฑูุงููโูุง ุจุงุนุซ **ฺฏุฑ ฺฉุฑุฏู ุจุฑูุงูู** ูโุดูุฏ ู ุจุฑุง ฺฉุงุฑุจุฑ ููุง ูโุชูุงูุฏ ุจุณุงุฑ ุฎุทุฑูุงฺฉ ุจุงุดุฏุ ฺุฑุง ฺฉู ููฺฉู ุงุณุช ุฏุงุฏูโูุง ุงุฒ ุจู ุจุฑููุฏ ุง ุฎุฑุงุจ ุดููุฏ.

### ูุซุงู ูุงูุน

ูุฑุถ ฺฉูุฏ ฺฉ ุชุฑุงฺฉูุด ุจุงูฺฉ ุจุฒุฑฺฏ ุฏุงุฑู ฺฉู ุจุงุฏ **ยฃ1 ูููู** ุงุฒ ุญุณุงุจ ุจุงูฺฉ ฺฉ ูุดุชุฑ ุจุฑุง ูพุฑุฏุงุฎุช ูุงูุงุช HMRC ุจุฑุฏุงุดุช ุดูุฏ.

* ูพูู ุงุฒ ุญุณุงุจ ฺฉุณุจโูฺฉุงุฑ ูุดุชุฑ ุจุฑุฏุงุดุช ูโุดูุฏ
* ูุจู ุงุฒ ุงูฺฉู ูพูู ุจู ุญุณุงุจ HMRC ูุงุฑุฒ ุดูุฏุ ฺฉ **Deadlock** ุฑุฎ ูโุฏูุฏ
* ูฺ ฺฏุฒูู ุจุงุฒุงุจ ูุฌูุฏ ูุฏุงุฑุฏ ู ุจุฑูุงูู ุจุงุฏ ุฎุงุชูู ุงุจุฏ ู ุฏูุจุงุฑู ุงุฌุฑุง ุดูุฏ

ูุชุฌู: ุญุณุงุจ ุจุงูฺฉ ฺฉุณุจโูฺฉุงุฑ **ยฃ1 ูููู** ฺฉุงูุด ูโุงุจุฏ ุงูุง ูุงูุงุช ูพุฑุฏุงุฎุช ูุดุฏู ุงุณุช ู ูุดุชุฑ ูููุฒ ูุณุฆูู ูพุฑุฏุงุฎุช ุขู ุงุณุช. ุงู ูุซุงู ุงููุช ุฌููฺฏุฑ ุงุฒ ุฑุฎ ุฏุงุฏู **Deadlocks** ุฑุง ูุดุงู ูโุฏูุฏ.

ุจุฑุง ุณุงุฏูโุชุฑ ฺฉุฑุฏู ููุถูุนุ ูุง ุจุง **ุฏู ุฑุดุชู** ฺฉุงุฑ ุฎูุงูู ฺฉุฑุฏุ ููุงูโุทูุฑ ฺฉู ุฏุฑ ูููุฏุงุฑ ุฒุฑ ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช:

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-7.jpeg)
</div>

ูุง ุฑุดุชูโูุงูุงู ุฑุง **Thread 1** ู **Thread 2** ู ููุงุจุนูุงู ุฑุง **Resource 1** ู **Resource 2** ูโูุงูู.

* **Thread 1** ฺฉ **Lock** ุฑู **Resource 1** ูโฺฏุฑุฏ.
* **Thread 2** ฺฉ **Lock** ุฑู **Resource 2** ูโฺฏุฑุฏ.

ุญุงูุง:

* **Thread 1** ูุงุฒ ุฏุงุฑุฏ ุจู **Resource 2** ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏุ ุงูุง ุจุงุฏ ููุชุธุฑ ุจูุงูุฏ ฺูู **Thread 2** ุขู ุฑุง ููู ฺฉุฑุฏู ุงุณุช.
* **Thread 2** ูุงุฒ ุฏุงุฑุฏ ุจู **Resource 1** ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏุ ุงูุง ุจุงุฏ ููุชุธุฑ ุจูุงูุฏ ฺูู **Thread 1** ุขู ุฑุง ููู ฺฉุฑุฏู ุงุณุช.

ูุชุฌู ุงู ุงุณุช ฺฉู ูู **Thread 1** ู ูู **Thread 2** ุฏุฑ ุญุงูุช **Wait** ูุฑุงุฑ ูโฺฏุฑูุฏ. ุงุฒ ุขูุฌุง ฺฉู ูฺโฺฉ ุงุฒ ุฑุดุชูโูุง ููโุชูุงููุฏ ุงุฏุงูู ุฏููุฏ ุชุง ุฏฺฏุฑ ููุจุนุด ุฑุง ุขุฒุงุฏ ฺฉูุฏุ ูุฑ ุฏู ุฑุดุชู ูุงุฑุฏ ูุถุนุช **Deadlock (ููู ุจูโุจุณุช)** ูโุดููุฏ. ุฒูุงู ฺฉู ฺฉ ุจุฑูุงูู ฺฉุงููพูุชุฑ ุฏุฑ ุญุงูุช **Deadlock** ูุฑุงุฑ ุฏุงุฑุฏุ ุจุฑูุงูู ฺฏุฑ ูโฺฉูุฏ ู ูุฌุจูุฑ ูโุดูุฏ ุขู ุฑุง ุฎุงุชูู ุฏูุฏ.

ฺฉ ูุซุงู ฺฉุฏ ุจุฑุง **Deadlock** ุจูุชุฑู ุฑุงู ุจุฑุง ุชูุถุญ ุงู ููุถูุน ุงุณุช. ุฏุฑ ุจุฎุด ุจุนุฏุ ฺฉ ูุซุงู ุนูู ุงุฒ **Deadlock** ูโููุณู.

---

## ๐ฅ๏ธ ฺฉุฏููุณ ูุซุงู Deadlock

ุจูุชุฑู ุฑูุด ุจุฑุง ููู ุงู ููุถูุนุ ฺฉ ูุซุงู ุนูู ุงุณุช. ูุง ุฏู ูุชุฏ ุฎูุงูู ููุดุช ฺฉู ูุฑ ฺฉุฏุงู ุฏุงุฑุง ุฏู **Lock** ูุฎุชูู ูุณุชูุฏ. ุงู ูุชุฏูุง ุงุดุง ุฑุง ููู ูโฺฉููุฏ ฺฉู ูุชุฏ ุฏฺฏุฑ ุจู ุขู ูุงุฒ ุฏุงุฑุฏ. ฺูู ูุฑ ุฑุดุชู ููุงุจุน ุฑุง ฺฉู ุฑุดุชู ุฏฺฏุฑ ูุงุฒ ุฏุงุฑุฏ ููู ูโฺฉูุฏุ ูุฑ ุฏู ุฑุดุชู ูุงุฑุฏ ุญุงูุช **Deadlock** ูโุดููุฏ. ุจุนุฏ ุงุฒ ุงูฺฉู ูุซุงู ูุง ฺฉุงุฑ ฺฉุฑุฏุ ุขู ุฑุง ุงุตูุงุญ ุฎูุงูู ฺฉุฑุฏ ุชุง ุงุฒ ูุถุนุช Deadlock ุจุงุฒุงุจ ุดูุฏ ู ุงุฏุงูู ุฏูุฏ.

ุงุจุชุฏุง ฺฉ ุจุฑูุงูู ุฌุฏุฏ **.NET Framework Console** ุงุฌุงุฏ ฺฉูุฏ ู ูุงู ุขู ุฑุง **CH08\_Deadlocks** ุจฺฏุฐุงุฑุฏ. ูุงุฒ ุจู ุฏู ุดุก ุจู ุนููุงู ูุชุบุฑูุง ุนุถู ุฏุงุฑู:

```csharp
static object _object1 = new object();
static object _object2 = new object();
```

ุงู ุงุดุงุก ุจู ุนููุงู **Lock Objects** ุงุณุชูุงุฏู ุฎูุงููุฏ ุดุฏ. ูุง ุฏู ุฑุดุชู ุฎูุงูู ุฏุงุดุช ู ูุฑ ุฑุดุชู ูุชุฏ ูุฎุตูุต ุจู ุฎูุฏ ุฑุง ุงุฌุฑุง ูโฺฉูุฏ.

---

### ูุชุฏ Thread1Method()

```csharp
private static void Thread1Method()
{
    Console.WriteLine("Thread1Method: Thread1Method Entered.");
    lock (_object1)
    {
        Console.WriteLine("Thread1Method: Entered _object1 lock. Sleeping...");
        Thread.Sleep(1000);
        Console.WriteLine("Thread1Method: Woke from sleep");
        lock (_object2)
        {
            Console.WriteLine("Thread1Method: Entered _object2 lock.");
        }
        Console.WriteLine("Thread1Method: Exited _object2 lock.");
    }
    Console.WriteLine("Thread1Method: Exited _object1 lock.");
}
```

* ุงู ูุชุฏ ุงุจุชุฏุง ฺฉ **Lock** ุฑู **\_object1** ูโฺฏุฑุฏ.
* ุณูพุณ ุจู ูุฏุช ฑ ุซุงูู **Sleep** ูโฺฉูุฏ.
* ุจุนุฏ ุงุฒ ุจุฏุงุฑ ุดุฏูุ **Lock** ุฑู **\_object2** ูโฺฏุฑุฏ.
* ุฏุฑ ููุงุช ูุฑ ุฏู Lock ุฑุง ุขุฒุงุฏ ฺฉุฑุฏู ู ูุชุฏ ุฎุงุชูู ูโุงุจุฏ.

---

### ูุชุฏ Thread2Method()

```csharp
private static void Thread2Method()
{
    Console.WriteLine("Thread2Method: Thread1Method Entered.");
    lock (_object2)
    {
        Console.WriteLine("Thread2Method: Entered _object2 lock. Sleeping...");
        Thread.Sleep(1000);
        Console.WriteLine("Thread2Method: Woke from sleep.");
        lock (_object1)
        {
            Console.WriteLine("Thread2Method: Entered _object1 lock.");
        }
        Console.WriteLine("Thread2Method: Exited _object1 lock.");
    }
    Console.WriteLine("Thread2Method: Exited _object2 lock.");
}
```

* ุงู ูุชุฏ ุงุจุชุฏุง ฺฉ **Lock** ุฑู **\_object2** ูโฺฏุฑุฏ.
* ุณูพุณ ุจู ูุฏุช ฑ ุซุงูู **Sleep** ูโฺฉูุฏ.
* ุจุนุฏ ุงุฒ ุจุฏุงุฑ ุดุฏูุ **Lock** ุฑู **\_object1** ูโฺฏุฑุฏ.
* ุฏุฑ ููุงุช ูุฑ ุฏู Lock ุฑุง ุขุฒุงุฏ ฺฉุฑุฏู ู ูุชุฏ ุฎุงุชูู ูโุงุจุฏ.

---

### ูุชุฏ DeadlockNoRecovery()

```csharp
private static void DeadlockNoRecovery()
{
    Thread thread1 = new Thread((ThreadStart)Thread1Method);
    Thread thread2 = new Thread((ThreadStart)Thread2Method);
    thread1.Start();
    thread2.Start();
    Console.WriteLine("Press any key to exit.");
    Console.ReadKey();
}
```

ุฏุฑ ุงู ูุชุฏ:

* ุฏู ุฑุดุชู ุงุฌุงุฏ ูโฺฉูู.
* ูุฑ ุฑุดุชู ูุชุฏ ูุชูุงูุช ุฑุง ุงุฌุฑุง ูโฺฉูุฏ.
* ูุฑ ุฏู ุฑุดุชู ุดุฑูุน ูโุดููุฏ.
* ุจุฑูุงูู ุชุง ุฒูุงู ฺฉู ฺฉุงุฑุจุฑ ฺฉูุฏ ุฑุง ูุดุงุฑ ุฏูุฏุ ูุชููู ูโุดูุฏ.

---

### ูุชุฏ Main()

```csharp
static void Main()
{
    DeadlockNoRecovery();
}
```

---

ููฺฏุงู ุงุฌุฑุง ุจุฑูุงููุ ุจุงุฏ ุฎุฑูุฌ ูุดุงุจู ุชุตูุฑ ุฒุฑ ุฑุง ูุดุงูุฏู ฺฉูุฏ: ๐
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-8.jpeg)
</div>

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ฺูู **Thread1** ุฑู **\_object1** ููู ุฏุงุฑุฏุ **Thread2** ููโุชูุงูุฏ ุขู ุฑุง ููู ฺฉูุฏ. ููฺููุ ฺูู **Thread2** ุฑู **\_object2** ููู ุฏุงุฑุฏุ **Thread1** ููโุชูุงูุฏ ุขู ุฑุง ููู ฺฉูุฏ. ุจูุงุจุฑุงู ูุฑ ุฏู ุฑุดุชู ูุงุฑุฏ **Deadlock** ูโุดููุฏ ู ุจุฑูุงูู ฺฏุฑ ูโฺฉูุฏ.

ุญุงูุง ฺฉุฏ ูโููุณู ฺฉู ูุดุงู ุฏูุฏ ฺฺฏููู ูโุชูุงู ุงุฒ ูููุน ุงู **Deadlock** ุฌููฺฏุฑ ฺฉุฑุฏ. ูุง ุงุฒ ูุชุฏ **Monitor.TryEnter()** ุงุณุชูุงุฏู ูโฺฉูู ุชุง ุชูุงุด ฺฉูู ุฏุฑ ูุฏุช ุฒูุงู ูุดุฎุต **Lock** ุจฺฏุฑู. ุณูพุณ ุฏุฑ ุตูุฑุช ููููุชุ ุจุง **Monitor.Exit()** ููู ุฑุง ุขุฒุงุฏ ูโฺฉูู.

---

### ูุชุฏ DeadlockWithRecovery()

```csharp
private static void DeadlockWithRecovery()
{
    Thread thread4 = new Thread((ThreadStart)Thread4Method);
    Thread thread5 = new Thread((ThreadStart)Thread5Method);
    thread4.Start();
    thread5.Start();
    Console.WriteLine("Press any key to exit.");
    Console.ReadKey();
}
```

* ุงู ูุชุฏ ุฏู **Foreground Thread** ุงุฌุงุฏ ูโฺฉูุฏ.
* ุณูพุณ ุฑุดุชูโูุง ุฑุง ุดุฑูุน ฺฉุฑุฏูุ ูพุงู ุฑู ฺฉูุณูู ฺุงูพ ูโฺฉูุฏ ู ููุชุธุฑ ูโูุงูุฏ ุชุง ฺฉุงุฑุจุฑ ฺฉูุฏ ุฑุง ูุดุงุฑ ุฏูุฏ.

---

### ูุชุฏ Thread4Method()

```csharp
private static void Thread4Method()
{
    Console.WriteLine("Thread4Method: Entered _object1 lock. Sleeping...");
    Thread.Sleep(1000);
    Console.WriteLine("Thread4Method: Woke from sleep");
    
    if (!Monitor.TryEnter(_object1))
    {
        Console.WriteLine("Thread4Method: Failed to lock _object1.");
        return;
    }
    try
    {
        if (!Monitor.TryEnter(_object2))
        {
            Console.WriteLine("Thread4Method: Failed to lock _object2.");
            return;
        }
        try
        {
            Console.WriteLine("Thread4Method: Doing work with _object2.");
        }
        finally
        {
            Monitor.Exit(_object2);
            Console.WriteLine("Thread4Method: Released _object2 lock.");
        }
    }
    finally
    {
        Monitor.Exit(_object1);
        Console.WriteLine("Thread4Method: Released _object1 lock.");
    }
}
```

* ุงู ูุชุฏ ฑ ุซุงูู **Sleep** ูโฺฉูุฏ.
* ุณูพุณ ุชูุงุด ูโฺฉูุฏ **Lock** ุฑู **\_object1** ุจฺฏุฑุฏ. ุงฺฏุฑ ูููู ูุดูุฏุ ูุชุฏ ุจุงุฒ ูโฺฏุฑุฏุฏ.
* ุงฺฏุฑ **\_object1** ููู ุดูุฏุ ุชูุงุด ูโฺฉูุฏ **Lock** ุฑู **\_object2** ุจฺฏุฑุฏ.
* ุงฺฏุฑ ูููู ูุดูุฏุ ูุชุฏ ุจุงุฒ ูโฺฏุฑุฏุฏ.
* ุงฺฏุฑ ููู ุดุฏุ ฺฉุงุฑ ูุงุฒู ุฑู **\_object2** ุงูุฌุงู ูโุดูุฏ.
* ุณูพุณ **\_object2** ุขุฒุงุฏ ูโุดูุฏ ู ุฏุฑ ููุงุช **\_object1** ูุฒ ุขุฒุงุฏ ูโุดูุฏ.

---

### ูุชุฏ Thread5Method()

```csharp
private static void Thread5Method()
{
    Console.WriteLine("Thread5Method: Entered _object2 lock. Sleeping...");
    Thread.Sleep(1000);
    Console.WriteLine("Thread5Method: Woke from sleep");
    
    if (!Monitor.TryEnter(_object2))
    {
        Console.WriteLine("Thread5Method: Failed to lock _object2.");
        return;
    }
    try
    {
        if (!Monitor.TryEnter(_object1))
        {
            Console.WriteLine("Thread5Method: Failed to lock _object1.");
            return;
        }
        try
        {
            Console.WriteLine("Thread5Method: Doing work with _object1.");
        }
        finally
        {
            Monitor.Exit(_object1);
            Console.WriteLine("Thread5Method: Released _object1 lock.");
        }
    }
    finally
    {
        Monitor.Exit(_object2);
        Console.WriteLine("Thread5Method: Released _object2 lock.");
    }
}
```

* ุนููฺฉุฑุฏ ุงู ูุชุฏ ููุงู Thread4Method ุงุณุชุ ุงูุง ุชุฑุชุจ ููู ฺฏุฑูุชู **\_object1** ู **\_object2** ุจุฑุนฺฉุณ ุงุณุช.

---

### ูุฑุงุฎูุงู ุฏุฑ Main()

```csharp
static void Main()
{
    DeadlockWithRecovery();
}
```

ฺฉุฏ ุฑุง ฺูุฏ ุจุงุฑ ุงุฌุฑุง ฺฉูุฏ. ุฏุฑ ุงฺฉุซุฑ ููุงุฑุฏุ ุฎุฑูุฌ ูุดุงุจู ุชุตูุฑ ุฒุฑ ุฎูุงูุฏ ุจูุฏุ ุฌุง ฺฉู ููู **Lockูุง** ุจุง ููููุช ฺฏุฑูุชู ุดุฏูโุงูุฏ. โ
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-9.jpeg)
</div>

ุณูพุณุ ูุฑ ฺฉูุฏ ุฑุง ูุดุงุฑ ุฏูุฏ ุชุง ุจุฑูุงูู ุฎุงุฑุฌ ุดูุฏ. ุงฺฏุฑ ุจุฑูุงูู ุฑุง ฺูุฏ ุจุงุฑ ุงุฌุฑุง ฺฉูุฏุ ุฏุฑ ููุงุช ุฎูุงูุฏ ุฏุฏ ฺฉู ฺฉ **Lock** ุดฺฉุณุช ูโุฎูุฑุฏ. ุจุฑูุงูู ูุชูุงูุณุช ุฏุฑ **Thread5Method()** ุฑู **\_object2** ููู ุจฺฏุฑุฏ. ุจุง ุงู ุญุงูุ ุงฺฏุฑ ฺฉูุฏ ุฑุง ูุดุงุฑ ุฏูุฏุ ุจุฑูุงูู ุฎุงุฑุฌ ูโุดูุฏ.

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ุจุง ุงุณุชูุงุฏู ุงุฒ **Monitor.TryEnter()** ูโุชูุงูุฏ ุชูุงุด ฺฉูุฏ ฺฉ ุดุก ุฑุง ููู ฺฉูุฏ. ุงูุง ุงฺฏุฑ ููู ฺฏุฑูุชู ูุดุฏุ ูโุชูุงูุฏ ุงูุฏุงู ุฏฺฏุฑ ุงูุฌุงู ุฏูุฏ ุจุฏูู ุงูฺฉู ุจุฑูุงูู ุดูุง ฺฏุฑ ฺฉูุฏ ุง **Hang** ุดูุฏ. โ

---

## โก ูพุดฺฏุฑ ุงุฒ **Race Conditions**

ุฒูุงู ฺฉู ฺูุฏู ุฑุดุชู ุงุฒ ฺฉ ููุจุน ูุดุชุฑฺฉ ุงุณุชูุงุฏู ูโฺฉููุฏ ู ุฎุฑูุฌโูุง ูุชูุงูุช ุจู ุฏูู ุฒูุงูโุจูุฏ ูุฑ ุฑุดุชู ุชููุฏ ูโุดูุฏุ ุงู ูุถุนุช ุฑุง **Race Condition** ูโูุงููุฏ.
ุฏุฑ ุงู ุจุฎุดุ ูุง ุงู ูุถุนุช ุฑุง ุจุง ฺฉ ูุซุงู ุนูู ูุดุงู ุฎูุงูู ุฏุงุฏ.

ุฏุฑ ูุซุงู ูุง:

* ุฏู ุฑุดุชู ูุฌูุฏ ุฎูุงูุฏ ุฏุงุดุช.
* ูุฑ ุฑุดุชู ฺฉ ูุชุฏ ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ ุชุง ุญุฑูู ุงููุจุง ุฑุง ฺุงูพ ฺฉูุฏ.
* ฺฉ ูุชุฏ ุญุฑูู ุจุฒุฑฺฏ (**Uppercase**) ู ูุชุฏ ุฏฺฏุฑ ุญุฑูู ฺฉูฺฺฉ (**Lowercase**) ุฑุง ฺุงูพ ูโฺฉูุฏ.
* ุงุฒ ุงู ูุซุงูุ ุฎูุงูุฏ ุฏุฏ ฺฉู ุฎุฑูุฌ ุงุดุชุจุงู ุงุณุช ู ูุฑ ุจุงุฑ ุงุฌุฑุง ุจุฑูุงูู ุฎุฑูุฌ ูุชูุงูุช ุฎูุงูุฏ ุจูุฏ.

---

### ูุชุฏ ThreadingRaceCondition()

```csharp
static void ThreadingRaceCondition()
{
    Thread T1 = new Thread(Method1);
    T1.Start();
    Thread T2 = new Thread(Method2);
    T2.Start();
}
```

* ุงู ูุชุฏ ุฏู ุฑุดุชู ุชููุฏ ูโฺฉูุฏ ู ุขููุง ุฑุง ุดุฑูุน ูโฺฉูุฏ.
* ูุฑ ุฑุดุชู ุจู ฺฉ ูุชุฏ ุงุดุงุฑู ุฏุงุฑุฏ:

  * **Method1()** ุญุฑูู ุงููุจุง ุฑุง ุจุง ุญุฑูู ุจุฒุฑฺฏ ฺุงูพ ูโฺฉูุฏ.
  * **Method2()** ุญุฑูู ุงููุจุง ุฑุง ุจุง ุญุฑูู ฺฉูฺฺฉ ฺุงูพ ูโฺฉูุฏ.

---

### ูุชุฏ Method1()

```csharp
static void Method1()
{
    for (_alphabetCharacter = 'A'; _alphabetCharacter <= 'Z'; _alphabetCharacter++)
    {
        Console.Write(_alphabetCharacter + " ");
    }
}
```

### ูุชุฏ Method2()

```csharp
private static void Method2()
{
    for (_alphabetCharacter = 'a'; _alphabetCharacter <= 'z'; _alphabetCharacter++)
    {
        Console.Write(_alphabetCharacter + " ");
    }
}
```

* ูุฑ ุฏู ูุชุฏ ุจู ูุชุบุฑ **\_alphabetCharacter** ุงุฑุฌุงุน ูโุฏููุฏ.
* ุจูุงุจุฑุงูุ ุจุงุฏ ุงู ุนุถู ุฑุง ุฏุฑ ุจุงูุง ฺฉูุงุณ ุงุถุงูู ฺฉูู:

```csharp
private static char _alphabetCharacter;
```

---

### ุจูโุฑูุฒุฑุณุงู ูุชุฏ Main()

```csharp
static void Main(string[] args)
{
    Console.WriteLine("\n\nRace Condition:");
    ThreadingRaceCondition();
    Console.WriteLine("\n\nPress any key to exit.");
    Console.ReadKey();
}
```

ุญุงูุง ฺฉุฏ ูุง ุขูุงุฏู ุงุณุช ุชุง **Race Condition** ุฑุง ูุดุงู ุฏูุฏ. ุงฺฏุฑ ุจุฑูุงูู ุฑุง ฺูุฏู ุจุงุฑ ุงุฌุฑุง ฺฉูุฏุ ุฎูุงูุฏ ุฏุฏ ฺฉู ูุชุงุฌ ููุงู ฺุฒ ูุณุช ฺฉู ุงูุชุธุงุฑ ุฏุงุฑู ู ุญุช ููฺฉู ุงุณุช ฺฉุงุฑุงฺฉุชุฑูุง ุฎุงุฑุฌ ุงุฒ ุญุฑูู ุงููุจุง ูุฒ ฺุงูพ ุดููุฏ. โ๏ธ
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-10.jpeg)
</div>

ุฏููุงู ููุงู ฺุฒ ูุจูุฏ ฺฉู ุงูุชุธุงุฑ ุฏุงุดุชูุ ุฏุฑุณุช ุงุณุชุ ๐

ูุง ูโุฎูุงูู ุงู ูุดฺฉู ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ **TPL** ุญู ฺฉูู. ูุฏู **Task Parallel Library (TPL)** ุณุงุฏูโุณุงุฒ **Parallelism** ู **Concurrency** ุงุณุช. ุจุง ุชูุฌู ุจู ุงูฺฉู ุงฺฉุซุฑ ฺฉุงููพูุชุฑูุง ุงูุฑูุฒ ุฏุงุฑุง ุฏู ุง ฺูุฏ ูพุฑุฏุงุฒูุฏู ูุณุชูุฏุ **TPL** ุจู ุตูุฑุช ูพูุง ูุฒุงู **Concurrency** ุฑุง ููุงุณโุจูุฏ ูโฺฉูุฏ ุชุง ุงุฒ ุชูุงู ูพุฑุฏุงุฒูุฏูโูุง ููุฌูุฏ ุจู ุจูููโุชุฑู ุดฺฉู ุงุณุชูุงุฏู ุดูุฏ. โก

* ุชูุณูโุจูุฏ ฺฉุงุฑ (**Partitioning of work**)
* ุฒูุงูโุจูุฏ ุฑุดุชูโูุง ุฏุฑ **Thread Pool**
* ูพุดุชุจุงู ุงุฒ ูุบู (**Cancellation**)
* ูุฏุฑุช ูุถุนุช (**State Management**)
  ู ููุงุฑุฏ ุฏฺฏุฑ ูุฒ ุชูุณุท **TPL** ุงูุฌุงู ูโุดููุฏ.
  ููฺฉ ูุณุชูุฏุงุช ุฑุณู ูุงฺฉุฑูุณุงูุช ุฏุฑุจุงุฑู **TPL** ุฏุฑ ุจุฎุด **Further Reading** ุงู ูุตู ููุฌูุฏ ุงุณุช. ๐

---

ุฑุงู ุญู ุงู ูุดฺฉู ุณุงุฏู ุงุณุช. ูุง ฺฉ **Task** ุฏุงุฑู ฺฉู ุงุจุชุฏุง **Method1()** ุฑุง ุงุฌุฑุง ูโฺฉูุฏ. ุณูพุณ ุงู **Task** ุงุฏุงูู ูโุฏูุฏ ู **Method2()** ุฑุง ุงุฌุฑุง ูโฺฉูุฏ. ุฏุฑ ููุงุช ุจุง ูุฑุงุฎูุงู **Wait()** ููุชุธุฑ ูโูุงูู ุชุง **Task** ฺฉุงูู ุดูุฏ.

---

### ูุชุฏ ThreadingRaceConditionFixed()

```csharp
static void ThreadingRaceConditionFixed()
{
    Task
        .Run(() => Method1())
        .ContinueWith(task => Method2())
        .Wait();
}
```

* ุงุจุชุฏุง **Method1()** ุงุฌุฑุง ูโุดูุฏ.
* ูพุณ ุงุฒ ุงุชูุงู ุขูุ **Method2()** ุงุฌุฑุง ูโุดูุฏ.
* **Wait()** ุงุทููุงู ูโุฏูุฏ ฺฉู ุจุฑูุงูู ุชุง ูพุงุงู ุงุฌุฑุง **Task** ุตุจุฑ ฺฉูุฏ. โ

---

### ุจูโุฑูุฒุฑุณุงู ูุชุฏ Main()

```csharp
static void Main(string[] args)
{
    //Console.WriteLine("\n\nRace Condition:");
    //ThreadingRaceCondition();
    Console.WriteLine("\n\nRace Condition Fixed:");
    ThreadingRaceConditionFixed();
    Console.WriteLine("\n\nPress any key to exit.");
    Console.ReadKey();
}
```

ฺฉุฏ ุฑุง ุงุฌุฑุง ฺฉูุฏ. ุงฺฏุฑ ุจุฑูุงูู ุฑุง ฺูุฏู ุจุงุฑ ุงุฌุฑุง ฺฉูุฏุ ุฎูุงูุฏ ุฏุฏ ฺฉู ุฎุฑูุฌ ููุดู ฺฉุณุงู ุงุณุชุ ููุงูโุทูุฑ ฺฉู ุฏุฑ ุชุตูุฑ ุฒุฑ ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช. ๐ฏ
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-11.jpeg)
</div>

ุชุง ุงูุฌุงุ ูุง ุฏุฏู ฺฉู **Thread** ฺุณุช ู ฺฺฏููู ูโุชูุงู ุงุฒ ุขูโูุง ุฏุฑ **Foreground** ู **Background** ุงุณุชูุงุฏู ฺฉุฑุฏ. ููฺูู ุจุง **Deadlocks** ู ูุญูู ุญู ุขูโูุง ุจุง **Monitor.TryEnter()** ุขุดูุง ุดุฏู. ุฏุฑ ููุงุชุ ุจุง **Race Conditions** ู ูุญูู ุญู ุขูโูุง ุจุง ุงุณุชูุงุฏู ุงุฒ **TPL** ุขุดูุง ุดุฏู. โ

ุญุงูุงุ ุจู ุณุฑุงุบ **Static Constructors** ู **Static Methods** ูโุฑูู.

---

## ๐น ุฏุฑฺฉ **Static Constructors** ู **Methods**

ุงฺฏุฑ ฺูุฏู ฺฉูุงุณ ููุฒูุงู ุจู ฺฉ **Property Instance** ุฏุณุชุฑุณ ูุงุฒ ุฏุงุดุชู ุจุงุดูุฏุ ฺฉ ุงุฒ **Threadูุง** ุฏุฑุฎูุงุณุช ุงุฌุฑุง **Static Constructor** (ฺฉู ุจู ุขู **Type Initializer** ูู ฺฏูุชู ูโุดูุฏ) ูโุฏูุฏ.
ุฏุฑ ุญุงู ฺฉู ููุชุธุฑ ุงุฌุฑุง **Type Initializer** ูุณุชูุ ุชูุงู **Threadูุง ุฏฺฏุฑ** ููู ูโุดููุฏ. ููุช **Type Initializer** ุงุฌุฑุง ุดุฏุ **Threadูุง ูููโุดุฏู** ุขุฒุงุฏ ุดุฏู ู ูุงุฏุฑ ุจู ุฏุณุชุฑุณ ุจู **Instance Property** ุฎูุงููุฏ ุจูุฏ.

* **Static Constructors** **Thread-Safe** ูุณุชูุฏุ ุฒุฑุง ุชุถูู ูโุดูุฏ ฺฉู ููุท ฺฉ ุจุงุฑ ุฏุฑ ูุฑ **Application Domain** ุงุฌุฑุง ุดููุฏ.
* ุขูโูุง ูุจู ุงุฒ ุฏุณุชุฑุณ ุจู ูุฑ **Static Member** ู ูุจู ุงุฒ ูุฑ **Class Instantiation** ุงุฌุฑุง ูโุดููุฏ.
* ุงฺฏุฑ ุงุณุชุซูุง ุฏุฑ **Static Constructor** ุงุฌุงุฏ ู ุจุฑูู ูุฑุงุฑ ฺฉูุฏุ **TypeInitializationException** ุชููุฏ ูโุดูุฏ ู ุจุงุนุซ ูโุดูุฏ **CLR** ุจุฑูุงูู ุดูุง ุฑุง ูุชููู ฺฉูุฏ.

---

### ูฺฉุงุช ููู ุฏุฑุจุงุฑู **Static Methods**

* **Static Methods** ุชููุง ฺฉ ูุณุฎู ุงุฒ ูุชุฏ ู ุฏุงุฏูโูุง ุขู ุฑุง ุฏุฑ ุณุทุญ **Type** ูฺฏู ูโุฏุงุฑูุฏ.
* ุงู ุจุฏุงู ูุนูุงุณุช ฺฉู ููุงู ูุชุฏ ู ุฏุงุฏูโูุง ุขู ุจู ูููููโูุง ูุฎุชูู ุจู ุงุดุชุฑุงฺฉ ฺฏุฐุงุดุชู ูโุดูุฏ.
* ูุฑ **Thread** ุฏุฑ ุจุฑูุงููุ **Stack** ุฎูุฏ ุฑุง ุฏุงุฑุฏ.
* **Value Types** ฺฉู ุจู ูุชุฏูุง **Static** ูพุงุณ ุฏุงุฏู ูโุดููุฏ ุฑู **Stack** ุฑุดุชู ูุฑุงุฎูุงููุฏู ุงุฌุงุฏ ูโุดููุฏุ ุจูุงุจุฑุงู **Thread-Safe** ูุณุชูุฏ.
* ุงฺฏุฑ ุฏู **Thread** ููุงู ฺฉุฏ ุฑุง ุจุง ููุงู ููุฏุงุฑ ูุฑุงุฎูุงู ฺฉููุฏุ ุฏู ูุณุฎู ุงุฒ ุขู ููุฏุงุฑ ุฑู **Stack** ูุฑ **Thread** ุงุฌุงุฏ ูโุดูุฏ. ุจูุงุจุฑุงูุ **Threads** ุฑู ูู ุงุซุฑ ููโฺฏุฐุงุฑูุฏ.

โ๏ธ ุงูุง:

* ุงฺฏุฑ ูุชุฏ **Static** ุจู **Member Variable** ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏุ **Thread-Safe** ูุณุช.
* ุฏู **Thread** ูุฎุชูู ููุงู ูุชุฏ ุฑุง ูุฑุงุฎูุงู ฺฉุฑุฏู ู ุจู **Member Variable** ุฏุณุชุฑุณ ุฏุงุฑูุฏ. **Context-Switching** ุจู **Threadูุง** ุฑุฎ ูโุฏูุฏ ู ูุฑ **Thread** ูุชุบุฑ ุฑุง ุชุบุฑ ูโุฏูุฏ. ุงู ููุฌุฑ ุจู **Race Conditions** ูโุดูุฏ.
* ุงฺฏุฑ **Reference Types** ุจู ูุชุฏ **Static** ูพุงุณ ุฏุงุฏู ุดููุฏุ ูุดฺฉูุงุช ูุดุงุจู ุฑุฎ ูโุฏูุฏ ู ุจุงุนุซ **Race Condition** ูโุดูุฏ.

โ ูุชุฌู:

* ููฺฏุงู ุงุณุชูุงุฏู ุงุฒ **Static Methods** ุฏุฑ **Threads**ุ ุงุฒ ุฏุณุชุฑุณ ุจู **Member Variable** ุงุฌุชูุงุจ ฺฉูุฏ ู **Reference Types** ูพุงุณ ูุฏูุฏ.
* **Static Methods** **Thread-Safe** ูุณุชูุฏ ุชุง ุฒูุงู ฺฉู ุชููุง **Primitive Types** ูพุงุณ ุฏุงุฏู ุดููุฏ ู ูุถุนุช ุชุบุฑ ูฺฉูุฏ.

---

## ๐ป ุงุถุงูู ฺฉุฑุฏู **Static Constructors** ุจู ฺฉุฏ ููููู

ฺฉ ุจุฑูุงูู ุฌุฏุฏ **.NET Framework Console** ุจุณุงุฒุฏ.
ฺฉ ฺฉูุงุณ ุจู ูุงู **StaticConstructorTestClass** ุงุถุงูู ฺฉูุฏ ู ฺฉ ูุชุบุฑ **Read-Only Static String** ุจู ูุงู **\_message** ุชุนุฑู ฺฉูุฏ:

```csharp
public class StaticConstructorTestClass
{
    private readonly static string _message;
}
```

ุงู ูุชุบุฑ ุชูุณุท ูุชุฏ **Message()** ุจู ูุฑุงุฎูุงููุฏู ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏ.

### ูุชุฏ Message()

```csharp
public static string Message()
{
    return $"Message: {_message}";
}
```

* ุงู ูุชุฏ ูพุงู ุฐุฎุฑูโุดุฏู ุฏุฑ **\_message** ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ.

### Constructor

```csharp
static StaticConstructorTestClass()
{
    Console.WriteLine("StaticConstructorTestClass static constructor started.");
    _message = "Hello, World!";
    Thread.Sleep(1000);
    _message = "Goodbye, World!";
    Console.WriteLine("StaticConstructorTestClass static constructor finished.");
}
```

* ุฏุฑ **Constructor** ฺฉ ูพุงู ุจู ฺฉูุณูู ูโููุณู.
* ุณูพุณ **Member Variable** ุชูุธู ูโุดูุฏ ู **Thread** ุจู ูุฏุช ฑ ุซุงูู ุฎูุงุจุฏู ู ุฏูุจุงุฑู ูพุงู ุชุบุฑ ุฏุงุฏู ูโุดูุฏ.
* ุฏุฑ ููุงุชุ ูพุงู ุฏฺฏุฑ ุจู ฺฉูุณูู ฺุงูพ ูโุดูุฏ.

---

### ุจูโุฑูุฒุฑุณุงู ูุชุฏ Main()

```csharp
static void Main(string[] args)
{
    var program = new Program();
    program.StaticConstructorExample();
    Thread.CurrentThread.Join();
}
```

* **Main()** ฺฉูุงุณ **Program** ุฑุง ูููููโุณุงุฒ ูโฺฉูุฏ.
* ุณูพุณ **StaticConstructorExample()** ูุฑุงุฎูุงู ูโุดูุฏ.
* ุจุฑูุงูู ูุชููู ุดุฏู ู ูุชุฌู ุฑุง ูุดุงูุฏู ูโฺฉููุ ุณูพุณ **Threadูุง** ุจู **Join()** ูโูพููุฏูุฏ.

ุฎุฑูุฌ ุฑุง ูโุชูุงูุฏ ุฏุฑ ุชุตูุฑ ุฒุฑ ูุดุงูุฏู ฺฉูุฏ. ๐บ
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-12.jpeg)
</div>

ุญุงูุง ุจู ุณุฑุงุบ ูุซุงูโูุง ุงุฒ **Static Methods** ูโุฑูู.

---

## ๐ป ุงุถุงูู ฺฉุฑุฏู **Static Methods** ุจู ฺฉุฏ ููููู

ุงฺฉููู ูุตุฏ ุฏุงุฑู **Static Methods** ุงูู ุจุฑุง **Thread** ู ุบุฑ ุงูู ุฑุง ุนูู ูุดุงูุฏู ฺฉูู.

ฺฉ ฺฉูุงุณ ุฌุฏุฏ ุจู ูุงู **StaticExampleClass** ุจู ฺฉ ุจุฑูุงูู **.NET Framework Console** ุงุถุงูู ฺฉูุฏ ู ฺฉุฏ ุฒุฑ ุฑุง ุจููุณุฏ:

```csharp
public static class StaticExampleClass
{
    private static int _x = 1;
    private static int _y = 2;
    private static int _z = 3;
}
```

* ุฏุฑ ุจุงูุง ฺฉูุงุณุ ุณู ุนุฏุฏ ุตุญุญ ุชุนุฑู ฺฉุฑุฏูโุงู: **\_xุ \_y ู \_z** ุจุง ููุงุฏุฑ ฑุ ฒ ู ณ.
* ุงู ูุชุบุฑูุง ูโุชูุงููุฏ ุจู **Threadูุง** ุชุบุฑ ฺฉููุฏ.

---

### Static Constructor

ุญุงูุง ฺฉ **Static Constructor** ุงุถุงูู ูโฺฉูู ุชุง ููุงุฏุฑ ุงู ูุชุบุฑูุง ุฑุง ฺุงูพ ฺฉูุฏ:

```csharp
static StaticExampleClass()
{
    Console.WriteLine($"Constructor: _x={_x}, _y={_y}, _z={_z}");
}
```

* ููุงูโุทูุฑ ฺฉู ูุดุงูุฏู ูโฺฉูุฏุ **Static Constructor** ููุท ููุงุฏุฑ ูุชุบุฑูุง ุฑุง ุฏุฑ **Console Window** ฺุงูพ ูโฺฉูุฏ.

---

### Thread-Safe Method

ูุชุฏ ุงูู ูุง ฺฉ ูุชุฏ **Thread-Safe** ุจู ูุงู **ThreadSafeMethod()** ุงุณุช:

```csharp
internal static void ThreadSafeMethod(int x, int y, int z)
{
    Console.WriteLine($"ThreadSafeMethod: x={x}, y={y}, z={z}");
    Console.WriteLine($"ThreadSafeMethod: {x}+{y}+{z}={x+y+z}");
}
```

* ุงู ูุชุฏ **Thread-Safe** ุงุณุช ุฒุฑุง ููุท ุจุง ูพุงุฑุงูุชุฑูุง **by value** ฺฉุงุฑ ูโฺฉูุฏ.
* ุจุง ูุชุบุฑูุง **Member** ุชุนุงูู ูุฏุงุฑุฏ ู ูฺ **by reference value** ูุฏุงุฑุฏ.
* ุจูุงุจุฑุงูุ ุตุฑู ูุธุฑ ุงุฒ ููุงุฏุฑ ูุฑูุฏุ ููุดู ูุชุฌู ููุฑุฏ ุงูุชุธุงุฑ ุฑุง ุฎูุงูุฏ ฺฏุฑูุช.

โ ุนู ฺู ฺฉ **Thread** ูุงุญุฏ ุง ุญุช ููููโูุง **Thread** ุจู ุงู ูุชุฏ ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏุ ุฎุฑูุฌ ูุฑ **Thread** ููุงู ฺุฒ ุฎูุงูุฏ ุจูุฏ ฺฉู ุงูุชุธุงุฑ ุฏุงุฑุฏุ ุญุช ุจุง ูุฌูุฏ **Context Switching**.

ุฎุฑูุฌ ุงู ูุชุฏ ุฑุง ุฏุฑ **Screenshot** ุจุนุฏ ูุดุงูุฏู ูโฺฉูู. ๐
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-13.jpeg)
</div>

ุญุงู ฺฉู ุจุง **Thread-Safe Methods** ุขุดูุง ุดุฏูุ ููุทู ุงุณุช ฺฉู ูฺฏุงู ูู ุจู **Non-Thread-Safe Methods** ุจูุฏุงุฒู.

โ ุชุง ุงูุฌุง ูโุฏุงูุฏ ฺฉู ูุฑ **Static Method** ฺฉู ุฑู **by reference values** ุง **Static Member Variables** ุนูู ฺฉูุฏุ **Thread-Safe** ูุณุช.

---

### Non-Thread-Safe Method

ุฏุฑ ูุซุงู ุจุนุฏุ ูุชุฏ ุจุง ููุงู ุณู ูพุงุฑุงูุชุฑ **ThreadSafeMethod()** ุฎูุงูู ุฏุงุดุชุ ุงูุง ุงู ุจุงุฑ:

* ูุชุบุฑูุง ุนุถู (**Member Variables**) ุฑุง ููุฏุงุฑุฏู ูโฺฉููุ
* ูพุงู ฺุงูพ ูโฺฉููุ
* ุจุฑุง ูุฏุช **Sleep** ูโฺฉููุ
* ุณูพุณ ุจุฏุงุฑ ุดุฏู ู ุฏูุจุงุฑู ููุงุฏุฑ ุฑุง ฺุงูพ ูโฺฉูู.

ฺฉุฏ **NotThreadSafeMethod()** ุฑุง ุจู ฺฉูุงุณ **StaticExampleClass** ุงุถุงูู ฺฉูุฏ:

```csharp
internal static void NotThreadSafeMethod(int x, int y, int z)
{
    _x = x;
    _y = y;
    _z = z;
    Console.WriteLine(
        $"{Thread.CurrentThread.ManagedThreadId}-NotThreadSafeMethod: _x={_x}, _y={_y}, _z={_z}"
    );
    Thread.Sleep(300);
    Console.WriteLine(
        $"{Thread.CurrentThread.ManagedThreadId}-ThreadSafeMethod: {_x}+{_y}+{_z}={_x + _y + _z}"
    );
}
```

* ุฏุฑ ุงู ูุชุฏุ ุงุจุชุฏุง **Member Variables** ุฑุง ุจุง ููุงุฏุฑ ูุฑูุฏ ููุฏุงุฑุฏู ูโฺฉูู.
* ุณูพุณ ุขู ููุงุฏุฑ ุฑุง ุฏุฑ **Console** ฺุงูพ ูโฺฉูู ู **300 ููโุซุงูู** ุจู **Sleep** ูโุฑูู.
* ูพุณ ุงุฒ ุจุฏุงุฑ ุดุฏูุ ุฏูุจุงุฑู ููุงุฏุฑ ุฑุง ฺุงูพ ูโฺฉูู.

---

### ุจุฑูุฒุฑุณุงู Main Method

ุฏุฑ ฺฉูุงุณ **Program**ุ **Main()** ุฑุง ุจู ุดฺฉู ุฒุฑ ุจุฑูุฒุฑุณุงู ฺฉูุฏ:

```csharp
static void Main(string[] args)
{
    var program = new Program();
    program.ThreadUnsafeMethodCall();
    Console.ReadKey();
}
```

* ุฏุฑ **Main()**ุ ุงุจุชุฏุง ฺฉูุงุณ **Program** ูููููโุณุงุฒ ูโุดูุฏ.
* ุณูพุณ ูุชุฏ **ThreadUnsafeMethodCall()** ูุฑุงุฎูุงู ูโุดูุฏ.
* ุจุฑูุงูู ุชุง ุฒูุงู ฺฉู ฺฉุงุฑุจุฑ ฺฉูุฏ ูุดุงุฑ ุฏูุฏุ ุตุจุฑ ูโฺฉูุฏ.

---

### ThreadUnsafeMethodCall

ุญุงูุง **ThreadUnsafeMethodCall()** ุฑุง ุจู ฺฉูุงุณ **Program** ุงุถุงูู ฺฉูุฏ:

```csharp
private void ThreadUnsafeMethodCall()
{
    for (var index = 0; index < 10; index++)
    {
        var thread = new Thread(() =>
        {
            StaticExampleClass.NotThreadSafeMethod(index + 1, index + 2, index + 3);
        });
        thread.Start();
    }
}
```

* ุงู ูุชุฏ **10 Thread** ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู ูุฑฺฉุฏุงู **NotThreadSafeMethod()** ุงุฒ ฺฉูุงุณ **StaticExampleClass** ุฑุง ูุฑุงุฎูุงู ูโฺฉููุฏ.
* ุงฺฏุฑ ฺฉุฏ ุฑุง ุงุฌุฑุง ฺฉูุฏุ ุฎุฑูุฌ ูุดุงุจู **Screenshot** ุจุนุฏ ูุดุงูุฏู ุฎูุงูุฏ ุดุฏ. โก

ุฎุฑูุฌ ูุดุงู ูโุฏูุฏ ฺฉู ููุงุฏุฑ ุจู **Threadูุง** ุชุฏุงุฎู ุฏุงุฑูุฏ ู ุจู ุฏูู ุนุฏู ุงูู **Thread**ุ ูุชุงุฌ ุบุฑูุงุจู ูพุดโุจู ุงุณุช.
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-14.jpeg)
</div>

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ุฎุฑูุฌ ุจุฑูุงูู ุขู ฺุฒ ูุณุช ฺฉู ุงูุชุธุงุฑ ุฏุงุดุชู. ุงู ุจู ุฏูู **ุขููุฏฺฏ ุฏุงุฏูโูุง ุชูุณุท Threadูุง ูุฎุชูู** ุฑุฎ ูโุฏูุฏ. ุงู ููุถูุน ูุง ุฑุง ุจู ุจุฎุด ุจุนุฏ ุนู **ูุงุจูุช ุชุบุฑ (Mutability)ุ ุนุฏู ุชุบุฑ (Immutability) ู ุงูู Thread** ูโุฑุณุงูุฏ. ๐

---

## ูุงุจูุช ุชุบุฑุ ุนุฏู ุชุบุฑ ู ุงูู Thread

**Mutability** ููุจุน ุจุฑูุฒ ุฎุทุง ุฏุฑ ุจุฑูุงููโูุง ฺูุฏ Threadู ุงุณุช. ฺฉ ุฎุทุง ูุงุจู ุชุบุฑ ูุนูููุงู ูุงุด ุงุฒ ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ ู ุจูโุฑูุฒุฑุณุงู ููุงุฏุฑ ุจู Threadูุงุณุช.

ุจุฑุง ุญุฐู ุฎุทุฑ ุงู ููุน ุฎุทุงูุงุ ุจูุชุฑ ุงุณุช ุงุฒ **Immutable Types** ุงุณุชูุงุฏู ฺฉูู.

**Thread Safety** ุนู ุงุฌุฑุง ุงูู ฺฉ ุจุฎุด ฺฉุฏ ุชูุณุท ฺูุฏ Thread ุจูโุทูุฑ ููุฒูุงู. ููุช ุจุฑูุงููโูุง ฺูุฏ Threadู ูโููุณุฏุ ููู ุงุณุช ฺฉู ฺฉุฏ ุดูุง **Thread-Safe** ุจุงุดุฏ. ฺฉุฏ ุดูุง Thread-Safe ุงุณุช ุงฺฏุฑ ุดุฑุงุท ูุงููุฏ **Race Conditions** ู **Deadlocks** ู ูุดฺฉูุงุช ูุงุด ุงุฒ **Mutability** ุฑุง ุญุฐู ฺฉูุฏ.

* **Immutable Object**: ุดุฆ ฺฉู ูพุณ ุงุฒ ุงุฌุงุฏ ูุงุจู ุชุบุฑ ูุณุช. ุงฺฏุฑ ฺูู ุดุฆ ุจู Threadูุง ุจูโุฏุฑุณุช ููฺฏุงูโุณุงุฒ ุดูุฏุ ููู Threadูุง ููุงู ูุถุนุช ูุนุชุจุฑ ุดุก ุฑุง ุฎูุงููุฏ ุฏุฏ.
* **Mutable Object**: ุดุฆ ฺฉู ูพุณ ุงุฒ ุงุฌุงุฏ ูุงุจู ุชุบุฑ ุงุณุช ู ุฏุงุฏูโูุง ุขู ูโุชูุงูุฏ ุจู Threadูุง ุชุบุฑ ฺฉูุฏ. ุงู ูโุชูุงูุฏ ุจุงุนุซ **Corruption ุฏุงุฏูโูุง** ุดูุฏุ ุญุช ุงฺฏุฑ ุจุฑูุงูู ฺฉุฑุด ูฺฉูุฏุ ุฏุงุฏูโูุง ููฺฉู ุงุณุช ุฏุฑ ูุถุนุช ูุงูุนุชุจุฑ ุจุงู ุจูุงููุฏ.

ุจูุงุจุฑุงูุ ููุช ุจุง ฺูุฏ Thread ฺฉุงุฑ ูโฺฉูุฏุ ููู ุงุณุช ฺฉู **ุงุดุงุก ุดูุง Immutable ุจุงุดูุฏ**. ุฏุฑ ูุตู ณ (Classes, Objects, and Data Structures) ุฑูุด ุงุฌุงุฏ ู ุงุณุชูุงุฏู ุงุฒ ุณุงุฎุชุงุฑูุง ุฏุงุฏู ุบุฑูุงุจู ุชุบุฑ ุฑุง ุงุฏ ฺฏุฑูุชู.

โ ุจุฑุง ุงุทููุงู ุงุฒ Thread Safety:

* ุงุฒ **Mutable Objects** ุงุณุชูุงุฏู ูฺฉูุฏ.
* ูพุงุฑุงูุชุฑูุง ุฑุง **By Reference** ุงุฑุณุงู ูฺฉูุฏ.
* **Member Variables** ุฑุง ุชุบุฑ ูุฏูุฏ.
* ููุท ูพุงุฑุงูุชุฑูุง ุฑุง **By Value** ุงุฑุณุงู ฺฉูุฏ ู ุฑู ููุงูโูุง ุนููุงุช ุงูุฌุงู ุฏูุฏ.

**Immutable Structures** ุฑูุด ุงูู ู ููุงุณุจ ุจุฑุง ุงูุชูุงู ุฏุงุฏูโูุง ุจู ุงุดุงุก ูุณุชูุฏ.

---

## ููููู ฺฉุฏ ุจุฑุง Mutable ู ุบุฑ Thread-Safe

ุจุฑุง ููุงุด **Mutability** ุฏุฑ ฺฉ ุจุฑูุงูู ฺูุฏ Threadูุ ฺฉ **Console Application** ุฌุฏุฏ ุงุฌุงุฏ ฺฉูุฏ. ฺฉ ฺฉูุงุณ ุจู ูุงู **MutableClass** ุงุถุงูู ฺฉูุฏ:

```csharp
internal class MutableClass
{
    private readonly int[] _intArray;
    public MutableClass(int[] intArray)
    {
        _intArray = intArray;
    }
    public int[] GetIntArray()
    {
        return _intArray;
    }
}
```

* ุงู ฺฉูุงุณ ฺฉ **Constructor** ุฏุงุฑุฏ ฺฉู ฺฉ ุขุฑุงู ุนุฏุฏ ุตุญุญ ูโฺฏุฑุฏ ู ุจู ุนุถู ฺฉูุงุณ ุงุฎุชุตุงุต ูโุฏูุฏ.
* ูุชุฏ **GetIntArray()** ููุงู ุขุฑุงู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.
* ุงฺฏุฑฺู ฺฉูุงุณ ุจู ูุธุฑ ุบุฑูุงุจู ุชุบุฑ ูโุขุฏุ ุงูุง **ุขุฑุงู ุนุฏุฏ ุตุญุญ ูุฑูุฏ mutable ุงุณุช** ู GetIntArray() ฺฉ **Reference** ุงุฒ ุขู ุจุฑูโฺฏุฑุฏุงูุฏ.

---

### MutableExample Method

ุฏุฑ ฺฉูุงุณ **Program**ุ ูุชุฏ **MutableExample()** ุฑุง ุงุถุงูู ฺฉูุฏ ุชุง ูุดุงู ุฏูุฏ ุขุฑุงู mutable ุงุณุช:

```csharp
private static void MutableExample()
{
    int[] iar = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 };
    var mutableClass = new MutableClass(iar);
    Console.WriteLine($"Initial Array: {iar[0]}, {iar[1]}, {iar[2]}, {iar[3]}, {iar[4]}, {iar[5]}, {iar[6]}, {iar[7]}, {iar[8]}, {iar[9]}");
    for (var x = 0; x < 9; x++)
    {
        var thread = new Thread(() =>
        {
            iar[x] = x + 1;
            var ia = mutableClass.GetIntArray();
            Console.WriteLine($"Array [{x}]: {ia[0]}, {ia[1]}, {ia[2]}, {ia[3]}, {ia[4]}, {ia[5]}, {ia[6]}, {ia[7]}, {ia[8]}, {ia[9]}");
        });
        thread.Start();
    }
}
```

* ุฏุฑ ุงู ูุชุฏุ ุงุจุชุฏุง ฺฉ ุขุฑุงู ุนุฏุฏ ุตุญุญ ุงุฒ ฐ ุชุง น ุงุฌุงุฏ ูโฺฉูู.
* ุณูพุณ ฺฉ ููููู ุงุฒ **MutableClass** ูโุณุงุฒู ู ุขุฑุงู ุฑุง ุจู ุขู ูพุงุณ ูโุฏูู.
* ุงุจุชุฏุง ูุญุชูุงุช ุขุฑุงู ุฑุง ฺุงูพ ูโฺฉูู.
* ุณูพุณ ุฏุฑ ฺฉ ุญููู น ุจุงุฑุ ููุฏุงุฑ ูุฑ ุงูุฏฺฉุณ ุฑุง ุจู `x + 1` ุชุบุฑ ูโุฏูู ู ฺฉ Thread ุจุฑุง ฺุงูพ ุขุฑุงู ุงุฌุงุฏ ูโฺฉูู.

---

### ุจุฑูุฒุฑุณุงู Main Method

```csharp
static void Main(string[] args)
{
    MutableExample();
    Console.ReadKey();
}
```

* Main() ุชููุง ูุชุฏ **MutableExample()** ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ ู ุณูพุณ ููุชุธุฑ ูุดุฑุฏู ฺฉ ฺฉูุฏ ูโูุงูุฏ.

ุจุง ุงุฌุฑุง ุงู ุจุฑูุงููุ ุฎุฑูุฌ ูุดุงุจู **Screenshot** ุจุนุฏ ููุงุด ุฏุงุฏู ุฎูุงูุฏ ุดุฏ ู ูุดุงู ูโุฏูุฏ ฺฉู **ฺูุฏ Thread ููุงุฏุฑ ุขุฑุงู ุฑุง ููุฒูุงู ุชุบุฑ ูโุฏููุฏ** ู ุจุงุนุซ **ุนุฏู ูพุดโุจู ูุถุนุช ููุง ุขุฑุงู** ูโุดููุฏ. โก
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-15.jpeg)
</div>

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ุญุช ุจุง ุงูฺฉู ุชููุง ฺฉ ููููู ุงุฒ **MutableClass** ุงุฌุงุฏ ฺฉุฑุฏู ูุจู ุงุฒ ุณุงุฎุช ู ุงุฌุฑุง Threadูุงุ ุชุบุฑ ุขุฑุงู ูุญู ุจุงุนุซ ุชุบุฑ ุขุฑุงู ุฏุฑ ููููู MutableClass ูโุดูุฏ. ุงู ุซุงุจุช ูโฺฉูุฏ ฺฉู ุขุฑุงูโูุง **ูุงุจู ุชุบุฑ (Mutable)** ูุณุชูุฏ ู ุจูุงุจุฑุงู **Thread-Safe** ูุณุชูุฏ. โ๏ธ

---

## ููุดุชู ฺฉุฏ Immutable ู Thread-Safe

ุฏุฑ ูุซุงู **Immutable**ุ ุฏูุจุงุฑู ฺฉ ุจุฑูุงูู **.NET Framework Console Application** ุงุฌุงุฏ ูโฺฉูู ู ุงุฒ ููุงู ุขุฑุงู ุงุณุชูุงุฏู ูโฺฉูู.

ฺฉ ฺฉูุงุณ ุจู ูุงู **ImmutableStruct** ุงุถุงูู ฺฉูุฏ ู ฺฉุฏ ุฑุง ุจู ุดฺฉู ุฒุฑ ุงุตูุงุญ ฺฉูุฏ:

```csharp
internal struct ImmutableStruct
{
    private ImmutableArray<int> _immutableArray;
    public ImmutableStruct(ImmutableArray<int> immutableArray)
    {
        _immutableArray = immutableArray;
    }
    public int[] GetIntArray()
    {
        return _immutableArray.ToArray<int>();
    }
}
```

* ุจู ุฌุง ุขุฑุงู ุนุฏุฏ ุตุญุญ ูุนูููุ ุงุฒ **ImmutableArray** ุงุณุชูุงุฏู ูโฺฉูู.
* ฺฉ ุขุฑุงู Immutable ุจู **Constructor** ูพุงุณ ุฏุงุฏู ุดุฏู ู ุจู ูุชุบุฑ ุนุถู `_immutableArray` ุงุฎุชุตุงุต ูโุงุจุฏ.
* ูุชุฏ **GetIntArray()** ุขุฑุงู Immutable ุฑุง ุจู ุตูุฑุช ุขุฑุงู ุนุฏุฏ ุตุญุญ ูุนููู ุจุฑูโฺฏุฑุฏุงูุฏ.

---

### ImmutableExample Method

ุฏุฑ ฺฉูุงุณ **Program**ุ ูุชุฏ **ImmutableExample()** ุฑุง ุงุถุงูู ฺฉูุฏ:

```csharp
private static void ImmutableExample()
{
    int[] iar = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 };
    var immutableStruct = new ImmutableStruct(iar.ToImmutableArray<int>());
    Console.WriteLine($"Initial Array: {iar[0]}, {iar[1]}, {iar[2]}, {iar[3]}, {iar[4]}, {iar[5]}, {iar[6]}, {iar[7]}, {iar[8]}, {iar[9]}");
    for (var x = 0; x < 9; x++)
    {
        var thread = new Thread(() =>
        {
            iar[x] = x + 1;
            var ia = immutableStruct.GetIntArray();
            Console.WriteLine($"Array [{x}]: {ia[0]}, {ia[1]}, {ia[2]}, {ia[3]}, {ia[4]}, {ia[5]}, {ia[6]}, {ia[7]}, {ia[8]}, {ia[9]}");
        });
        thread.Start();
    }
}
```

* ุฏุฑ ุงู ูุชุฏุ ุงุจุชุฏุง ฺฉ ุขุฑุงู ุนุฏุฏ ุตุญุญ ุงุฌุงุฏ ูโฺฉูู ู ุขู ุฑุง ุจู Constructor **ImmutableStruct** ุจู ุตูุฑุช ฺฉ **ImmutableArray** ูพุงุณ ูโุฏูู.
* ุณูพุณ ูุญุชูุง ุขุฑุงู ูุญู ูุจู ุงุฒ ุชุบุฑ ฺุงูพ ูโุดูุฏ.
* ุจุนุฏ ุงุฒ ุขูุ ฺฉ ุญููู น ุจุงุฑ ุงุฌุฑุง ูโฺฉูู ู ุฏุฑ ูุฑ ุชฺฉุฑุงุฑ ููุฏุงุฑ ุงูุฏฺฉุณ ุฌุงุฑ + ฑ ุจู ุขุฑุงู ูุญู ุงุถุงูู ูโฺฉูู.
* ุณูพุณ ุงุฒ ุทุฑู ูุชุฏ **GetIntArray()**ุ ฺฉ ฺฉูพ ุงุฒ ุขุฑุงู Immutable ุฏุฑุงูุช ฺฉุฑุฏู ู ููุงุฏุฑ ุขู ุฑุง ฺุงูพ ูโฺฉูู.
* ุฏุฑ ููุงุชุ Thread ุฑุง ุงุฌุฑุง ูโฺฉูู.

ูุชุฏ **ImmutableExample()** ุฑุง ุงุฒ **Main()** ูุฑุงุฎูุงู ฺฉุฑุฏู ู ุจุฑูุงูู ุฑุง ุงุฌุฑุง ฺฉูุฏ. ุฎุฑูุฌ ูุดุงู ูโุฏูุฏ ฺฉู **ุขุฑุงู Immutable ูฺ ุชุบุฑ ุชูุณุท Threadูุง ููโุจูุฏ** ู ุจุฑูุงูู **Thread-Safe** ุงุณุช. โ
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-16.jpeg)
</div>

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ ูุญุชูุง ุขุฑุงู ุจุง ุชุบุฑ ุขุฑุงู ูุญู ุชุบุฑ ููโฺฉูุฏ. ุงู ูุณุฎู ุงุฒ ุจุฑูุงูู ูุดุงู ูโุฏูุฏ ฺฉู ุจุฑูุงูู ูุง **Thread-Safe** ุงุณุช. โ

---

## ุฏุฑฺฉ ููููู Thread-Safety ๐ก๏ธ

ููุงูโุทูุฑ ฺฉู ุฏุฑ ุฏู ุจุฎุด ูุจู ุฏุฏุฏุ ููฺฏุงู ููุดุชู ฺฉุฏูุง ฺูุฏ ูุฎ ุจุงุฏ ุจุณุงุฑ ูุฑุงูุจ ุจูุฏ. ููุดุชู ฺฉุฏ **Thread-Safe** ูโุชูุงูุฏ ุจูโูฺู ุฏุฑ ูพุฑูฺูโูุง ุจุฒุฑฺฏ ุจุณุงุฑ ุฏุดูุงุฑ ุจุงุดุฏ. ุดูุง ุจุงุฏ ุจูโุทูุฑ ูฺู ูุฑุงูุจ ููุงุฑุฏ ุฒุฑ ุจุงุดุฏ:

* ฺฉุงุฑ ุจุง **Collections**
* **ูพุงุณ ุฏุงุฏู ูพุงุฑุงูุชุฑูุง ุจูโุตูุฑุช ูุฑุฌุน (by reference)**
* ุฏุณุชุฑุณ ุจู **ูุชุบุฑูุง ุนุถู ุฏุฑ ฺฉูุงุณโูุง static**

ุจูุชุฑู ุดููโูุง ุจุฑุง ุจุฑูุงููโูุง ฺูุฏ ูุฎ:

1. ุชููุง ุงุฒ **Immutable Types** ุงุณุชูุงุฏู ฺฉูุฏ.
2. ุจู ูุชุบุฑูุง ุนุถู **static** ุฏุณุชุฑุณ ูพุฏุง ูฺฉูุฏ.
3. ุงฺฏุฑ ฺฉุฏ ูุฌูุฏ ุฏุงุฑุฏ ฺฉู **Thread-Safe ูุณุช**ุ ุขู ุฑุง ุจุง **lockุ mutex ุง semaphore** ูุญุงูุธุช ฺฉูุฏ.

ฺฏุฑฺู ุดูุง ูุจูุงู ูููููโูุง ุงุฒ ุงู ฺฉุฏูุง ุฑุง ุฏุฑ ุงู ูุตู ุฏุฏูโุงุฏุ ุจุงุฏ ฺฉ ูุฑูุฑ ฺฉูุชุงู ุจุง ููููู ฺฉุฏ ุฏุงุดุชู ุจุงุดู.

---

### ููููู ููุดุชู ฺฉ ููุน Immutable ุจุง `readonly struct`

```csharp
public readonly struct ImmutablePerson
{
    public ImmutablePerson(int id, string firstName, string lastName)
    {
        _id = id;
        _firstName = firstName;
        _lastName = lastName;
    }
    public int Id { get; }
    public string FirstName { get { return _firstName; } }
    public string LastName { get { return _lastName; } }
}
```

* ุฏุฑ ุณุงุฎุชุงุฑ **ImmutablePerson**ุ ฺฉ **Constructor ุนููู** ุฏุงุฑู ฺฉู ฺฉ ุนุฏุฏ ุตุญุญ ุจุฑุง **ID** ู ุฏู ุฑุดุชู ุจุฑุง ูุงู ู ูุงู ุฎุงููุงุฏฺฏ ูโฺฏุฑุฏ.
* ูพุงุฑุงูุชุฑูุง **idุ firstName ู lastName** ุจู ูุชุบุฑูุง ุนุถู **Read-Only** ุงุฎุชุตุงุต ุฏุงุฏู ูโุดููุฏ.
* ุชููุง ุฏุณุชุฑุณ ุจู ุฏุงุฏูโูุง ุงุฒ ุทุฑู **Properties ููุท ุฎูุงูุฏู** ุงูุฌุงู ูโุดูุฏุ ุจูุงุจุฑุงู **ุงูฺฉุงู ุชุบุฑ ุฏุงุฏูโูุง ูุฌูุฏ ูุฏุงุฑุฏ**.

ุงุฒ ุขูุฌุง ฺฉู ุฏุงุฏูโูุง ูพุณ ุงุฒ ุงุฌุงุฏ ูุงุจู ุชุบุฑ ูุณุชูุฏุ ุงู ุณุงุฎุชุงุฑ **Thread-Safe** ุงุณุช. ุนู ููโุชูุงู ุขู ุฑุง ุงุฒ ุทุฑู Threadูุง ูุฎุชูู ุชุบุฑ ุฏุงุฏ. ุชููุง ุฑุงู ุชุบุฑ ุฏุงุฏูโูุงุ ุงุฌุงุฏ ฺฉ **Struct ุฌุฏุฏ ุจุง ุฏุงุฏูโูุง ุฌุฏุฏ** ุงุณุช.

---

### ูฺฉุงุช ุชฺฉูู

* Structูุง ูโุชูุงููุฏ **Mutable** ุจุงุดูุฏุ ุฏุฑุณุช ูุงููุฏ ฺฉูุงุณโูุง.
* ุงูุง ุงฺฏุฑ ูโุฎูุงูุฏ ุฏุงุฏูโูุง ุชุบุฑ ูุงูพุฐุฑ ุจุงุดูุฏุ **Read-Only Structs** ฺฏุฒููโุง ุณุจฺฉ ู ููุงุณุจ ูุณุชูุฏ.
* ุงุฌุงุฏ ู ุงุฒ ุจู ุจุฑุฏู ุงู Structูุง ุณุฑุนโุชุฑ ุงุฒ ฺฉูุงุณโูุง ุงุณุชุ ุฒุฑุง ุฑู **Stack** ูุฑุงุฑ ูโฺฏุฑูุฏ (ูฺฏุฑ ุงูฺฉู ุจุฎุด ุงุฒ ฺฉูุงุณ ุจุงุดูุฏ ฺฉู ุฑู **Heap** ูุฑุงุฑ ุฏุงุฑุฏ).

---

### Collections Immutable

ูพุดโุชุฑ ุฏุฏู ฺฉู **Collections Mutable** ูุณุชูุฏ. ุงูุง ฺฉ **Namespace** ุจุฑุง **Immutable Collections** ูุฌูุฏ ุฏุงุฑุฏ ุจู ูุงู:

**`System.Collections.Immutable`**

ุฌุฏูู ุฒุฑ ุจุฑุฎ ุงุฒ ุนูุงุตุฑ ููู ุงู Namespace ุฑุง ูุดุงู ูโุฏูุฏ:
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-17.jpeg)
</div>

Namespace **`System.Collections.Immutable`** ุดุงูู ูุฌููุนูโุง ุงุฒ **Immutable Collections** ุงุณุช ฺฉู ูโุชูุงูุฏ ุจูโุทูุฑ ุงูู ุจู Threadูุง ุงุณุชูุงุฏู ฺฉูุฏ. ุจุฑุง ุฌุฒุฆุงุช ุจุดุชุฑุ ุจู ููฺฉ ุฒุฑ ูุฑุงุฌุนู ฺฉูุฏ:
[https://docs.microsoft.com/en-us/dotnet/api/system.collections.immutable?view=netcore-3.1](https://docs.microsoft.com/en-us/dotnet/api/system.collections.immutable?view=netcore-3.1) ๐

---

### ุงุณุชูุงุฏู ุงุฒ Lock ุฏุฑ C# ๐

ุงุณุชูุงุฏู ุงุฒ **lock object** ุฏุฑ C# ุจุณุงุฑ ุณุงุฏู ุงุณุชุ ููุงูโุทูุฑ ฺฉู ุฏุฑ ููููู ฺฉุฏ ุฒุฑ ูโุจูุฏ:

```csharp
public class LockExample
{
    public object _lock = new object();

    public void UnsafeMethod()
    {
        lock(_lock)
        {
            // ุงุฌุฑุง ฺฉุฏ ุบุฑ ุงูู
        }
    }
}
```

* ุงุจุชุฏุง ูุชุบุฑ ุนุถู `_lock` ุฑุง ุงุฌุงุฏ ู ูููููโุณุงุฒ ูโฺฉูู.
* ุฒูุงู ฺฉู ูโุฎูุงูู ฺฉุฏ ฺฉู **Thread-Safe ูุณุช** ุฑุง ุงุฌุฑุง ฺฉููุ ุขู ุฑุง ุฏุงุฎู **lock** ูุฑุงุฑ ูโุฏูู ู `_lock` ุฑุง ุจู ุนููุงู **lock object** ุงุณุชูุงุฏู ูโฺฉูู.
* ููุช ฺฉ Thread ูุงุฑุฏ lock ูโุดูุฏุ ุชูุงู Threadูุง ุฏฺฏุฑ ุชุง ุฎุฑูุฌ Thread ูุนู ุงุฒ lockุ ุงุฌุงุฒู ุงุฌุฑุง ูุฏุงุฑูุฏ.

ฺฉ ูุดฺฉู ุงุญุชูุงู: **Deadlock**. ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุขู ูโุชูุงู ุงุฒ **Mutex** ุงุณุชูุงุฏู ฺฉุฑุฏ.

---

### ุงุณุชูุงุฏู ุงุฒ Mutex ๐ก๏ธ

ุงุจุชุฏุง ูุชุบุฑ Mutex ุฑุง ุชุนุฑู ฺฉูุฏ:

```csharp
private static readonly Mutex _mutex = new Mutex();
```

ุณูพุณ ฺฉุฏ ูุญุงูุธุชโุดุฏู ุฑุง ุจู ุงู ุตูุฑุช ุงุฌุฑุง ฺฉูุฏ:

```csharp
try
{
    _mutex.WaitOne();
    // ... ุงูุฌุงู ฺฉุงุฑ ...
}
finally
{
    _mutex.ReleaseMutex();
}
```

* **WaitOne()** Thread ูุนู ุฑุง ุชุง ุฒูุงู ุฏุฑุงูุช ุณฺฏูุงู ูุชููู ูโฺฉูุฏ.
* ูพุณ ุงุฒ ุฏุฑุงูุช ุณฺฏูุงูุ Thread ูุงูฺฉ **mutex** ูโุดูุฏ ู ูโุชูุงูุฏ ุจู ููุงุจุน ูุญุงูุธุชโุดุฏู ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏ.
* ูพุณ ุงุฒ ุงุชูุงู ฺฉุงุฑุ ุจุง **ReleaseMutex()** Mutex ุขุฒุงุฏ ูโุดูุฏ.
* ููู: ููุดู ReleaseMutex() ุฑุง ุฏุฑ ุจููฺฉ **finally** ูุฑุงุฑ ุฏูุฏ ุชุง ุฏุฑ ุตูุฑุช ุฑุฎ ุฏุงุฏู Exceptionุ ููุงุจุน ููฺูุงู ุขุฒุงุฏ ุดููุฏ. โ

---

### ุงุณุชูุงุฏู ุงุฒ Semaphore ๐ข

**Semaphore** ูุฒ ุดุจู Mutex ุนูู ูโฺฉูุฏุ ุงูุง ุชูุงูุช ุงุตู ุงู ุงุณุช ฺฉู **Mutex ูฺฉุงูุฒู ููู ุงุณุช** ู **Semaphore ูฺฉุงูุฒู ุณฺฏูุงูโุฏู**.

ูุซุงู ุชุนุฑู Semaphore:

```csharp
private static readonly Semaphore _semaphore = new Semaphore(2, 4);
```

* ูพุงุฑุงูุชุฑ ุงูู: ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง ููุฒูุงู ุงููู ฺฉู ูโุชูุงููุฏ ุงุฌุงุฒู ุฏุณุชุฑุณ ุจฺฏุฑูุฏ.
* ูพุงุฑุงูุชุฑ ุฏูู: ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง ููุฒูุงู ฺฉู ูโุชูุงููุฏ ุงุฌุงุฒู ุฏุณุชุฑุณ ุจฺฏุฑูุฏ.

ุงุณุชูุงุฏู ุฏุฑ ูุชุฏูุง:

```csharp
try
{
    _semaphore.WaitOne();
    // ... ุงูุฌุงู ฺฉุงุฑ ...
}
finally
{
    _semaphore.Release();
}
```

* Thread ูุนู ุชุง ุฏุฑุงูุช ุณฺฏูุงู ููุชุธุฑ ูโูุงูุฏุ ุณูพุณ ฺฉุงุฑ ุฎูุฏ ุฑุง ุงูุฌุงู ูโุฏูุฏ ู ุฏุฑ ููุงุช **Semaphore** ุขุฒุงุฏ ูโุดูุฏ.

---

### ูฺฉุงุช ููู ๐น

* ุฏุฑ ุงู ูุตู ุงุฏ ฺฏุฑูุชู ฺฉู ฺฺฏููู ุจุง **locksุ mutexes ู semaphores** ุงุฒ ฺฉุฏูุง ุบุฑ Thread-Safe ูุญุงูุธุช ฺฉูู.
* **Threadูุง ูพุณโุฒููู** ูพุณ ุงุฒ ุงุชูุงู ูพุฑูุณู ุฎุงุชูู ูโุงุจูุฏุ ุฏุฑ ุญุงู ฺฉู **Threadูุง ูพุดโุฒููู** ุชุง ูพุงุงู ุงุฌุฑุง ุงุฏุงูู ูโุฏููุฏ.
* ุงฺฏุฑ ูุงุฒ ุฏุงุฑุฏ ฺฉุฏ **ุชุง ูพุงุงู ุงุฌุฑุง ุจุฏูู ูุทุน ุดุฏู Thread** ุงุฏุงูู ูพุฏุง ฺฉูุฏุ ุจูุชุฑ ุงุณุช ุงุฒ **Foreground Threads** ุงุณุชูุงุฏู ฺฉูุฏ.

---

### ูุงุจุณุชฺฏโูุง ูุชุฏ ููุฒูุงู (Synchronized Method Dependencies) โก

ุจุฑุง ููุฒูุงูโุณุงุฒ ฺฉุฏูุง:

* ุงุฒ **lock statement** ุงุณุชูุงุฏู ฺฉูุฏ.
* ุง **Namespace** `System.Runtime.CompilerServices` ุฑุง ุงุถุงูู ฺฉุฑุฏู ู ุงุฒ annotation ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```csharp
[MethodImpl(MethodImplOptions.Synchronized)]
public static void ThisIsASynchronisedMethod()
{
    Console.WriteLine("Synchronised method called.");
}
```

ุจุง property ูุฒ ูโุชูุงู ููุฒูุงูโุณุงุฒ ุงูุฌุงู ุฏุงุฏ:

```csharp
private int i;
public int SomeProperty
{
    [MethodImpl(MethodImplOptions.Synchronized)]
    get { return i; }
    [MethodImpl(MethodImplOptions.Synchronized)]
    set { i = value; }
}
```

---

### ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณ Interlocked โก

ุฏุฑ ุจุฑูุงููโูุง ฺูุฏ ูุฎุ **ุฎุทุงูุง ููฺฏุงู Context Switching Threadูุง** ุฑุฎ ูโุฏููุฏุ ูุซูุงู ููุช ฺูุฏ Thread ูุชุบุฑ ฺฉุณุงู ุฑุง ุจูโุฑูุฒุฑุณุงู ูโฺฉููุฏ.

ฺฉูุงุณ **`System.Threading.Interlocked`** ุฏุฑ **mscorlib** ุจุฑุง ูุญุงูุธุช ุฏุฑ ุจุฑุงุจุฑ ุงู ุฎุทุงูุง ุงุณุชูุงุฏู ูโุดูุฏ.

ูฺฺฏโูุง:

* ุฑูุดโูุง **Exception** ููโุงูุฏุงุฒูุฏ ู ุนููฺฉุฑุฏ ุจูุชุฑ ูุณุจุช ุจู lock ุฏุงุฑูุฏ.
* ุจุฑุง ุงุนูุงู ุชุบุฑุงุช ุณุงุฏู ุฏุฑ ูุถุนุช ูุชุบุฑูุง ุงุฏูโุขู ูุณุชูุฏ.

---

### ูุชุฏูุง ููุฌูุฏ ุฏุฑ Interlocked ๐ง

* **CompareExchange**: ููุงุณู ุฏู ูุชุบุฑ ู ุฐุฎุฑู ูุชุฌู ุฏุฑ ูุชุบุฑ ุฏฺฏุฑ
* **Add**: ุฌูุน ุฏู ูุชุบุฑ Int32 ุง Int64 ู ุฐุฎุฑู ูุชุฌู ุฏุฑ ูุชุบุฑ ุงูู
* **Decrement**: ฺฉุงูุด ููุฏุงุฑ Int32 ู Int64 ู ุฐุฎุฑู ูุชุฌู
* **Increment**: ุงูุฒุงุด ููุฏุงุฑ Int32 ู Int64 ู ุฐุฎุฑู ูุชุฌู
* **Read**: ุฎูุงูุฏู ูุชุบุฑูุง Int64
* **Exchange**: ุชุจุงุฏู ููุงุฏุฑ ุจู ูุชุบุฑูุง
ูุง ุงฺฉููู ูุตุฏ ุฏุงุฑู ฺฉ ุจุฑูุงููโ ุณุงุฏูโ ฺฉูุณูู ุจููุณู ฺฉู ุงู ุฑูุดโูุง ุฑุง ููุงุด ุฏูุฏ. ๐ป

ุงุจุชุฏุง ฺฉ ุจุฑูุงููโ ุฌุฏุฏ **.NET Framework Console Application** ุงุฌุงุฏ ฺฉูุฏ ู ุฎุทูุท ุฒุฑ ุฑุง ุฏุฑ ุจุงูุง ฺฉูุงุณ **Program** ุงุถุงูู ฺฉูุฏ:

```csharp
private static long _value = long.MaxValue;
private static int _resourceInUse = 0;
```

ูุชุบุฑ `_value` ุจุฑุง ูุดุงู ุฏุงุฏู ุจูโุฑูุฒุฑุณุงู ูุชุบุฑูุง ุจุง ุงุณุชูุงุฏู ุงุฒ ุฑูุดโูุง **interlocking** ุงุณุชูุงุฏู ูโุดูุฏ. ูุชุบุฑ `_resourceInUse` ุจุฑุง ูุดุงู ุฏุงุฏู ุงู ุงุณุช ฺฉู ุขุง ฺฉ ููุจุน ุฏุฑ ุญุงู ุงุณุชูุงุฏู ุงุณุช ุง ุฎุฑ.

ุณูพุณ ูุชุฏ **CompareExchangeVariables()** ุฑุง ุงุถุงูู ฺฉูุฏ:

```csharp
private static void CompareExchangeVariables()
{
    Interlocked.CompareExchange(ref _value, 123, long.MaxValue);
}
```

ุฏุฑ ูุชุฏ **CompareExchangeVariables()**ุ ูุง ูุชุฏ **CompareExchange()** ุฑุง ูุฑุงุฎูุงู ูโฺฉูู ุชุง `_value` ุฑุง ุจุง `long.MaxValue` ููุงุณู ฺฉูุฏ. ุงฺฏุฑ ุฏู ููุฏุงุฑ ุจุฑุงุจุฑ ุจุงุดูุฏุ `_value` ุจุง ููุฏุงุฑ `123` ุฌุงฺฏุฒู ูโุดูุฏ.

ุญุงูุง ูุชุฏ **AddVariables()** ุฑุง ุงุถุงูู ูโฺฉูู:

```csharp
private static void AddVariables()
{
    Interlocked.Add(ref _value, 321);
}
```

ูุชุฏ **AddVariables()** ูุชุฏ **Add()** ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ ุชุง ุจู ูุชุบุฑ ุนุถู `_value` ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ ู ุขู ุฑุง ุจุง ููุฏุงุฑ `_value + 321` ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ.

ุณูพุณ ูุชุฏ **DecrementVariable()** ุฑุง ุงุถุงูู ูโฺฉูู:

```csharp
private static void DecrementVariable()
{
    Interlocked.Decrement(ref _value);
}
```

ุงู ูุชุฏุ ูุชุฏ **Decrement()** ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ ฺฉู ููุฏุงุฑ ูุชุบุฑ ุนุถู `_value` ุฑุง ฑ ูุงุญุฏ ฺฉุงูุด ูโุฏูุฏ.

ูุชุฏ ุจุนุฏ **IncrementVariable()** ุงุณุช:

```csharp
private static void IncrementVariable()
{
    Interlocked.Increment(ref _value);
}
```

ุฏุฑ **IncrementVariable()**ุ ููุฏุงุฑ ูุชุบุฑ ุนุถู `_value` ุจุง ูุฑุงุฎูุงู ูุชุฏ **Increment()** ุงูุฒุงุด ูโุงุจุฏ.

ุญุงูุง ูุชุฏ **ReadVariable()** ุฑุง ูโููุณู:

```csharp
private static long ReadVariable()
{
    // ูุชุฏ Read ุฏุฑ ุณุณุชูโูุง 64 ุจุช ูุงุฒู ูุณุชุ
    // ฺูู ุนููุงุช ุฎูุงูุฏู 64 ุจุช ุจูโุตูุฑุช atomic ุงูุฌุงู ูโุดูุฏ.
    // ุฏุฑ ุณุณุชูโูุง 32 ุจุชุ ุนููุงุช ุฎูุงูุฏู 64 ุจุช atomic ูุณุช
    // ูฺฏุฑ ุงูฺฉู ุจุง Read ุงูุฌุงู ุดูุฏ.
    return Interlocked.Read(ref _value);
}
```

ุงุฒ ุขูุฌุง ฺฉู ุนููุงุช ุฎูุงูุฏู ถด ุจุช atomic ุงุณุชุ ูุฑุงุฎูุงู ูุชุฏ **Interlocked.Read()** ุฏุฑ ุณุณุชูโูุง ถด ุจุช ุถุฑูุฑ ูุณุช. ุงูุง ุฏุฑ ุณุณุชูโูุง ณฒ ุจุชุ ุจุฑุง ุงูฺฉู ุฎูุงูุฏู ถด ุจุช atomic ุจุงุดุฏุ ุจุงุฏ ุงุฒ **Interlocked.Read()** ุงุณุชูุงุฏู ฺฉูุฏ.

ุณูพุณ ูุชุฏ **PerformUnsafeCodeSafely()** ุฑุง ุงุถุงูู ูโฺฉูู:

```csharp
private static void PerformUnsafeCodeSafely()
{
    for (int i = 0; i < 5; i++)
    {
        UseResource();
        Thread.Sleep(1000);
    }
}
```

ูุชุฏ **PerformUnsafeCodeSafely()** ูพูุฌ ุจุงุฑ ุญููู ูโุฒูุฏ. ุฏุฑ ูุฑ ุจุงุฑ ุญูููุ ูุชุฏ **UseResource()** ูุฑุงุฎูุงู ูโุดูุฏ ู ุณูพุณ ูุฎ ุจุฑุง ฺฉ ุซุงูู ุจู ุฎูุงุจ ูโุฑูุฏ.

ุญุงูุง ูุชุฏ **UseResource()** ุฑุง ุงุถุงูู ูโฺฉูู:

```csharp
static bool UseResource()
{
    if (0 == Interlocked.Exchange(ref _resourceInUse, 1))
    {
        Console.WriteLine($"{Thread.CurrentThread.Name} acquired the lock");
        NonThreadSafeResourceAccess();
        Thread.Sleep(500);
        Console.WriteLine($"{Thread.CurrentThread.Name} exiting lock");
        Interlocked.Exchange(ref _resourceInUse, 0);
        return true;
    }
    else
    {
        Console.WriteLine($"{Thread.CurrentThread.Name} was denied the lock");
        return false;
    }
}
```

ูุชุฏ **UseResource()** ุฌููฺฏุฑ ูโฺฉูุฏ ุงุฒ ุงูฺฉู ุงฺฏุฑ ููุจุน ุฏุฑ ุญุงู ุงุณุชูุงุฏู ุงุณุชุ **lock** ฺฏุฑูุชู ุดูุฏุ ููุงูุทูุฑ ฺฉู ุชูุณุท ูุชุบุฑ `_resourceInUse` ูุดุฎุต ุดุฏู ุงุณุช. ุงุจุชุฏุง ููุฏุงุฑ `_resourceInUse` ุฑุง ุจุง ูุฑุงุฎูุงู ูุชุฏ **Exchange()** ุฑู ฑ ุชูุธู ูโฺฉูู. ูุชุฏ **Exchange()** ฺฉ ุนุฏุฏ ุจุงุฒูโฺฏุฑุฏุงูุฏ ฺฉู ุจุง ฐ ููุงุณู ูโุดูุฏ. ุงฺฏุฑ ููุฏุงุฑ ุจุงุฒฺฏุดุช ฐ ุจุงุดุฏุ ูุชุฏ ุฏุฑ ุญุงู ุงุณุชูุงุฏู ูุณุช.

ุงฺฏุฑ ูุชุฏ ุฏุฑ ุญุงู ุงุณุชูุงุฏู ุจุงุดุฏุ ูพุงู ุจู ฺฉุงุฑุจุฑ ููุงุด ุฏุงุฏู ูโุดูุฏ ฺฉู ูุฎ ูุนู ุงุฌุงุฒูโ lock ูุฏุงุฑุฏ.
ุงฺฏุฑ ูุชุฏ ุขุฒุงุฏ ุจุงุดุฏุ ูพุงู ุจู ฺฉุงุฑุจุฑ ููุงุด ุฏุงุฏู ูโุดูุฏ ฺฉู ูุฎ ูุนู lock ุฑุง ฺฏุฑูุชู ุงุณุช. ุณูพุณ ูุชุฏ **NonThreadSafeResourceAccess()** ูุฑุงุฎูุงู ูโุดูุฏ ู ูุฎ ุจุฑุง ูู ุซุงูู ุจู ุฎูุงุจ ูโุฑูุฏ ุชุง ุดุจูโุณุงุฒ ฺฉุงุฑ ุงูุฌุงู ุดูุฏ.

ูพุณ ุงุฒ ุจุฏุงุฑ ุดุฏู ูุฎุ ูพุงู ูุดุงู ูโุฏูุฏ ฺฉู ูุฎ ูุนู ุงุฒ lock ุฎุงุฑุฌ ุดุฏู ุงุณุช ู ุณูพุณ lock ุจุง ูุฑุงุฎูุงู **Exchange()** ุขุฒุงุฏ ูโุดูุฏ ู ููุฏุงุฑ `_resourceInUse` ุจู ฐ ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏ.

ูุชุฏ **NonThreadSafeResourceAccess()** ุฑุง ุงุถุงูู ฺฉูุฏ:

```csharp
private static void NonThreadSafeResourceAccess()
{
    Console.WriteLine("Non-thread-safe code executed.");
}
```

ุฏุฑ **NonThreadSafeResourceAccess()** ฺฉุฏ ุบุฑ thread-safe ุฏุฑ ุงููุช lock ุงุฌุฑุง ูโุดูุฏ. ุฏุฑ ูุซุงู ูุงุ ููุท ูพุงู ุจู ฺฉุงุฑุจุฑ ููุงุด ุฏุงุฏู ูโุดูุฏ.

ุฏุฑ ููุงุชุ ูุชุฏ **Main()** ุฑุง ุจู ุดฺฉู ุฒุฑ ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ:

```csharp
static void Main(string[] args)
{
    CompareExchangeVariables();
    AddVariables();
    DecrementVariable();
    IncrementVariable();
    ReadVariable();
    PerformUnsafeCodeSafely();
}
```

ูุชุฏ **Main()** ูุชุฏูุง ฺฉู ุฑูุดโูุง **Interlocked** ุฑุง ุชุณุช ูโฺฉููุฏุ ูุฑุงุฎูุงู ูโฺฉูุฏ. โ

ุงฺฏุฑ ฺฉุฏ ุฑุง ุงุฌุฑุง ฺฉูุฏุ ุฎุฑูุฌ ูุดุงุจู ฺุฒ ุฎูุงูุฏ ุจูุฏ ฺฉู ุงูุชุธุงุฑ ุฏุงุฑู.

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/08/Table%208-18.jpeg)
</div>

ุญุงู ุจุงุฏ ุจู ุจุฑุฎ ุชูุตูโูุง ุนููู ุจูพุฑุฏุงุฒู. ๐

### ุชูุตูโูุง ุนููู โ๏ธ

ุฏุฑ ุงู ุจุฎุด ููุงุ ุจุฑุฎ ุงุฒ ุชูุตูโูุง ูุงฺฉุฑูุณุงูุช ุจุฑุง ฺฉุงุฑ ุจุง ุจุฑูุงููโูุง **multi-threaded** ุฑุง ุจุฑุฑุณ ูโฺฉูู. ุงู ุชูุตูโูุง ุดุงูู ููุงุฑุฏ ุฒุฑ ูุณุชูุฏ:

* ุงุฒ **Thread.Abort** ุจุฑุง ุฎุงุชูู ุฏุงุฏู ุจู ุณุงุฑ threadูุง ุงุฌุชูุงุจ ฺฉูุฏ.
* ุงุฒ **mutex**ุ **ManualResetEvent**ุ **AutoResetEvent** ู **Monitor** ุจุฑุง ููฺฏุงูโุณุงุฒ ูุนุงูุชโูุง ุจู ฺูุฏ thread ุงุณุชูุงุฏู ฺฉูุฏ.
* ูุฑ ุฌุง ฺฉู ููฺฉู ุงุณุชุ ุงุฒ **thread pool** ุจุฑุง threadูุง ฺฉุงุฑ ุงุณุชูุงุฏู ฺฉูุฏ.
* ุงฺฏุฑ threadูุง ฺฉุงุฑ ุดูุง ูุณุฏูุฏ ุดุฏูุฏุ ุงุฒ **Monitor.PulseAll** ุจุฑุง ุงุทูุงุน ุฏุงุฏู ุจู ููู threadูุง ุงุฒ ุชุบุฑ ูุถุนุช thread ฺฉุงุฑ ุงุณุชูุงุฏู ฺฉูุฏ.
* ุงุฒ ุงุณุชูุงุฏู ุงุฒ **this**ุ ูููููโูุง ููุนโูุง (**type instances**) ู ูููููโูุง ุฑุดุชูโุง (**string instances**) ุงุฒ ุฌููู ุฑุดุชูโูุง literal ุจูโุนููุงู **lock objects** ุงุฌุชูุงุจ ฺฉูุฏ. ุงุณุชูุงุฏู ุงุฒ ููุน lockูุง ูโุชูุงูุฏ ุฎุทุฑ deadlock ุงุฌุงุฏ ฺฉูุฏุ ูพุณ ูุฑุงูุจ ุจุงุดุฏ.
* ุงุฒ ุจููฺฉ **try/finally** ุจุง threadูุง ฺฉู ูุงุฑุฏ **monitor** ูโุดููุฏ ุงุณุชูุงุฏู ฺฉูุฏุ ุชุง ุฏุฑ ุจููฺฉ **finally** ุงุทููุงู ุญุงุตู ุดูุฏ ฺฉู thread ุจุง ูุฑุงุฎูุงู **Monitor.Exit()** ุงุฒ monitor ุฎุงุฑุฌ ูโุดูุฏ.
* ุจุฑุง ููุงุจุน ูุฎุชููุ ุงุฒ threadูุง ุฌุฏุงฺฏุงูู ุงุณุชูุงุฏู ฺฉูุฏ ู ุงุฒ ุงุฎุชุตุงุต ฺูุฏ thread ุจู ฺฉ ููุจุน ุงุฌุชูุงุจ ฺฉูุฏ.
* ูุธุงู **I/O** ุจุงุฏ thread ูุฎุตูุต ุฎูุฏ ุฑุง ุฏุงุดุชู ุจุงุดูุฏุ ุฒุฑุง ููฺฏุงู ุงูุฌุงู ุนููุงุช I/O ูุณุฏูุฏ ูโุดููุฏ ู ุงู ุงุฌุงุฒู ูโุฏูุฏ ุณุงุฑ threadูุง ุงุฌุฑุง ุดููุฏ.
* ูุฑูุฏ ฺฉุงุฑุจุฑ ุจุงุฏ thread ูุฎุตูุต ุจู ุฎูุฏ ุฑุง ุฏุงุดุชู ุจุงุดุฏ.
* ุจุฑุง ุจูุจูุฏ ุนููฺฉุฑุฏ ุฏุฑ ุชุบุฑุงุช ุณุงุฏู ูุถุนุชุ ุงุฒ ูุชุฏูุง ฺฉูุงุณ **System.Threading.Interlocked** ุจู ุฌุง ุฏุณุชูุฑ **lock** ุงุณุชูุงุฏู ฺฉูุฏ.
* ุจุฑุง ฺฉุฏูุง ฺฉู ุงุณุชูุงุฏู ุฒุงุฏ ุฏุงุฑูุฏุ ุงุฒ ููฺฏุงูโุณุงุฒ ุงุฌุชูุงุจ ฺฉูุฏุ ุฒุฑุง ูโุชูุงูุฏ ููุฌุฑ ุจู deadlock ู race condition ุดูุฏ.
* ุฏุงุฏูโูุง **static** ุจุงุฏ ุจูโุตูุฑุช ูพุดโูุฑุถ **thread-safe** ุจุงุดูุฏ.
* ุฏุงุฏูโูุง **instance** ูุจุงุฏ ุจูโุตูุฑุช ูพุดโูุฑุถ **thread-safe** ุจุงุดูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ุนููฺฉุฑุฏ ฺฉุงูุด ูโุงุจุฏุ ุฑูุงุจุช ุจุฑ ุณุฑ lock ุงูุฒุงุด ูโุงุจุฏ ู ุงูฺฉุงู ูููุน race condition ู deadlock ุงูุฒุงุด ูโุงุจุฏ.
* ุงุฒ ูุชุฏูุง **static** ฺฉู state ุฑุง ุชุบุฑ ูโุฏููุฏ ุงุฌุชูุงุจ ฺฉูุฏุ ุฒุฑุง ููุฌุฑ ุจู ุจุงฺฏโูุง threading ูโุดููุฏ.

---

### ุฌูุนโุจูุฏ ๐

ุฏุฑ ุงู ูุตูุ ูุง ุจุฑุฑุณ ฺฉุฑุฏู ฺฉู **threading** ฺุณุช ู ฺฺฏููู ุงุฒ ุขู ุงุณุชูุงุฏู ฺฉูู. ูุง ูุดฺฉูุงุช **deadlock** ู **race condition** ุฑุง ูุดุงูุฏู ฺฉุฑุฏู ู ุฏุฏู ฺฺฏููู ูโุชูุงู ุจุง ุงุณุชูุงุฏู ุงุฒ **lock statement** ู ฺฉุชุงุจุฎุงูู **TPL** ุงุฒ ุงู ุดุฑุงุท ุงุณุชุซูุง ุฌููฺฏุฑ ฺฉุฑุฏ. ููฺูู ุจู ุจุฑุฑุณ **thread safety** ุฏุฑ **static constructors**ุ **static methods**ุ **immutable objects** ู **mutable objects** ูพุฑุฏุงุฎุชู. ูุดุงูุฏู ฺฉุฑุฏู ฺฉู ุงุณุชูุงุฏู ุงุฒ **immutable objects** ุฑุงู ุงูู ุจุฑุง ุงูุชูุงู ุฏุงุฏู ุจู threadูุง ุงุณุช ู ุจุฑุฎ ุชูุตูโูุง ุนููู ุจุฑุง ฺฉุงุฑ ุจุง threadูุง ูุฑูุฑ ุดุฏ.

ููฺูู ุฏุฏู ฺฉู ฺฺฏููู ุงูู ฺฉุฑุฏู ฺฉุฏ ุจุฑุง threadูุง ูโุชูุงูุฏ ูุฒุงุง ุฒุงุฏ ุฏุงุดุชู ุจุงุดุฏ. โ

ุฏุฑ ูุตู ุจุนุฏุ ุจู ุทุฑุงุญ **APIs** ูุคุซุฑ ุฎูุงูู ูพุฑุฏุงุฎุช. ุงูุง ุฏุฑ ุญุงู ุญุงุถุฑ ูโุชูุงูุฏ ุฏุงูุด ุฎูุฏ ุฑุง ุจุง ูพุงุณุฎ ุฏุงุฏู ุจู ุณูุงูุงุช ุฒุฑ ุงูุชุญุงู ฺฉูุฏ ู ูุทุงูุนู ุฎูุฏ ุฑุง ุจุง ูุฑุงุฌุนู ุจู ููฺฉโูุง ุงุฑุงุฆู ุดุฏู ุงุฏุงูู ุฏูุฏ.

---

### ุณูุงูุงุช โ

1. **Thread ฺุณุชุ**
2. ุฏุฑ ฺฉ ุจุฑูุงูู **single-threaded** ฺูุฏ thread ูุฌูุฏ ุฏุงุฑุฏุ
3. ฺู ุงููุงุน ุงุฒ thread ูุฌูุฏ ุฏุงุฑุฏุ
4. ฺฉุฏุงู thread ุจูุงูุงุตูู ูพุณ ุงุฒ ุฎุฑูุฌ ุจุฑูุงูู ุฎุงุชูู ูโุงุจุฏุ
5. ฺฉุฏุงู thread ุญุช ูพุณ ุงุฒ ุฎุฑูุฌ ุจุฑูุงูู ุชุง ุชฺฉูู ุงุฏุงูู ูโุงุจุฏุ
6. ฺู ฺฉุฏ ุจุงุนุซ ูโุดูุฏ ฺฉ thread ุจู ูุฏุช ูู ููโุซุงูู ุจุฎูุงุจุฏุ
7. ฺฺฏููู ฺฉ thread ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู ูุชุฏ ุจู ูุงู **Method1** ุฑุง ูุฑุงุฎูุงู ฺฉูุฏุ
8. ฺฺฏููู ฺฉ thread ุฑุง ุจู **background thread** ุชุจุฏู ูโฺฉูุฏุ
9. **Deadlock** ฺุณุชุ
10. ฺฺฏููู ุงุฒ ฺฉ lock ฺฉู ุจุง **Monitor.TryEnter(objectName)** ฺฏุฑูุชู ุดุฏู ุฎุงุฑุฌ ูโุดูุฏุ
11. ฺฺฏููู ูโุชูุงู ุงุฒ **deadlock** ุจุงุฒุงุจ ฺฉุฑุฏุ
12. **Race condition** ฺุณุชุ
13. ฺฉ ุฑูุด ุจุฑุง ุฌููฺฏุฑ ุงุฒ **race condition** ฺุณุชุ
14. ฺู ฺุฒ ูุชุฏูุง **static** ุฑุง ูุงุงูู ูโฺฉูุฏุ
15. ุขุง **static constructors** thread-safe ูุณุชูุฏุ
16. ฺู ฺุฒ ูุณุฆูู ูุฏุฑุช ฺฏุฑููโูุง thread ุงุณุชุ
17. **Immutable object** ฺุณุชุ
18. ฺุฑุง ุฏุฑ ุจุฑูุงููโูุง multi-threadedุ **immutable objects** ูุณุจุช ุจู **mutable objects** ุชุฑุฌุญ ุฏุงุฏู ูโุดููุฏุ

---

### ูุทุงูุนูโ ุจุดุชุฑ ๐

* [Examples of using mutex and semaphore](https://www.c-sharpcorner.com/blogs/mutex-and-semaphore-inthread)
* [Differences between mutex and semaphore](https://www.guru99.com/mutex-vs-semaphore.html)
* [Official Microsoft documentation on static constructors](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/static-constructors)
* [Microsoft guidance on managed threading best practices](https://docs.microsoft.com/en-us/dotnet/standard/threading/managedthreading-best-practices)
* [Official Microsoft API documentation for the TPL](https://docs.microsoft.com/en-us/dotnet/standard/parallel-programming/task-parallel-library-tpl)
* [Interlocked class in C# threading](https://www.c-sharpcorner.com/UploadFile/1d42da/interlocked-class-inC-Sharp-threading/)
* [Discussion on System.Threading.Interlocked](http://geekswithblogs.net/BlackRabbitCoder/archive/2012/08/23/c.net-little-wonders-interlocked-read-and-exchange.aspx)
* [Free eBook about threading in C#](http://www.albahari.com/threading/)
* [Immutable collections in System.Collections.Immutable](https://docs.microsoft.com/en-us/dotnet/api/system.collections.immutable?view=netcore-3.1)
