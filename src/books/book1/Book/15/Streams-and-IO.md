---
layout: layout.njk
title: ุงุณุชุฑูโูุง ู ูุฑูุฏ/ุฎุฑูุฌ (Streams and I/O)
---
# ูุตู ูพุงูุฒุฏูู:  ุงุณุชุฑูโูุง ู ูุฑูุฏ/ุฎุฑูุฌ (Streams and I/O)

ุงู ูุตูุ ุงููุงุน ุจูุงุฏ ุจุฑุง **ูุฑูุฏ (Input)** ู **ุฎุฑูุฌ (Output)** ุฏุฑ .NET ุฑุง ุชูุถุญ ูโุฏูุฏุ ุจุง ุชูุฑฺฉุฒ ูฺู ุฑู ููุถูุนุงุช ุฒุฑ:

* ูุนูุงุฑ **Stream** ุฏุฑ .NET ู ุงูโฺฉู ฺุทูุฑ ฺฉ ุฑุงุจุท ุจุฑูุงููโููุณ (Programming Interface) ฺฉูพุงุฑฺู ุจุฑุง **ุฎูุงูุฏู** ู **ููุดุชู** ุฑู ุงููุงุน ูุฎุชูู I/O ูุฑุงูู ูโฺฉูุฏ.
* ฺฉูุงุณโูุง ุจุฑุง ฺฉุงุฑ ุจุง **ูุงูโูุง** ู **ุฏุงุฑฺฉุชูุฑโูุง** ุฑู ุฏุณฺฉ.
* ุงุณุชุฑูโูุง ุชุฎุตุต ุจุฑุง **ูุดุฑุฏูโุณุงุฒ (Compression)**ุ **Named Pipes**ุ ู **Memory-Mapped Files**.

ุงู ูุตู ุจุดุชุฑ ุฑู ููุนโูุง ุฏุฑ ูุถุง ูุงู `System.IO` ุชูุฑฺฉุฒ ุฏุงุฑุฏุ ุฌุง ฺฉู ูุงุจูุชโูุง ุณุทุญ ูพุงู I/O ูุฑุงุฑ ฺฏุฑูุชูโุงูุฏ.

---

## ๐๏ธ ูุนูุงุฑ Stream

ูุนูุงุฑ Stream ุฏุฑ .NET ุญูู ุณู ููููู ุงุตู ูโฺุฑุฎุฏ:

* **Backing Stores**
* **Decorators**
* **Adapters**

ููุงูโุทูุฑ ฺฉู ุฏุฑ ุดฺฉู 15-1 ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช.

**Backing Store** ููุงู ููุทู ุงูุชูุง ุงุณุช ฺฉู ูุฑูุฏ ู ุฎุฑูุฌ ุฑุง ฺฉุงุฑุจุฑุฏ ูโฺฉูุฏุ ูุซู ฺฉ ูุงู ุง ุงุชุตุงู ุดุจฺฉู. ุจูโุทูุฑ ุฏููโุชุฑุ Backing Store ูโุชูุงูุฏ ฺฉ ุง ูุฑ ุฏู ููุงุฑุฏ ุฒุฑ ุจุงุดุฏ:

* ฺฉ ููุจุน (Source) ฺฉู ุจุงุชโูุง ูโุชูุงููุฏ ุจูโุตูุฑุช ุชุฑุชุจ (Sequential) ุงุฒ ุขู ุฎูุงูุฏู ุดููุฏ.
* ฺฉ ููุตุฏ (Destination) ฺฉู ุจุงุชโูุง ูโุชูุงููุฏ ุจูโุตูุฑุช ุชุฑุชุจ ุฏุฑ ุขู ููุดุชู ุดููุฏ.

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/15/Table-15-1.jpeg)
</div>

### ๐ Backing Store

ฺฉ **Backing Store** ุจูโุชููุง ูฺ ฺฉุงุฑุจุฑุฏ ุจุฑุง ุจุฑูุงููโููุณ ูุฏุงุฑุฏุ ูฺฏุฑ ุงูโฺฉู ุฏุฑ ูุนุฑุถ ุงุณุชูุงุฏู ูุฑุงุฑ ฺฏุฑุฏ. ฺฉูุงุณ ุงุณุชุงูุฏุงุฑุฏ .NET ุจุฑุง ุงู ููุธูุฑุ **Stream** ุงุณุช. ุงู ฺฉูุงุณ ูุฌููุนูโุง ุงุณุชุงูุฏุงุฑุฏ ุงุฒ ูุชุฏูุง ุฑุง ุจุฑุง **ุฎูุงูุฏู (Reading)**ุ **ููุดุชู (Writing)** ู **ูฺฉุงูโุงุจ (Positioning)** ุฏุฑ ุงุฎุชุงุฑ ูุฑุงุฑ ูโุฏูุฏ.

ุจุฑุฎูุงู **ุขุฑุงู (Array)** ฺฉู ููู ุฏุงุฏูโูุง ูพุดุชุจุงู ุขู ุจูโุทูุฑ ููโุฒูุงู ุฏุฑ ุญุงูุธู ูุฑุงุฑ ุฏุงุฑูุฏุ **Stream** ุฏุงุฏูโูุง ุฑุง ุจูโุตูุฑุช **ุณุฑุงู (Serially)** ูุฏุฑุช ูโฺฉูุฏโุง ฺฉ ุจุงุช ุฏุฑ ูุฑ ุจุงุฑุ ุง ุฏุฑ ุจููฺฉโูุง ุจุง ุงูุฏุงุฒู ูุงุจู ูุฏุฑุช. ุจู ููู ุฏููุ ฺฉ Stream ูโุชูุงูุฏ ุจุฏูู ุชูุฌู ุจู ุงูุฏุงุฒู Backing Storeุ ููุท ุงุฒ ููุฏุงุฑ ฺฉู ุญุงูุธู ุซุงุจุช ุงุณุชูุงุฏู ฺฉูุฏ.

---

### ๐๏ธ ุฏุณุชูโุจูุฏ Streamูุง

ุงุณุชุฑูโูุง ุจู ุฏู ุฏุณุชู ุชูุณู ูโุดููุฏ:

1. **Backing Store Streams**
   ุงู ุงุณุชุฑูโูุง ุจู ฺฉ ููุน ุฎุงุต ุงุฒ Backing Store ูุชุตู ูุณุชูุฏุ ูุซู `FileStream` ุง `NetworkStream`.

2. **Decorator Streams**
   ุงู ุงุณุชุฑูโูุง ุฑู ฺฉ ุงุณุชุฑู ุฏฺฏุฑ ุณูุงุฑ ูโุดููุฏ ู ุฏุงุฏูโูุง ุฑุง ุจู ููุน ุชุบุฑ ูโุฏููุฏุ ูุซู `DeflateStream` ุง `CryptoStream`.

---

### ๐ ูุฒุงุง ูุนูุงุฑ Decorator Streams

* ุขูโูุง ุงุณุชุฑูโูุง Backing Store ุฑุง ุงุฒ ูุงุฒ ุจู ูพุงุฏูโุณุงุฒ ูฺฺฏโูุง ูุซู **ูุดุฑุฏูโุณุงุฒ (Compression)** ู **ุฑูุฒูฺฏุงุฑ (Encryption)** ุขุฒุงุฏ ูโฺฉููุฏ.
* ููุช ฺฉ ุงุณุชุฑู ุจุง Decorator ูพูุดุงูุฏู ูโุดูุฏุ **ุฑุงุจุท (Interface)** ุขู ุชุบุฑ ููโฺฉูุฏ.
* ุดูุง ูโุชูุงูุฏ Decoratorูุง ุฑุง **ุฏุฑ ุฒูุงู ุงุฌุฑุง (Runtime)** ูุชุตู ฺฉูุฏ.
* ูโุชูุงู ฺูุฏ Decorator ุฑุง ุจู ูู ุฒูุฌุฑ ฺฉุฑุฏ (ูุซูุงู ฺฉ **ูุดุฑุฏูโุณุงุฒ** ู ุณูพุณ ฺฉ **ุฑูุฒูฺฏุงุฑ**).

---

### ๐ ููุด Adapter

ูุฑ ุฏู ููุน ุงุณุชุฑู (Backing Store ู Decorator) ุตุฑูุงู ุจุง **ุจุงุชโูุง** ฺฉุงุฑ ูโฺฉููุฏ. ฺฏุฑฺู ุงู ุฑูฺฉุฑุฏ ุงูุนุทุงูโูพุฐุฑ ู ฺฉุงุฑุขูุฏ ุงุณุชุ ูู ุจุณุงุฑ ุงุฒ ุจุฑูุงููโูุง ุฏุฑ ุณุทูุญ ุจุงูุงุชุฑ ฺฉุงุฑ ูโฺฉููุฏโูุซู **ูุชู (Text)** ุง **XML**.

ุงูุฌุง ุงุณุช ฺฉู **Adapter** ูุงุฑุฏ ุนูู ูโุดูุฏ. Adapter ุจุง **ูพูุดุงูุฏู (Wrapping)** ฺฉ ุงุณุชุฑูุ ูุชุฏูุง ุชุฎุตุต ุจุฑุง ฺฉ ูุฑูุช ุฎุงุต ุงุฑุงุฆู ูโุฏูุฏ.

* ฺฉ **TextReader** ูุชุฏ ุจู ูุงู `ReadLine` ุฏุงุฑุฏ.
* ฺฉ **XmlWriter** ูุชุฏ ุจู ูุงู `WriteAttributes` ุฏุงุฑุฏ.

Adapter ุฏุฑุณุช ูุซู ฺฉ Decoratorุ ฺฉ ุงุณุชุฑู ุฑุง ูโูพูุดุงูุฏ. ุงูุง ุจุฑ ุฎูุงู Decoratorุ ุฎูุฏ ฺฉ ุงุณุชุฑู ูุณุช ู ูุนูููุงู ูุชุฏูุง **ุจุงุชโูุญูุฑ** ุฑุง ุจูโุทูุฑ ฺฉุงูู ูพููุงู ูโฺฉูุฏ.

---

### ๐ ุฎูุงุตู

* **Backing Store Streams** ุฏุงุฏู ุฎุงู ุฑุง ูุฑุงูู ูโฺฉููุฏ.
* **Decorator Streams** ุชุบุฑุงุช ุจุงูุฑ ุดูุงู ูุซู ุฑูุฒูฺฏุงุฑ ุงุฑุงุฆู ูโุฏููุฏ.
* **Adapters** ูุชุฏูุง ุณุทุญ ุจุงูุงุชุฑ ุจุฑุง ฺฉุงุฑ ุจุง ุงููุงุน ูุซู ุฑุดุชูโูุง (Strings) ู XML ูุฑุงูู ูโฺฉููุฏ.

๐ ุดฺฉู 15-1 ุงุฑุชุจุงุท ูุงู ุงู ุงุฌุฒุงุก ุฑุง ูุดุงู ูโุฏูุฏ. ุจุฑุง ุณุงุฎุช ฺฉ ุฒูุฌุฑูุ ฺฉุงู ุงุณุช ฺฉ ุดุก ุฑุง ุจู ุณุงุฒูุฏู (Constructor) ุดุก ุฏฺฏุฑ ุจุฏูุฏ.

---

## โ๏ธ ุงุณุชูุงุฏู ุงุฒ Streams

ฺฉูุงุณ **Stream** ฺฉ ฺฉูุงุณ **Abstract** ุงุณุช ฺฉู ูพุงูโุง ุจุฑุง ุชูุงู ุงุณุชุฑูโูุง ูุญุณูุจ ูโุดูุฏ. ุงู ฺฉูุงุณ ูุชุฏูุง ู ูฺฺฏโูุง ุจุฑุง ุณู ุนููุงุช ุจูุงุฏ ุชุนุฑู ูโฺฉูุฏ:

* **ุฎูุงูุฏู (Reading)**
* **ููุดุชู (Writing)**
* **ุฌุณุชุฌู ุง ูฺฉุงูโุงุจ (Seeking)**

ุจูโุนูุงููุ ุจุฑุง ฺฉุงุฑูุง ูุฏุฑุช ูุซู:

* **ุจุณุชู (Closing)**
* **ุชุฎูู ุง Flush ฺฉุฑุฏู**
* **ูพฺฉุฑุจูุฏ Timeoutูุง**

ูุฒ ูุชุฏูุง ู ูฺฺฏโูุง ุฏุฑ ุงุฎุชุงุฑ ูุฑุงุฑ ูโุฏูุฏ (ุฌุฏูู 15-1 ุฑุง ุจุจูุฏ).
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/15/Table-15-2.jpeg)
</div>

### โก ูุณุฎูโูุง Asynchronous

ูุชุฏูุง **Read** ู **Write** ูุณุฎูโูุง **Asynchronous** ูู ุฏุงุฑูุฏ ฺฉู ููุฏุงุฑ **Task** ุจุฑูโฺฏุฑุฏุงููุฏ ู ุจูโุตูุฑุช ุงุฎุชุงุฑ ฺฉ **CancellationToken** ูโูพุฐุฑูุฏ. ููฺูู ูุณุฎูโูุง Overload ุจุฑุง ฺฉุงุฑ ุจุง ููุนโูุง `Span<T>` ู `Memory<T>` (ฺฉู ุฏุฑ ูุตู ฒณ ุชูุถุญ ุฏุงุฏู ูโุดููุฏ) ูุฌูุฏ ุฏุงุฑุฏ.

---

### ๐ ููููู ฺฉุฏ: ุฎูุงูุฏูุ ููุดุชู ู Seek ุฏุฑ FileStream

```csharp
using System;
using System.IO;

// ุงุฌุงุฏ ูุงู ุจู ูุงู test.txt ุฏุฑ ูุณุฑ ุฌุงุฑ:
using (Stream s = new FileStream("test.txt", FileMode.Create))
{
    Console.WriteLine(s.CanRead);   // True
    Console.WriteLine(s.CanWrite);  // True
    Console.WriteLine(s.CanSeek);   // True

    s.WriteByte(101);
    s.WriteByte(102);

    byte[] block = { 1, 2, 3, 4, 5 };
    s.Write(block, 0, block.Length);      // ููุดุชู ฺฉ ุจููฺฉ 5 ุจุงุช

    Console.WriteLine(s.Length);          // 7
    Console.WriteLine(s.Position);        // 7

    s.Position = 0;                       // ุจุงุฒฺฏุดุช ุจู ุงุจุชุฏุง ูุงู
    Console.WriteLine(s.ReadByte());      // 101
    Console.WriteLine(s.ReadByte());      // 102

    // ุฎูุงูุฏู ุฏุงุฏู ุงุฒ ุงุณุชุฑู ู ุจุงุฒููุณ ุฏุฑ ุขุฑุงู block:
    Console.WriteLine(s.Read(block, 0, block.Length));   // 5

    // ฺูู ุฏุฑ ุงูุชูุง ูุงู ูุณุชูุ ุจุงุฑ ุจุนุฏ ุฎูุงูุฏู 0 ุจุฑูโฺฏุฑุฏุงูุฏ:
    Console.WriteLine(s.Read(block, 0, block.Length));   // 0
}
```

---

### ๐ ููููู ฺฉุฏ: ุงุณุชูุงุฏู ุงุฒ ูุชุฏูุง Async

ุฎูุงูุฏู ุง ููุดุชู ุจูโุตูุฑุช **Asynchronous** ููุท ุจู ุงู ูุนู ุงุณุช ฺฉู ุจูโุฌุง **Read/Write**ุ ุงุฒ **ReadAsync/WriteAsync** ุงุณุชูุงุฏู ฺฉูุฏ ู ูุชุฌู ุฑุง `await` ฺฉูุฏ (ู ููฺูู ุจุงุฏ ูุชุฏ ูุฑุงุฎูุงููุฏู `async` ุชุนุฑู ุดูุฏุ ููุงูโุทูุฑ ฺฉู ุฏุฑ ูุตู ฑด ุชูุถุญ ุฏุงุฏู ุดุฏ).

```csharp
async static void AsyncDemo()
{
    using (Stream s = new FileStream("test.txt", FileMode.Create))
    {
        byte[] block = { 1, 2, 3, 4, 5 };

        await s.WriteAsync(block, 0, block.Length);   // ููุดุชู ุจูโุตูุฑุช Async
        s.Position = 0;                               // ุจุงุฒฺฏุดุช ุจู ุงุจุชุฏุง ูุงู

        // ุฎูุงูุฏู ุฏูุจุงุฑู ุฏุงุฏูโูุง ุงุฒ ุงุณุชุฑู ุจู ุขุฑุงู block:
        Console.WriteLine(await s.ReadAsync(block, 0, block.Length));   // 5
    }
}
```

ูุชุฏูุง Asynchronous ฺฉูฺฉ ูโฺฉููุฏ ุจุฑูุงููโูุง **Responsive** ู **Scalable** ููุดุชู ุดููุฏ ฺฉู ุจุชูุงููุฏ ุจุง ุงุณุชุฑูโูุง ุจุงูููู ฺฉูุฏ (ุจูโูฺู ุงุณุชุฑูโูุง ุดุจฺฉูโุง) ฺฉุงุฑ ฺฉููุฏุ ุจุฏูู ุงูโฺฉู ฺฉ Thread ุจูโุทูุฑ ฺฉุงูู ูุดุบูู ุดูุฏ.

> ุจุฑุง ุณุงุฏฺฏุ ุฏุฑ ุจุดุชุฑ ูุซุงูโูุง ุงู ูุตู ุงุฒ ูุชุฏูุง **Synchronous** ุงุณุชูุงุฏู ูโฺฉูู. ุจุง ุงู ุญุงูุ ุฏุฑ ุจุดุชุฑ ุณูุงุฑููุง **I/O ุดุจฺฉูโุง** ุชูุตู ูโุดูุฏ ุงุฒ ูุชุฏูุง Async ุงุณุชูุงุฏู ฺฉูุฏ.

---

## โ๏ธ ุฎูุงูุฏู ู ููุดุชู (Reading and Writing)

ฺฉ ุงุณุชุฑู ูโุชูุงูุฏ ุงุฒ **ุฎูุงูุฏู**ุ **ููุดุชู** ุง ูุฑ ุฏู ูพุดุชุจุงู ฺฉูุฏ.

* ุงฺฏุฑ `CanWrite` ุจุฑุงุจุฑ `false` ุจุงุดุฏุ ุงุณุชุฑู **ููุท ุฎูุงูุฏู** ุงุณุช.
* ุงฺฏุฑ `CanRead` ุจุฑุงุจุฑ `false` ุจุงุดุฏุ ุงุณุชุฑู **ููุท ููุดุชู** ุงุณุช.

๐น ูุชุฏ `Read` ฺฉ ุจููฺฉ ุฏุงุฏู ุงุฒ ุงุณุชุฑู ูโฺฏุฑุฏ ู ุขู ุฑุง ุฏุฑูู ฺฉ ุขุฑุงู ูุฑุงุฑ ูโุฏูุฏ. ุงู ูุชุฏ ุชุนุฏุงุฏ ุจุงุชโูุง ุฎูุงูุฏูโุดุฏู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู ููุดู **ฺฉูุชุฑ ุง ูุณุงู** ุจุง ุขุฑฺฏููุงู `count` ุงุณุช.

* ุงฺฏุฑ ููุฏุงุฑ ฺฉูุชุฑ ุงุฒ `count` ุจุงุดุฏุ ุนู ุง ุจู ุงูุชูุง ุงุณุชุฑู ุฑุณุฏูโุงูุ ุง ุฏุงุฏูโูุง ุฏุฑ **ูุทุนุงุช ฺฉูฺฺฉโุชุฑ** ุจุฑฺฏุฑุฏุงูุฏู ูโุดููุฏ (ูุซู ุญุงูุช ูุนููู ุฏุฑ ุงุณุชุฑูโูุง ุดุจฺฉูโุง).
* ุฏุฑ ุงู ุดุฑุงุทุ ุจุฎุด ุจุงูโูุงูุฏู ุงุฒ ุขุฑุงู ุจุฏูู ุชุบุฑ ุจุงู ูโูุงูุฏ.

> ุฑุณุฏู ุจู ุงูุชูุง ุงุณุชุฑู ููุท ุฒูุงู ูุทุน ุงุณุช ฺฉู `Read` ููุฏุงุฑ `0` ุจุฑฺฏุฑุฏุงูุฏ.

---

### โ ูุซุงู ุงุดุชุจุงู

ูุฑุถ ฺฉูุฏ ฺฉ ุงุณุชุฑู ฑฐฐฐ ุจุงุช ุฏุงุฑู:

```csharp
// ูุฑุถ ฺฉูุฏ s ฺฉ ุงุณุชุฑู ุงุณุช:
byte[] data = new byte[1000];
s.Read(data, 0, data.Length);
```

ุฏุฑ ุงู ุญุงูุชุ `Read` ููฺฉู ุงุณุช ูุฑ ููุฏุงุฑ ุจู **ฑ ุชุง ฑฐฐฐ** ุจุฑฺฏุฑุฏุงูุฏ ู ุจุฎุด ุจุงูโูุงูุฏู ุฎูุงูุฏู ูุดูุฏ.

---

### โ ูุซุงู ุฏุฑุณุช

```csharp
byte[] data = new byte[1000];
// bytesRead ุฏุฑ ููุงุช ููุดู 1000 ุฎูุงูุฏ ุจูุฏุ ูฺฏุฑ ุงูโฺฉู ุทูู ุงุณุชุฑู ฺฉูุชุฑ ุจุงุดุฏ:
int bytesRead = 0;
int chunkSize = 1;

while (bytesRead < data.Length && chunkSize > 0)
    bytesRead += chunkSize = s.Read(data, bytesRead, data.Length - bytesRead);
```

---

### ๐ ูุชุฏูุง ุฌุฏุฏ ุฏุฑ .NET 7

ุงุฒ ูุณุฎู .NET 7ุ ฺฉูุงุณ **Stream** ูุชุฏูุง ฺฉูฺฉ ุฒุฑ ุฑุง ุฏุงุฑุฏ:

* `ReadExactly`
* `ReadAtLeast`

(ุจู ููุฑุงู ูุณุฎูโูุง Async ุขูโูุง).

```csharp
byte[] data = new byte[1000];
s.ReadExactly(data);   // ุฏููุงู 1000 ุจุงุช ูโุฎูุงูุฏ
```

ูุนุงุฏู:

```csharp
s.ReadExactly(data, offset: 0, count: 1000);
```

---

### ๐ฆ BinaryReader

ููุน **BinaryReader** ุฑุงูโุญู ุฏฺฏุฑ ุจุฑุง ุงู ฺฉุงุฑ ุงุณุช:

```csharp
byte[] data = new BinaryReader(s).ReadBytes(1000);
```

* ุงฺฏุฑ ุทูู ุงุณุชุฑู ฺฉูุชุฑ ุงุฒ ฑฐฐฐ ุจุงุช ุจุงุดุฏุ ุงูุฏุงุฒู ุขุฑุงู ูุชูุงุณุจ ุจุง ุทูู ูุงูุน ุงุณุชุฑู ุฎูุงูุฏ ุจูุฏ.
* ุงฺฏุฑ ุงุณุชุฑู ูุงุจูุช `Seek` ุฏุงุดุชู ุจุงุดุฏุ ูโุชูุงู ุจุง ุฌุงฺฏุฒู ฺฉุฑุฏู ฑฐฐฐ ุจุง `(int)s.Length` ฺฉู ูุญุชูุง ุขู ุฑุง ุฎูุงูุฏ.

> ุฌุฒุฆุงุช ุจุดุชุฑ ุฏุฑุจุงุฑู BinaryReader ุฏุฑ ุจุฎุด **โStream Adaptersโ** (ุตูุญู 709) ุขูุฏู ุงุณุช.

---

### ๐น ReadByte ู WriteByte

* ูุชุฏ `ReadByte` ฺฉ ุจุงุช ูโุฎูุงูุฏ ู ุฏุฑ ุตูุฑุช ุฑุณุฏู ุจู ุงูุชูุง ุงุณุชุฑูุ `-1` ุจุฑูโฺฏุฑุฏุงูุฏ.
  (ุจู ููู ุฏูู ููุฏุงุฑ ุจุงุฒฺฏุดุช ุขู `int` ุงุณุชุ ฺูู ููุน `byte` ููโุชูุงูุฏ `-1` ุจุฑฺฏุฑุฏุงูุฏ).

* ูุชุฏูุง `Write` ู `WriteByte` ุฏุงุฏู ุฑุง ุจู ุงุณุชุฑู ูโูุฑุณุชูุฏ. ุงฺฏุฑ ุงุฑุณุงู ฺฉุงูู ุจุงุชโูุง ููฺฉู ูุจุงุดุฏุ ฺฉ **Exception** ูพุฑุชุงุจ ูโุดูุฏ.

---

## ๐ฏ ุฌุณุชุฌู ุฏุฑ ุงุณุชุฑู (Seeking)

* ุขุฑฺฏููุงู `offset` ุฏุฑ ูุชุฏูุง **Read/Write** ุจู ุงูุฏุณ ุดุฑูุน ุฏุฑ ุขุฑุงู **Buffer** ุงุดุงุฑู ุฏุงุฑุฏุ ูู ุจู ูููุนุช ุฏุฑ ุฎูุฏ ุงุณุชุฑู.
* ฺฉ ุงุณุชุฑู **Seekable** ุงุณุช ุงฺฏุฑ ูฺฺฏ `CanSeek` ุขู `true` ุจุงุดุฏ (ูุซู FileStream).

ุจุง ฺฉ ุงุณุชุฑู Seekable ูโุชูุงู:

* ููุฏุงุฑ `Length` ุฑุง ูพุฑุณุฏ ุง ุจุง `SetLength` ุชุบุฑ ุฏุงุฏ.
* ุฏุฑ ูุฑ ูุญุธู `Position` ุฑุง ุชุบุฑ ุฏุงุฏ ู ูุดุฎุต ฺฉุฑุฏ ุงุฒ ฺฉุฌุง ุจุฎูุงูุฏ ุง ุจููุณุฏ.

๐น ูฺฺฏ `Position` ูุณุจุช ุจู ุงุจุชุฏุง ุงุณุชุฑู ุงุณุชุ ุงูุง ูุชุฏ `Seek` ุงุฌุงุฒู ูโุฏูุฏ ูุณุจุช ุจู ูููุนุช ูุนู ุง ุงูุชูุง ุงุณุชุฑู ุญุฑฺฉุช ฺฉูุฏ.

* ุชุบุฑ `Position` ุฏุฑ FileStream ูุนูููุงู ููุท ฺูุฏ ูฺฉุฑูุซุงูู ุทูู ูโฺฉุดุฏ. ุงฺฏุฑ ูุฑุงุฑ ุงุณุช ุงู ฺฉุงุฑ ุฑุง **ููููโูุง ุจุงุฑ** ุฏุฑ ฺฉ ุญููู ุงูุฌุงู ุฏูุฏุ ุงุณุชูุงุฏู ุงุฒ `MemoryMappedFile` ุงูุชุฎุงุจ ุจูุชุฑ ูุณุจุช ุจู FileStream ุฎูุงูุฏ ุจูุฏ (ุตูุญู 736 ุฑุง ุจุจูุฏ).
* ุฏุฑ ุงุณุชุฑูโูุง ุบุฑูุงุจู Seek (ูุซู ุงุณุชุฑู ุฑูุฒูฺฏุงุฑ)ุ ุชููุง ุฑุงู ุฏุงูุณุชู ุทููุ ุฎูุงูุฏู ฺฉู ุขู ุงุณุช. ููฺูู ุจุฑุง ุฎูุงูุฏู ุฏูุจุงุฑู ฺฉ ุจุฎุด ูุจูุ ุจุงุฏ ุงุณุชุฑู ุฑุง ุจุจูุฏุฏ ู ฺฉ ุงุณุชุฑู ุฌุฏุฏ ุจุงุฒ ฺฉูุฏ.

---

## ๐ ุจุณุชู ู Flush ฺฉุฑุฏู ุงุณุชุฑูโูุง

ุงุณุชุฑูโูุง ูพุณ ุงุฒ ุงุณุชูุงุฏู ุจุงุฏ **Dispose** ุดููุฏ ุชุง ููุงุจุน ุฒุฑุจูุง ูุซู **File Handle** ู **Socket Handle** ุขุฒุงุฏ ุดููุฏ.

๐น ุณุงุฏูโุชุฑู ุฑุงู ุชุถูู ุงู ููุถูุนุ ูุฑุงุฑ ุฏุงุฏู ุงุณุชุฑู ุฏุฑูู ฺฉ **ุจููฺฉ using** ุงุณุช.

ููุงูู ฺฉู ูุฏุฑุช ุงุณุชุฑูโูุง:

* ูุชุฏูุง **Dispose** ู **Close** ุนููฺฉุฑุฏ ฺฉุณุงู ุฏุงุฑูุฏ.
* ุจุณุชู ุง Dispose ฺฉุฑุฏู ฺูุฏุจุงุฑู ฺฉ ุงุณุชุฑู ูุดฺฉู ุงุฌุงุฏ ููโฺฉูุฏ.
* ุจุณุชู ฺฉ ุงุณุชุฑู Decorator ุจุงุนุซ ุจุณุชู ุดุฏู ุฎูุฏุด ู **Backing Store** ุขู ูโุดูุฏ.
* ุฏุฑ ฺฉ ุฒูุฌุฑู ุงุฒ Decoratorูุงุ ุจุณุชู Decorator ุจุฑูู ฺฉู ุฒูุฌุฑู ุฑุง ูโุจูุฏุฏ.

ุจุฑุฎ ุงุณุชุฑูโูุง ุฏุงุฏูโูุง ุฑุง ุจุฑุง ุจูุจูุฏ ฺฉุงุฑุง ุฏุฑ ุญุงูุธู **Buffer** ูโฺฉููุฏ (ูุซู FileStream). ุงู ุจุงุนุซ ูโุดูุฏ ุฏุงุฏูโุง ฺฉู ุจู ุงุณุชุฑู ูโููุณุฏุ ุจูุงูุงุตูู ูุงุฑุฏ Backing Store ูุดูุฏ.

* ูุชุฏ **Flush** ุจุงุนุซ ูโุดูุฏ ุฏุงุฏูโูุง ุจุงูุฑ ุดุฏู ููุฑุงู ููุดุชู ุดููุฏ.
* `Flush` ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ููฺฏุงู ุจุณุชู ุดุฏู ุงุณุชุฑู ุตุฏุง ุฒุฏู ูโุดูุฏุ ุจูุงุจุฑุงู ูฺโููุช ูุงุฒ ุจู ููุดุชู ฺฉุฏ ูุซู ุฒุฑ ูุฏุงุฑุฏ:

```csharp
s.Flush();
s.Close();
```

## โฑ๏ธ Timeoutูุง

ฺฉ ุงุณุชุฑู ุฒูุงู ุงุฒ **Timeout** ูพุดุชุจุงู ูโฺฉูุฏ ฺฉู ูฺฺฏ `CanTimeout` ููุฏุงุฑ `true` ุฏุงุดุชู ุจุงุดุฏ.

* ุงุณุชุฑูโูุง **ุดุจฺฉูโุง (Network Streams)** ุงุฒ Timeout ูพุดุชุจุงู ูโฺฉููุฏ.
* ุงุณุชุฑูโูุง **ูุงู (File Streams)** ู **ุญุงูุธู (Memory Streams)** ุงุฒ Timeout ูพุดุชุจุงู ููโฺฉููุฏ.

ุจุฑุง ุงุณุชุฑูโูุง ฺฉู Timeout ุฑุง ูพุดุชุจุงู ูโฺฉููุฏ:

* ูฺฺฏโูุง `ReadTimeout` ู `WriteTimeout` ูุฏุช ุฒูุงู Timeout ุฑุง ุจุฑ ุญุณุจ **ููโุซุงูู** ูุดุฎุต ูโฺฉููุฏ.
* ููุฏุงุฑ `0` ุนู **ุจุฏูู Timeout**.
* ุงฺฏุฑ Timeout ุฑุฎ ุฏูุฏุ ูุชุฏูุง `Read` ู `Write` ฺฉ **Exception** ูพุฑุชุงุจ ูโฺฉููุฏ.

โ๏ธ ูุชุฏูุง Asynchronous (`ReadAsync`/`WriteAsync`) ุงุฒ Timeout ูพุดุชุจุงู ููโฺฉููุฏ. ุฏุฑ ุงู ุญุงูุชุ ูโุชูุงูุฏ ฺฉ **CancellationToken** ุจู ุงู ูุชุฏูุง ุจุฏูุฏ.

---

## ๐งต Thread Safety

ุจูโุทูุฑ ฺฉูุ ุงุณุชุฑูโูุง **Thread-Safe** ูุณุชูุฏุ ุนู ุฏู Thread ููโุชูุงููุฏ ุจูโุทูุฑ ููโุฒูุงู ุฑู ฺฉ ุงุณุชุฑู ุจุฎูุงููุฏ ุง ุจููุณูุฏุ ฺูู ุงุญุชูุงู ุฎุทุง ูุฌูุฏ ุฏุงุฑุฏ.

ฺฉูุงุณ **Stream** ฺฉ ุฑุงูฺฉุงุฑ ุณุงุฏู ุงุฑุงุฆู ูโุฏูุฏ: ูุชุฏ ุงุณุชุงุชฺฉ `Synchronized`.

* ุงู ูุชุฏ ฺฉ ุงุณุชุฑู ุงุฒ ูุฑ ููุน ุฑุง ูโูพุฐุฑุฏ ู ฺฉ **Wrapper ุงูู ุจุฑุง Thread** ุจุฑูโฺฏุฑุฏุงูุฏ.
* ุงู Wrapper ุจุง ฺฏุฑูุชู ฺฉ **ููู ุงูุญุตุงุฑ (Exclusive Lock)** ุฏุฑ ุงุทุฑุงู ูุฑ ุนููุงุช ุฎูุงูุฏูุ ููุดุชู ุง Seekุ ุชุถูู ูโฺฉูุฏ ฺฉู ููุท ฺฉ Thread ุฏุฑ ูุฑ ูุญุธู ุจุชูุงูุฏ ุนูู ููุฑุฏ ูุธุฑ ุฑุง ุงูุฌุงู ุฏูุฏ.

๐น ูุชุฌู ุนูู ุงู ุงุณุช ฺฉู ฺูุฏ Thread ูโุชูุงููุฏ ุจูโุทูุฑ ููโุฒูุงู ุฏุงุฏูโูุง ุฑุง ุจู ฺฉ ุงุณุชุฑู **Append** ฺฉููุฏ.
ุงูุง ุณุงุฑ ูุนุงูุชโูุง (ูุซู ุฎูุงูุฏู ููโุฒูุงู) ูุงุฒููุฏ ูููโฺฏุฐุงุฑ ุงุถุงู ูุณุชูุฏ ุชุง ูุทูุฆู ุดูุฏ ูุฑ Thread ุฏููุงู ุจู ุจุฎุด ุฏุฑุณุช ุงุฒ ุงุณุชุฑู ุฏุณุชุฑุณ ุฏุงุฑุฏ.

๐ ุฌุฒุฆุงุช ฺฉุงููโุชุฑ ุฏุฑุจุงุฑู **Thread Safety** ุฏุฑ ูุตู ฒฑ ุชูุถุญ ุฏุงุฏู ูโุดูุฏ.

---

### ๐ ูฺฺฏ ุฌุฏุฏ ุฏุฑ .NET 6

ุงุฒ ูุณุฎู .NET 6 ุจู ุจุนุฏุ ูโุชูุงูุฏ ุจุฑุง ุนููุงุช **File I/O ุงูู ู ฺฉุงุฑุขูุฏ ุฏุฑ ุจุฑุงุจุฑ Thread** ุงุฒ ฺฉูุงุณ **RandomAccess** ุงุณุชูุงุฏู ฺฉูุฏ.

* ุงู ฺฉูุงุณ ุงูฺฉุงู **Thread-Safe File I/O** ุจุง ฺฉุงุฑุง ุจุงูุง ุฑุง ูุฑุงูู ูโฺฉูุฏ.
* ููฺูู ุงุฌุงุฒู ูโุฏูุฏ ฺูุฏู **Buffer** ุฑุง ุจุฑุง ุจูุจูุฏ ุนููฺฉุฑุฏ ุจูโุทูุฑ ููโุฒูุงู ูพุงุณ ุฏูุฏ.

---

## ๐๏ธ Backing Store Streams

๐ ุดฺฉู 15-2 ุงุณุชุฑูโูุง ุงุตู **Backing Store** ฺฉู ุชูุณุท .NET ุงุฑุงุฆู ูโุดููุฏ ุฑุง ูุดุงู ูโุฏูุฏ.

๐น ุนูุงูู ุจุฑ ุงูุ ฺฉ **Null Stream** ูู ุงุฒ ุทุฑู ููุฏ ุงุณุชุงุชฺฉ `Stream.Null` ุฏุฑ ุฏุณุชุฑุณ ุงุณุช.

**Null Stream** ูโุชูุงูุฏ ููฺฏุงู ููุดุชู **Unit Test**ูุง ุจุณุงุฑ ููุฏ ุจุงุดุฏ.

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/15/Table-15-3.jpeg)
</div>

## ๐ FileStream

ุฏุฑ ุจุฎุดโูุง ุจุนุฏุ ุจู ุจุฑุฑุณ **FileStream** ู **MemoryStream** ูโูพุฑุฏุงุฒูุ ู ุฏุฑ ุจุฎุด ูพุงุงู ุงู ูุตูุ **IsolatedStorageStream** ุฑุง ูุนุฑู ูโฺฉูู. ุฏุฑ ูุตู ฑถ ูู ุจู **NetworkStream** ุฎูุงูู ูพุฑุฏุงุฎุช.

---

### โจ ูฺฺฏโูุง FileStream

ูพุดโุชุฑ ุงุณุชูุงุฏูโ ูพุงูโุง ุงุฒ **FileStream** ุจุฑุง ุฎูุงูุฏู ู ููุดุชู ุจุงุชโูุง ุฑุง ุฏุฏู. ุญุงูุง ุจุงุฏ ูฺฺฏโูุง ุฎุงุต ุงู ฺฉูุงุณ ุฑุง ุฏููโุชุฑ ุจุฑุฑุณ ฺฉูู.

๐น ุงฺฏุฑ ูููุฒ ุงุฒ **UWP (Universal Windows Platform)** ุงุณุชูุงุฏู ูโฺฉูุฏุ ูโุชูุงูุฏ ุนููุงุช ูุงู ุฑุง ุจุง ููุนโูุง ููุฌูุฏ ุฏุฑ ูุถุง ูุงู **Windows.Storage** ุงูุฌุงู ุฏูุฏ. ุชูุถุญุงุช ุจุดุชุฑ ุฏุฑ [ุถููู ุขููุงู](http://www.albahari.com/nutshell) ุขูุฏู ุงุณุช.

---

### ๐๏ธ ุณุงุฎุช ฺฉ FileStream

ุณุงุฏูโุชุฑู ุฑุงู ุจุฑุง ูููููโุณุงุฒ **FileStream** ุงุณุชูุงุฏู ุงุฒ ูุชุฏูุง ุงุณุชุงุชฺฉ ฺฉูุงุณ **File** ุงุณุช:

```csharp
FileStream fs1 = File.OpenRead("readme.bin");   // ููุท ุฎูุงูุฏู
FileStream fs2 = File.OpenWrite("writeme.tmp"); // ููุท ููุดุชู
FileStream fs3 = File.Create("readwrite.tmp");  // ุฎูุงูุฏู/ููุดุชู
```

โ๏ธ ุชูุงูุช `OpenWrite` ู `Create`:

* `Create` ูุญุชูุง ูุจู ูุงู ุฑุง **ฺฉุงูู ูพุงฺฉ ูโฺฉูุฏ** (truncate).
* `OpenWrite` ูุญุชูุง ููุฌูุฏ ุฑุง ูฺฏู ูโุฏุงุฑุฏ ู ูฺฉุงู ุงุณุชุฑู ุฑุง ุฑู ุตูุฑ ูุฑุงุฑ ูโุฏูุฏ.
  ุงฺฏุฑ ฺฉูุชุฑ ุงุฒ ุงูุฏุงุฒูโ ูุจู ุฏุงุฏู ุจููุณุฏุ ูุชุฌู ุชุฑฺฉุจ ุงุฒ ุฏุงุฏูโูุง ูุฏู ู ุฌุฏุฏ ุฎูุงูุฏ ุดุฏ.

ููฺูู ูโุชูุงูุฏ ูุณุชูู ุงุฒ **ุณุงุฒูุฏูโ FileStream** ุงุณุชูุงุฏู ฺฉูุฏ. ุณุงุฒูุฏูโูุง ุงูฺฉุงู ฺฉูุชุฑู ฺฉุงูู ุฑู:

* ูุงู ูุงู ุง **file handle ุณุทุญ ูพุงู**
* ุญุงูุชโูุง ุณุงุฎุช ู ุฏุณุชุฑุณ ุจู ูุงู
* ฺฏุฒููโูุง ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ (sharing)ุ ุจุงูุฑูฺฏ ู ุงููุช

ุฑุง ูุฑุงูู ูโฺฉููุฏ. ุจุฑุง ูุซุงู:

```csharp
using var fs = new FileStream("readwrite.tmp", FileMode.Open);
```

(ฺฉูุฏูุงฺูโ `using` ุชุถูู ูโฺฉูุฏ ฺฉู ุงุณุชุฑู ูพุณ ุงุฒ ุฎุฑูุฌ ุงุฒ ูุญุฏูุฏู dispose ุดูุฏ).

๐ ุฏุฑ ุงุฏุงูู ุจู ุฌุฒุฆุงุช `FileMode` ูโูพุฑุฏุงุฒู.

---

### โก ูุชุฏูุง ูุงูโุจูุฑ ฺฉูุงุณ File

ุงู ูุชุฏูุง ฺฉู ูุญุชูุง ูุงู ุฑุง ุฏุฑ ฺฉ ูุฑุญูู ูโุฎูุงููุฏ:

* `File.ReadAllText` โ ุจุงุฒฺฏุฑุฏุงูุฏู ฺฉ **string**
* `File.ReadAllLines` โ ุจุงุฒฺฏุฑุฏุงูุฏู ฺฉ **ุขุฑุงู ุงุฒ string**
* `File.ReadAllBytes` โ ุจุงุฒฺฏุฑุฏุงูุฏู ฺฉ **ุขุฑุงูโ ุจุงุช**

ุงู ูุชุฏูุง ฺฉู ูุงู ุฑุง ุฏุฑ ฺฉ ูุฑุญูู ูโููุณูุฏ:

* `File.WriteAllText`
* `File.WriteAllLines`
* `File.WriteAllBytes`
* `File.AppendAllText` (ููุงุณุจ ุจุฑุง ุงุถุงููโฺฉุฑุฏู ุจู ูุงูโูุง ูุงฺฏ)

ููฺูู ูุชุฏ ุจู ูุงู `File.ReadLines` ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ูุงููุฏ `ReadAllLines` ุงุณุชุ ุจุง ุงู ุชูุงูุช ฺฉู ฺฉ `IEnumerable<string>` **Lazy** ุจุงุฒูโฺฏุฑุฏุงูุฏ (ุจูโุตูุฑุช ุชุฏุฑุฌ ุฎูุงูุฏู ูโุดูุฏุ ูู ฺฉโุฌุง). ุงู ฺฉุงุฑุง ุจูุชุฑ ุฏุงุฑุฏ ฺูู ฺฉู ูุงู ฺฉโุฌุง ุฏุฑ ุญุงูุธู ุจุงุฑฺฏุฐุงุฑ ููโุดูุฏ.

ูุซุงู ุจุง LINQ ุจุฑุง ุดูุฑุฏู ุชุนุฏุงุฏ ุฎุทูุท ฺฉู ุทูู ุขูโูุง ุจุดุชุฑ ุงุฒ ธฐ ฺฉุงุฑุงฺฉุชุฑ ุงุณุช:

```csharp
int longLines = File.ReadLines("filePath")
                   .Count(l => l.Length > 80);
```

---

### ๐ ูุดุฎุตโฺฉุฑุฏู ูุงู ูุงู

ูุงู ูุงู ูโุชูุงูุฏ:

* **ูุทูู (Absolute)** ุจุงุดุฏ โ ูุซู:

  * ููุฏูุฒ: `c:\temp\test.txt`
  * ููฺฉุณ: `/tmp/test.txt`
* **ูุณุจ (Relative)** ุจู ุฏุงุฑฺฉุชูุฑ ูุนู โ ูุซู:

  * `test.txt`
  * `temp\test.txt`

๐น ุฏุงุฑฺฉุชูุฑ ูุนู ุจุฑูุงูู ุงุฒ ุทุฑู ูฺฺฏ ุงุณุชุงุชฺฉ:

```csharp
Environment.CurrentDirectory
```

ูุงุจู ุฏุณุชุฑุณ ู ุชุบุฑ ุงุณุช.

โ๏ธ ุงูุง ุฏุงุฑฺฉุชูุฑ ูุนู **ููฺฉู ุงุณุช ุจุง ูุณุฑ ุงุฌุฑุง ุจุฑูุงูู ฺฉ ูุจุงุดุฏ**. ุจูุงุจุฑุงู **ูฺโููุช** ุจุฑุง ุงูุชู ูุงูโูุง ููุฑุงู executable ุฑู ุขู ุญุณุงุจ ูฺฉูุฏ.

ุฏุงุฑฺฉุชูุฑ ูพุงูโ ุงูพูฺฉุดู ุงุฒ ุทุฑู:

```csharp
AppDomain.CurrentDomain.BaseDirectory
```

ุฏุฑุงูุช ูโุดูุฏ (ูุนูููุงู ููุงู ูพูุดูโ ูุงู ุงุฌุฑุง ุงุณุช).

ุจุฑุง ูุดุฎุต ฺฉุฑุฏู ูุงู ูุงู ุจูโุตูุฑุช ูุณุจ ูุณุจุช ุจู ุงู ุฏุงุฑฺฉุชูุฑ:

```csharp
string baseFolder = AppDomain.CurrentDomain.BaseDirectory;
string logoPath = Path.Combine(baseFolder, "logo.jpg");
Console.WriteLine(File.Exists(logoPath));
```

---

### ๐ ูุณุฑูุง ุดุจฺฉูโุง (UNC Path)

ุฏุฑ ููุฏูุฒ ูโุชูุงูุฏ ูุงูโูุง ุฑุง ุงุฒ ุทุฑู ูุณุฑ **UNC** ุจุฎูุงูุฏ/ุจููุณุฏ:

* `\\JoesPC\PicShare\pic.jpg`
* `\\10.1.1.2\PicShare\pic.jpg`

๐น ุฏุฑ macOS ุง Unix ุจุฑุง ุฏุณุชุฑุณ ุจู ฺฉ Windows File Share ุจุงุฏ ุงุจุชุฏุง ุขู ุฑุง ุจู filesystem ุฎูุฏ mount ฺฉูุฏุ ุณูพุณ ูุงููุฏ ูุณุฑ ูุนููู ุฏุฑ C# ุจุงุฒ ฺฉูุฏ.

---

### โ๏ธ ูุดุฎุต ฺฉุฑุฏู FileMode

ุชูุงู ุณุงุฒูุฏูโูุง `FileStream` ฺฉู ฺฉ ูุงู ูุงู ูโูพุฐุฑูุฏุ ูุงุฒ ุจู ฺฉ ุขุฑฺฏููุงู ุงุฒ ููุน **FileMode enum** ุฏุงุฑูุฏ.

๐ ุดฺฉู 15-3 ูุดุงู ูโุฏูุฏ ฺฺฏููู ุจุงุฏ ฺฉ FileMode ุงูุชุฎุงุจ ฺฉูุฏ. ูุชุงุฌ ูุดุงุจู ูุฑุงุฎูุงู ูุชุฏูุง ุงุณุชุงุชฺฉ ฺฉูุงุณ **File** ุฎูุงูุฏ ุจูุฏ.
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/15/Table-15-4.jpeg)
</div>

## ๐ FileStream

๐น ุงฺฏุฑ ุฑู ูุงูโูุง **Hidden** ุงุฒ `File.Create` ุง `FileMode.Create` ุงุณุชูุงุฏู ฺฉูุฏุ ฺฉ **ุงุณุชุซูุง (Exception)** ูพุฑุชุงุจ ูโุดูุฏ. ุจุฑุง ุจุงุฒููุณ ฺฉ ูุงู ูุฎูุ ุจุงุฏ ุงุจุชุฏุง ุขู ุฑุง **ุญุฐู** ู ุณูพุณ ุฏูุจุงุฑู ุงุฌุงุฏ ฺฉูุฏ:

```csharp
File.Delete("hidden.txt");
using var file = File.Create("hidden.txt");
```

---

### ๐ FileAccess

ุงฺฏุฑ ููุท ูุงู ูุงู ู ฺฉ `FileMode` ุฑุง ุจู ุณุงุฒูุฏูโ `FileStream` ุจุฏูุฏุ ูุชุฌู (ุจุง ฺฉ ุงุณุชุซูุง) ฺฉ ุงุณุชุฑู **ูุงุจู ุฎูุงูุฏู/ููุดุชู** ุฎูุงูุฏ ุจูุฏ.
ุงูุง ูโุชูุงูุฏ ุจุง ูุดุฎุตโฺฉุฑุฏู ุขุฑฺฏููุงู **FileAccess** ุฏุณุชุฑุณ ุฑุง ูุญุฏูุฏ ฺฉูุฏ:

```csharp
[Flags]
public enum FileAccess { Read = 1, Write = 2, ReadWrite = 3 }
```

ูุซุงู: ุณุงุฎุชู ฺฉ ุงุณุชุฑู ููุท-ุฎูุงูุฏู (ูุนุงุฏู `File.OpenRead`):

```csharp
using var fs = new FileStream("x.bin", FileMode.Open, FileAccess.Read);
```

โ๏ธ ุญุงูุช ุฎุงุต: `FileMode.Append` โ ููุท **Write-only** ุงุณุช.
ุงฺฏุฑ ูโุฎูุงูุฏ ุฏุงุฏูโูุง ุฑุง **ุงุถุงูู (Append)** ฺฉูุฏ ู ููุฒูุงู ุงูฺฉุงู ุฎูุงูุฏู ุฏุงุดุชู ุจุงุดุฏุ ุจุงุฏ ุงุฒ `FileMode.Open` ุง `FileMode.OpenOrCreate` ุงุณุชูุงุฏู ฺฉูุฏ ู ุณูพุณ ูฺฉุงู ุงุณุชุฑู ุฑุง ุจู ุงูุชูุง ูุงู ุจุจุฑุฏ:

```csharp
using var fs = new FileStream("myFile.bin", FileMode.Open);
fs.Seek(0, SeekOrigin.End);
```

---

### โ๏ธ ูฺฺฏโูุง ูพุดุฑูุชูโ FileStream

ูโุชูุงูุฏ ููฺฏุงู ุณุงุฎุช ฺฉ FileStream ุขุฑฺฏููุงูโูุง ุงุถุงู ุจุฏูุฏ:

* **FileShare enum** โ ูุฒุงู ุฏุณุชุฑุณ ุณุงุฑ ูพุฑุฏุงุฒุดโูุง (Noneุ Readุ ReadWriteุ Write).
* **Buffer size** โ ุงูุฏุงุฒู ุจุงูุฑ ุฏุงุฎู (ุจูโุตูุฑุช ูพุดโูุฑุถ ดKB).
* **Async flag** โ ูุงฺฏุฐุงุฑ ุนููุงุช ูุงููฺฏุงู ุจู ุณุณุชูโุนุงูู.
* **FileOptions flags** โ ุดุงูู:

  * `Encrypted` โ ุฑูุฒูฺฏุงุฑ ุชูุณุท ุณุณุชูโุนุงูู
  * `DeleteOnClose` โ ุญุฐู ุฎูุฏฺฉุงุฑ ูุงู ููฺฏุงู ุจุณุชูโุดุฏู
  * `RandomAccess` โ ุจูููโุณุงุฒ ุจุฑุง ุฏุณุชุฑุณ ุชุตุงุฏู
  * `SequentialScan` โ ุจูููโุณุงุฒ ุจุฑุง ุงุณฺฉู ุชุฑุชุจ
  * `WriteThrough` โ ุบุฑูุนุงู ฺฉุฑุฏู ฺฉุด ุณุณุชูโุนุงูู (ุจุฑุง ูุงูโูุง ุชุฑุงฺฉูุด ุง ูุงฺฏโูุง)

โ๏ธ ููฺฏโูุง ฺฉู ุณุณุชูโุนุงูู ูพุดุชุจุงู ูฺฉูุฏุ ุจโุตุฏุง (silently) ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

ุงฺฏุฑ ุจุง `FileShare.ReadWrite` ูุงู ุฑุง ุจุงุฒ ฺฉูุฏุ ฺูุฏ ูพุฑุฏุงุฒุด ุง ฺฉุงุฑุจุฑ ูโุชูุงููุฏ ููุฒูุงู ุจุฎูุงููุฏ/ุจููุณูุฏ. ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชุฏุงุฎูุ ูโุชูุงู ุจุฎุดโูุง ุงุฒ ูุงู ุฑุง ููู ฺฉุฑุฏ:

```csharp
public virtual void Lock(long position, long length);
public virtual void Unlock(long position, long length);
```

ูุชุฏ `Lock` ุงฺฏุฑ ูุงุญูโุง ุงุฒ ูุงู ูุจูุงู ููู ุจุงุดุฏุ ุงุณุชุซูุง ูพุฑุชุงุจ ูโฺฉูุฏ.

---

## ๐ง MemoryStream

**MemoryStream** ุงุฒ ฺฉ ุขุฑุงู ุฏุฑ ุญุงูุธู ุจูโุนููุงู **backing store** ุงุณุชูุงุฏู ูโฺฉูุฏ.
ุงู ุนู ุชูุงู ุฏุงุฏูโูุง ุจุงุฏ ฺฉโุฌุง ุฏุฑ ุญุงูุธู ุจุงุดูุฏ (ุจุฑุฎูุงู ูุฒุช ุงุตู Stream).

ุงูุง ููฺูุงู ููุฏ ุงุณุชุ ุจูโุฎุตูุต ููุช:

* ูุงุฒ ุจู ุฏุณุชุฑุณ ุชุตุงุฏู (Random Access) ุจู ฺฉ ุงุณุชุฑู ุบุฑูุงุจู Seek ุฏุงุฑุฏ.
* ุฏุงุฏูโ ุงุตู ฺฉูฺฺฉ ู ูุงุจู ูุฏุฑุช ุงุณุช.

๐ ูุซุงู: ฺฉูพ ฺฉุฑุฏู ุฏุงุฏูโ ฺฉ ุงุณุชุฑู ุฏุฑูู MemoryStream:

```csharp
var ms = new MemoryStream();
sourceStream.CopyTo(ms);
```

* ุจุฑุง ฺฏุฑูุชู ุฏุงุฏูโูุง:

  * `ToArray()` โ ฺฉ ฺฉูพ ุงุฒ ุฏุงุฏูโูุง ุจุงุฒูโฺฏุฑุฏุงูุฏ.
  * `GetBuffer()` โ ูุฑุฌุน ูุณุชูู ุจู ุขุฑุงูโ ุฐุฎุฑูโุณุงุฒ ูโุฏูุฏ (ฺฉุงุฑุขูุฏุชุฑ ุงุณุชุ ุงูุง ุทูู ุขู ูุนูููุงู ุงุฒ ุฏุงุฏูโ ูุงูุน ุจุดุชุฑ ุงุณุช).

๐ ุจุณุชู ุง Flush ฺฉุฑุฏู MemoryStream ุงุฎุชุงุฑ ุงุณุช:

* ุจุนุฏ ุงุฒ `Close` ุฏฺฏุฑ ููโุชูุงูุฏ ุจุฎูุงูุฏ/ุจููุณุฏุ ูู ููฺูุงู `ToArray()` ฺฉุงุฑ ูโฺฉูุฏ.
* `Flush` ูฺ ุชุฃุซุฑ ูุฏุงุฑุฏ.

---

## ๐ PipeStream

**PipeStream** ุฑุงู ุณุงุฏู ุจุฑุง ุงุฑุชุจุงุท ุจู ูพุฑุฏุงุฒุดโูุง (IPC) ุงุฒ ุทุฑู ูพุฑูุชฺฉู **Pipe** ุณุณุชูโุนุงูู ุงุณุช.

### ุงููุงุน Pipe

1. **Anonymous Pipe (ุณุฑุนโุชุฑ)** โ ุงุฑุชุจุงุท ฺฉโุทุฑูู ุจู ฺฉ ูพุฑุฏุงุฒุด ูุงูุฏ ู ูุฑุฒูุฏ (ุฑู ููุงู ุณุณุชู).
2. **Named Pipe (ุงูุนุทุงูโูพุฐุฑุชุฑ)** โ ุงุฑุชุจุงุท ุฏูุทุฑูู ุจู ูพุฑุฏุงุฒุดโูุง ูุฎุชูู (ุฑู ฺฉ ุณุณุชู ุง ุจู ุณุณุชูโูุง ุฏุฑ ุดุจฺฉู).

๐ Pipes ุจุฑุง IPC ุฑู ฺฉ ฺฉุงููพูุชุฑ ุนุงู ูุณุชูุฏ:

* ูุงุฒ ุจู ูพุฑูุชฺฉู ุดุจฺฉู ูุฏุงุฑูุฏ (ุจุฏูู ุณุฑุจุงุฑ ุดุจฺฉู).
* ูุดฺฉู ุจุง ูุงุฑูุงูโูุง ูุฏุงุฑูุฏ.

---

### ฺฉูุงุณโูุง

PipeStream ฺฉ ฺฉูุงุณ ุงูุชุฒุงุน ุงุณุช. ฺูุงุฑ ุฒุฑฺฉูุงุณ ุงุตู ุฏุงุฑุฏ:

* **AnonymousPipeServerStream**
* **AnonymousPipeClientStream**
* **NamedPipeServerStream**
* **NamedPipeClientStream**

๐น Named Pipes ุณุงุฏูโุชุฑูุฏุ ูพุณ ุงูู ุขูโูุง ุฑุง ุจุฑุฑุณ ูโฺฉูู.

---

### ๐ก Named Pipes

ุงุฑุชุจุงุท ุงุฒ ุทุฑู ฺฉ ูุงู ูุดุชุฑฺฉ ุจุฑูุฑุงุฑ ูโุดูุฏ. ุฏู ููุด ุงุตู ูุฌูุฏ ุฏุงุฑุฏ:

* **Server** โ ูููููโุง ุงุฒ `NamedPipeServerStream` ุณุงุฎุชู ู `WaitForConnection()` ุฑุง ุตุฏุง ูโุฒูุฏ.
* **Client** โ ูููููโุง ุงุฒ `NamedPipeClientStream` ุณุงุฎุชู ู `Connect()` ุฑุง ุตุฏุง ูโุฒูุฏ.

ุณูพุณ ุฏู ุทุฑู ุงุฒ ุงุณุชุฑู ุจุฑุง ุฎูุงูุฏู/ููุดุชู ุงุณุชูุงุฏู ูโฺฉููุฏ.

๐ ูุซุงู ุณุงุฏู:

**Server** โ ุงุฑุณุงู ฺฉ ุจุงุช (ฑฐฐ) ู ุฏุฑุงูุช ฺฉ ุจุงุช:

```csharp
using var s = new NamedPipeServerStream("pipedream");
s.WaitForConnection();
s.WriteByte(100);
Console.WriteLine(s.ReadByte());
```

**Client** โ ุฏุฑุงูุช ุจุงุช ู ุงุฑุณุงู ฺฉ ุจุงุช (ฒฐฐ):

```csharp
using var s = new NamedPipeClientStream("pipedream");
s.Connect();
Console.WriteLine(s.ReadByte());
s.WriteByte(200);
```

๐น Pipeูุง ุจูโุทูุฑ ูพุดโูุฑุถ **ุฏูุทุฑูู** ูุณุชูุฏ. ูพุณ ุจุงุฏ ฺฉ **ูพุฑูุชฺฉู ุชูุงูู** ุจู Client ู Server ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ ุชุง ูุฑ ุฏู ููุฒูุงู ูููุณูุฏ ุง ูุฎูุงููุฏ.

---

### ๐ Message Transmission Mode (ููุท ููุฏูุฒ)

ุจุฑุง ูพุงูโูุง ุทููุงูโุชุฑุ Pipeูุง ฺฉ ุญุงูุช ุฎุงุต ุจู ูุงู **Message Mode** ุฏุงุฑูุฏ.
ุฏุฑ ุงู ุญุงูุช ูโุชูุงู ุจุง ูฺฺฏ `IsMessageComplete` ูููุฏ ฺฉ ูพุงู ฺฉุงูู ุฏุฑุงูุช ุดุฏู ุงุณุช.

๐ ูุซุงู: ุฎูุงูุฏู ฺฉู ูพุงู:

```csharp
static byte[] ReadMessage(PipeStream s)
{
    MemoryStream ms = new MemoryStream();
    byte[] buffer = new byte[0x1000]; // 4KB
    do { ms.Write(buffer, 0, s.Read(buffer, 0, buffer.Length)); }
    while (!s.IsMessageComplete);
    return ms.ToArray();
}
```

---

### โจ ูุนุงูโุณุงุฒ Message Mode

**Server**:

```csharp
using var s = new NamedPipeServerStream(
    "pipedream", PipeDirection.InOut, 1, PipeTransmissionMode.Message);

s.WaitForConnection();
byte[] msg = Encoding.UTF8.GetBytes("Hello");
s.Write(msg, 0, msg.Length);
Console.WriteLine(Encoding.UTF8.GetString(ReadMessage(s)));
```

**Client**:

```csharp
using var s = new NamedPipeClientStream("pipedream");
s.Connect();
s.ReadMode = PipeTransmissionMode.Message;

Console.WriteLine(Encoding.UTF8.GetString(ReadMessage(s)));
byte[] msg = Encoding.UTF8.GetBytes("Hello right back!");
s.Write(msg, 0, msg.Length);
```

โ๏ธ **Message Mode ููุท ุฑู ููุฏูุฒ ูพุดุชุจุงู ูโุดูุฏ.**
ุฏุฑ ุณุงุฑ ุณุณุชูโุนุงููโูุง โ `PlatformNotSupportedException` ูพุฑุชุงุจ ูโุดูุฏ.

---

### **ูพุงูพโูุง ูุงุดูุงุณ (Anonymous pipes)**

ฺฉ **ูพุงูพ ูุงุดูุงุณ** ฺฉ ุฌุฑุงู ุงุฑุชุจุงุท ฺฉโุทุฑูู ุจู ฺฉ **ูพุฑุฏุงุฒุด ูุงูุฏ (parent process)** ู ฺฉ **ูพุฑุฏุงุฒุด ูุฑุฒูุฏ (child process)** ูุฑุงูู ูโฺฉูุฏ. ุจูโุฌุง ุงุณุชูุงุฏู ุงุฒ ฺฉ ูุงู ุณุฑุงุณุฑ ุฏุฑ ุณุณุชูุ ูพุงูพโูุง ูุงุดูุงุณ ุงุฒ ุทุฑู ฺฉ **ููุฏู ุฎุตูุต (private handle)** ุจุง ูู ุงุฑุชุจุงุท ุจุฑูุฑุงุฑ ูโฺฉููุฏ.

ููุงููุฏ ูพุงูพโูุง ูุงูโุฏุงุฑุ ุฏุฑ ุงูุฌุง ูู ููุดโูุง ูุดุฎุต ุจุฑุง **ฺฉูุงูุช** ู **ุณุฑูุฑ** ูุฌูุฏ ุฏุงุฑุฏ. ุจุง ุงู ุญุงูุ ุดููโ ุงุฑุชุจุงุท ฺฉู ูุชูุงูุช ุงุณุช ู ุจูโุตูุฑุช ุฒุฑ ุงูุฌุงู ูโุดูุฏ:

1. ุณุฑูุฑ ฺฉ **AnonymousPipeServerStream** ูโุณุงุฒุฏ ู ุจู ฺฉ **PipeDirection** (ุฌูุช In ุง Out) ูุชุนูุฏ ูโุดูุฏ.
2. ุณุฑูุฑ ูุชุฏ **GetClientHandleAsString** ุฑุง ุตุฏุง ูโุฒูุฏ ุชุง ฺฉ ุดูุงุณู ุจุฑุง ูพุงูพ ุจฺฏุฑุฏุ ุณูพุณ ุขู ุฑุง ุจู ฺฉูุงูุช ูโูุฑุณุชุฏ (ูุนูููุงู ุจูโุนููุงู ุขุฑฺฏููุงู ููฺฏุงู ุฑุงูโุงูุฏุงุฒ ูพุฑุฏุงุฒุด ูุฑุฒูุฏ).
3. ูพุฑุฏุงุฒุด ูุฑุฒูุฏ ฺฉ **AnonymousPipeClientStream** ูโุณุงุฒุฏ ู ุฌูุช ูุฎุงูู ุฑุง ูุดุฎุต ูโฺฉูุฏ.
4. ุณุฑูุฑ ููุฏู ูุญูโุง ฺฉู ุฏุฑ ูุฑุญููโ ฒ ุณุงุฎุชู ุดุฏู ุจูุฏ ุฑุง ุจุง ูุชุฏ **DisposeLocalCopyOfClientHandle** ุขุฒุงุฏ ูโฺฉูุฏ.
5. ุญุงูุง ูพุฑุฏุงุฒุด ูุงูุฏ ู ูุฑุฒูุฏ ูโุชูุงููุฏ ุงุฒ ุทุฑู ุฎูุงูุฏู/ููุดุชู ุงุณุชุฑู ุจุง ูู ุงุฑุชุจุงุท ุจุฑูุฑุงุฑ ฺฉููุฏ.

ุงุฒ ุขูุฌุง ฺฉู ูพุงูพโูุง ูุงุดูุงุณ ฺฉโุทุฑูู ูุณุชูุฏุ ฺฉ ุณุฑูุฑ ุจุฑุง ุงุฑุชุจุงุท ุฏูุทุฑูู ุจุงุฏ **ุฏู ูพุงูพ** ุจุณุงุฒุฏ.

ฺฉุฏ ุฒุฑ ูุดุงู ูโุฏูุฏ ฺฉู ฺุทูุฑ ุฏู ูพุงูพ (ูุฑูุฏ ู ุฎุฑูุฌ) ุณุงุฎุชู ูโุดููุฏ ู ุณูพุณ ฺฉ ูพุฑุฏุงุฒุด ูุฑุฒูุฏ ุฑุงูโุงูุฏุงุฒ ูโุดูุฏ. ุฏุฑ ุงุฏุงููุ ฺฉ ุจุงุช ุงุฒ ุณุฑูุฑ ุจู ูุฑุฒูุฏ ุงุฑุณุงู ุดุฏู ู ฺฉ ุจุงุช ุฏุฑ ูพุงุณุฎ ุฏุฑุงูุช ูโุดูุฏ:

```csharp
class Program
{
  static void Main (string[] args)
  {
    if (args.Length == 0)
      // ุจุฏูู ุขุฑฺฏููุงู = ุญุงูุช ุณุฑูุฑ
      AnonymousPipeServer();
    else
      // ุขุฑฺฏููุงูโูุง = ุดูุงุณูโูุง ูพุงูพ ุจุฑุง ุญุงูุช ฺฉูุงูุช
      AnonymousPipeClient (args [0], args [1]);
  }

  static void AnonymousPipeClient (string rxID, string txID)
  {
    using var rx = new AnonymousPipeClientStream (PipeDirection.In, rxID);
    using var tx = new AnonymousPipeClientStream (PipeDirection.Out, txID);
    Console.WriteLine ("Client received: " + rx.ReadByte ());
    tx.WriteByte (200);
  }

  static void AnonymousPipeServer ()
  {
    using var tx = new AnonymousPipeServerStream (
                     PipeDirection.Out, HandleInheritability.Inheritable);
    using var rx = new AnonymousPipeServerStream (
                     PipeDirection.In, HandleInheritability.Inheritable);

    string txID = tx.GetClientHandleAsString ();
    string rxID = rx.GetClientHandleAsString ();

    // ุงุฌุงุฏ ู ุฑุงูโุงูุฏุงุฒ ูพุฑุฏุงุฒุด ูุฑุฒูุฏ
    string thisAssembly = Assembly.GetEntryAssembly().Location;
    string thisExe = Path.ChangeExtension (thisAssembly, ".exe");
    var args = $"{txID} {rxID}";
    var startInfo = new ProcessStartInfo (thisExe, args);
    startInfo.UseShellExecute = false;   // ุงูุฒุงู ุจุฑุง ูพุฑุฏุงุฒุด ูุฑุฒูุฏ
    Process p = Process.Start (startInfo);

    tx.DisposeLocalCopyOfClientHandle ();  // ุขุฒุงุฏุณุงุฒ ููุงุจุน
    rx.DisposeLocalCopyOfClientHandle ();

    tx.WriteByte (100);    // ุงุฑุณุงู ฺฉ ุจุงุช ุจู ูพุฑุฏุงุฒุด ูุฑุฒูุฏ
    Console.WriteLine ("Server received: " + rx.ReadByte ());
    p.WaitForExit ();
  }
}
```

๐ ููุงููุฏ ูพุงูพโูุง ูุงูโุฏุงุฑุ **ฺฉูุงูุช ู ุณุฑูุฑ ุจุงุฏ ุงุฑุณุงู ู ุฏุฑุงูุช ุฎูุฏ ุฑุง ููุงููฺฏ ฺฉููุฏ** ู ุฑู ุทูู ูุฑ ุงูุชูุงู ุชูุงูู ุฏุงุดุชู ุจุงุดูุฏ. ูุชุฃุณูุงูู ูพุงูพโูุง ูุงุดูุงุณ ุงุฒ **ุญุงูุช ูพุงู (message mode)** ูพุดุชุจุงู ููโฺฉููุฏุ ุจูุงุจุฑุงู ุจุงุฏ ุฎูุฏุชุงู ูพุฑูุชฺฉู ูุฏุฑุช ุทูู ูพุงู ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ.

ฺฉ ุงุฒ ุฑุงูโุญูโูุง ุงู ุงุณุช ฺฉู ุฏุฑ ฺูุงุฑ ุจุงุช ุงูู ูุฑ ุงูุชูุงูุ ฺฉ **ุนุฏุฏ ุตุญุญ (integer)** ุงุฑุณุงู ุดูุฏ ฺฉู ุทูู ูพุงู ุจุนุฏ ุฑุง ูุดุฎุต ฺฉูุฏ. ฺฉูุงุณ **BitConverter** ูุชุฏูุง ุจุฑุง ุชุจุฏู ุจู ฺฉ ุนุฏุฏ ุตุญุญ ู ฺฉ ุขุฑุงูโ ด ุจุงุช ูุฑุงูู ูโฺฉูุฏ.

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/15/Table-15-5.jpeg)
</div>

---

### **BufferedStream (ุงุณุชุฑู ุจุงูุฑ ุดุฏู)**

ุจุงูุฑูฺฏ ุจุงุนุซ ุจูุจูุฏ ฺฉุงุฑุง ูโุดูุฏ ฺูู ุชุนุฏุงุฏ ุฏูุนุงุช ุฑูุชโูุจุฑฺฏุดุช ุจู **backing store** (ูุซู ูุงู ุง ุดุจฺฉู) ุฑุง ฺฉุงูุด ูโุฏูุฏ.

ุฏุฑ ูุซุงู ุฒุฑ ูุง ฺฉ **FileStream** ุฑุง ุฏุงุฎู ฺฉ **BufferedStream** ุจุง ุงูุฏุงุฒูโ ุจุงูุฑ ฒฐ ฺฉููุจุงุช ูโูพฺู:

```csharp
// ููุดุชู 100K ุฏุฑ ฺฉ ูุงู:
File.WriteAllBytes ("myFile.bin", new byte [100000]);
using FileStream fs = File.OpenRead ("myFile.bin");
using BufferedStream bs = new BufferedStream (fs, 20000);  // ุจุงูุฑ 20K
bs.ReadByte();
Console.WriteLine (fs.Position);   // 20000
```

๐ ุฏุฑ ุงู ูุซุงูุ ุงุณุชุฑู ุฒุฑู (**FileStream**) ุจุนุฏ ุงุฒ ุฎูุงูุฏู ููุท **ฺฉ ุจุงุช**ุ ุจู ุงูุฏุงุฒูโ ฒฐ,ฐฐฐ ุจุงุช ุฌูู ูโุฑูุฏุ ุงู ุจู ุฎุงุทุฑ **read-ahead buffering** ุงุณุช. ูุง ูโุชูุงูู ูุชุฏ `ReadByte` ุฑุง **ฑน,นนน ุจุงุฑ ุฏฺฏุฑ** ุตุฏุง ุจุฒููุ ุจุฏูู ุงูฺฉู ุฏูุจุงุฑู `FileStream` ุฏุฑฺฏุฑ ุดูุฏ.

โ ุฏุฑ ุนููุ ุจุณุชู ฺฉ **BufferedStream** ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุงุณุชุฑู backing store ุฒุฑู ุฑุง ูู ูโุจูุฏุฏ.

โ๏ธ ุชุฑฺฉุจ **BufferedStream** ุจุง **FileStream** (ูุซู ุงู ูุซุงู) ุงุฑุฒุด ูุญุฏูุฏ ุฏุงุฑุฏุ ฺูู **FileStream ุฎูุฏุด ุจุงูุฑ ุฏุงุฎู ุฏุงุฑุฏ**. ุชููุง ฺฉุงุฑุจุฑุฏ ุขู ูโุชูุงูุฏ ุฒูุงู ุจุงุดุฏ ฺฉู ุจุฎูุงูู ุจุงูุฑ ฺฉ **FileStream** ุณุงุฎุชูโุดุฏู ุฑุง **ุจุฒุฑฺฏโุชุฑ ฺฉูู**.

---

### **Stream Adapters (ุขุฏุงูพุชูุฑูุง ุงุณุชุฑู)**

ุงุฒ ุขูุฌุง ฺฉู **Stream ููุท ุจุง ุจุงุชโูุง ุณุฑูฺฉุงุฑ ุฏุงุฑุฏ**ุ ุจุฑุง ุฎูุงูุฏู ุง ููุดุชู ุฏุงุฏูโูุง ูุซู **ุฑุดุชูโูุง (string)**ุ **ุงุนุฏุงุฏ ุตุญุญ (int)** ุง **ุนูุงุตุฑ XML** ุจุงุฏ ุงุฒ **adapter** ุงุณุชูุงุฏู ฺฉูุฏ.

๐ .NET ุขุฏุงูพุชูุฑูุง ุฒุฑ ุฑุง ูุฑุงูู ฺฉุฑุฏู ุงุณุช:

* **ุขุฏุงูพุชูุฑูุง ูุชู (ุจุฑุง ุฏุงุฏูโูุง ุฑุดุชู ู ฺฉุงุฑุงฺฉุชุฑ):**

  * `TextReader`, `TextWriter`
  * `StreamReader`, `StreamWriter`
  * `StringReader`, `StringWriter`

* **ุขุฏุงูพุชูุฑูุง ุจุงูุฑ (ุจุฑุง ุงููุงุน ุฏุงุฏูโูุง ุงููู ูุซู int, bool, string, float):**

  * `BinaryReader`, `BinaryWriter`

* **ุขุฏุงูพุชูุฑูุง XML (ูพูุดุด ุฏุงุฏูโุดุฏู ุฏุฑ ูุตู 11):**

  * `XmlReader`, `XmlWriter`

๐ ุดฺฉู 15-5 ุฑูุงุจุท ุจู ุงู ููุนโูุง ุฑุง ูุดุงู ูโุฏูุฏ.

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/15/Table-15-6.jpeg)
</div>

### **ุขุฏุงูพุชูุฑูุง ูุชู (Text Adapters)**

`TextReader` ู `TextWriter` ฺฉูุงุณโูุง ูพุงูโ ุงูุชุฒุงุน ูุณุชูุฏ ฺฉู ูุฎุตูุต ฺฉุงุฑ ุจุง **ฺฉุงุฑุงฺฉุชุฑูุง** ู **ุฑุดุชูโูุง** ุทุฑุงุญ ุดุฏูโุงูุฏ. ูุฑ ฺฉุฏุงู ุฏุฑ .NET ุฏู ูพุงุฏูโุณุงุฒ ุนููู ุฏุงุฑูุฏ:

* **`StreamReader` / `StreamWriter`**
  ุงุฒ ฺฉ **Stream** ุจูโุนููุงู ููุจุน ุฏุงุฏูโ ุฎุงู ุงุณุชูุงุฏู ูโฺฉููุฏ ู ุจุงุชโูุง ุงุณุชุฑู ุฑุง ุจู ฺฉุงุฑุงฺฉุชุฑูุง ุง ุฑุดุชูโูุง ุชุจุฏู ูโฺฉููุฏ.

* **`StringReader` / `StringWriter`**
  `TextReader` / `TextWriter` ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ **ุฑุดุชูโูุง ุฏุฑูู ุญุงูุธู** ูพุงุฏูโุณุงุฒ ูโฺฉููุฏ.

๐ **ุฌุฏูู 15-2** ุงุนุถุง `TextReader` ุฑุง ุจุฑ ุงุณุงุณ ุฏุณุชูโุจูุฏ ูุดุงู ูโุฏูุฏ.

* ูุชุฏ `Peek` ฺฉุงุฑุงฺฉุชุฑ ุจุนุฏ ุฏุฑ ุงุณุชุฑู ุฑุง **ุจุฑูโฺฏุฑุฏุงูุฏ ุจุฏูู ุงูฺฉู ูููุนุช ุฑุง ุฌูู ุจุจุฑุฏ**.
* ูู `Peek` ู ูู ูุณุฎูโ ุจุฏูู ูพุงุฑุงูุชุฑ `Read` ููุฏุงุฑ **-1** ุฑุง ุจุฑูโฺฏุฑุฏุงููุฏ ุงฺฏุฑ ุจู ุงูุชูุง ุงุณุชุฑู ุฑุณุฏู ุจุงุดูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ฺฉ **ุนุฏุฏ ุตุญุญ (int)** ุจุฑูโฺฏุฑุฏุงููุฏ ฺฉู ูโุชูุงู ุขู ุฑุง ูุณุชูู ุจู `char` ุชุจุฏู ฺฉุฑุฏ.
* ูุณุฎูโ overload ุดุฏูโ `Read` ฺฉู ฺฉ `char[] buffer` ูโฺฏุฑุฏุ ุฏููุงู ูุดุงุจู ูุชุฏ `ReadBlock` ุนูู ูโฺฉูุฏ.
* ูุชุฏ `ReadLine` ูโุฎูุงูุฏ ุชุง ุฒูุงู ฺฉู ุจู ฺฉ ุงุฒ ุงูโูุง ุจุฑุณุฏ:

  * **CR** (ฺฉุฏ ฺฉุงุฑุงฺฉุชุฑ 13)
  * **LF** (ฺฉุฏ ฺฉุงุฑุงฺฉุชุฑ 10)
  * ุง ุชุฑฺฉุจ **CR+LF**
    ุณูพุณ ฺฉ **ุฑุดุชู (string)** ุจุฑูโฺฏุฑุฏุงูุฏ ู ฺฉุงุฑุงฺฉุชุฑูุง CR/LF ุฑุง ุญุฐู ูโฺฉูุฏ.

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/15/Table-15-7.jpeg)
</div>

`Environment.NewLine` ุฏูุจุงููโ **new-line** ููุงุณุจ ุจุฑุง ุณุณุชูโุนุงูู ูุนู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.

* ุฏุฑ **ููุฏูุฒ**ุ ุงู ููุฏุงุฑ `"\r\n"` ุงุณุช (ุจู ุงุฏ โReturNโ ุจูุชุฏ) ู ุจู ุตูุฑุช ุชูุฑุจ ุดุจู ฺฉ ูุงุดู ุชุญุฑุฑ ูฺฉุงูฺฉ ูุฏู ุดุฏู: ุงุจุชุฏุง **CR** (ฺฉุงุฑุงฺฉุชุฑ ฑณ) ู ุณูพุณ **LF** (ฺฉุงุฑุงฺฉุชุฑ ฑฐ). ุงฺฏุฑ ุชุฑุชุจ ุฑุง ุจุฑุนฺฉุณ ฺฉูุฏุ ุง ุฏู ุฎุท ุฌุฏุฏ ุฎูุงูุฏ ุฏุงุดุช ุง ูฺ!
* ุฏุฑ **Unix** ู **macOS**ุ ููุฏุงุฑ ุชููุง `"\n"` ุงุณุช.

`TextWriter` ูุชุฏูุง ูุดุงุจู ุจุฑุง ููุดุชู ุฏุงุฑุฏุ ููุงูโุทูุฑ ฺฉู ุฏุฑ **ุฌุฏูู 15-3** ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช. ูุชุฏูุง `Write` ู `WriteLine` ููฺูู **overload** ุดุฏูโุงูุฏ ุชุง ูููโ ููุนโูุง ุงููู ู ููุน **object** ุฑุง ูุจูู ฺฉููุฏ. ุงู ูุชุฏูุง ุตุฑูุงู ูุชุฏ `ToString` ุฑุง ุฑู ููุฏุงุฑ ฺฉู ุฏุงุฏู ุดุฏู ุตุฏุง ูโุฒููุฏ (ุงุฎุชุงุฑ ุงุฒ ุทุฑู ฺฉ `IFormatProvider` ฺฉู ููฺฏุงู ุตุฏุง ุฒุฏู ูุชุฏ ุง ููฺฏุงู ุณุงุฎุช `TextWriter` ูุดุฎุต ุดุฏู ุจุงุดุฏ).

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/15/Table-15-8.jpeg)
</div>

ูุชุฏ `WriteLine` ุจูโุณุงุฏฺฏ ูุชู ุฏุงุฏูโุดุฏู ุฑุง ุจุง `Environment.NewLine` ุงูุญุงู ูโฺฉูุฏ. ูโุชูุงูุฏ ุงู ุฑูุชุงุฑ ุฑุง ุงุฒ ุทุฑู **ุฎุงุตุช `NewLine`** ุชุบุฑ ุฏูุฏ (ุงู ูโุชูุงูุฏ ุจุฑุง **ุชุทุจู ุจุง ูุฑูุชโูุง ูุงู Unix** ููุฏ ุจุงุดุฏ).

ููุงููุฏ `Stream`ุ ฺฉูุงุณโูุง `TextReader` ู `TextWriter` ูุณุฎูโูุง **ุขุณูฺฉุฑูู ูุจุชู ุจุฑ Task** ุงุฒ ูุชุฏูุง ุฎูุงูุฏู ู ููุดุชู ุฎูุฏ ุฑุง ุงุฑุงุฆู ูโุฏููุฏ.

### StreamReader ู StreamWriter ๐โ๏ธ

ุฏุฑ ูุซุงู ุฒุฑุ ฺฉ `StreamWriter` ุฏู ุฎุท ูุชู ุฑุง ุฏุฑ ฺฉ ูุงู ูโููุณุฏ ู ุณูพุณ ฺฉ `StreamReader` ูุงู ุฑุง ุฏูุจุงุฑู ูโุฎูุงูุฏ:

```csharp
using (FileStream fs = File.Create("test.txt"))
using (TextWriter writer = new StreamWriter(fs))
{
    writer.WriteLine("Line1");
    writer.WriteLine("Line2");
}
using (FileStream fs = File.OpenRead("test.txt"))
using (TextReader reader = new StreamReader(fs))
{
    Console.WriteLine(reader.ReadLine()); // Line1
    Console.WriteLine(reader.ReadLine()); // Line2
}
```

ฺูู **Text adapters** ุงุบูุจ ููุฑุงู ุจุง ูุงูโูุง ุงุณุชูุงุฏู ูโุดููุฏุ ฺฉูุงุณ `File` ูุชุฏูุง **ุงุณุชุงุชฺฉ** `CreateText`ุ `AppendText` ู `OpenText` ุฑุง ุจุฑุง ฺฉูุชุงู ฺฉุฑุฏู ุฑููุฏ ูุฑุงูู ูโฺฉูุฏ:

```csharp
using (TextWriter writer = File.CreateText("test.txt"))
{
    writer.WriteLine("Line1");
    writer.WriteLine("Line2");
}
using (TextWriter writer = File.AppendText("test.txt"))
    writer.WriteLine("Line3");

using (TextReader reader = File.OpenText("test.txt"))
    while (reader.Peek() > -1)
        Console.WriteLine(reader.ReadLine()); // Line1, Line2, Line3
```

ุงู ูุซุงู ููฺูู ูุดุงู ูโุฏูุฏ ฺฉู ฺฺฏููู ูพุงุงู ูุงู ุฑุง ุจุฑุฑุณ ฺฉูู (`reader.Peek()`). ุฑูุด ุฏฺฏุฑ ุงู ุงุณุช ฺฉู ุชุง ููุช `reader.ReadLine` ููุฏุงุฑ `null` ุจุฑฺฏุฑุฏุงูุฏุ ุงุฏุงูู ุฏูู.

ูโุชูุงูุฏ ุงููุงุน ุฏฺฏุฑ ูุงููุฏ **ุงุนุฏุงุฏ ุตุญุญ** ุฑุง ูุฒ ุจุฎูุงูุฏ ู ุจููุณุฏุ ุงูุง ฺูู `TextWriter` ูุชุฏ `ToString` ุฑุง ุฑู ููุน ุดูุง ุตุฏุง ูโุฒูุฏุ ููฺฏุงู ุฎูุงูุฏู ุจุงุฏ ุฑุดุชู ุฑุง **Parse** ฺฉูุฏ:

```csharp
using (TextWriter w = File.CreateText("data.txt"))
{
    w.WriteLine(123);      // ูโููุณุฏ "123"
    w.WriteLine(true);     // ูโููุณุฏ "true"
}
using (TextReader r = File.OpenText("data.txt"))
{
    int myInt = int.Parse(r.ReadLine());   // myInt == 123
    bool yes = bool.Parse(r.ReadLine());   // yes == true
}
```

### ุฑูุฒฺฏุฐุงุฑ ฺฉุงุฑุงฺฉุชุฑูุง ๐ค

`TextReader` ู `TextWriter` ุฎูุฏุดุงู ุชููุง ฺฉูุงุณโูุง **abstract** ูุณุชูุฏ ู ุงุฑุชุจุงุท ุจุง ฺฉ **stream** ุง **backing store** ูุฏุงุฑูุฏ. ุงูุง `StreamReader` ู `StreamWriter` ุจู ฺฉ **stream ุจุงุชโูุญูุฑ** ูุชุตูโุงูุฏ ู ุจุงุฏ ุจู **ฺฉุงุฑุงฺฉุชุฑูุง ู ุจุงุชโูุง** ุชุจุฏู ุงูุฌุงู ุฏููุฏ. ุงู ฺฉุงุฑ ุงุฒ ุทุฑู ฺฉูุงุณ `Encoding` ุฏุฑ **System.Text** ุงูุฌุงู ูโุดูุฏ ฺฉู ููฺฏุงู ุณุงุฎุช `StreamReader` ุง `StreamWriter` ุงูุชุฎุงุจ ูโฺฉูุฏ. ุงฺฏุฑ ฺุฒ ุงูุชุฎุงุจ ูฺฉูุฏุ **UTF-8** ูพุดโูุฑุถ ุงุณุชูุงุฏู ูโุดูุฏ.

ุงฺฏุฑ ุจูโุทูุฑ ุตุฑุญ ฺฉ **Encoding** ูุดุฎุต ฺฉูุฏุ `StreamWriter` ุจูโุทูุฑ ูพุดโูุฑุถ ฺฉ ูพุดโููุฏ (prefix) ุจุฑุง ุดูุงุณุง ุฑูุฒฺฏุฐุงุฑ ุจู ุงุจุชุฏุง ุฌุฑุงู ูโููุณุฏ. ุงู ูุนูููุงู ูุงุฎูุงุณุชู ุงุณุช ู ูโุชูุงูุฏ ุจุง ุณุงุฎุช Encoding ุจู ุดฺฉู ุฒุฑ ุงุฒ ุขู ุฌููฺฏุฑ ฺฉูุฏ:

```csharp
var encoding = new UTF8Encoding(
    encoderShouldEmitUTF8Identifier: false,
    throwOnInvalidBytes: true
);
```

ุขุฑฺฏููุงู ุฏูู ุจู `StreamWriter` ุง `StreamReader` ูโฺฏูุฏ ุงฺฏุฑ ุจุง ุจุงุชโูุง ููุงุฌู ุดุฏ ฺฉู ุชุฑุฌูู ูุนุชุจุฑ ุจู ุฑุดุชู ูุฏุงุฑูุฏุ **Exception** ูพุฑุชุงุจ ฺฉูุฏุ ฺฉู ุจุง ุฑูุชุงุฑ ูพุดโูุฑุถ ูุทุงุจูุช ุฏุงุฑุฏ.

### ูุซุงู ุฑูุฒฺฏุฐุงุฑ ASCII ู UTF-8

ุฑูุฒฺฏุฐุงุฑ ุณุงุฏู `ASCII` ุงุณุชุ ฺูู ูุฑ ฺฉุงุฑุงฺฉุชุฑ ุจุง ฺฉ ุจุงุช ููุงุด ุฏุงุฏู ูโุดูุฏ. ฺฉุงุฑุงฺฉุชุฑูุง ุบุฑุงูฺฏูุณ ุง ููุงุฏูุง ูฺู ูุงุจู ููุงุด ูุณุชูุฏ ู ุจู `โก` ุชุจุฏู ูโุดููุฏ.

ุฑูุฒฺฏุฐุงุฑ ูพุดโูุฑุถ `UTF-8` ูโุชูุงูุฏ ุชูุงู ฺฉุงุฑุงฺฉุชุฑูุง ููฺฉุฏ ุฑุง ููุงุด ุฏูุฏ. ฺฉุงุฑุงฺฉุชุฑูุง ASCII (127 ฺฉุงุฑุงฺฉุชุฑ ุงูู) ุจุง ฺฉ ุจุงุช ฺฉุฏฺฏุฐุงุฑ ูโุดููุฏุ ุจูู ฺฉุงุฑุงฺฉุชุฑูุง ุจุง ุชุนุฏุงุฏ ุจุงุช ูุชุบุฑ (ูุนูููุงู ุฏู ุง ุณู) ฺฉุฏฺฏุฐุงุฑ ูโุดููุฏ. ูุซุงู:

```csharp
using (TextWriter w = File.CreateText("but.txt")) // ุงุณุชูุงุฏู ุงุฒ UTF-8 ูพุดโูุฑุถ
    w.WriteLine("but-");

using (Stream s = File.OpenRead("but.txt"))
    for (int b; (b = s.ReadByte()) > -1;)
        Console.WriteLine(b);
```

ุจุฑุง ฺฉุงุฑุงฺฉุชุฑ **em dash (โ)** ฺฉู ุฎุงุฑุฌ ุงุฒ 127 ฺฉุงุฑุงฺฉุชุฑ ุงูู ููฺฉุฏ ุงุณุชุ UTF-8 ุณู ุจุงุช ุงุณุชูุงุฏู ูโฺฉูุฏ.

### UTF-16

UTF-16 ุงุฒ ุฏู ุง ฺูุงุฑ ุจุงุช ุจุฑุง ูุฑ ฺฉุงุฑุงฺฉุชุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ. ููุน `char` ุฏุฑ C# ููุท 16 ุจุช ุงุณุชุ ูพุณ UTF-16 ุฏููุงู ุฏู ุจุงุช ุจุฑุง ูุฑ char ุงุณุชูุงุฏู ูโฺฉูุฏ. ุงู ุงูฺฉุงู ูพุฑุด ุจู ุงูุฏฺฉุณ ฺฉุงุฑุงฺฉุชุฑ ูุดุฎุต ุฏุฑ stream ุฑุง ุขุณุงู ูโฺฉูุฏ.

UTF-16 ุงุฒ ฺฉ ูพุดโููุฏ ุฏู ุจุงุช ุจุฑุง ูุดุฎุต ฺฉุฑุฏู **little-endian** ุง **big-endian** ุงุณุชูุงุฏู ูโฺฉูุฏ. ุชุฑุชุจ ูพุดโูุฑุถ little-endian ุจุฑุง ุณุณุชูโูุง ูุจุชู ุจุฑ ููุฏูุฒ ุงุณุชุงูุฏุงุฑุฏ ุงุณุช.

### StringReader ู StringWriter

ุงูโูุง **stream** ุฑุง wrap ููโฺฉููุฏ ู ุงุฒ ฺฉ **string** ุง **StringBuilder** ุจูโุนููุงู ููุจุน ุฏุงุฏู ุงุณุชูุงุฏู ูโฺฉููุฏ. ุจูุงุจุฑุงู ูุงุฒ ุจู ุชุฑุฌูู ุจุงุช ูุณุช ู ฺฉูุงุณโูุง ุชููุง ุจุฑ ุงุณุงุณ ููุงู ุฑูุชุงุฑ ูพุงู `StreamReader/StreamWriter` ุนูู ูโฺฉููุฏ.

ูุซุงู: ุงฺฏุฑ ุจุฎูุงูุฏ ฺฉ ุฑุดุชู ุญุงู XML ุฑุง ุจุง `XmlReader` ุชุฌุฒู ฺฉูุฏ:

```csharp
XmlReader r = XmlReader.Create(new StringReader(myString));
```

### Binary Adapters ๐พ

`BinaryReader` ู `BinaryWriter` ุฏุงุฏูโูุง native ูุงููุฏ `bool`ุ `byte`ุ `int`ุ `double`ุ `string` ู ุขุฑุงูโูุง ููุนโูุง ุงููู ุฑุง ูโุฎูุงููุฏ ู ูโููุณูุฏ.
ุจุฑ ุฎูุงู `StreamReader/StreamWriter`ุ binary adapters ุฏุงุฏูโูุง ุฑุง ุจูโุตูุฑุช **ููุซุฑ ุฏุฑ ุญุงูุธู** ุฐุฎุฑู ูโฺฉููุฏ.

ูุซุงู ุชุนุฑู ฺฉูุงุณ ุณุงุฏู ู ุฐุฎุฑู/ุจุงุฑฺฏุฐุงุฑ ุจุง binary adapters:

```csharp
public class Person
{
    public string Name;
    public int Age;
    public double Height;

    public void SaveData(Stream s)
    {
        var w = new BinaryWriter(s);
        w.Write(Name);
        w.Write(Age);
        w.Write(Height);
        w.Flush(); // ุงุทููุงู ุงุฒ ุฎุงู ุดุฏู ุจุงูุฑ
    }

    public void LoadData(Stream s)
    {
        var r = new BinaryReader(s);
        Name = r.ReadString();
        Age = r.ReadInt32();
        Height = r.ReadDouble();
    }
}
```

ููฺูู ูโุชูุงู ุจุง `BinaryReader` ฺฉู ูุญุชูุง ฺฉ **stream seekable** ุฑุง ุจู ุขุฑุงู ุจุงุช ุฎูุงูุฏ:

```csharp
byte[] data = new BinaryReader(s).ReadBytes((int)s.Length);
```

ุงู ุฑูุด ุฑุงุญุชโุชุฑ ุงุฒ ุฎูุงูุฏู ูุณุชูู ุงุฒ stream ุงุณุชุ ฺูู ูุงุฒ ุจู loop ุจุฑุง ุงุทููุงู ุงุฒ ุฎูุงูุฏู ุชูุงู ุฏุงุฏูโูุง ูุฏุงุฑุฏ.

### ุจุณุชู ู ุขุฒุงุฏุณุงุฒ Stream Adapters ๐

ุจุฑุง **ุชุฎุฑุจ (tear down)** stream adaptersุ ฺูุงุฑ ฺฏุฒูู ุฏุงุฑุฏ:

1. ููุท adapter ุฑุง ุจุจูุฏุฏ.
2. adapter ุฑุง ุจุจูุฏุฏ ู ุณูพุณ stream ุฑุง ุจุจูุฏุฏ.
3. (ุจุฑุง writers) adapter ุฑุง Flush ฺฉุฑุฏู ู ุณูพุณ stream ุฑุง ุจุจูุฏุฏ.
4. (ุจุฑุง readers) ููุท stream ุฑุง ุจุจูุฏุฏ.

ุฏุฑ adaptersุ ูุชุฏูุง `Close` ู `Dispose` **ููโูุนู** ูุณุชูุฏุ ููุงููุฏ ุฑูุชุงุฑุดุงู ุฏุฑ streams.

ฺฏุฒููโูุง 1 ู 2 ุงุฒ ูุธุฑ ูุนูุง **ฺฉุณุงู** ูุณุชูุฏุ ุฒุฑุง ุจุณุชู ฺฉ adapter ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ **stream ุฒุฑู** ุฑุง ูุฒ ูโุจูุฏุฏ. ูุฑ ุฒูุงู ฺฉู ุงุฒ **nested using statements** ุงุณุชูุงุฏู ูโฺฉูุฏุ ุนููุงู ฺฏุฒูู 2 ุฑุง ุงูุชุฎุงุจ ฺฉุฑุฏูโุงุฏ:

```csharp
using (FileStream fs = File.Create("test.txt"))
using (TextWriter writer = new StreamWriter(fs))
    writer.WriteLine("Line");
```

ฺูู dispose ุจู ุชุฑุชุจ ุงุฒ ุฏุงุฎู ุจู ุจุฑูู ุงูุฌุงู ูโุดูุฏุ ุงุจุชุฏุง adapter ุจุณุชู ูโุดูุฏ ู ุณูพุณ stream. ููฺูู ุงฺฏุฑ ุฏุฑ **constructor** adapter ุงุณุชุซูุง ุฑุฎ ุฏูุฏุ stream ููฺูุงู ุจุณุชู ูโุดูุฏ. ุงุณุชูุงุฏู ุงุฒ nested using statements ุชูุฑุจุงู ููุดู ุงูู ุงุณุช.

> ูุฑฺฏุฒ ฺฉ stream ุฑุง ูุจู ุงุฒ ุจุณุชู ุง Flush ฺฉุฑุฏู writer ุขู ูุจูุฏุฏ โ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ุฏุงุฏูโูุง ุจุงูุฑ ุดุฏู ุฏุฑ adapter ุงุฒ ุจู ูโุฑููุฏ.

ฺฏุฒููโูุง 3 ู 4 ฺฉุงุฑ ูโฺฉููุฏ ฺูู adapters ุฏุฑ ุฏุณุชู **objects ุจุง disposal ุงุฎุชุงุฑ** ูุฑุงุฑ ุฏุงุฑูุฏ. ฺฉ ูุซุงู: ููฺฉู ุงุณุช adapter ุฑุง ุชูุงู ฺฉุฑุฏู ุจุงุดุฏ ูู ุจุฎูุงูุฏ **stream ุฒุฑู** ุจุฑุง ุงุณุชูุงุฏูโูุง ุจุนุฏ ุจุงุฒ ุจูุงูุฏ:

```csharp
using (FileStream fs = new FileStream("test.txt", FileMode.Create))
{
    StreamWriter writer = new StreamWriter(fs);
    writer.WriteLine("Hello");
    writer.Flush();
    fs.Position = 0;
    Console.WriteLine(fs.ReadByte());
}
```

ุฏุฑ ุงูุฌุงุ ุงุจุชุฏุง ุจู ูุงู ูโููุณูุ ูููุนุช stream ุฑุง ุชุบุฑ ูโุฏูู ู ุณูพุณ ุงููู ุจุงุช ุฑุง ูโุฎูุงูู. ุงฺฏุฑ StreamWriter ุฑุง dispose ูโฺฉุฑุฏูุ FileStream ูุฒ ุจุณุชู ูโุดุฏ ู ุฎูุงูุฏู ุจุนุฏ ุดฺฉุณุช ูโุฎูุฑุฏ. ุดุฑุท ุงู ุงุณุช ฺฉู **Flush** ุฑุง ุตุฏุง ุจุฒูู ุชุง ุจุงูุฑ StreamWriter ุจู stream ููุดุชู ุดูุฏ.

Stream adapters ุจุง semantics **ุงุฎุชุงุฑ ุฏุฑ disposal**ุ ุงูฺฏู **extended disposal** ฺฉู finalizer ุฏุฑ ุขู Dispose ุฑุง ุตุฏุง ูโุฒูุฏุ ูพุงุฏูโุณุงุฒ ููโฺฉููุฏ. ุงู ุงูฺฉุงู ุฑุง ูโุฏูุฏ ฺฉู adapter ุฑูุงุดุฏู ููฺฏุงู ุฑุณุฏู **garbage collector** ุจู ุขูุ ุฎูุฏฺฉุงุฑ dispose ูุดูุฏ.

ููฺูู ฺฉ constructor ุฏุฑ StreamReader/StreamWriter ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุฏุณุชูุฑ ูโุฏูุฏ stream ุจุนุฏ ุงุฒ disposal ุจุงุฒ ุจูุงูุฏ. ุจูุงุจุฑุงู ูโุชูุงู ูุซุงู ูุจู ุฑุง ุจู ุดฺฉู ุฒุฑ ุจุงุฒููุณ ฺฉุฑุฏ:

```csharp
using (var fs = new FileStream("test.txt", FileMode.Create))
{
    using (var writer = new StreamWriter(fs, new UTF8Encoding(false, true), 0x400, true))
        writer.WriteLine("Hello");
    fs.Position = 0;
    Console.WriteLine(fs.ReadByte());
    Console.WriteLine(fs.Length);
}
```

---

### Compression Streams ๐ฆ

ุฏุฑ ูุถุง ูุงู `System.IO.Compression` ุฏู **compression stream** ุนููู ูุฌูุฏ ุฏุงุฑุฏ: `DeflateStream` ู `GZipStream`. ูุฑ ุฏู ุงุฒ ุงูฺฏูุฑุชู ูุดุฑุฏูโุณุงุฒ ูุดุงุจู ZIP ุงุณุชูุงุฏู ูโฺฉููุฏ. ุชูุงูุชุดุงู ุงู ุงุณุช ฺฉู **GZipStream** ฺฉ ูพุฑูุชฺฉู ุงุถุงู ุฏุฑ ุงุจุชุฏุง ู ุงูุชูุง ูโููุณุฏ ฺฉู ุดุงูู CRC ุจุฑุง ุชุดุฎุต ุฎุทุง ุงุณุช ู ุจุง ุงุณุชุงูุฏุงุฑุฏูุง ูุฑูโุงูุฒุงุฑ ุฏฺฏุฑ ุณุงุฒฺฏุงุฑ ุงุณุช.

.NET ููฺูู `BrotliStream` ุฑุง ุงุฑุงุฆู ูโุฏูุฏ ฺฉู ุงูฺฏูุฑุชู Brotli ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ. **BrotliStream** ุจุด ุงุฒ 10 ุจุฑุงุจุฑ ฺฉูุฏุชุฑ ุงุฒ DeflateStream ู GZipStream ุงุณุช ุงูุง ูุณุจุช ูุดุฑุฏูโุณุงุฒ ุจูุชุฑ ุฏุงุฑุฏ. (ุงู ฺฉุงูุด ุณุฑุนุช ููุท ุจุฑุง ูุดุฑุฏูโุณุงุฒ ุงุณุชุ ุฏฺฉุงููพุฑุดู ุจุณุงุฑ ุณุฑุน ุงุณุช.)

ูุฑ ุณู stream ูุงุจูุช ุฎูุงูุฏู ู ููุดุชู ุฏุงุฑูุฏุ ุจุง ุงู ุดุฑุงุท:

* ููฺฏุงู ูุดุฑุฏูโุณุงุฒุ ููุดู ุฑู stream ูโููุณุฏ.
* ููฺฏุงู ุฏฺฉุงููพุฑุดูุ ููุดู ุงุฒ stream ูโุฎูุงูุฏ.

`DeflateStream`ุ `GZipStream` ู `BrotliStream` **decorator** ูุณุชูุฏุ ุขูโูุง ุฏุงุฏูโูุง ุฑุง ุงุฒ stream ุฏฺฏุฑ ฺฉู ููฺฏุงู ุณุงุฎุช ุงุฑุงุฆู ูโุฏูุฏุ ูุดุฑุฏู ุง ุฏฺฉุงููพุฑ ูโฺฉููุฏ.

ูุซุงู ูุดุฑุฏูโุณุงุฒ ู ุฏฺฉุงููพุฑุดู ฺฉ ุณุฑ ุจุงุช ุจุง ุงุณุชูุงุฏู ุงุฒ FileStream:

```csharp
using (Stream s = File.Create("compressed.bin"))
using (Stream ds = new DeflateStream(s, CompressionMode.Compress))
    for (byte i = 0; i < 100; i++)
        ds.WriteByte(i);

using (Stream s = File.OpenRead("compressed.bin"))
using (Stream ds = new DeflateStream(s, CompressionMode.Decompress))
    for (byte i = 0; i < 100; i++)
        Console.WriteLine(ds.ReadByte()); // 0 ุชุง 99
```

ุจุง DeflateStreamุ ูุงู ูุดุฑุฏู 102 ุจุงุช ุงุณุช: ฺฉู ุจุฒุฑฺฏุชุฑ ุงุฒ ุงุตู. BrotliStream ุขู ุฑุง ุจู 73 ุจุงุช ูุดุฑุฏู ูโฺฉูุฏ. ูุดุฑุฏูโุณุงุฒ ุจุง ุฏุงุฏูโูุง ุจุงูุฑ **ูุชุฑุงฺฉู ู ุบุฑุชฺฉุฑุงุฑ** ุถุนู ุนูู ูโฺฉูุฏ ู ุจุง ุฏุงุฏูโูุง ุฑูุฒูฺฏุงุฑ ุดุฏู ุจุฏุชุฑ ุงุณุช. ุงูุง ุจุฑุง ูุงูโูุง ูุชู ุนููฺฉุฑุฏ ุฎูุจ ุฏุงุฑุฏ.

ูุซุงู ุจุนุฏ: ูุดุฑุฏู ู ุฏฺฉุงููพุฑุดู ฺฉ ูุชู 1000 ฺฉููู ุจุง ุงูฺฏูุฑุชู Brotli:

```csharp
string[] words = "The quick brown fox jumps over the lazy dog".Split();
Random rand = new Random(0); // ุจุฑุง ุซุจุงุช
using (Stream s = File.Create("compressed.bin"))
using (Stream ds = new BrotliStream(s, CompressionMode.Compress))
using (TextWriter w = new StreamWriter(ds))
    for (int i = 0; i < 1000; i++)
        await w.WriteAsync(words[rand.Next(words.Length)] + " ");

Console.WriteLine(new FileInfo("compressed.bin").Length); // 808

using (Stream s = File.OpenRead("compressed.bin"))
using (Stream ds = new BrotliStream(s, CompressionMode.Decompress))
using (TextReader r = new StreamReader(ds))
    Console.Write(await r.ReadToEndAsync());
```

ุฏุฑ ุงู ุญุงูุชุ BrotliStream ุจู ุทูุฑ ูุคุซุฑ ูุงู ุฑุง ุจู 808 ุจุงุช ูุดุฑุฏู ูโฺฉูุฏ โ ฺฉูุชุฑ ุงุฒ ฺฉ ุจุงุช ุจุฑุง ูุฑ ฺฉููู. (DeflateStream ููุงู ุฏุงุฏูโูุง ุฑุง ุจู 885 ุจุงุช ูุดุฑุฏู ูโฺฉูุฏ.)

---

### ูุดุฑุฏูโุณุงุฒ ุฏุฑ ุญุงูุธู ๐ง๐จ

ฺฏุงู ูุงุฒู ุงุณุช ูุดุฑุฏูโุณุงุฒ ฺฉุงููุงู **ุฏุฑ ุญุงูุธู** ุงูุฌุงู ุดูุฏ. ููููู ุจุง MemoryStream:

```csharp
byte[] data = new byte[1000]; // ุขุฑุงู ุฎุงู ุจุฑุง ุชุณุช ูุดุฑุฏูโุณุงุฒ
var ms = new MemoryStream();
using (Stream ds = new DeflateStream(ms, CompressionMode.Compress))
    ds.Write(data, 0, data.Length);

byte[] compressed = ms.ToArray();
Console.WriteLine(compressed.Length); // 11

// ุฏฺฉุงููพุฑุดู ุฏูุจุงุฑู ุจู ุขุฑุงู ุฏุงุฏู:
ms = new MemoryStream(compressed);
using (Stream ds = new DeflateStream(ms, CompressionMode.Decompress))
    for (int i = 0; i < 1000; i += ds.Read(data, i, 1000 - i));
```

ุงุณุชูุงุฏู ุงุฒ `using` ุฑู DeflateStream ุขู ุฑุง ุจูโุทูุฑ ุงุณุชุงูุฏุงุฑุฏ ูโุจูุฏุฏ ู ูุฑ ุจุงูุฑ ููุดุชูโูุดุฏู ุฑุง Flush ูโฺฉูุฏ. ุงู ููฺูู MemoryStream ุฑุง ูโุจูุฏุฏุ ุจูุงุจุฑุงู ุจุฑุง ุงุณุชุฎุฑุงุฌ ุฏุงุฏูโูุง ุจุงุฏ `ToArray` ุฑุง ุตุฏุง ุจุฒูู.

ูุณุฎู ุฌุงฺฏุฒู ฺฉู **MemoryStream ุฑุง ุจุงุฒ ูฺฏู ูโุฏุงุฑุฏ** ู ุงุฒ ูุชุฏูุง **ุขุณูฺฉุฑูู** ุงุณุชูุงุฏู ูโฺฉูุฏ:

```csharp
byte[] data = new byte[1000];
MemoryStream ms = new MemoryStream();
using (Stream ds = new DeflateStream(ms, CompressionMode.Compress, true))
    await ds.WriteAsync(data, 0, data.Length);

Console.WriteLine(ms.Length); // 113
ms.Position = 0;
using (Stream ds = new DeflateStream(ms, CompressionMode.Decompress))
    for (int i = 0; i < 1000; i += await ds.ReadAsync(data, i, 1000 - i));
```

ููฺฏ ุงุถุงู ุฏุฑ constructor ุจู DeflateStream ูโฺฏูุฏ ฺฉู **stream ุฒุฑู ุฑุง ุฏุฑ disposal ูุจูุฏุฏ**. ุจู ุงู ุชุฑุชุจ MemoryStream ุจุงุฒ ูโูุงูุฏ ู ูโุชูุงูู ุขู ุฑุง ุฏูุจุงุฑู ุงุฒ ูููุนุช ุตูุฑ ุจุฎูุงูู.

### ูุดุฑุฏูโุณุงุฒ ูุงูโูุง ุฏุฑ Unix ุจุง GZip ๐ง๐ฆ

ุงูฺฏูุฑุชู ูุดุฑุฏูโุณุงุฒ **GZipStream** ุฏุฑ ุณุณุชูโูุง Unix ุจูโุนููุงู ูุฑูุช ูุดุฑุฏูโุณุงุฒ ูุงู ูุญุจูุจ ุงุณุช. ูุฑ ูุงู ููุจุน ุฏุฑ ฺฉ ูุงู ูุฏู ุฌุฏุงฺฏุงูู ุจุง ูพุณููุฏ `.gz` ูุดุฑุฏู ูโุดูุฏ.

ุฑูุดโูุง ุฒุฑ ููุงู ฺฉุงุฑ **gzip** ู **gunzip** ุฏุฑ ุฎุท ูุฑูุงู Unix ุฑุง ุงูุฌุงู ูโุฏููุฏ:

```csharp
async Task GZip(string sourcefile, bool deleteSource = true)
{
    var gzip = $"{sourcefile}.gz";
    if (File.Exists(gzip))
        throw new Exception("Gzip file already exists");
    
    // ูุดุฑุฏูโุณุงุฒ
    using (FileStream inStream = File.Open(sourcefile, FileMode.Open))
    using (FileStream outStream = new FileStream(gzip, FileMode.CreateNew))
    using (GZipStream gzipStream = new GZipStream(outStream, CompressionMode.Compress))
        await inStream.CopyToAsync(gzipStream); 

    if (deleteSource) File.Delete(sourcefile);
}

async Task GUnzip(string gzipfile, bool deleteGzip = true)
{
    if (Path.GetExtension(gzipfile) != ".gz")
        throw new Exception("Not a gzip file");

    var uncompressedFile = gzipfile.Substring(0, gzipfile.Length - 3);
    if (File.Exists(uncompressedFile))
        throw new Exception("Destination file already exists");
    
    // ุฏฺฉุงููพุฑุดู
    using (FileStream uncompressToStream = File.Open(uncompressedFile, FileMode.Create))
    using (FileStream zipfileStream = File.Open(gzipfile, FileMode.Open))
    using (var unzipStream = new GZipStream(zipfileStream, CompressionMode.Decompress))
        await unzipStream.CopyToAsync(uncompressToStream);

    if (deleteGzip) File.Delete(gzipfile);
}
```

ููููู ุงุณุชูุงุฏู:

```csharp
await GZip("/tmp/myfile.txt");        // ุงุฌุงุฏ /tmp/myfile.txt.gz
await GUnzip("/tmp/myfile.txt.gz");   // ุจุงุฒุณุงุฒ /tmp/myfile.txt
```

---

### ฺฉุงุฑ ุจุง ูุงูโูุง ZIP ๐๏ธ

ฺฉูุงุณโูุง **ZipArchive** ู **ZipFile** ุฏุฑ `System.IO.Compression` ุงุฒ ูุฑูุช ZIP ูพุดุชุจุงู ูโฺฉููุฏ. ูุฒุช ZIP ูุณุจุช ุจู **DeflateStream** ู **GZipStream** ุงู ุงุณุช ฺฉู:

* ูโุชูุงูุฏ ฺูุฏู ูุงู ุฑุง ุฏุฑ ุฎูุฏ ุฌุง ุฏูุฏ.

* ุจุง ูุงูโูุง ZIP ุงุฌุงุฏ ุดุฏู ุชูุณุท Windows Explorer ุณุงุฒฺฏุงุฑ ุงุณุช.

* **ZipArchive** ุจุง streams ฺฉุงุฑ ูโฺฉูุฏ.

* **ZipFile** ุณูุงุฑู ูุนููู ฺฉุงุฑ ุจุง ูุงูโูุง ุฑุง ูพูุดุด ูโุฏูุฏ ู ฺฉูุงุณ ฺฉูฺฉ ุงุณุช ุจุฑุง ZipArchive.

ููููู ุงุณุชูุงุฏู ุงุฒ **CreateFromDirectory** ุจุฑุง ุงูุฒูุฏู ุชูุงู ูุงูโูุง ฺฉ ุฏุงุฑฺฉุชูุฑ ุจู ZIP:

```csharp
ZipFile.CreateFromDirectory(@"d:\MyFolder", @"d:\archive.zip");
```

ุจุฑุง ุงุณุชุฎุฑุงุฌ ZIP ุจู ุฏุงุฑฺฉุชูุฑ:

```csharp
ZipFile.ExtractToDirectory(@"d:\archive.zip", @"d:\MyFolder");
```

> ุงุฒ .NET 8 ุจู ุจุนุฏ ูโุชูุงูุฏ ุจู ุฌุง ูุณุฑ ูุงูุ ฺฉ Stream ูุฒ ูุดุฎุต ฺฉูุฏ.

ููฺฏุงู ูุดุฑุฏูโุณุงุฒุ ูโุชูุงูุฏ ูุดุฎุต ฺฉูุฏ ฺฉู ุจูููโุณุงุฒ ุจุฑุง **ุญุฌู ูุงู ุง ุณุฑุนุช** ุงูุฌุงู ุดูุฏ ู ุขุง ูุงู ุฏุงุฑฺฉุชูุฑ ููุจุน ุฏุฑ ุขุฑุดู ูุญุงุธ ุดูุฏ ุง ูู.

ุจุฑุง ุฏุณุชุฑุณ ุจู ูุฑูุฏโูุง ูููุฑุฏ ZIP ุงุฒ **Open** ุงุณุชูุงุฏู ูโฺฉููุ ฺฉู ฺฉ **ZipArchive** ุจุฑูโฺฏุฑุฏุงูุฏ. ูโุชูุงู ูุงูโูุง ุฑุง ุงุฒ ุทุฑู **Entries** ุดูุงุฑุด ุง ุจุง **GetEntry** ุจูโุตูุฑุช ุฎุงุต ุงูุช:

```csharp
using (ZipArchive zip = ZipFile.Open(@"d:\zz.zip", ZipArchiveMode.Read))
    foreach (ZipArchiveEntry entry in zip.Entries)
        Console.WriteLine(entry.FullName + " " + entry.Length);
```

**ZipArchiveEntry** ููฺูู ูุชุฏูุง `Delete`ุ `ExtractToFile` ู `Open` ุฑุง ุฏุงุฑุฏ. ุจุฑุง ุงุฌุงุฏ ูุฑูุฏ ุฌุฏุฏ ุงุฒ `CreateEntry` ุง ูุชุฏ ุงฺฉุณุชูุดู `CreateEntryFromFile` ุงุณุชูุงุฏู ูโฺฉูู:

```csharp
byte[] data = File.ReadAllBytes(@"d:\foo.dll"); 
using (ZipArchive zip = ZipFile.Open(@"d:\zz.zip", ZipArchiveMode.Update))
    zip.CreateEntry(@"bin\X64\foo.dll").Open().Write(data, 0, data.Length);
```

ูโุชูุงู ุชูุงู ุงู ฺฉุงุฑูุง ุฑุง ฺฉุงููุงู ุฏุฑ ุญุงูุธู ุงูุฌุงู ุฏุงุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ **MemoryStream** ุจู ุฌุง ูุณุฑ ูุงู.

---

### ฺฉุงุฑ ุจุง ูุงูโูุง Tar ๐ฆ๐ง

ฺฉูุงุณโูุง `System.Formats.Tar` (.NET 7 ุจู ุจุนุฏ) ุงุฒ ูุฑูุช **.tar** ูพุดุชุจุงู ูโฺฉููุฏ. ุงู ูุฑูุช ุฏุฑ Unix ุจุฑุง ุจุณุชูโุจูุฏ ฺูุฏู ูุงู ูุญุจูุจ ุงุณุช.

ุงุฌุงุฏ ฺฉ ูุงู tar (tarball):

```csharp
TarFile.CreateFromDirectory("/tmp/testfolder", "/tmp/test.tar", false);
```

* ุขุฑฺฏููุงู ุณูู ูุดุฎุต ูโฺฉูุฏ ฺฉู ุขุง ูุงู ุฏุงุฑฺฉุชูุฑ ูพุงู ุฏุฑ ูุฑูุฏโูุง ุขุฑุดู ูุญุงุธ ุดูุฏ ุง ุฎุฑ.

ุงุณุชุฎุฑุงุฌ tarball:

```csharp
TarFile.ExtractToDirectory("/tmp/test.tar", "/tmp/testfolder", true);
```

* ุขุฑฺฏููุงู ุณูู ูุดุฎุต ูโฺฉูุฏ ฺฉู ุขุง ูุงูโูุง ููุฌูุฏ ุจุงุฒููุณ ุดููุฏ ุง ุฎุฑ.

ูุฑ ุฏู ูุชุฏ ุงูฺฉุงู ุงุณุชูุงุฏู ุงุฒ **Stream** ุจู ุฌุง ูุณุฑ ูุงู tar ุฑุง ูุฒ ุฏุงุฑูุฏ.

ููููู ูุดุฑุฏูโุณุงุฒ tar ุจู tar.gz ุจุง GZipStream:

```csharp
var ms = new MemoryStream();
TarFile.CreateFromDirectory("/tmp/testfolder", ms, false);
ms.Position = 0;

using (var fs = File.Create("/tmp/test.tar.gz"))
using (var gz = new GZipStream(fs, CompressionMode.Compress))
    ms.CopyTo(gz);
```

* ุงู ฺฉุงุฑ ููุฏ ุงุณุช ฺูู ูุฑูุช tar ุฎูุฏุด ูุดุฑุฏูโุณุงุฒ ูุฏุงุฑุฏุ ุจุฑ ุฎูุงู zip.

ุงุณุชุฎุฑุงุฌ tar.gz:

```csharp
using (var fs = File.OpenRead("/tmp/test.tar.gz"))
using (var gz = new GZipStream(fs, CompressionMode.Decompress))
    TarFile.ExtractToDirectory(gz, "/tmp/testfolder", true);
```

ููฺูู ูโุชูุงูุฏ ุจุง ฺฉูุงุณโูุง **TarReader** ู **TarWriter** ุจู ุณุทุญ API ุฏููโุชุฑ ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ. ููููู ุงุณุชูุงุฏู ุงุฒ **TarReader**:

```csharp
using (FileStream archiveStream = File.OpenRead("/tmp/test.tar"))
using (TarReader reader = new(archiveStream))
{
    while (true)
    {
        TarEntry entry = reader.GetNextEntry();
        if (entry == null) break;
        Console.WriteLine($"Entry {entry.Name} is {entry.DataStream.Length} bytes long");
        entry.ExtractToFile(Path.Combine("/tmp/testfolder", entry.Name), true);
    }
}
```

---

### ุนููุงุช ูุงู ู ุฏุงุฑฺฉุชูุฑ ๐โ๏ธ

ูุถุง ูุงู `System.IO` ูุฌููุนูโุง ุงุฒ ุงููุงุน ุจุฑุง ุงูุฌุงู ุนููุงุช **utility** ุฑู ูุงู ู ุฏุงุฑฺฉุชูุฑ ุงุฑุงุฆู ูโุฏูุฏุ ูุงููุฏ:

* ฺฉูพ ู ุงูุชูุงู ูุงูโูุง
* ุงุฌุงุฏ ุฏุงุฑฺฉุชูุฑ
* ุชูุธู ุฎุตูุตุงุช ู ุฏุณุชุฑุณโูุง ูุงู

ุจุฑุง ุงฺฉุซุฑ ูฺฺฏโูุงุ ูโุชูุงูุฏ ุจู ุฏู ฺฉูุงุณ ุงูุชุฎุงุจ ฺฉูุฏ:

* **ฺฉูุงุณโูุง ุงุณุชุง (Static):** `File` ู `Directory`
* **ฺฉูุงุณโูุง ุจุง ูุชุฏ ููููู:** `FileInfo` ู `DirectoryInfo` (ุณุงุฎุชู ุดุฏู ุจุง ูุงู ูุงู ุง ุฏุงุฑฺฉุชูุฑ)

ุนูุงูู ุจุฑ ุงูุ ฺฉูุงุณ ุงุณุชุง **Path** ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ูฺ ุนูู ุฑู ูุงู ุง ุฏุงุฑฺฉุชูุฑ ุงูุฌุงู ููโุฏูุฏุ ุจูฺฉู ูุชุฏูุง ุจุฑุง **ุฏุณุชฺฉุงุฑ ุฑุดุชู ูุณุฑูุง ู ูุงู ูุงูโูุง** ุงุฑุงุฆู ูโฺฉูุฏ ู ููฺูู ุจุง ูุงูโูุง ูููุช ฺฉูฺฉ ูโฺฉูุฏ.

### ฺฉูุงุณ File ๐๐ป

ฺฉูุงุณ **File** ฺฉ ฺฉูุงุณ ุงุณุชุง (static) ุงุณุช ฺฉู ุชูุงู ูุชุฏูุง ุขู ฺฉ **ูุงู ูุงู** ูโฺฏุฑูุฏ. ูุงู ูุงู ูโุชูุงูุฏ ูุณุจ ุจู ุฏุงุฑฺฉุชูุฑ ุฌุงุฑ ุง ฺฉุงูู ุจุง ูุณุฑ ุฏุงุฑฺฉุชูุฑ ุจุงุดุฏ. ูุชุฏูุง ุงู ฺฉูุงุณ (ุชูุงู **public** ู **static**) ุนุจุงุฑุชโุงูุฏ ุงุฒ:

```csharp
bool Exists(string path);                 // ุงฺฏุฑ ูุงู ููุฌูุฏ ุจุงุดุฏ true ุจุฑูโฺฏุฑุฏุงูุฏ
void Delete(string path);                 
void Copy(string sourceFileName, string destFileName);
void Move(string sourceFileName, string destFileName);
void Replace(string sourceFileName, string destinationFileName,
             string destinationBackupFileName);
FileAttributes GetAttributes(string path);
void SetAttributes(string path, FileAttributes fileAttributes);
void Decrypt(string path);
void Encrypt(string path);
DateTime GetCreationTime(string path);      // ูุณุฎู UTC ูุฒ ูุฌูุฏ ุฏุงุฑุฏ
DateTime GetLastAccessTime(string path);    // ูุณุฎู UTC ูุฒ ูุฌูุฏ ุฏุงุฑุฏ
DateTime GetLastWriteTime(string path);
void SetCreationTime(string path, DateTime creationTime);
void SetLastAccessTime(string path, DateTime lastAccessTime);
void SetLastWriteTime(string path, DateTime lastWriteTime);
FileSecurity GetAccessControl(string path);
FileSecurity GetAccessControl(string path, AccessControlSections includeSections);
void SetAccessControl(string path, FileSecurity fileSecurity);
```

* ูุชุฏ **Move** ุงฺฏุฑ ูุงู ููุตุฏ ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ ุงุณุชุซูุง ูโุงูุฏุงุฒุฏุ ุงูุง **Replace** ุงู ฺฉุงุฑ ุฑุง ููโฺฉูุฏ.
* ูุฑ ุฏู ูุชุฏ ุงูฺฉุงู ุชุบุฑ ูุงู ูุงู ุง ุงูุชูุงู ุขู ุจู ุฏุงุฑฺฉุชูุฑ ุฏฺฏุฑ ุฑุง ูุฑุงูู ูโฺฉููุฏ.
* **Delete** ุงฺฏุฑ ูุงู **read-only** ุจุงุดุฏ ุง ูุฌูุฒ ุญุฐู ุชูุณุท ุณุณุชูโุนุงูู ุจู ูุฑุขูุฏ ุดูุง ุฏุงุฏู ูุดุฏู ุจุงุดุฏุ ุงุณุชุซูุง `UnauthorizedAccessException` ูพุฑุชุงุจ ูโฺฉูุฏ.

ุชูุงู ุงุนุถุง **FileAttributes** ฺฉู ุชูุณุท `GetAttributes` ุจุฑฺฏุฑุฏุงูุฏู ูโุดููุฏ:

```
Archive, Compressed, Device, Directory, Encrypted,
Hidden, IntegritySystem, Normal, NoScrubData, NotContentIndexed, 
Offline, ReadOnly, ReparsePoint, SparseFile, System, Temporary
```

ุงู ุงุนุถุง ูุงุจู ุชุฑฺฉุจ ูุณุชูุฏ. ุจุฑุง ุชุบุฑ ฺฉ ูฺฺฏ ูุงู ุจุฏูู ุชุบุฑ ุณุงุฑ ูฺฺฏโูุง:

```csharp
string filePath = "test.txt";
FileAttributes fa = File.GetAttributes(filePath);
if ((fa & FileAttributes.ReadOnly) != 0)
{
    // ุงุฒ ุนููฺฏุฑ XOR (^) ุจุฑุง ุชุบุฑ ูพุฑฺู ReadOnly ุงุณุชูุงุฏู ูโฺฉูู
    fa ^= FileAttributes.ReadOnly;
    File.SetAttributes(filePath, fa);
}

// ุญุงูุง ูโุชูุงูู ูุงู ุฑุง ุญุฐู ฺฉูู
File.Delete(filePath);
```

ุฑุงู ุณุงุฏูโุชุฑ ุจุง **FileInfo**:

```csharp
new FileInfo("test.txt").IsReadOnly = false;
```

---

### ูฺฺฏโูุง ูุดุฑุฏูโุณุงุฒ ู ุฑูุฒฺฏุฐุงุฑ ๐๐๏ธ

ุงู ูุงุจูุช ุชููุง ุฏุฑ **Windows** ููุฌูุฏ ุงุณุช ู ูุงุฒููุฏ ูพฺฉุฌ NuGet `System.Management` ุงุณุช.

* ูฺฺฏโูุง **Compressed** ู **Encrypted** ูุชูุงุธุฑ ุจุง ฺฺฉโุจุงฺฉุณโูุง ูุดุฑุฏูโุณุงุฒ ู ุฑูุฒฺฏุฐุงุฑ ุฏุฑ ูพูุฌุฑู Properties ูุงู ุง ุฏุงุฑฺฉุชูุฑ ุฏุฑ Windows Explorer ูุณุชูุฏ.
* ุงู ููุน ูุดุฑุฏูโุณุงุฒ ู ุฑูุฒฺฏุฐุงุฑ **ุดูุงู** ุงุณุชุ ุจู ุทูุฑ ฺฉู ุณุณุชูโุนุงูู ุชูุงู ุนููุงุช ุฑุง ุงูุฌุงู ูโุฏูุฏ ู ุดูุง ูโุชูุงูุฏ ุฏุงุฏูโูุง ุฑุง ุจู ุตูุฑุช plain ุจุฎูุงูุฏ ู ุจููุณุฏ.
* ููโุชูุงู ุจุง `SetAttributes` ูฺฺฏโูุง **Compressed** ุง **Encrypted** ุฑุง ุชุบุฑ ุฏุงุฏ (ุงฺฏุฑ ุชูุงุด ฺฉูุฏุ ุจุฏูู ุฎุทุง ุดฺฉุณุช ูโุฎูุฑุฏ).

ุฑุงู ุญู: ุจุฑุง ุฑูุฒฺฏุฐุงุฑ ู ุฑูุฒฺฏุดุง ุงุฒ ูุชุฏูุง `Encrypt()` ู `Decrypt()` ุฏุฑ ฺฉูุงุณ **File** ุงุณุชูุงุฏู ฺฉูุฏ.
ุจุฑุง ูุดุฑุฏูโุณุงุฒุ ุงุณุชูุงุฏู ุงุฒ WMI ุฏุฑ `System.Management` ุฑุงู ุญู ุงุณุช:

```csharp
static uint CompressFolder(string folder, bool recursive)
{
    string path = "Win32_Directory.Name='" + folder + "'";
    using (ManagementObject dir = new ManagementObject(path))
    using (ManagementBaseObject p = dir.GetMethodParameters("CompressEx"))
    {
        p["Recursive"] = recursive;
        using (ManagementBaseObject result = dir.InvokeMethod("CompressEx", p, null))
            return (uint)result.Properties["ReturnValue"].Value;
    }
}
```

* ุจุฑุง ุงุณุชุฎุฑุงุฌุ `CompressEx` ุฑุง ุจุง `UncompressEx` ุฌุงฺฏุฒู ฺฉูุฏ.

**ุฑูุฒฺฏุฐุงุฑ ุดูุงู** ุจุฑ ูพุงู ฺฉูุฏ ุณุงุฎุชู ุดุฏู ุงุฒ ุฑูุฒ ุนุจูุฑ ฺฉุงุฑุจุฑ ูุงฺฏู ุดุฏู ุงุณุช. ุชุบุฑ ุฑูุฒ ุนุจูุฑ ุชูุณุท ฺฉุงุฑุจุฑ ูุนุชุจุฑ ูุดฺฉู ุงุฌุงุฏ ููโฺฉูุฏุ ุงูุง ุงฺฏุฑ ุฑูุฒ ุชูุณุท ูุฏุฑ ุฑุณุช ุดูุฏุ ุฏุงุฏูโูุง ูุงูโูุง ุฑูุฒฺฏุฐุงุฑโุดุฏู ูุงุจู ุจุงุฒุงุจ ูุฎูุงููุฏ ุจูุฏ.

**NTFS** ุงู ูุงุจูุชโูุง ุฑุง ูพุดุชุจุงู ูโฺฉูุฏุ ุงูุง **CDFS** (ุฑู CD-ROM) ู **FAT** (ุฑู ฺฉุงุฑุชโูุง ูุงุจู ุญูู) ูพุดุชุจุงู ููโฺฉููุฏ.

ุจุฑุง ุชุดุฎุต ูพุดุชุจุงู ฺฉ ุญุฌู ุงุฒ ูุดุฑุฏูโุณุงุฒ ู ุฑูุฒฺฏุฐุงุฑ:

```csharp
using System;
using System.IO;
using System.Text;
using System.ComponentModel;
using System.Runtime.InteropServices;

class SupportsCompressionEncryption
{
    const int SupportsCompression = 0x10;
    const int SupportsEncryption = 0x20000;

    [DllImport("Kernel32.dll", SetLastError = true)]
    extern static bool GetVolumeInformation(string vol, StringBuilder name,
        int nameSize, out uint serialNum, out uint maxNameLen, out uint flags,
        StringBuilder fileSysName, int fileSysNameSize);

    static void Main()
    {
        uint serialNum, maxNameLen, flags;
        bool ok = GetVolumeInformation(@"C:\", null, 0, out serialNum,
                                       out maxNameLen, out flags, null, 0);
        if (!ok) throw new Win32Exception();

        bool canCompress = (flags & SupportsCompression) != 0;
        bool canEncrypt = (flags & SupportsEncryption) != 0;
    }
}
```

---

### ุงููุช ูุงู ุฏุฑ Windows ๐

ุงู ูฺฺฏ ูุฒ **ููุฏูุฒ** ุงุณุช ู ูุงุฒููุฏ ูพฺฉุฌ NuGet `System.IO.FileSystem.AccessControl` ูโุจุงุดุฏ.

ฺฉูุงุณ **FileSecurity** ุงุฌุงุฒู ูโุฏูุฏ ูุฌูุฒูุง ุณุณุชูโุนุงูู ุฑุง ุจุฑุง ฺฉุงุฑุจุฑุงู ู ููุดโูุง ูุดุงูุฏู ู ุชุบุฑ ุฏูุฏ:

```csharp
using System;
using System.IO;
using System.Security.AccessControl;
using System.Security.Principal;

void ShowSecurity(FileSecurity sec)
{
    AuthorizationRuleCollection rules = sec.GetAccessRules(true, true, typeof(NTAccount));
    foreach (FileSystemAccessRule r in rules.Cast<FileSystemAccessRule>()
        .OrderBy(rule => rule.IdentityReference.Value))
    {
        Console.WriteLine($"  {r.IdentityReference.Value}");  // ูุซุงู: MyDomain/Joe
        Console.WriteLine($"    {r.FileSystemRights}: {r.AccessControlType}"); // FullControl
    }
}

var file = "sectest.txt";
File.WriteAllText(file, "File security test.");

var sid = new SecurityIdentifier(WellKnownSidType.BuiltinUsersSid, null);
string usersAccount = sid.Translate(typeof(NTAccount)).ToString();
Console.WriteLine($"User: {usersAccount}");

FileSecurity sec = new FileSecurity(file,
    AccessControlSections.Owner |
    AccessControlSections.Group |
    AccessControlSections.Access);

Console.WriteLine("AFTER CREATE:");
ShowSecurity(sec); // BUILTIN\Users ูููุฒ ุฏุณุชุฑุณ Write ูุฏุงุฑุฏ

sec.ModifyAccessRule(AccessControlModification.Add,
    new FileSystemAccessRule(usersAccount, FileSystemRights.Write, AccessControlType.Allow),
    out bool modified);

Console.WriteLine("AFTER MODIFY:");
ShowSecurity(sec); // BUILTIN\Users ุงฺฉููู ุฏุณุชุฑุณ Write ุฏุงุฑุฏ
```

ูุซุงูโูุง ุจุดุชุฑ ุฏุฑ ุจุฎุด **Special Folders** ุตูุญู 730 ุงุฑุงุฆู ุดุฏู ุงุณุช.

---

### ุงููุช ูุงู ุฏุฑ Unix ๐ง

ุงุฒ **.NET 7** ุจู ุจุนุฏุ ฺฉูุงุณ **File** ุดุงูู ูุชุฏูุง **GetUnixFileMode** ู **SetUnixFileMode** ุจุฑุง ฺฏุฑูุชู ู ุชุนู ูุฌูุฒ ูุงูโูุง ุฏุฑ Unix ุงุณุช.

ููฺูู ูุชุฏ **Directory.CreateDirectory** ุงูุฑููุฏ ุดุฏู ุชุง ุจุชูุงูุฏ ูุฌูุฒ Unix ุฑุง ุจูพุฐุฑุฏุ ู ููฺฏุงู ุงุฌุงุฏ ูุงู ูโุชูุงู ูุฌูุฒ ุฑุง ูุดุฎุต ฺฉุฑุฏ:

```csharp
var fs = new FileStream("test.txt",
    new FileStreamOptions
    {
        Mode = FileMode.Create,
        UnixCreateMode = UnixFileMode.UserRead | UnixFileMode.UserWrite
    });
```

### ฺฉูุงุณ Directory ๐๐ป

ฺฉูุงุณ **Directory** ฺฉ ฺฉูุงุณ ุงุณุชุง (static) ุงุณุช ฺฉู ูุฌููุนูโุง ุงุฒ ูุชุฏูุง ูุดุงุจู ฺฉูุงุณ **File** ุงุฑุงุฆู ูโุฏูุฏุ ุงุฒ ุฌููู: ุจุฑุฑุณ ูุฌูุฏ ุฏุงุฑฺฉุชูุฑ (`Exists`)ุ ุฌุงุจุฌุง (`Move`)ุ ุญุฐู (`Delete`)ุ ุฏุฑุงูุช/ุชูุธู ุฒูุงู ุงุฌุงุฏ ุง ุขุฎุฑู ุฏุณุชุฑุณุ ู ุฏุฑุงูุช/ุชูุธู ูุฌูุฒูุง ุงููุช.

ูุชุฏูุง ููู ุขู ุนุจุงุฑุชโุงูุฏ ุงุฒ:

```csharp
string GetCurrentDirectory();                 // ุฏุงุฑฺฉุชูุฑ ุฌุงุฑ
void   SetCurrentDirectory(string path);     // ุชูุธู ุฏุงุฑฺฉุชูุฑ ุฌุงุฑ
DirectoryInfo CreateDirectory(string path);  // ุงุฌุงุฏ ุฏุงุฑฺฉุชูุฑ
DirectoryInfo GetParent(string path);        // ุฏุงุฑฺฉุชูุฑ ูุงูุฏ
string GetDirectoryRoot(string path);        // ุฑุดู ุฏุงุฑฺฉุชูุฑ
string[] GetLogicalDrives();                 // ุฏุฑุงููุง ุง mount points ุฏุฑ Unix

// ุจุงุฒฺฏุฑุฏุงูุฏู ูุณุฑูุง ฺฉุงูู
string[] GetFiles(string path);
string[] GetDirectories(string path);
string[] GetFileSystemEntries(string path);
IEnumerable<string> EnumerateFiles(string path);
IEnumerable<string> EnumerateDirectories(string path);
IEnumerable<string> EnumerateFileSystemEntries(string path);
```

ูฺฉุงุช ููู:

* ูุชุฏูุง `Enumerate*` ุจู ุตูุฑุช **lazy** ุนูู ูโฺฉููุฏ ู ุฏุงุฏูโูุง ุฑุง ููฺฏุงู ูพูุงุด ุงุฒ ุณุณุชู ูุงู ุฏุฑุงูุช ูโฺฉููุฏุ ุจูุงุจุฑุงู ุจุฑุง **LINQ** ุจุณุงุฑ ููุงุณุจ ูุณุชูุฏ.
* ุงู ูุชุฏูุง ูโุชูุงููุฏ ุขุฑฺฏููุงูโูุง `searchPattern` ู `searchOption` ุจฺฏุฑูุฏ ู ุจุง `SearchOption.SearchAllSubDirectories` ุฌุณุชุฌู ุจุงุฒฺฏุดุช ุงูุฌุงู ุฏููุฏ.
* ูุชุฏูุง `*FileSystemEntries` ุชุฑฺฉุจ ุงุฒ ูุงูโูุง ู ุฏุงุฑฺฉุชูุฑโูุง ูุณุชูุฏ.

ุงุฌุงุฏ ฺฉ ุฏุงุฑฺฉุชูุฑ ุชููุง ุฏุฑ ุตูุฑุช ุนุฏู ูุฌูุฏ:

```csharp
if (!Directory.Exists(@"d:\test"))
    Directory.CreateDirectory(@"d:\test");
```

---

### FileInfo ู DirectoryInfo ๐

ูุชุฏูุง ุงุณุชุง ุจุฑุง ุนููุงุช ฺฉุจุงุฑู ููุงุณุจ ูุณุชูุฏุ ุงูุง ุงฺฏุฑ ูุงุฒ ุจู ูุฌููุนูโุง ุงุฒ ุนููุงุช ูพุดุช ุณุฑ ูู ุฏุงุฑุฏุ ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณโูุง **FileInfo** ู **DirectoryInfo** ุฑุงุญุชโุชุฑ ุงุณุช.

* **FileInfo** ุงฺฉุซุฑ ูุชุฏูุง ฺฉูุงุณ **File** ุฑุง ุจู ุตูุฑุช instance ุงุฑุงุฆู ูโุฏูุฏ ู ูฺฺฏโูุง ุงุถุงู ูุซู `Extension`ุ `Length`ุ `IsReadOnly` ู `Directory` ุฏุงุฑุฏ:

```csharp
static string TestDirectory =>
    RuntimeInformation.IsOSPlatform(OSPlatform.Windows)
        ? @"C:\Temp" 
        : "/tmp";

Directory.CreateDirectory(TestDirectory);
FileInfo fi = new FileInfo(Path.Combine(TestDirectory, "FileInfo.txt"));

Console.WriteLine(fi.Exists);          // false
using (TextWriter w = fi.CreateText())
    w.Write("Some text");

fi.Refresh();
Console.WriteLine(fi.Exists);          // true
Console.WriteLine(fi.Name);            // FileInfo.txt
Console.WriteLine(fi.FullName);        // c:\temp\FileInfo.txt (Windows) ุง /tmp/FileInfo.txt (Unix)
Console.WriteLine(fi.DirectoryName);   // c:\temp ุง /tmp
Console.WriteLine(fi.Directory.Name);  // temp
Console.WriteLine(fi.Extension);       // .txt
Console.WriteLine(fi.Length);          // 9
fi.Encrypt();
fi.Attributes ^= FileAttributes.Hidden; // ุชุบุฑ ูพุฑฺู Hidden
fi.IsReadOnly = true;
Console.WriteLine(fi.Attributes);      // ReadOnly, Archive, Hidden, Encrypted
Console.WriteLine(fi.CreationTime);   // ุฒูุงู ุงุฌุงุฏ
fi.MoveTo(Path.Combine(TestDirectory, "FileInfoX.txt")); 
```

* **DirectoryInfo** ุจุฑุง ูพูุงุด ุฏุงุฑฺฉุชูุฑโูุง ู ูุงูโูุง ููุงุณุจ ุงุณุช:

```csharp
DirectoryInfo di = new DirectoryInfo(@"e:\photos");

foreach (FileInfo fi in di.GetFiles("*.jpg"))
    Console.WriteLine(fi.Name);

foreach (DirectoryInfo subDir in di.GetDirectories())
    Console.WriteLine(subDir.FullName);
```

---

### ฺฉูุงุณ Path ๐ค๏ธ

ฺฉูุงุณ **Path** ุจู ุตูุฑุช ุงุณุชุง ูุชุฏูุง ู ููุฏูุง ุจุฑุง ฺฉุงุฑ ุจุง ูุณุฑูุง ู ูุงู ูุงูโูุง ุงุฑุงุฆู ูโุฏูุฏ.

ูุซุงู:

```csharp
string dir  = @"c:\mydir";    // ุง /mydir
string file = "myfile.txt";
string path = @"c:\mydir\myfile.txt";    // ุง /mydir/myfile.txt
Directory.SetCurrentDirectory(@"k:\demo");  // ุง /demo
```

ุจุง ุงู setup ูโุชูุงู ุงุฒ ูุชุฏูุง ฺฉูุงุณ **Path** ุจุฑุง ุฏุณุชฺฉุงุฑ ุฑุดุชูโูุง ูุณุฑ ู ูุงู ูุงู ุงุณุชูุงุฏู ฺฉุฑุฏุ ูุงููุฏ ุชุฑฺฉุจ ูุณุฑุ ุงุณุชุฎุฑุงุฌ ูุงู ูุงูุ ุงุณุชุฎุฑุงุฌ ูพุณููุฏุ ู ุบุฑู.
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/15/Table-15-9.jpeg)
</div>

### ูุชุฏูุง ฺฉูุงุณ Path ู ูุฏุฑุช ูพูุดูโูุง ูฺู ๐ค๏ธ๐

#### ฑ. **Path.Combine**

ูุชุฏ **Combine** ุจุณุงุฑ ููุฏ ุงุณุชุ ุฒุฑุง ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ฺฉ ุฏุงุฑฺฉุชูุฑ ู ูุงู ูุงู ุง ุฏู ุฏุงุฑฺฉุชูุฑ ุฑุง ุจุฏูู ุจุฑุฑุณ ูุฌูุฏ ุง ูุจูุฏู ุฌุฏุงฺฉููุฏู ูุณุฑ ุชุฑฺฉุจ ฺฉูุฏ.

* ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ุฌุฏุงฺฉููุฏู ููุงุณุจ ุณุณุชู ุนุงูู ุฑุง ุงุณุชูุงุฏู ูโฺฉูุฏ.
* ุงูุฑููุฏูุง ุฏุงุฑุฏ ฺฉู ุชุง ฺูุงุฑ ูุณุฑ ุง ูุงู ูุงู ุฑุง ูโูพุฐุฑุฏ.

#### ฒ. **GetFullPath**

ุชุจุฏู ูุณุฑ ูุณุจ ุจู ูุณุฑ ฺฉุงูู (Absolute).

```csharp
string fullPath = Path.GetFullPath(@"..\..\file.txt");
```

#### ณ. **GetRandomFileName ู GetTempFileName**

* `GetRandomFileName` ูุงู ูุงู ธ.ณ ููุญุตุฑ ุจูโูุฑุฏ ุชููุฏ ูโฺฉูุฏ ุจุฏูู ุงุฌุงุฏ ูุงู ูุงูุน.
* `GetTempFileName` ูุงู ูุงู ูููุช ุงุฌุงุฏ ูโฺฉูุฏ ู ูุงู ุตูุฑ ุจุงุช ุฏุฑ ุฏุงุฑฺฉุชูุฑ temp ูโุณุงุฒุฏ.
  โ๏ธ ูพุณ ุงุฒ ุงุณุชูุงุฏู ุจุงุฏ ุขู ุฑุง ุญุฐู ฺฉูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ูพุณ ุงุฒ ถตฐฐฐ ุจุงุฑ ูุฑุงุฎูุงู ุงุณุชุซูุง ุงุฌุงุฏ ูโุดูุฏ.

ุงฺฏุฑ ูุดฺฉู ุงุฌุงุฏ ุดุฏุ ูโุชูุงู ุงุฒ ุชุฑฺฉุจ `GetTempPath` ุจุง `GetRandomFileName` ุงุณุชูุงุฏู ฺฉุฑุฏุ ุงูุง ูุฑุงูุจ ูพุฑ ุดุฏู ูุงุฑุฏ ุจุงุดุฏ.

---

### ูพูุดูโูุง ูฺู (Special Folders) ๐

ฺฉูุงุณ **Path** ู **Directory** ูพูุดูโูุง ูฺู ูุซู **My Documents** ุง **Program Files** ุฑุง ูพูุดุด ููโุฏููุฏ. ุจุฑุง ุงู ฺฉุงุฑ ุงุฒ:

```csharp
string myDocPath = Environment.GetFolderPath(Environment.SpecialFolder.MyDocuments);
```

* `Environment.SpecialFolder` ฺฉ enum ุงุณุช ฺฉู ุชูุงู ูพูุดูโูุง ูฺู ููุฏูุฒ ุฑุง ุดุงูู ูโุดูุฏ: AdminTools, ApplicationData, Fonts, StartMenu ู ุบุฑู.
* ูุณุฑ runtime ุฏุงุชโูุช ุจุง:

```csharp
System.Runtime.InteropServices.RuntimeEnvironment.GetRuntimeDirectory()
```

#### ูฺฉุงุช ููู ุฏุฑ ููุฏูุฒ

* **ApplicationData:** ุฏุงุฏูโูุง ฺฉุงุฑุจุฑ ฺฉู ุฏุฑ ุดุจฺฉู ููุชูู ูโุดููุฏ (ุฑูุงููฺฏ).
* **LocalApplicationData:** ุฏุงุฏูโูุง ูุญู ฺฉุงุฑุจุฑุ ุจุฏูู ุฑุงููฺฏ.
* **CommonApplicationData:** ุฏุงุฏูโูุง ูุดุชุฑฺฉ ุจู ฺฉุงุฑุจุฑุงู.

ุฑุนุงุช ุงุณุชุงูุฏุงุฑุฏ: ุงุฌุงุฏ ฺฉ ุฒุฑูพูุดู ุจุง ูุงู ุจุฑูุงูู ุดูุง ุจุฑุง ุฐุฎุฑูโุณุงุฒ ุฏุงุฏูโูุง.

```csharp
string localAppDataPath = Path.Combine(
    Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
    "MyCoolApplication"
);
if (!Directory.Exists(localAppDataPath))
    Directory.CreateDirectory(localAppDataPath);
```

โ๏ธ ูฺฉุชู: ุงฺฏุฑ ุจุฑูุงูู ุจุง ุณุทุญ ุฏุณุชุฑุณ ูุฏุฑ ุงุฌุฑุง ุดูุฏ ู ูพูุดูโูุง ุฏุฑ `CommonApplicationData` ุงุฌุงุฏ ุดููุฏุ ฺฉุงุฑุจุฑุงู ุจุง ุฏุณุชุฑุณ ูุญุฏูุฏ ููฺฉู ุงุณุช ูุชูุงููุฏ ูุงูโูุง ุฑุง ุจุนุฏุงู ุชุบุฑ ุฏููุฏ. ุฑุงูโุญู: ุงุฌุงุฏ ูพูุดูโูุง ุจุง ูุฌูุฒ ููุงุณุจ ุฏุฑ ูุฑุขูุฏ ูุตุจ.

---

### Querying Volume Information ๐ฝ

ุจุฑุง ุฏุฑุงูุช ุงุทูุงุนุงุช ุฏุฑุงููุง ุงุฒ **DriveInfo** ุงุณุชูุงุฏู ูโฺฉูู:

```csharp
DriveInfo c = new DriveInfo("C"); // ุง "/" ุฏุฑ Unix
long totalSize = c.TotalSize;
long freeBytes = c.TotalFreeSpace;
long freeToMe  = c.AvailableFreeSpace;

foreach (DriveInfo d in DriveInfo.GetDrives())
{
    Console.WriteLine(d.Name);          // C:\
    Console.WriteLine(d.DriveType);     // Fixed
    Console.WriteLine(d.RootDirectory); // C:\
    if (d.IsReady)
    {
        Console.WriteLine(d.VolumeLabel); // ุจุฑฺุณุจ ุฏุฑุงู
        Console.WriteLine(d.DriveFormat); // NTFS, FAT ู ุบุฑู
    }
}
```

* `GetDrives` ููู ุฏุฑุงููุง ุชุนุฑูโุดุฏูุ ุดุงูู CD-ROMุ ฺฉุงุฑุช ุญุงูุธู ู ุดุจฺฉู ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ.
* `DriveType` enum: `Unknown, NoRootDirectory, Removable, Fixed, Network, CDRom, Ram`.

---

### ูุงูุชูุฑ ฺฉุฑุฏู ุชุบุฑุงุช ูุงู ู ุฏุงุฑฺฉุชูุฑ ุจุง FileSystemWatcher ๐

* **FileSystemWatcher** ุงูฺฉุงู ูุงูุชูุฑ ฺฉุฑุฏู ฺฉ ุฏุงุฑฺฉุชูุฑ ู ุฒุฑุดุงุฎูโูุง ุขู ุจุฑุง ูุนุงูุชโูุง ุฑุง ูุฑุงูู ูโฺฉูุฏ.
* ุฑูุฏุงุฏูุง ุฏุงุฑุฏ ฺฉู ููฺฏุงู ุงุฌุงุฏุ ุชุบุฑุ ุญุฐูุ ุชุบุฑ ูุงู ุง ุชุบุฑ ูฺฺฏ ูุงู/ุฏุงุฑฺฉุชูุฑ ูุนุงู ูโุดููุฏ.

ูุซุงู:

```csharp
Watch(GetTestDirectory(), "*.txt", true);

void Watch(string path, string filter, bool includeSubDirs)
{
    using var watcher = new FileSystemWatcher(path, filter);
    watcher.Created += FileCreatedChangedDeleted;
    watcher.Changed += FileCreatedChangedDeleted;
    watcher.Deleted += FileCreatedChangedDeleted;
    watcher.Renamed += FileRenamed;
    watcher.Error   += FileError;
    watcher.IncludeSubdirectories = includeSubDirs;
    watcher.EnableRaisingEvents = true;

    Console.WriteLine("Listening for events - press <enter> to end");
    Console.ReadLine();
}

void FileCreatedChangedDeleted(object o, FileSystemEventArgs e)
    => Console.WriteLine("File {0} has been {1}", e.FullPath, e.ChangeType);

void FileRenamed(object o, RenamedEventArgs e)
    => Console.WriteLine("Renamed: {0}->{1}", e.OldFullPath, e.FullPath);

void FileError(object o, ErrorEventArgs e)
    => Console.WriteLine("Error: " + e.GetException().Message);

string GetTestDirectory() =>
    RuntimeInformation.IsOSPlatform(OSPlatform.Windows) ? @"C:\Temp" : "/tmp";
```

ูฺฉุงุช ููู:

* ุฑูุฏุงุฏูุง ุฏุฑ ฺฉ **Thread ุฌุฏุงฺฏุงูู** ุงุฌุฑุง ูโุดููุฏุ ุจูุงุจุฑุงู ุจุงุฏ ูุฏุฑุช ุงุณุชุซูุง ุฏุงุดุชู ุจุงุดุฏ.
* ุฑูุฏุงุฏ `Error` ูุดุงูโุฏููุฏู overflow ุจุงูุฑ ุฏุงุฎู ุงุณุช. ุจุง `InternalBufferSize` ูโุชูุงู ุจุงูุฑ ุฑุง ุชุบุฑ ุฏุงุฏ.
* `IncludeSubdirectories` ุจู ุตูุฑุช ุจุงุฒฺฏุดุช ุงุนูุงู ูโุดูุฏ.
* ูุฑุงูุจ ุจุงุดุฏ ูุงูโูุง ุฑุง ูุจู ุงุฒ ุงูฺฉู ฺฉุงููุงู ููุดุชู ุดููุฏุ ุจุงุฒ ูฺฉูุฏุ ููฺฉู ุงุณุช ูุงุฒ ุจู ุงุณุชุฑุงุชฺโูุง ูุซู ููุดุชู ุจุง ูพุณููุฏ ูููุช ู ุชุบุฑ ูุงู ุจุนุฏ ุงุฒ ุชฺฉูู ุฏุงุดุชู ุจุงุดุฏ.

### ุงููุช ุณุณุชูโุนุงูู (OS Security) ๐ก๏ธ

ููู ุจุฑูุงููโูุง ุชุญุช ูุญุฏูุฏุชโูุง ุณุณุชูโุนุงูู ุงุฌุฑุง ูโุดููุฏ ู ุงู ูุญุฏูุฏุชโูุง ุจุฑ ุงุณุงุณ ุณุทุญ ุฏุณุชุฑุณ ฺฉุงุฑุจุฑ ุงุนูุงู ูโุดููุฏ. ุงู ูุญุฏูุฏุชโูุง ุนูุงูู ุจุฑ I/O ูุงูุ ุจุฑ ุฏุณุชุฑุณ ุจู ููุงุจุน ุฏฺฏุฑ ูุซู **Windows Registry** ูู ุชุฃุซุฑ ุฏุงุฑูุฏ.

---

#### ฑ. **ุงููุงุน ุญุณุงุจ ฺฉุงุฑุจุฑ**

* **ุญุณุงุจ ฺฉุงุฑุจุฑ ุงุฏูู / ุณููพุฑ ูุฒุฑ:** ุจุฏูู ูุญุฏูุฏุช ุฏุฑ ุฏุณุชุฑุณ ุจู ฺฉุงููพูุชุฑ ูุญู.
* **ุญุณุงุจ ุจุง ุฏุณุชุฑุณ ูุญุฏูุฏ:** ุนููฺฉุฑุฏูุง ูุฏุฑุช ูุญุฏูุฏ ู ุฏุณุชุฑุณ ุจู ุฏุงุฏูโูุง ุฏฺฏุฑ ฺฉุงุฑุจุฑุงู ูุญุฏูุฏ ุงุณุช.

ุฏุฑ ููุฏูุฒุ ูฺฺฏ **User Account Control (UAC)** ุจุงุนุซ ูโุดูุฏ ููฺฏุงู ูุฑูุฏุ ูุฏุฑ ุณุณุชู ุฏู ุชูฺฉู ุง โฺฉูุงูโ ุฏุงุดุชู ุจุงุดุฏ:

1. ฺฉูุงู ูุฏุฑ (Administrative)
2. ฺฉูุงู ฺฉุงุฑุจุฑ ุนุงุฏ (Ordinary User)

ุจูโุทูุฑ ูพุดโูุฑุถ ุจุฑูุงููโูุง ุจุง ฺฉูุงู ฺฉุงุฑุจุฑ ุนุงุฏ ุงุฌุฑุง ูโุดููุฏ ูฺฏุฑ ุงูฺฉู ุฏุฑุฎูุงุณุช ุฏุณุชุฑุณ ูุฏุฑุช ฺฉููุฏ ู ฺฉุงุฑุจุฑ ุขู ุฑุง ุชุฃุฏ ฺฉูุฏ.

ุฏุฑ Unixุ ฺฉุงุฑุจุฑุงู ูุนูููุงู ุจุง ุญุณุงุจ ูุญุฏูุฏ ูุงุฑุฏ ูโุดููุฏ ู ุจุฑุง ุงุฌุฑุง ุฏุณุชูุฑุงุช ุจุง ุฏุณุชุฑุณ ุจุงูุง ุงุฒ `sudo` ุงุณุชูุงุฏู ูโฺฉููุฏ.

---

#### ฒ. **ุงุฌุฑุง ุจุฑูุงูู ุจุง ุฏุณุชุฑุณ ูุญุฏูุฏ**

* ุจูโุทูุฑ ูพุดโูุฑุถุ ุจุฑูุงููโูุง ุจุง ูุญุฏูุฏุช ฺฉุงุฑุจุฑ ุงุฌุฑุง ูโุดููุฏ. ุจูุงุจุฑุงู ุจุงุฏ:

  1. ุจุฑูุงูู ุฑุง ุทูุฑ ุทุฑุงุญ ฺฉูุฏ ฺฉู ุจุฏูู ุฏุณุชุฑุณ ูุฏุฑ ฺฉุงุฑ ฺฉูุฏ (**ฺฏุฒูู ุงููโุชุฑ ู ุฑุงุญุชโุชุฑ**)
  2. ุง ุฏุณุชุฑุณ ูุฏุฑุช ุฑุง ุงุฒ ุทุฑู **Application Manifest** ุฏุฑุฎูุงุณุช ฺฉูุฏ (ููุฏูุฒ)

ุจุฑุง ุชุดุฎุต ุงูฺฉู ุจุฑูุงูู ุจุง ุฏุณุชุฑุณ ูุฏุฑ ุงุฌุฑุง ูโุดูุฏ:

```csharp
[DllImport("libc")]
public static extern uint getuid();

static bool IsRunningAsAdmin()
{
    if (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))
    {
        using var identity = WindowsIdentity.GetCurrent();
        var principal = new WindowsPrincipal(identity);
        return principal.IsInRole(WindowsBuiltInRole.Administrator);
    }
    return getuid() == 0;
}
```

* ุฏุฑ ููุฏูุฒุ ููุท ุฏุฑ ุตูุฑุช ูุนุงู ุจูุฏู UAC ู Elevationุ ููุฏุงุฑ true ุจุฑูโฺฏุฑุฏุฏ.
* ุฏุฑ ูููฺฉุณุ true ููุท ููุช ูุฑุขูุฏ ุจุง sudo ุงุฌุฑุง ุดูุฏ.

---

#### ณ. **ูุญุฏูุฏุชโูุง ุญุณุงุจ ฺฉุงุฑุจุฑ ุนุงุฏ**

ฺฉุงุฑูุง ฺฉู ููโุชูุงู ุจุง ุญุณุงุจ ุนุงุฏ ุงูุฌุงู ุฏุงุฏ:

* ููุดุชู ุฏุฑ ูพูุดูโูุง ุณุณุชู (ูุซูุงู `\Windows` ุง `/bin, /sbin`) ู ุฒุฑุดุงุฎูโูุง
* ููุดุชู ุฏุฑ ูพูุดู Program Files ุง `/usr/bin, /opt`
* ููุดุชู ุฏุฑ ุฑุดู ุฏุฑุงู ุณุณุชู (`C:\` ุง `/`)
* ููุดุชู ุฏุฑ ุดุงุฎู `HKEY_LOCAL_MACHINE` ุฏุฑ Registry ููุฏูุฒ
* ุฎูุงูุฏู ุฏุงุฏูโูุง Performance Monitoring (WMI ุฏุฑ ููุฏูุฒ)

ููฺูู ููฺฉู ุงุณุช ุฏุณุชุฑุณ ุจู ูุงูโูุง ุง ููุงุจุน ุฏฺฏุฑ ฺฉุงุฑุจุฑุงู ูุญุฏูุฏ ุจุงุดุฏ. ููุฏูุฒ ุงุฒ **Access Control List (ACL)** ุจุฑุง ูุญุงูุธุช ุงุณุชูุงุฏู ูโฺฉูุฏ ู ุงฺฏุฑ ุฏุณุชุฑุณ ุฑุฏ ุดูุฏุ CLR ุงุณุชุซูุง **UnauthorizedAccessException** ูพุฑุชุงุจ ูโฺฉูุฏ.

**ุฑุงูฺฉุงุฑ ููุงุจูู ุจุง ูุญุฏูุฏุชโูุง:**

* ูุงูโูุง ุฑุง ุฏุฑ ูฺฉุงูโูุง ุชูุตูโุดุฏู ฺฉุงุฑุจุฑ ุฐุฎุฑู ฺฉูุฏ.
* ุงุฒ Registry ููุท ุจุฑุง HKEY\_CURRENT\_USER ุงุณุชูุงุฏู ฺฉูุฏ.
* ฺฉุงููพูููุชโูุง ActiveX ุง COM ุฑุง ุฏุฑ ูุฑุขูุฏ ูุตุจ ุซุจุช ฺฉูุฏ.

---

#### ด. **ูฺฉุงูโูุง ูพุดููุงุฏ ุฐุฎุฑูโุณุงุฒ ูุงูโูุง**

```csharp
string docsFolder = Environment.GetFolderPath(Environment.SpecialFolder.MyDocuments);
string path = Path.Combine(docsFolder, "test.txt");

string configFolder = Path.Combine(
    Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData), // ุจุฑุง ฺฉุงุฑุจุฑ ูุนู
    "MyApp"
);
if (!Directory.Exists(configFolder))
    Directory.CreateDirectory(configFolder);
```

โ๏ธ ุชูุฌู: ุงุณุชูุงุฏู ุงุฒ `CommonApplicationData` ุจุฑุง ุฏุณุชุฑุณ ููู ฺฉุงุฑุจุฑุงูุ ุจุงุฏ ุจุง ุชูุธู ูุฌูุฒูุง ููุฑุงู ุจุงุดุฏ.

---

#### ต. **Elevation ูุฏุฑุช ู Virtualization ููุฏูุฒ**

ุจุง **Application Manifest** ูโุชูุงูุฏ ุฏุฑุฎูุงุณุช ุฏุณุชุฑุณ ูุฏุฑ ฺฉูุฏ:

```xml
<requestedExecutionLevel level="requireAdministrator" />
```

* `asInvoker`: ุจุฑูุงูู ุจุฏูู ุฏุณุชุฑุณ ูุฏุฑ ุงุฌุฑุง ุดูุฏ ู Virtualization ุบุฑูุนุงู ุงุณุช.

**Virtualization:** ุชุบุฑุงุช ุฏุฑ ูพูุดู Program Files ุง Windows ู HKEY\_LOCAL\_MACHINE ุจู ูฺฉุงู ุฌุฏุงฺฏุงูู ูุฏุงุช ูโุดูุฏ ุชุง ุงุฒ ุขุณุจ ุจู ุณุณุชู ุฌููฺฏุฑ ุดูุฏ.

---

#### ถ. **Memory-Mapped Files** ๐๏ธ

ูุฒุงุง:

1. ุฏุณุชุฑุณ ุณุฑุน ู ุชุตุงุฏู ุจู ุฏุงุฏูโูุง ูุงู
2. ุงุดุชุฑุงฺฉ ุญุงูุธู ุจู ูุฑุขูุฏูุง ูุฎุชูู

ุฏุฑ ุฏุงุชโูุช ุงุฒ **System.IO.MemoryMappedFiles** ุงุณุชูุงุฏู ูโฺฉูู ฺฉู ุฏุฑ ูุงูุน API ุณุณุชูโุนุงูู ุจุฑุง Memory-Mapped Files ุฑุง ูพูุดุด ูโุฏูุฏ.

### ูุงูโูุง Memory-Mapped ู ุฏุณุชุฑุณ ุชุตุงุฏู ุจู ูุงู ๐๏ธ๐จ

Memory-mapped files ุจุฑุง ุฏุณุชุฑุณ **ุชุตุงุฏู ู ุณุฑุน** ุจู ุฏุงุฏูโูุง ูุงู ู ููฺูู ุงุดุชุฑุงฺฉ ุญุงูุธู ุจู ูุฑุขูุฏูุง ุงุณุชูุงุฏู ูโุดููุฏ. ุฏุฑ ููุงุณู ุจุง FileStream:

| ููุน ุฏุณุชุฑุณ          | FileStream      | Memory-Mapped File |
| ------------------- | --------------- | ------------------ |
| Sequential (ูุชูุงู) | ุณุฑุนโุชุฑ (\~10ร) | ฺฉูุฏุชุฑ              |
| Random (ุชุตุงุฏู)     | ฺฉูุฏุชุฑ           | ุณุฑุนโุชุฑ (\~10ร)    |

---

#### ฑ. ุงุฌุงุฏ ฺฉ Memory-Mapped File

1. ฺฉ `FileStream` ูุนููู ุจุณุงุฒุฏ.
2. ฺฉ `MemoryMappedFile` ุจุณุงุฒุฏ ู ูุงู ุฑุง ุจู ุขู ุจุฏูุฏ.
3. ุงุฒ `CreateViewAccessor` ุจุฑุง ุงุฌุงุฏ **View Accessor** ุงุณุชูุงุฏู ฺฉูุฏ.

```csharp
File.WriteAllBytes("long.bin", new byte[1_000_000]);
using MemoryMappedFile mmf = MemoryMappedFile.CreateFromFile("long.bin");
using MemoryMappedViewAccessor accessor = mmf.CreateViewAccessor();

accessor.Write(500_000, (byte)77);
Console.WriteLine(accessor.ReadByte(500_000));  // 77
```

* ูโุชูุงู ูุงู Map ู ุธุฑูุช ูุดุฎุต ฺฉุฑุฏ ุชุง ุญุงูุธู ุจู ุงุดุชุฑุงฺฉ ฺฏุฐุงุดุชู ุดูุฏ ุง ุงูุฏุงุฒู ูุงู ุจุฒุฑฺฏโุชุฑ ุดูุฏ.

---

#### ฒ. ุงุดุชุฑุงฺฉ ุญุงูุธู ุจู ูุฑุขูุฏูุง (Windows)

* ฺฉ ูุฑุขูุฏ `MemoryMappedFile.CreateNew` ุงุฌุงุฏ ูโฺฉูุฏ.
* ูุฑุขูุฏูุง ุฏฺฏุฑ ุจุง `OpenExisting` ุจู ููุงู ุญุงูุธู ุฏุณุชุฑุณ ุฏุงุฑูุฏ.

```csharp
// Writer
using var mmFile = MemoryMappedFile.CreateNew("Demo", 500);
using var accessor = mmFile.CreateViewAccessor();
accessor.Write(0, 12345);
Console.ReadLine(); // ุญุงูุธู ุฑุง ุฒูุฏู ูฺฏู ูโุฏุงุฑุฏ

// Reader (ูุฑุขูุฏ ุฏฺฏุฑ)
using var mmFile = MemoryMappedFile.OpenExisting("Demo");
using var accessor = mmFile.CreateViewAccessor();
Console.WriteLine(accessor.ReadInt32(0)); // 12345
```

---

#### ณ. ุงุดุชุฑุงฺฉ ุญุงูุธู ุจู ูุฑุขูุฏูุง ุฏุฑ Windows ู Unix

* ูุงู ุฑุง ุจุง `FileStream` ุจุงุฒ ฺฉูุฏ ู ุงุฌุงุฒู ุฎูุงูุฏู/ููุดุชู ูุดุชุฑฺฉ ุจุฏูุฏ (`FileShare.ReadWrite`).
* ุณูพุณ `MemoryMappedFile.CreateFromFile` ุจุณุงุฒุฏ.

```csharp
var file = Path.Combine(TestDirectory, "interprocess.bin");
File.WriteAllBytes(file, new byte[100]);

using FileStream fs = new FileStream(file, FileMode.Open, FileAccess.ReadWrite, FileShare.ReadWrite);
using MemoryMappedFile mmf = MemoryMappedFile.CreateFromFile(fs, null, fs.Length, MemoryMappedFileAccess.ReadWrite, HandleInheritability.None, true);
using MemoryMappedViewAccessor accessor = mmf.CreateViewAccessor();
accessor.Write(0, 12345);
Console.ReadLine();
File.Delete(file);
```

---

#### ด. ฺฉุงุฑ ุจุง View Accessor

* `Read*` ู `Write*` ุจุฑุง **ููุนโูุง ุนุฏุฏุ boolุ char** ู ุขุฑุงูโูุง/structูุง Value Type ุงุณุชูุงุฏู ูโุดููุฏ.
* ุจุฑุง ุฑุดุชูโูุงุ ุจุงุฏ ุงุจุชุฏุง ุขูโูุง ุฑุง ุจู ุขุฑุงู ุจุงุช ุชุจุฏู ฺฉูุฏ.

```csharp
byte[] data = Encoding.UTF8.GetBytes("This is a test");
accessor.Write(0, data.Length);
accessor.WriteArray(4, data, 0, data.Length);

// ุฎูุงูุฏู ูุฌุฏุฏ
byte[] readData = new byte[accessor.ReadInt32(0)];
accessor.ReadArray(4, readData, 0, readData.Length);
Console.WriteLine(Encoding.UTF8.GetString(readData)); // This is a test
```

* ฺฉุงุฑ ุจุง struct:

```csharp
struct Data { public int X, Y; }
var data = new Data { X = 123, Y = 456 };
accessor.Write(0, ref data);
accessor.Read(0, out data);
Console.WriteLine(data.X + " " + data.Y); // 123 456
```

---

#### ต. ุจูููโุณุงุฒ ุนููฺฉุฑุฏ ุจุง ุงุดุงุฑูโฺฏุฑูุง (Unsafe)

* ุงุณุชูุงุฏู ุงุฒ `SafeMemoryMappedViewHandle.AcquirePointer` ุจุณุงุฑ ุณุฑุนโุชุฑ ุงุฒ `Read/Write` ุงุณุชุ ูุฎุตูุตุงู ุจุฑุง ุฏุงุฏูโูุง ุจุฒุฑฺฏ:

```csharp
unsafe
{
    byte* pointer = null;
    try
    {
        accessor.SafeMemoryMappedViewHandle.AcquirePointer(ref pointer);
        int* intPointer = (int*)pointer;
        Console.WriteLine(*intPointer); // 123
    }
    finally
    {
        if (pointer != null)
            accessor.SafeMemoryMappedViewHandle.ReleasePointer();
    }
}
```

* ูุงุฒ ุจู ูุนุงู ฺฉุฑุฏู unsafe code ุฏุฑ ูุงู `.csproj`:

```xml
<PropertyGroup>
  <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
</PropertyGroup>
```

ุฏูู ุงุตู ุจุฑุชุฑ ุนููฺฉุฑุฏ ุงุณุชูุงุฏู ุงุฒ **ุงุดุงุฑูโฺฏุฑูุง (pointers)** ููุช ุจุง ุณุงุฎุชุงุฑูุง ุจุฒุฑฺฏ ฺฉุงุฑ ูโฺฉูู ุงู ุงุณุช ฺฉู ุงุดุงุฑูโฺฏุฑูุง ุงุฌุงุฒู ูโุฏููุฏ ูุณุชููุงู ุจุง ุฏุงุฏูโูุง ุฎุงู (raw data) ฺฉุงุฑ ฺฉููุ ุจุฏูู ุงูฺฉู ูุฌุจูุฑ ุจุงุดู ุงุฒ ูุชุฏูุง `Read` ู `Write` ุจุฑุง ฺฉูพ ฺฉุฑุฏู ุฏุงุฏูโูุง ุจู ุญุงูุธู **ูุฏุฑุชโุดุฏู (managed)** ู **ูุฏุฑุชโูุดุฏู (unmanaged)** ุงุณุชูุงุฏู ฺฉูู.

ุงู ฺฉุงุฑ ุจุงุนุซ ุตุฑููโุฌู ูุงุจูโุชูุฌู ุฏุฑ ุฒูุงู ู ููุงุจุน ูโุดูุฏุ ุจูโูฺู ููุช ุญุฌู ุฏุงุฏูโูุง ุฒุงุฏ ุจุงุดุฏ. ุงู ููุถูุน ุฏุฑ **ูุตู ฒด** ฺฉุชุงุจ ุจูโุทูุฑ ฺฉุงูู ุจุฑุฑุณ ุดุฏู ุงุณุช.
