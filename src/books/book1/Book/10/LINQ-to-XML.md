# ูุตู ุฏูู:  LINQ to XML

.NET ุชุนุฏุงุฏ ุฒุงุฏ API ุจุฑุง ฺฉุงุฑ ุจุง ุฏุงุฏูโูุง XML ูุฑุงูู ูโฺฉูุฏ. ุงูุชุฎุงุจ ุงุตู ุจุฑุง ูพุฑุฏุงุฒุด ุนููู ุงุณูุงุฏ XMLุ **LINQ to XML** ุงุณุช.
LINQ to XML ุดุงูู ฺฉ ูุฏู ุดุก ุณูุฏ XML (**DOM**) ุณุจฺฉ ู ุณุงุฒฺฏุงุฑ ุจุง LINQ ุงุณุชุ ุจูโุนูุงูู ูุฌููุนูโุง ุงุฒ ุนููฺฏุฑูุง ูพุฑุณโูุฌู ุชฺฉูู.

ุฏุฑ ุงู ูุตูุ ูุง ุจูโุทูุฑ ฺฉุงูู ุฑู LINQ to XML ุชูุฑฺฉุฒ ูโฺฉูู. ุฏุฑ ูุตู ฑฑุ ุจู **ุฎูุงููุฏู/ููุณูุฏู XML** ฺฉโุทุฑูู (forward-only) ูโูพุฑุฏุงุฒู ู ุฏุฑ ุถูููโ ุขููุงูุ ููุนโูุง ุจุฑุง ฺฉุงุฑ ุจุง **schemaูุง** ู **stylesheetูุง** ุฑุง ูพูุดุด ูโุฏูู. .NET ููฺูู ุดุงูู DOM ูุฏู ูุจุชู ุจุฑ **XmlDocument** ุงุณุช ฺฉู ูุง ุขู ุฑุง ูพูุดุด ููโุฏูู.

DOM ูุฑุจูุท ุจู LINQ to XML ุจุณุงุฑ ุฎูุจ ุทุฑุงุญ ุดุฏู ู ุงุฒ ูุธุฑ ฺฉุงุฑุง ุจุณุงุฑ ูู ุงุณุช. ุญุช ุจุฏูู LINQุ ุงู DOM ุจูโุนููุงู ฺฉ ูุงูโ ุณุจฺฉ ุฑู ฺฉูุงุณโูุง ุณุทุญ ูพุงู **XmlReader** ู **XmlWriter** ุงุฑุฒุดููุฏ ุงุณุช.

ุชูุงู ููุนโูุง LINQ to XML ุฏุฑ ูุถุง ูุงู **System.Xml.Linq** ุชุนุฑู ุดุฏูโุงูุฏ.

---

## ๐ ููุง ฺฉู ูุนูุงุฑ (Architectural Overview)

ุงู ุจุฎุด ุจุง ูุนุฑู ุจุณุงุฑ ฺฉูุชุงู ุงุฒ ููููู **DOM** ุดุฑูุน ูโุดูุฏ ู ุณูพุณ ููุทู ูพุดุช DOM ุฏุฑ LINQ to XML ุฑุง ุชูุถุญ ูโุฏูุฏ.

---

### โ DOM ฺุณุชุ (What Is a DOM?)

ุจู ูุงู XML ุฒุฑ ุชูุฌู ฺฉูุฏ:

```xml
<?xml version="1.0" encoding="utf-8"?>
<customer id="123" status="archived">
  <firstname>Joe</firstname>
  <lastname>Bloggs</lastname>
</customer>
```

ููุงูโุทูุฑ ฺฉู ุฏุฑ ูููโ ูุงูโูุง XML ูุฌูุฏ ุฏุงุฑุฏุ ูุง ุจุง ฺฉ **ุงุนูุงู (declaration)** ุดุฑูุน ูโฺฉูู ู ุณูพุณ ฺฉ ุนูุตุฑ ุฑุดู (**root element**) ุฏุงุฑู ฺฉู ูุงู ุขู `customer` ุงุณุช.
ุนูุตุฑ `customer` ุฏู ูฺฺฏ (**attribute**) ุฏุงุฑุฏุ ูุฑฺฉุฏุงู ุจุง ฺฉ ูุงู (id ู status) ู ููุฏุงุฑ ("123" ู "archived").
ุฏุฑูู `customer`ุ ุฏู ุนูุตุฑ ูุฑุฒูุฏ (**child element**) ูุฌูุฏ ุฏุงุฑุฏ: `firstname` ู `lastname`ุ ฺฉู ูุฑฺฉุฏุงู ูุญุชูุง ูุชู ุณุงุฏูโุง ("Joe" ู "Bloggs") ุฏุงุฑูุฏ.

ูุฑฺฉุฏุงู ุงุฒ ุงู ุณุงุฎุชุงุฑูุงโุงุนูุงูุ ุนูุตุฑุ ูฺฺฏุ ููุฏุงุฑุ ู ูุญุชูุง ูุชูโูโุชูุงููุฏ ุจุง ฺฉ **ฺฉูุงุณ (class)** ููุงุด ุฏุงุฏู ุดููุฏ. ู ุงฺฏุฑ ฺูู ฺฉูุงุณโูุง ุฎุตูุตุชโูุง ูุฌููุนูโุง (**collection properties**) ุจุฑุง ุฐุฎุฑูโ ูุญุชูุง ูุฑุฒูุฏ ุฏุงุดุชู ุจุงุดูุฏุ ูโุชูุงูู ฺฉ **ุฏุฑุฎุช ุงุฒ ุงุดุงุก** ุจุณุงุฒู ฺฉู ฺฉ ุณูุฏ ุฑุง ุจูโุทูุฑ ฺฉุงูู ุชูุตู ฺฉูุฏ.
ุจู ุงู ูุฏูุ **Document Object Model** ุง **DOM** ฺฏูุชู ูโุดูุฏ.

---

### ๐งฉ DOM ุฏุฑ LINQ to XML

LINQ to XML ุงุฒ ุฏู ุจุฎุด ุชุดฺฉู ุดุฏู ุงุณุช:

* ฺฉ DOM ูุฑุจูุท ุจู XML ฺฉู ุขู ุฑุง **X-DOM** ูโูุงูู.
* ูุฌููุนูโุง ุงุฒ ุญุฏูุฏ ฑฐ ุนููฺฏุฑ ูพุฑุณโูุฌู ุชฺฉูู.

ููุงูโุทูุฑ ฺฉู ุงูุชุธุงุฑ ูโุฑูุฏุ **X-DOM** ุดุงูู ููุนโูุง ูุซู **XDocument**ุ **XElement** ู **XAttribute** ุงุณุช.
ูฺฉุชูโ ุฌุงูุจ ุงู ุงุณุช ฺฉู ููุนโูุง X-DOM ุจู LINQ ูุงุจุณุชู ูุณุชูุฏโุดูุง ูโุชูุงูุฏ ฺฉ X-DOM ุฑุง ุจุงุฑฺฏุฐุงุฑ (load)ุ ูููููโุณุงุฒ (instantiate)ุ ุจูโุฑูุฒุฑุณุงู (update) ู ุฐุฎุฑู (save) ฺฉูุฏ ุจุฏูู ุขูฺฉู ูฺ ูพุฑุณโูุฌู LINQ ุจููุณุฏ.

ุจุฑุนฺฉุณุ ุดูุง ูโุชูุงูุฏ ุงุฒ LINQ ุจุฑุง ูพุฑุณโูุฌู ุฏุฑ ฺฉ DOM ฺฉู ุจุง ููุนโูุง ูุฏู ู ุณุงุฒฺฏุงุฑ ุจุง **W3C** ุณุงุฎุชู ุดุฏูุ ุงุณุชูุงุฏู ฺฉูุฏ. ุจุง ุงู ุญุงูุ ุงู ฺฉุงุฑ ูุญุฏูุฏฺฉููุฏู ู ุขุฒุงุฑุฏููุฏู ุฎูุงูุฏ ุจูุฏ.
ูฺฺฏ ูุชูุงุฒ **X-DOM** ุงู ุงุณุช ฺฉู ุณุงุฒฺฏุงุฑ ุจุง LINQ (**LINQ-friendly**) ุงุณุชุ ุนู:

* ูุชุฏูุง ุฏุงุฑุฏ ฺฉู ุชูุงูโูุง **IEnumerable** ููุฏ ุชููุฏ ูโฺฉููุฏ ฺฉู ูโุชูุงูุฏ ุฑู ุขูโูุง ูพุฑุณโูุฌู ฺฉูุฏ.
* ุณุงุฒูุฏูโูุง ุขู ุจูโฺฏูููโุง ุทุฑุงุญ ุดุฏูโุงูุฏ ฺฉู ูโุชูุงูุฏ ฺฉ ุฏุฑุฎุช X-DOM ุฑุง ุงุฒ ุทุฑู ฺฉ **LINQ projection** ุจุณุงุฒุฏ.

---

### ๐ ููุง ฺฉู X-DOM

ุดฺฉู ฑฐ-ฑ ููุนโูุง ุงุตู X-DOM ุฑุง ูุดุงู ูโุฏูุฏ.
ูพุฑฺฉุงุฑุจุฑุฏุชุฑู ุงู ููุนโูุง **XElement** ุงุณุช.
**XObject** ุฑุดูโ ุณูุณููโูุฑุงุชุจ ูุฑุงุซุช ุงุณุชุ ู **XElement** ู **XDocument** ุฑุดูโูุง ุณูุณููโูุฑุงุชุจ ุฏุฑุจุฑฺฏุฑ (**containership hierarchy**) ูุณุชูุฏ.

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/10/Table-10-1.jpeg)
</div>

ุดฺฉู ฑฐ-ฒ ุฏุฑุฎุช X-DOM ุณุงุฎุชูโุดุฏู ุงุฒ ฺฉุฏ ุฒุฑ ุฑุง ูุดุงู ูโุฏูุฏ:

```csharp
string xml = @"<customer id='123' status='archived'>
                 <firstname>Joe</firstname>
                 <lastname>Bloggs<!--nice name--></lastname>
               </customer>";
XElement customer = XElement.Parse (xml);
```

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/10/Table-10-2.jpeg)
</div>

### ๐งฉ XObject

**XObject** ฺฉูุงุณ ูพุงูโ ุงูุชุฒุงุน ุจุฑุง ุชูุงู ูุญุชูุง XML ุงุณุช. ุงู ฺฉูุงุณ ฺฉ ูพููุฏ ุจู ุนูุตุฑ **Parent** (ูุงูุฏ) ุฏุฑ ุฏุฑุฎุช ุฏุฑุจุฑฺฏุฑ (containership tree) ุชุนุฑู ูโฺฉูุฏ ู ููฺูู ูโุชูุงูุฏ ฺฉ **XDocument** ุงุฎุชุงุฑ ุฏุงุดุชู ุจุงุดุฏ.

---

### ๐งฉ XNode

**XNode** ฺฉูุงุณ ูพุงู ุจุฑุง ุจุดุชุฑ ูุญุชูุง XML (ุจูโุฌุฒ attributeูุง) ุงุณุช. ูฺฺฏ ูุชูุงุฒ XNode ุงู ุงุณุช ฺฉู ูโุชูุงูุฏ ุฏุฑ ฺฉ ูุฌููุนูโ ูุฑุชุจโุดุฏู ุงุฒ XNodeูุง ฺูุฏููุน ูุฑุงุฑ ุจฺฏุฑุฏ.

ุจุฑุง ูุซุงูุ ุจู XML ุฒุฑ ุชูุฌู ฺฉูุฏ:

```xml
<data>
 Hello world
 <subelement1/>
 <!--comment-->
 <subelement2/>
</data>
```

ุฏุฑูู ุนูุตุฑ ูุงูุฏ `<data>`ุ ุงุจุชุฏุง ฺฉ **XText node** ("Hello world") ูุฑุงุฑ ุฏุงุฑุฏุ ุณูพุณ ฺฉ **XElement node**ุ ุจุนุฏ ฺฉ **XComment node**ุ ู ุฏุฑ ูพุงุงู ฺฉ **XElement node** ุฏฺฏุฑ.
ุฏุฑ ููุงุจูุ ฺฉ **XAttribute** ุชููุง ุณุงุฑ XAttributeูุง ุฑุง ุจูโุนููุงู ููโุณุทุญ (peer) ูโูพุฐุฑุฏ.

ุจุง ุงูฺฉู ฺฉ **XNode** ูโุชูุงูุฏ ุจู ุนูุตุฑ ูุงูุฏ ุฎูุฏ (**XElement**) ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏุ ุงูุง ูฺ ููููู ุงุฒ **child node** ูุฏุงุฑุฏุ ุงู ูุธููโ ุฒุฑฺฉูุงุณ ุขู ุนู **XContainer** ุงุณุช.

---

### ๐งฉ XContainer

**XContainer** ุงุนุถุง ุจุฑุง ฺฉุงุฑ ุจุง ูุฑุฒูุฏุงู ุชุนุฑู ูโฺฉูุฏ ู ฺฉูุงุณ ูพุงูโ ุงูุชุฒุงุน ุจุฑุง **XElement** ู **XDocument** ุงุณุช.

---

### ๐งฉ XElement

**XElement** ุงุนุถุง ุจุฑุง ูุฏุฑุช attributeูุง ูุนุฑู ูโฺฉูุฏโู ููฺูู ุฎุตูุตุชโูุง **Name** ู **Value** ุฑุง.
ุฏุฑ ุญุงูุช ฺฉู ฺฉ ุนูุตุฑ ุชููุง ฺฉ ูุฑุฒูุฏ ุงุฒ ููุน **XText** ุฏุงุดุชู ุจุงุดุฏ (ฺฉู ุญุงูุช ูุณุจุชุงู ุฑุงุฌ ุงุณุช)ุ ุฎุตูุตุช **Value** ุฏุฑ XElement ูุญุชูุง ุงู ูุฑุฒูุฏ ุฑุง ูู ุจุฑุง ุนููุงุช **get** ู ูู ุจุฑุง **set** ุฏุฑุจุฑูโฺฏุฑุฏ ู ูุงุฒ ุจู ูพูุงุด ุบุฑุถุฑูุฑ ุฑุง ุญุฐู ูโฺฉูุฏ.
ุจู ูุทู **Value**ุ ูุนูููุงู ูุงุฒ ุจู ฺฉุงุฑ ูุณุชูู ุจุง **XText nodeูุง** ูุฏุงุฑุฏ.

---

### ๐งฉ XDocument

**XDocument** ุฑุดูโ ฺฉ ุฏุฑุฎุช XML ุฑุง ููุงุด ูโุฏูุฏ. ุจูโุทูุฑ ุฏููโุชุฑุ ุงู ฺฉูุงุณ ุนูุตุฑ ุฑุดู (**root XElement**) ุฑุง ุฏุฑุจุฑ ูโฺฏุฑุฏ ู ฺฉ **XDeclaration**ุ ุฏุณุชูุฑุงูุนููโูุง ูพุฑุฏุงุฒุด (processing instructions) ู ุณุงุฑ ููุงุฑุฏ ุณุทุญ ุฑุดู ุฑุง ุงุถุงูู ูโฺฉูุฏ.

ุจุฑุฎูุงู DOM ุฏุฑ ุงุณุชุงูุฏุงุฑุฏ **W3C**ุ ุงุณุชูุงุฏู ุงุฒ XDocument ุงุฎุชุงุฑ ุงุณุช: ุดูุง ูโุชูุงูุฏ ฺฉ X-DOM ุฑุง ุจุงุฑฺฏุฐุงุฑุ ุฏุณุชโฺฉุงุฑ ู ุฐุฎุฑู ฺฉูุฏ ุจุฏูู ุงูฺฉู ูฺโููุช ฺฉ XDocument ุจุณุงุฒุฏ!
ููฺูู ูุณุชูู ุจูุฏู ุงุฒ XDocument ุจุงุนุซ ูโุดูุฏ ุจุชูุงูุฏ ฺฉ ุฒุฑโุฏุฑุฎุช node ุฑุง ุจูโุทูุฑ ฺฉุงุฑุขูุฏ ู ุขุณุงู ุจู ุณูุณููโูุฑุงุชุจ X-DOM ุฏฺฏุฑ ููุชูู ฺฉูุฏ.

---

## ๐ฅ ุจุงุฑฺฏุฐุงุฑ ู ุชุฌุฒู (Loading and Parsing)

ูู **XElement** ู ูู **XDocument** ูุชุฏูุง ุงุณุชุง (**static**) **Load** ู **Parse** ุฑุง ุจุฑุง ุณุงุฎุชู ฺฉ ุฏุฑุฎุช X-DOM ุงุฒ ฺฉ ููุจุน ููุฌูุฏ ุงุฑุงุฆู ูโุฏููุฏ:

* **Load** ฺฉ X-DOM ุฑุง ุงุฒ ูุงูุ URIุ Streamุ TextReader ุง XmlReader ูโุณุงุฒุฏ.
* **Parse** ฺฉ X-DOM ุฑุง ุงุฒ ฺฉ ุฑุดุชู (string) ูโุณุงุฒุฏ.

ูุซุงู:

```csharp
XDocument fromWeb = XDocument.Load ("http://albahari.com/sample.xml");
XElement fromFile = XElement.Load (@"e:\media\somefile.xml");
XElement config = XElement.Parse (
 @"<configuration>
    <client enabled='true'>
      <timeout>30</timeout>
    </client>
  </configuration>");
```

ุฏุฑ ุจุฎุดโูุง ุจุนุฏุ ุฑูุด ูพูุงุด ู ุจูโุฑูุฒุฑุณุงู ฺฉ X-DOM ุฑุง ุชูุถุญ ูโุฏูู.
ุจูโุนููุงู ฺฉ ูพุดโููุงุด ุณุฑุนุ ุฏุฑ ุงูุฌุง ูุญููโ ุฏุณุชโฺฉุงุฑ ุนูุตุฑ `config` ฺฉู ููู ุงูุงู ุณุงุฎุชู ุขูุฏู ุงุณุช:

```csharp
foreach (XElement child in config.Elements())
  Console.WriteLine (child.Name);                     // client

XElement client = config.Element ("client");
bool enabled = (bool) client.Attribute ("enabled");   // Read attribute
Console.WriteLine (enabled);                          // True

client.Attribute ("enabled").SetValue (!enabled);     // Update attribute

int timeout = (int) client.Element ("timeout");       // Read element
Console.WriteLine (timeout);                          // 30

client.Element ("timeout").SetValue (timeout * 2);    // Update element

client.Add (new XElement ("retries", 3));             // Add new element

Console.WriteLine (config);   // Implicitly call config.ToString()
```

ูุชุฌูโ ุขุฎุฑู ุฏุณุชูุฑ `Console.WriteLine` ุจูโุดฺฉู ุฒุฑ ุฎูุงูุฏ ุจูุฏ:

```xml
<configuration>
  <client enabled="false">
    <timeout>60</timeout>
    <retries>3</retries>
  </client>
</configuration>
```

---

### ๐งฉ XNode.ReadFrom

**XNode** ููฺูู ฺฉ ูุชุฏ ุงุณุชุง **ReadFrom** ุฏุงุฑุฏ ฺฉู ูุฑ ููุน node ุฑุง ุงุฒ ฺฉ **XmlReader** ูููููโุณุงุฒ ู ููุฏุงุฑุฏู ูโฺฉูุฏ.
ุจุฑุฎูุงู **Load**ุ ุงู ูุชุฏ ูพุณ ุงุฒ ุฎูุงูุฏู ฺฉ node ฺฉุงูู ูุชููู ูโุดูุฏุ ุจูุงุจุฑุงู ุดูุง ูโุชูุงูุฏ ุจูโุทูุฑ ุฏุณุช ุงุฒ ููุงู XmlReader ุงุฏุงููโ ุฎูุงูุฏู ุฑุง ุงูุฌุงู ุฏูุฏ.

ููฺูู ูโุชูุงูุฏ ุจุฑุนฺฉุณ ุนูู ฺฉูุฏ ู ุจุง ุงุณุชูุงุฏู ุงุฒ ูุชุฏูุง **CreateReader** ู **CreateWriter**ุ ุงุฒ ฺฉ XmlReader ุง XmlWriter ุจุฑุง ุฎูุงูุฏู ุง ููุดุชู ฺฉ XNode ุงุณุชูุงุฏู ฺฉูุฏ.

ูุง ุฏุฑ ูุตู ฑฑ ุฎูุงููุฏูโูุง ู ููุณูุฏูโูุง XML ู ูุญููโ ุงุณุชูุงุฏู ุงุฒ ุขูโูุง ุจุง X-DOM ุฑุง ุชูุถุญ ุฎูุงูู ุฏุงุฏ.

---

## ๐พ ุฐุฎุฑูโุณุงุฒ ู ุณุฑุงูโุณุงุฒ (Saving and Serializing)

ูุฑุงุฎูุงู **ToString** ุฑู ูุฑ nodeุ ูุญุชูุง ุขู ุฑุง ุจู ฺฉ ุฑุดุชูโ XML ุชุจุฏู ูโฺฉูุฏโุจุง ูุงูุจโุจูุฏ ุดุงูู ุดฺฉุณุช ุฎุท ู ุชูุฑูุชฺฏุ ููุงูโุทูุฑ ฺฉู ุฏุฏู.
(ูโุชูุงูุฏ ุดฺฉุณุช ุฎุท ู ุชูุฑูุชฺฏ ุฑุง ุบุฑูุนุงู ฺฉูุฏุ ุจุง ูุดุฎุต ฺฉุฑุฏู **SaveOptions.DisableFormatting** ููฺฏุงู ูุฑุงุฎูุงู ToString.)

**XElement** ู **XDocument** ููฺูู ูุชุฏ **Save** ุฏุงุฑูุฏ ฺฉู ฺฉ X-DOM ุฑุง ุฏุฑ ูุงูุ Streamุ TextWriter ุง XmlWriter ูโููุณุฏ. ุงฺฏุฑ ฺฉ ูุงู ูุดุฎุต ฺฉูุฏุ ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ฺฉ **XML declaration** ููุดุชู ูโุดูุฏ.

ููฺูู ูุชุฏ **WriteTo** ุฏุฑ ฺฉูุงุณ **XNode** ุชุนุฑู ุดุฏู ุงุณุช ฺฉู ููุท ฺฉ **XmlWriter** ูโูพุฐุฑุฏ.

ูุง ุฌุฒุฆุงุช ุจุดุชุฑ ุฏุฑุจุงุฑูโ ูุญููโ ูุฏุฑุช ุงุนูุงูโูุง XML ููฺฏุงู ุฐุฎุฑูโุณุงุฒ ุฑุง ุฏุฑ ุจุฎุด **โDocuments and Declarationsโ** ุฏุฑ ุตูุญูโ ตณน ุชูุถุญ ุฎูุงูู ุฏุงุฏ.
ูููููโุณุงุฒ ฺฉ X-DOM
ุจูโุฌุง ุงุณุชูุงุฏู ุงุฒ ูุชุฏูุง **Load** ุง **Parse**ุ ูโุชูุงูุฏ ฺฉ ุฏุฑุฎุช X-DOM ุฑุง ุจุง ูููููโุณุงุฒ ุฏุณุช ุงุดุงุก ู ุงูุฒูุฏู ุขูโูุง ุจู ฺฉ ูุงูุฏ ุงุฒ ุทุฑู ูุชุฏ **Add** ุฏุฑ ฺฉูุงุณ **XContainer** ุจุณุงุฒุฏ.

ุจุฑุง ุณุงุฎุชู ฺฉ **XElement** ู **XAttribute** ฺฉุงู ุงุณุช ฺฉ ูุงู ู ููุฏุงุฑ ูุดุฎุต ฺฉูุฏ:

```csharp
XElement lastName = new XElement("lastname", "Bloggs");
lastName.Add(new XComment("nice name"));
XElement customer = new XElement("customer");
customer.Add(new XAttribute("id", 123));
customer.Add(new XElement("firstname", "Joe"));
customer.Add(lastName);
Console.WriteLine(customer.ToString());
```

ุฎุฑูุฌ ุจู ุงู ุตูุฑุช ุงุณุช:

```xml
<customer id="123">
  <firstname>Joe</firstname>
  <lastname>Bloggs<!--nice name--></lastname>
</customer>
```

ููุช ฺฉ **XElement** ูโุณุงุฒุฏุ ููุฏุงุฑ (value) ุงุฎุชุงุฑ ุงุณุช โ ูโุชูุงูุฏ ููุท ูุงู ุนูุตุฑ ุฑุง ุจุฏูุฏ ู ุจุนุฏุงู ูุญุชูุง ุงุถุงูู ฺฉูุฏ. ุชูุฌู ฺฉูุฏ ฺฉู ููุช ููุฏุงุฑ ุชุนู ฺฉุฑุฏูุ ฺฉ ุฑุดุชูโ ุณุงุฏู ฺฉุงู ุจูุฏุ ูุงุฒู ูุจูุฏ ฺฉู ุจูโุทูุฑ ุตุฑุญ ฺฉ **XText** ุจุณุงุฒู ู ุงุถุงูู ฺฉูู. X-DOM ุงู ฺฉุงุฑ ุฑุง ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ุงูุฌุงู ูโุฏูุฏุ ุจูุงุจุฑุงู ุดูุง ููุท ุจุง "ููุฏุงุฑ" ุณุฑูฺฉุงุฑ ุฏุงุฑุฏ.

---

### ุณุงุฎุชุงุฑ ุชุงุจุน (Functional Construction)

ุฏุฑ ูุซุงู ูุจูุ ุฎูุงูุฏู ุณุงุฎุชุงุฑ XML ุงุฒ ุฑู ฺฉุฏ ฺฉู ุฏุดูุงุฑ ุงุณุช. X-DOM ฺฉ ุญุงูุช ุฏฺฏุฑ ูููููโุณุงุฒ ุจู ูุงู **ุณุงุฎุชุงุฑ ุชุงุจุน** (ุงุฒ ุจุฑูุงููโููุณ ุชุงุจุน) ูพุดุชุจุงู ูโฺฉูุฏ. ุฏุฑ ุงู ุญุงูุชุ ูโุชูุงูุฏ ฺฉู ุฏุฑุฎุช ุฑุง ุฏุฑ ฺฉ ุนุจุงุฑุช ูุงุญุฏ ุจุณุงุฒุฏ:

```csharp
XElement customer =
  new XElement("customer", new XAttribute("id", 123),
    new XElement("firstname", "joe"),
    new XElement("lastname", "bloggs",
      new XComment("nice name")
    )
  );
```

ุงู ุฑูุด ุฏู ูุฒุช ุฏุงุฑุฏ:

1. ฺฉุฏ ุดุจู ุณุงุฎุชุงุฑ XML ูโุดูุฏ.
2. ูโุชูุงู ุขู ุฑุง ุฏุฑ ุนุจุงุฑุช **select** ฺฉ ฺฉูุฆุฑ LINQ ุงุณุชูุงุฏู ฺฉุฑุฏ.

ูุซูุงูุ ฺฉูุฆุฑ ุฒุฑ ุงุฒ ฺฉ ฺฉูุงุณ ููุฌูุฏุช EF Core ุจู ฺฉ X-DOM ูพุฑูุฌฺฉุช ูโฺฉูุฏ:

```csharp
XElement query =
  new XElement("customers",
    from c in dbContext.Customers.AsEnumerable()
    select
      new XElement("customer", new XAttribute("id", c.ID),
        new XElement("firstname", c.FirstName),
        new XElement("lastname", c.LastName,
          new XComment("nice name")
        )
      )
  );
```

(ุงู ููุถูุน ุฑุง ุจุนุฏุงู ุฏุฑ ููู ูุตู ุฏุฑ ุจุฎุด ยซูพุฑูุฌฺฉุช ฺฉุฑุฏู ุจู ุฏุงุฎู ฺฉ X-DOMยป ุจุฑุฑุณ ูโฺฉูู.)

---

### ุชุนู ูุญุชูุง (Specifying Content)

ุณุงุฎุชุงุฑ ุชุงุจุน ุงูฺฉุงูโูพุฐุฑ ุงุณุช ฺูู ุณุงุฒูุฏูโูุง **XElement** (ู **XDocument**) ุทูุฑ overload ุดุฏูโุงูุฏ ฺฉู ฺฉ `params object[]` ุฑุง ุจูพุฐุฑูุฏ:

```csharp
public XElement (XName name, params object[] content)
```

ููู ููุถูุน ุจุฑุง ูุชุฏ **Add** ุฏุฑ **XContainer** ูุฒ ุตุฏู ูโฺฉูุฏ:

```csharp
public void Add (params object[] content)
```

ุจูุงุจุฑุงูุ ููฺฏุงู ุณุงุฎุช ุง ุงุถุงูู ฺฉุฑุฏู ุจู ฺฉ X-DOM ูโุชูุงูุฏ ูุฑ ุชุนุฏุงุฏ ุดุก ุจุง ูุฑ ููุน ุฑุง ุจูโุนููุงู ูุฑุฒูุฏ ูุดุฎุต ฺฉูุฏ. ุฏูู ุงู ฺฉุงุฑ ุงู ุงุณุช ฺฉู ูุฑ ฺุฒ ูโุชูุงูุฏ ูุญุชูุง ูุงููู ุจุงุดุฏ. ุฏุฑ ุงูุฌุง ุชุตููุงุช ฺฉู **XContainer** ุจุฑุง ูพุฑุฏุงุฒุด ูุฑ ุดุก ูโฺฏุฑุฏ ุขูุฏู ุงุณุช:

1. ุงฺฏุฑ ุดุก **null** ุจุงุดุฏุ ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ.
2. ุงฺฏุฑ ุดุก ุงุฒ ููุน **XNode** ุง **XStreamingElement** ุจุงุดุฏุ ูุณุชููุงู ุจู ฺฉุงูฺฉุดู **Nodes** ุงุถุงูู ูโุดูุฏ.
3. ุงฺฏุฑ ุดุก ฺฉ **XAttribute** ุจุงุดุฏุ ุจู ฺฉุงูฺฉุดู **Attributes** ุงุถุงูู ูโุดูุฏ.
4. ุงฺฏุฑ ุดุก ฺฉ **string** ุจุงุดุฏุ ุฏุฑ ฺฉ **XText** ูุฑุงุฑ ฺฏุฑูุชู ู ุจู **Nodes** ุงูุฒูุฏู ูโุดูุฏ.
5. ุงฺฏุฑ ุดุก ุงุฒ **IEnumerable** ูพุฑู ฺฉูุฏุ ุงุนุถุง ุขู ูพูุงุด ุดุฏู ู ููู ููุงูู ุฑู ูุฑ ุนุถู ุงุนูุงู ูโุดูุฏ.
6. ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ุดุก ุจู ุฑุดุชู ุชุจุฏู ุดุฏูุ ุฏุฑ ฺฉ **XText** ูุฑุงุฑ ฺฏุฑูุชู ู ุจู **Nodes** ุงุถุงูู ูโุดูุฏ.

> ูฺฉุชู: X-DOM ุงู ูุฑุญูู ุฑุง ุจูููโุณุงุฒ ูโฺฉูุฏ ู ูุญุชูุง ูุชู ุณุงุฏู ุฑุง ุฏุฑ ฺฉ **string** ุฐุฎุฑู ูโฺฉูุฏ. ููุฏ **XText** ูุงูุนุงู ุณุงุฎุชู ููโุดูุฏ ุชุง ููุช ฺฉู ูุชุฏ **Nodes()** ุฑุง ุฑู XContainer ูุฑุงุฎูุงู ฺฉูุฏ.

ุฏุฑ ููุงุชุ ููู ฺุฒ ุง ุฏุฑ **Nodes** ูุฑุงุฑ ูโฺฏุฑุฏ ุง ุฏุฑ **Attributes**.

ูพุด ุงุฒ ุตุฏุง ุฒุฏู **ToString** ุฑู ฺฉ ููุน ุฏูุฎูุงูุ **XContainer** ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ุงุฒ ุงููุงุน ุฒุฑ ูุณุช ุง ุฎุฑ:

* `float, double, decimal, bool, DateTime, DateTimeOffset, TimeSpan`

ุงฺฏุฑ ฺูู ุจุงุดุฏุ ุจูโุฌุง **ToString** ูุนูููุ ูุชุฏ ููุงุณุจ **XmlConvert** ูุฑุงุฎูุงู ูโุดูุฏ ุชุง ุฏุงุฏูโูุง ูุงุจูุช **round-trip** ุฏุงุดุชู ุจุงุดูุฏ ู ุจุง ููุงูู ุงุณุชุงูุฏุงุฑุฏ XML ุณุงุฒฺฏุงุฑ ุจุงุดูุฏ.

---

### ฺฉูููโฺฏุฑ ุนูู ุฎูุฏฺฉุงุฑ (Automatic Deep Cloning)

ููุช ฺฉ ููุฏ ุง attribute ุจู ฺฉ element ุงุถุงูู ูโุดูุฏ (ฺู ุงุฒ ุทุฑู ุณุงุฎุชุงุฑ ุชุงุจุน ุง ูุชุฏ **Add**)ุ ุฎุงุตุช **Parent** ุขู ููุฏ ุง attribute ุจู ุขู ุนูุตุฑ ุชูุธู ูโุดูุฏ.
ุงุฒ ุขูุฌุง ฺฉู ูุฑ ููุฏ ููุท ูโุชูุงูุฏ ฺฉ ูุงูุฏ ุฏุงุดุชู ุจุงุดุฏุ ุงฺฏุฑ ฺฉ ููุฏู ูุงูุฏุฏุงุฑ ุฑุง ุจู ูุงูุฏ ุฏฺฏุฑ ุงุถุงูู ฺฉูุฏุ ุขู ููุฏ ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ **ฺฉููู ุนูู (deep clone)** ูโุดูุฏ.

ูุซุงู:

```csharp
var address = new XElement("address",
                 new XElement("street", "Lawley St"),
                 new XElement("town", "North Beach")
             );

var customer1 = new XElement("customer1", address);
var customer2 = new XElement("customer2", address);

customer1.Element("address").Element("street").Value = "Another St";

Console.WriteLine(
  customer2.Element("address").Element("street").Value);   // Lawley St
```

ุงู ุชฺฉุซุฑ ุฎูุฏฺฉุงุฑ ุจุงุนุซ ูโุดูุฏ ูููููโุณุงุฒ X-DOM ุจุฏูู **side effect** ุจุงุดุฏ โ ฺฉู ฺฉ ุฏฺฏุฑ ุงุฒ ูฺฺฏโูุง ฺฉูุฏ ุจุฑูุงููโููุณ ุชุงุจุน ุงุณุช. โ

ูพูุงุด ู ฺฉูุฆุฑโฺฏุฑ (Navigating and Querying)
ููุงูโุทูุฑ ฺฉู ุงูุชุธุงุฑ ุฏุงุฑุฏุ ฺฉูุงุณโูุง **XNode** ู **XContainer** ูุชุฏูุง ู ูฺฺฏโูุง ุจุฑุง ูพูุงุด ุฏุฑุฎุช X-DOM ุชุนุฑู ูโฺฉููุฏ. ุงูุง ุจุฑุฎูุงู ฺฉ DOM ุณูุชุ ุงู ุชูุงุจุน ูุฌููุนูโุง ฺฉู **IList<T>** ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ ุจุฑููโฺฏุฑุฏุงููุฏ. ุฏุฑ ุนูุถุ ุง ฺฉ ููุฏุงุฑ ูููุฑุฏ ุง ฺฉ ุฏูุจุงูู (sequence) ฺฉู **IEnumerable<T>** ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ ุจุฑูโฺฏุฑุฏุงููุฏ โ ู ุดูุง ุงูุชุธุงุฑ ูโุฑูุฏ ฺฉู ุฑู ุขู ุง ฺฉ ฺฉูุฆุฑ LINQ ุงุฌุฑุง ฺฉูุฏ ุง ุจุง ฺฉ **foreach** ูพูุงุด ฺฉูุฏ.

ุงู ููุถูุน ุงูฺฉุงู ุงุฌุฑุง ฺฉูุฆุฑโูุง ูพุดุฑูุชู ุฑุง ุฏุฑ ฺฉูุงุฑ ูุธุงู ุณุงุฏูโ ูพูุงุดุ ุจุง ุงุณุชูุงุฏู ุงุฒ ููุงู ุณูุชฺฉุณ ุขุดูุง LINQุ ูุฑุงูู ูโฺฉูุฏ. โ

---

> **ูฺฉุชู:** ููุงููุฏ XMLุ ุฏุฑ X-DOM ูุงู ุนูุงุตุฑ (Element) ู ุตูุงุช (Attribute) **ุญุณุงุณ ุจู ุญุฑูู ฺฉูฺฺฉ ู ุจุฒุฑฺฏ** ูุณุชูุฏ.

---

### ูพูุงุด ููุฏูุง ูุฑุฒูุฏ (Child Node Navigation)

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/10/Table-10-3.jpeg)
</div>

ุชุงุจุนโูุง ฺฉู ุฏุฑ ุณุชูู ุณูู ุฌุฏูู (ุงูุฌุง ู ุฏุฑ ุฌุฏููโูุง ุฏฺฏุฑ) ุจุง ฺฉ ุณุชุงุฑู (\*) ุนูุงูุชโฺฏุฐุงุฑ ุดุฏูโุงูุฏุ ุฑู ุฏูุจุงููโูุง ุงุฒ ููุงู ููุน ูู ุนูู ูโฺฉููุฏ.
ุจุฑุง ูุซุงูุ ูโุชูุงูุฏ ูุชุฏ **Nodes** ุฑุง ูู ุฑู ฺฉ ุดุก **XContainer** ู ูู ุฑู ฺฉ ุฏูุจุงูู ุงุฒ ุงุดุงุก **XContainer** ูุฑุงุฎูุงู ฺฉูุฏ. ุงู ูุงุจูุช ุจู ูุทู **extension method**ูุง ุงุณุช ฺฉู ุฏุฑ ูุถุง ูุงู **System.Xml.Linq** ุชุนุฑู ุดุฏูโุงูุฏโุนู ููุงู **ุนููฺฏุฑูุง ฺฉูฺฉ ฺฉูุฆุฑ** ฺฉู ุฏุฑ ุจุฎุด ูุฑูุฑ (overview) ุฏุฑุจุงุฑูโุดุงู ุตุญุจุช ฺฉุฑุฏู.

---

### ๐ข FirstNodeุ LastNode ู Nodes

* **FirstNode** ู **LastNode** ุฏุณุชุฑุณ ูุณุชูู ุจู ุงููู ุง ุขุฎุฑู ููุฏ ูุฑุฒูุฏ ูโุฏููุฏ.
* **Nodes** ูููโ ูุฑุฒูุฏูุง ุฑุง ุจู ุตูุฑุช ฺฉ ุฏูุจุงูู (sequence) ุจุฑูโฺฏุฑุฏุงูุฏ.

ูุฑ ุณู ุงู ุชุงุจุนโูุง ููุท ูุฑุฒูุฏุงู ูุณุชูู (direct descendants) ุฑุง ุฏุฑ ูุธุฑ ูโฺฏุฑูุฏ:

```csharp
var bench = new XElement ("bench",
              new XElement ("toolbox",
                new XElement ("handtool", "Hammer"),
                new XElement ("handtool", "Rasp")
              ),
              new XElement ("toolbox",
                new XElement ("handtool", "Saw"),
                new XElement ("powertool", "Nailgun")
              ),
              new XComment ("Be careful with the nailgun")
            );

foreach (XNode node in bench.Nodes())
  Console.WriteLine (node.ToString (SaveOptions.DisableFormatting) + ".");
```

๐น ุฎุฑูุฌ ฺฉุฏ ุจุงูุง:

```
<toolbox><handtool>Hammer</handtool><handtool>Rasp</handtool></toolbox>.
<toolbox><handtool>Saw</handtool><powertool>Nailgun</powertool></toolbox>.
<!--Be careful with the nailgun-->.
```

---

### ๐ข ุจุงุฒุงุจ ุนูุงุตุฑ (Retrieving elements)

ูุชุฏ **Elements** ููุท ููุฏูุง ูุฑุฒูุฏ ุงุฒ ููุน **XElement** ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ:

```csharp
foreach (XElement e in bench.Elements())
  Console.WriteLine (e.Name + "=" + e.Value);
// toolbox=HammerRasp
// toolbox=SawNailgun
```

๐น ฺฉูุฆุฑ ุฒุฑ ุฌุนุจูโุงุจุฒุงุฑ (**toolbox**) ุฑุง ูพุฏุง ูโฺฉูุฏ ฺฉู ุฏุฑููุด ุงุจุฒุงุฑ **Nailgun** ูุฌูุฏ ุฏุงุฑุฏ:

```csharp
IEnumerable<string> query =
  from toolbox in bench.Elements()
  where toolbox.Elements().Any (tool => tool.Value == "Nailgun")
  select toolbox.Value;

// RESULT: { "SawNailgun" }
```

๐น ุฏุฑ ูุซุงู ุจุนุฏ ุงุฒ **SelectMany** ุงุณุชูุงุฏู ูโฺฉูู ุชุง ุงุจุฒุงุฑูุง ุฏุณุช (**handtool**) ูููโ ุฌุนุจูโุงุจุฒุงุฑูุง ุฑุง ุจูโุฏุณุช ุจุงูุฑู:

```csharp
IEnumerable<string> query =
  from toolbox in bench.Elements()
  from tool in toolbox.Elements()
  where tool.Name == "handtool"
  select tool.Value;

// RESULT: { "Hammer", "Rasp", "Saw" }
```

---

### ๐ข ูฺฉุชู ุฏุฑุจุงุฑู Elements

* ูุชุฏ **Elements** ูุนุงุฏู ฺฉ ฺฉูุฆุฑ LINQ ุฑู **Nodes** ุงุณุช.
  ูุซูุงู ฺฉูุฆุฑ ูุจู ูโุชูุงูุณุช ุงูโุทูุฑ ุดุฑูุน ุดูุฏ:

```csharp
from toolbox in bench.Nodes().OfType<XElement>()
where ...
```

* ูุชุฏ **Elements** ูโุชูุงูุฏ ููุท ุนูุงุตุฑ ุจุง ฺฉ ูุงู ูุดุฎุต ุฑุง ูู ุจุฑฺฏุฑุฏุงูุฏ:

```csharp
int x = bench.Elements("toolbox").Count();    // 2
```

ุงู ฺฉุฏ ูุนุงุฏู ุงุณุช ุจุง:

```csharp
int x = bench.Elements().Where (e => e.Name == "toolbox").Count();  // 2
```

* ูุชุฏ **Elements** ุจูโุนููุงู ฺฉ **extension method** ูู ุชุนุฑู ุดุฏู ฺฉู ฺฉ **IEnumerable<XContainer>** (ุง ุฏููโุชุฑ: `IEnumerable<T> where T : XContainer`) ูโูพุฐุฑุฏ.
  ุจู ููู ุฏููุ ูโุชูุงูุฏ ุฑู ุฏูุจุงููโุง ุงุฒ ุนูุงุตุฑ ูู ฺฉุงุฑ ฺฉูุฏ.

ูุซุงู ุจุงุฒููุณโุดุฏู ุจุฑุง ุงูุชู ุงุจุฒุงุฑูุง ุฏุณุช:

```csharp
from tool in bench.Elements("toolbox").Elements("handtool")
select tool.Value;
```

๐น ุฏุฑ ุงูุฌุง:

* ูุฑุงุฎูุงู ุงูู **Elements** ุจู ูุชุฏ ูููููโุง (instance method) ุฏุฑ **XContainer** ูุชุตู ูโุดูุฏ.
* ูุฑุงุฎูุงู ุฏูู **Elements** ุจู ูุชุฏ ุชูุณุนูโุง (extension method) ูุชุตู ูโุดูุฏ.

### ุจุงุฒุงุจ ฺฉ ุนูุตุฑ ูููุฑุฏ (Retrieving a Single Element)

ูุชุฏ **Element** (ุชฺฉโุฌูุน) ุงููู ุนูุตุฑ ูุทุงุจู ุจุง ูุงู ุฏุงุฏูโุดุฏู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.
ุงู ูุชุฏ ุจุฑุง ูพูุงุด ุณุงุฏู ููุฏ ุงุณุชุ ูุงููุฏ ูุซุงู ุฒุฑ:

```csharp
XElement settings = XElement.Load("databaseSettings.xml");
string cx = settings.Element("database").Element("connectString").Value;
```

ูุชุฏ **Element** ูุนุงุฏู ูุฑุงุฎูุงู **Elements()** ู ุณูพุณ ุงุนูุงู **FirstOrDefault** ุจุง ฺฉ predicate ุจุฑุง ูุทุงุจูุช ูุงู ุงุณุช.
ุงฺฏุฑ ุนูุตุฑ ุฏุฑุฎูุงุณุชโุดุฏู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ **Element** ููุฏุงุฑ **null** ุจุฑูโฺฏุฑุฏุงูุฏ.

> ุชูุฌู: ูุฑุงุฎูุงู `Element("xyz").Value` ุฒูุงู ฺฉู ุนูุตุฑ `xyz` ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ุจุงุนุซ **NullReferenceException** ูโุดูุฏ.
> ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงุณุชุซูุง ูโุชูุงูุฏ ุงุฒ **null-conditional operator** ุงุณุชูุงุฏู ฺฉูุฏ:

```csharp
Element("xyz")?.Value
```

ุง ุนูุตุฑ **XElement** ุฑุง ูุณุชููุงู ุจู **string** ุชุจุฏู ฺฉูุฏ:

```csharp
string xyz = (string)settings.Element("xyz");
```

ุงู ฺฉุงุฑ ุงูฺฉุงูโูพุฐุฑ ุงุณุช ฺูู **XElement** ฺฉ ุชุจุฏู ุตุฑุญ ุจู ุฑุดุชู (explicit string conversion) ุชุนุฑู ฺฉุฑุฏู ุงุณุช. โ

---

### ุจุงุฒุงุจ ูุฑุฒูุฏุงู ู ูููโูุง (Retrieving Descendants)

ฺฉูุงุณ **XContainer** ููฺูู ูุชุฏูุง **Descendants** ู **DescendantNodes** ุฑุง ุงุฑุงุฆู ูโุฏูุฏ ฺฉู ุนูุงุตุฑ ุง ููุฏูุง ูุฑุฒูุฏ ู ุชูุงู ูุฑุฒูุฏุงู ุขูโูุง (ฺฉู ุฏุฑุฎุช) ุฑุง ุจุฑูโฺฏุฑุฏุงููุฏ.
ูุชุฏ **Descendants** ฺฉ ูุงู ุนูุตุฑ ุงุฎุชุงุฑ ูู ูโูพุฐุฑุฏ.

ูุซุงู:

```csharp
Console.WriteLine(bench.Descendants("handtool").Count());  // 3
```

ูู ูุงูุฏูุง ู ูู ุจุฑฺฏโูุง ุดุงูู ูโุดููุฏุ ููุงูโุทูุฑ ฺฉู ูุซุงู ุฒุฑ ูุดุงู ูโุฏูุฏ:

```csharp
foreach (XNode node in bench.DescendantNodes())
  Console.WriteLine(node.ToString(SaveOptions.DisableFormatting));
```

๐น ุฎุฑูุฌ:

```
<toolbox><handtool>Hammer</handtool><handtool>Rasp</handtool></toolbox>
<handtool>Hammer</handtool>
Hammer
<handtool>Rasp</handtool>
Rasp
<toolbox><handtool>Saw</handtool><powertool>Nailgun</powertool></toolbox>
<handtool>Saw</handtool>
Saw
<powertool>Nailgun</powertool>
Nailgun
<!--Be careful with the nailgun-->
```

ฺฉูุฆุฑ ุจุนุฏ ุชูุงู **comment**ูุง ุฏุงุฎู X-DOM ฺฉู ุดุงูู ฺฉูููโ "careful" ูุณุชูุฏ ุฑุง ุงุณุชุฎุฑุงุฌ ูโฺฉูุฏ:

```csharp
IEnumerable<string> query =
  from c in bench.DescendantNodes().OfType<XComment>()
  where c.Value.Contains("careful")
  orderby c.Value
  select c.Value;
```

---

### ูพูุงุด ูุงูุฏู (Parent Navigation)

ุชูุงู **XNode**ูุง ุฏุงุฑุง ุฎุตูุตุช **Parent** ู ูุชุฏูุง **AncestorXXX** ุจุฑุง ูพูุงุด ูุงูุฏู ูุณุชูุฏ.
ฺฉ ูุงูุฏ ููุดู ุงุฒ ููุน **XElement** ุงุณุช.
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/10/Table-10-4.jpeg)
</div>

ุงฺฏุฑ **x** ฺฉ **XElement** ุจุงุดุฏุ ฺฉุฏ ุฒุฑ ููุดู ููุฏุงุฑ **true** ฺุงูพ ูโฺฉูุฏ:

```csharp
foreach (XNode child in x.Nodes())
  Console.WriteLine(child.Parent == x);
```

ุจุง ุงู ุญุงูุ ุงู ููุถูุน ุฏุฑ ููุฑุฏ **XDocument** ุตุงุฏู ูุณุช. **XDocument** ฺฉู ูุชูุงูุช ุงุณุช: ูโุชูุงูุฏ ูุฑุฒูุฏ ุฏุงุดุชู ุจุงุดุฏ ุงูุง ูุฑฺฏุฒ ููโุชูุงูุฏ ูุงูุฏ ูฺ ููุฏ ุจุงุดุฏ!

ุจุฑุง ุฏุณุชุฑุณ ุจู **XDocument**ุ ุจุงุฏ ุงุฒ ุฎุตูุตุช **Document** ุงุณุชูุงุฏู ฺฉูุฏุ ุงู ูฺฺฏ ุฑู ูุฑ ุดุก ุฏุฑ ุฏุฑุฎุช X-DOM ฺฉุงุฑ ูโฺฉูุฏ.

---

### ูพูุงุด ูุงูุฏู (Ancestors)

* ูุชุฏ **Ancestors** ฺฉ ุฏูุจุงูู ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู ุงููู ุนูุตุฑ ุขู **Parent** ุงุณุชุ ุนูุตุฑ ุจุนุฏ **Parent.Parent** ู ุจู ููู ุชุฑุชุจ ุชุง ุฑุณุฏู ุจู ุนูุตุฑ ุฑุดู ุงุฏุงูู ุฏุงุฑุฏ.
* ูโุชูุงูุฏ ุจุง ฺฉูุฆุฑ LINQ ุฒุฑ ุจู ุนูุตุฑ ุฑุดู ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏ:

```csharp
AncestorsAndSelf().Last();
```

* ุฑูุด ุฏฺฏุฑ ุจุฑุง ุฑุณุฏู ุจู ุนูุตุฑ ุฑุดู ุงู ุงุณุช ฺฉู ุงุฒ **Document.Root** ุงุณุชูุงุฏู ฺฉูุฏุ ุงูุจุชู ุงู ููุท ุฒูุงู ฺฉุงุฑ ูโฺฉูุฏ ฺฉู ฺฉ **XDocument** ููุฌูุฏ ุจุงุดุฏ.

---

### ูพูุงุด ููุฏูุง ููโุณุทุญ (Peer Node Navigation)

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/10/Table-10-5.jpeg)
</div>

ุจุง **PreviousNode** ู **NextNode** (ู ููฺูู **FirstNode** ู **LastNode**) ูโุชูุงูุฏ ููุฏูุง ุฑุง ูุงููุฏ ฺฉ **ูุณุช ูพููุฏ (linked list)** ูพูุงุด ฺฉูุฏ.
ุงู ุงุชูุงู ุชุตุงุฏู ูุณุช: ุฏุฑ ุณุทุญ ุฏุงุฎูุ ููุฏูุง ุฏุฑ ฺฉ **ูุณุช ูพููุฏ** ุฐุฎุฑู ูโุดููุฏ.

> ุชูุฌู: **XNode** ุงุฒ ฺฉ ูุณุช ูพููุฏ ุชฺฉโุฌูุชู ุงุณุชูุงุฏู ูโฺฉูุฏุ ุจูุงุจุฑุงู **PreviousNode** ุนููฺฉุฑุฏ ฺูุฏุงู ุจูููโุง ูุฏุงุฑุฏ.

---

### ูพูุงุด ุตูุงุช (Attribute Navigation)

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/10/Table-10-6.jpeg)
</div>

ุนูุงูู ุจุฑ ุงูุ **XAttribute** ุฎุตูุตุงุช **PreviousAttribute** ู **NextAttribute** ุฑุง ุชุนุฑู ูโฺฉูุฏ ู ููฺูู **Parent** ุฑุง ุฏุงุฑุฏ.

ูุชุฏ **Attributes** ฺฉู ฺฉ ูุงู ุฑุง ูโูพุฐุฑุฏุ ฺฉ ุฏูุจุงูู ุจุง ุตูุฑ ุง ฺฉ ุนูุตุฑ ุจุฑูโฺฏุฑุฏุงูุฏุ ุฒุฑุง ฺฉ ุนูุตุฑ ููโุชูุงูุฏ ุฏุฑ XML ุตูุงุช ุจุง ูุงูโูุง ุชฺฉุฑุงุฑ ุฏุงุดุชู ุจุงุดุฏ. โ

---

### ุจูโุฑูุฒุฑุณุงู X-DOM (Updating an X-DOM)

ูโุชูุงูุฏ ุนูุงุตุฑ ู ุตูุงุช ุฑุง ุจู ุฑูุดโูุง ุฒุฑ ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ:

* ูุฑุงุฎูุงู **SetValue** ุง ุงุฎุชุตุงุต ุฏูุจุงุฑู ุจู ุฎุตูุตุช **Value**.
* ูุฑุงุฎูุงู **SetElementValue** ุง **SetAttributeValue**.
* ูุฑุงุฎูุงู ฺฉ ุงุฒ ูุชุฏูุง **RemoveXXX**.
* ูุฑุงุฎูุงู ฺฉ ุงุฒ ูุชุฏูุง **AddXXX** ุง **ReplaceXXX** ู ูุดุฎุต ฺฉุฑุฏู ูุญุชูุง ุฌุฏุฏ.

ููฺูู ูโุชูุงูุฏ ุฎุตูุตุช **Name** ุฑุง ุฑู ุงุดุงุก **XElement** ุฏูุจุงุฑู ุงุฎุชุตุงุต ุฏูุฏ.

---

### ุจูโุฑูุฒุฑุณุงู ุณุงุฏู ููุงุฏุฑ (Simple Value Updates)

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/10/Table-10-7.jpeg)
</div>

ูุชุฏ **SetValue** ูุญุชูุง ฺฉ ุนูุตุฑ ุง ุตูุช ุฑุง ุจุง ฺฉ ููุฏุงุฑ ุณุงุฏู ุฌุงฺฏุฒู ูโฺฉูุฏ.
ุงุฎุชุตุงุต ููุฏุงุฑ ุจู ุฎุตูุตุช **Value** ูุฒ ููู ฺฉุงุฑ ุฑุง ุงูุฌุงู ูโุฏูุฏุ ุงูุง ููุท ุฏุงุฏูโูุง ุฑุดุชูโุง (**string**) ุฑุง ูโูพุฐุฑุฏ.
ูุฑ ุฏู ุงู ุชูุงุจุน ุจูโุทูุฑ ุฏููโุชุฑ ุฏุฑ ุจุฎุด ยซWorking with Valuesยป ุฏุฑ ุตูุญู 537 ุชูุถุญ ุฏุงุฏู ุดุฏูโุงูุฏ. โ

ฺฉ ุงุฒ ุงุซุฑุงุช ูุฑุงุฎูุงู **SetValue** (ุง ุงุฎุชุตุงุต ุฏูุจุงุฑู ุจู **Value**) ุงู ุงุณุช ฺฉู **ุชูุงู ููุฏูุง ูุฑุฒูุฏ ุฑุง ุฌุงฺฏุฒู ูโฺฉูุฏ**:

```csharp
XElement settings = new XElement("settings",
                      new XElement("timeout", 30)
                    );

settings.SetValue("blah");
Console.WriteLine(settings.ToString());  // <settings>blah</settings>
```

---

### ุจูโุฑูุฒุฑุณุงู ููุฏูุง ูุฑุฒูุฏ ู ุตูุงุช (Updating Child Nodes and Attributes)

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/10/Table-10-8.jpeg)
</div>

ุฑุงุญุชโุชุฑู ูุชุฏูุง ุฏุฑ ุงู ฺฏุฑููุ ุฏู ูุชุฏ ุขุฎุฑ ุนู **SetElementValue** ู **SetAttributeValue** ูุณุชูุฏ.
ุงู ูุชุฏูุง ุจูโุนููุงู **ูุงูโุจุฑ** ุจุฑุง ุงุฌุงุฏ ฺฉ **XElement** ุง **XAttribute** ู ุณูพุณ **ุงูุฒูุฏู ุขู ุจู ูุงูุฏ** ุนูู ูโฺฉููุฏุ ู ุฏุฑ ุตูุฑุช ูุฌูุฏ ุนูุตุฑ ุง ุตูุช ุจุง ููุงู ูุงูุ ุขู ุฑุง ุฌุงฺฏุฒู ูโฺฉููุฏ:

```csharp
XElement settings = new XElement("settings");

settings.SetElementValue("timeout", 30);  // ุงูุฒูุฏู ููุฏ ูุฑุฒูุฏ
settings.SetElementValue("timeout", 60);  // ุจูโุฑูุฒุฑุณุงู ุจู 60
```

* ูุชุฏ **Add** ฺฉ ููุฏ ูุฑุฒูุฏ ุจู ฺฉ ุนูุตุฑ ุง ุณูุฏ ุงุถุงูู ูโฺฉูุฏ.

* ูุชุฏ **AddFirst** ููู ฺฉุงุฑ ุฑุง ุงูุฌุงู ูโุฏูุฏ ุงูุง ุฏุฑ ุงุจุชุฏุง ูุฌููุนู ุงุถุงูู ูโฺฉูุฏุ ูู ุฏุฑ ุงูุชูุง.

* ูโุชูุงูุฏ ุชูุงู ููุฏูุง ูุฑุฒูุฏ ุง ุตูุงุช ุฑุง ฺฉุฌุง ุจุง **RemoveNodes** ุง **RemoveAttributes** ุญุฐู ฺฉูุฏ.

* **RemoveAll** ูุนุงุฏู ูุฑุงุฎูุงู ูุฑ ุฏู ูุชุฏ ุงุณุช.

* ูุชุฏูุง **ReplaceXXX** ูุนุงุฏู ุญุฐู ู ุณูพุณ ุงูุฒูุฏู ูุณุชูุฏ. ุงู ูุชุฏูุง ุงุฒ ูุฑูุฏ **snapshot** ูโฺฏุฑูุฏุ ุจูุงุจุฑุงู ูุฑุงุฎูุงูโุง ูุงููุฏ:

```csharp
e.ReplaceNodes(e.Nodes())
```

ุจูโุทูุฑ ููุฑุฏ ุงูุชุธุงุฑ ุนูู ูโฺฉูุฏ.

---

### ุจูโุฑูุฒุฑุณุงู ุงุฒ ุทุฑู ูุงูุฏ (Updating Through the Parent)

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/10/Table-10-9.jpeg)
</div>

ูุชุฏูุง **AddBeforeSelf**ุ **AddAfterSelf**ุ **Remove** ู **ReplaceWith** ุฑู ูุฑุฒูุฏุงู ููุฏ ุนูู ููโฺฉููุฏ.
ุฏุฑ ุนูุถุ ุงู ูุชุฏูุง ุฑู **ูุฌููุนูโุง ฺฉู ุฎูุฏ ููุฏ ุฏุฑ ุขู ูุฑุงุฑ ุฏุงุฑุฏ** ุนูู ูโฺฉููุฏ.
ุจุฑุง ุงู ฺฉุงุฑุ ููุฏ ุจุงุฏ ุฏุงุฑุง **ูุงูุฏ (Parent)** ุจุงุดุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ฺฉ ุงุณุชุซูุง (exception) ุงุฌุงุฏ ูโุดูุฏ.

* **AddBeforeSelf** ู **AddAfterSelf** ุจุฑุง ุฏุฑุฌ ฺฉ ููุฏ ุฏุฑ **ูููุนุช ุฏูุฎูุงู** ููุฏ ูุณุชูุฏ:

```csharp
XElement items = new XElement("items",
                   new XElement("one"),
                   new XElement("three")
                 );

items.FirstNode.AddAfterSelf(new XElement("two"));
```

๐น ูุชุฌู:

```xml
<items><one /><two /><three /></items>
```

ุฏุฑุฌ ุฏุฑ ฺฉ ูููุนุช ุฏูุฎูุงู ุฏุฑ ฺฉ ุฏูุจุงูู ุทููุงู ุงุฒ ุนูุงุตุฑ **ฺฉุงุฑุขูุฏ** ุงุณุช ุฒุฑุง ููุฏูุง ุจูโุตูุฑุช ุฏุงุฎู ุฏุฑ ฺฉ **ูุณุช ูพููุฏ** ุฐุฎุฑู ุดุฏูโุงูุฏ.

* ูุชุฏ **Remove** ููุฏ ุฌุงุฑ ุฑุง ุงุฒ ูุงูุฏ ุฎูุฏ ุญุฐู ูโฺฉูุฏ.
* ูุชุฏ **ReplaceWith** ููู ฺฉุงุฑ ุฑุง ุงูุฌุงู ูโุฏูุฏ ู ุณูพุณ ูุญุชูุง ุฏฺฏุฑ ุฑุง ุฏุฑ ููุงู ูููุนุช ุฏุฑุฌ ูโฺฉูุฏ:

```csharp
XElement items = XElement.Parse("<items><one/><two/><three/></items>");
items.FirstNode.ReplaceWith(new XComment("One was here"));
```

๐น ูุชุฌู:

```xml
<items><!--One was here--><two /><three /></items>
```

---

### ุญุฐู ฺฉ ุฏูุจุงูู ุงุฒ ููุฏูุง ุง ุตูุงุช (Removing a Sequence of Nodes or Attributes)

ุจู ูุทู **extension method**ูุง ููุฌูุฏ ุฏุฑ **System.Xml.Linq**ุ ูโุชูุงูุฏ ูุชุฏ **Remove** ุฑุง ุฑู ฺฉ ุฏูุจุงูู ุงุฒ ููุฏูุง ุง ุตูุงุช ูู ูุฑุงุฎูุงู ฺฉูุฏ.

ูุซุงู X-DOM:

```csharp
XElement contacts = XElement.Parse(
@"<contacts>
    <customer name='Mary'/>
    <customer name='Chris' archived='true'/>
    <supplier name='Susan'>
      <phone archived='true'>012345678<!--confidential--></phone>
    </supplier>
</contacts>");
```

* ุญุฐู ุชูุงู ูุดุชุฑุงู:

```csharp
contacts.Elements("customer").Remove();
```

* ุญุฐู ุชูุงู ุนูุงุตุฑ ุขุฑุดู ุดุฏู (Chris ุญุฐู ูโุดูุฏ):

```csharp
contacts.Elements()
        .Where(e => (bool?) e.Attribute("archived") == true)
        .Remove();
```

* ุงฺฏุฑ **Elements()** ุฑุง ุจุง **Descendants()** ุฌุงฺฏุฒู ฺฉููุ ุชูุงู ุนูุงุตุฑ ุขุฑุดู ุดุฏู ุฏุฑ ฺฉู DOM ุญุฐู ูโุดููุฏุ ู ูุชุฌู ุงู ุฎูุงูุฏ ุจูุฏ:

```xml
<contacts>
  <customer name="Mary" />
  <supplier name="Susan" />
</contacts>
```

* ูุซุงู ุจุนุฏุ ุญุฐู ุชูุงู ุชูุงุณโูุง ฺฉู ุฏุฑ ูุฑ ุฌุง ุฏุฑุฎุช ฺฉุงููุช "confidential" ุฏุงุฑูุฏ:

```csharp
contacts.Elements()
        .Where(e => e.DescendantNodes()
                     .OfType<XComment>()
                     .Any(c => c.Value == "confidential"))
        .Remove();
```

๐น ูุชุฌู:

```xml
<contacts>
  <customer name="Mary" />
  <customer name="Chris" archived="true" />
</contacts>
```

* ููุงุณู ุจุง ฺฉูุฆุฑ ุณุงุฏูโุชุฑ ฺฉู ุชูุงู ููุฏูุง ฺฉุงููุช ุฑุง ุงุฒ ุฏุฑุฎุช ุญุฐู ูโฺฉูุฏ:

```csharp
contacts.DescendantNodes().OfType<XComment>().Remove();
```

> ุฏุฑ ุณุทุญ ุฏุงุฎูุ ูุชุฏ **Remove** ุงุจุชุฏุง ููู ุนูุงุตุฑ ูุทุงุจู ุฑุง ุฏุฑ ฺฉ ูุณุช ูููุช ูโุฎูุงูุฏ ู ุณูพุณ ุฑู ููุงู ูุณุช ูููุช ูพูุงุด ฺฉุฑุฏู ู ุญุฐู ุฑุง ุงูุฌุงู ูโุฏูุฏ.
> ุงู ฺฉุงุฑ ุงุฒ ุฎุทุงูุง ุฌููฺฏุฑ ูโฺฉูุฏ ฺฉู ููฺฉู ุงุณุช ููฺฏุงู **ุญุฐู ู ูพุฑุณโูุฌู ููุฒูุงู** ุฑุฎ ุฏููุฏ.
>
### ฺฉุงุฑ ุจุง ููุงุฏุฑ (Working with Values)

ูู **XElement** ู ูู **XAttribute** ุฏุงุฑุง ุฎุตูุตุช **Value** ุงุฒ ููุน **string** ูุณุชูุฏ.

* ุงฺฏุฑ ฺฉ ุนูุตุฑ ุชููุง ฺฉ ููุฏ ูุฑุฒูุฏ **XText** ุฏุงุดุชู ุจุงุดุฏุ ุฎุตูุตุช **Value** ุฏุฑ **XElement** ุจูโุนููุงู ฺฉ **ูุงูโุจุฑ ููุงุณุจ** ุจุฑุง ูุญุชูุง ุขู ููุฏ ุนูู ูโฺฉูุฏ.
* ุฏุฑ **XAttribute**ุ ุฎุตูุตุช **Value** ุตุฑูุงู ููุฏุงุฑ ุตูุช ุฑุง ูฺฏู ูโุฏุงุฑุฏ.

ุจุง ูุฌูุฏ ุชูุงูุชโูุง ุฐุฎุฑูโุณุงุฒุ **X-DOM** ูุฌููุนูโุง ฺฉููุงุฎุช ุงุฒ ุนููุงุช ุจุฑุง ฺฉุงุฑ ุจุง ููุงุฏุฑ ุนูุงุตุฑ ู ุตูุงุช ุงุฑุงุฆู ูโุฏูุฏ. โ

---

### ุงุฎุชุตุงุต ููุงุฏุฑ (Setting Values)

ุฏู ุฑูุด ุจุฑุง ุงุฎุชุตุงุต ููุฏุงุฑ ูุฌูุฏ ุฏุงุฑุฏ: ูุฑุงุฎูุงู **SetValue** ุง ุงุฎุชุตุงุต ุจู ุฎุตูุตุช **Value**.

* **SetValue** ุงูุนุทุงูโูพุฐุฑ ุจุดุชุฑ ุฏุงุฑุฏุ ุฒุฑุง ููุท ุฑุดุชู ุฑุง ููโูพุฐุฑุฏ ุจูฺฉู ุงููุงุน ุฏุงุฏู ุณุงุฏู ุฏฺฏุฑ ุฑุง ูุฒ ูุจูู ูโฺฉูุฏ:

```csharp
var e = new XElement("date", DateTime.Now);
e.SetValue(DateTime.Now.AddDays(1));
Console.Write(e.Value);  // 2019-10-02T16:39:10.734375+09:00
```

ูโุชูุงูุณุชู ุจู ุฌุง ุขูุ ูุณุชููุงู **Value** ุฑุง ุงุฎุชุตุงุต ุฏููุ ุงูุง ุฏุฑ ุงู ุตูุฑุช ูุฌุจูุฑ ุจูุฏู **DateTime** ุฑุง ุฏุณุช ุจู ุฑุดุชู ุชุจุฏู ฺฉูู ฺฉู ูพฺุฏูโุชุฑ ุงุณุช ู ูุงุฒ ุจู ุงุณุชูุงุฏู ุงุฒ **XmlConvert** ุจุฑุง ูุชุฌู ุณุงุฒฺฏุงุฑ ุจุง XML ุฏุงุฑุฏ.

* ููฺฏุงู ุงุฑุณุงู ููุฏุงุฑ ุจู ุณุงุฒูุฏู **XElement** ุง **XAttribute**ุ ุชุจุฏู ุฎูุฏฺฉุงุฑ ุจุฑุง ุงููุงุน ุบุฑุฑุดุชูโุง ูุฒ ุงูุฌุงู ูโุดูุฏ. ุงู ุงุทููุงู ูโุฏูุฏ ฺฉู:

  * **DateTime** ุจูโุฏุฑุณุช ูุฑูุช ูโุดูุฏ
  * **true** ุจุง ุญุฑูู ฺฉูฺฺฉ ููุดุชู ูโุดูุฏ
  * **double.NegativeInfinity** ุจู ุตูุฑุช "-INF" ููุดุชู ูโุดูุฏ

---

### ุจุงุฒุงุจ ููุงุฏุฑ (Getting Values)

ุจุฑุง ุจุฑุนฺฉุณ ฺฉุฑุฏูุ ุนู ุชุจุฏู **Value** ุจู ููุน ูพุงูุ ฺฉุงู ุงุณุช **XElement** ุง **XAttribute** ุฑุง ุจู ููุน ููุฑุฏ ูุธุฑ **cast** ฺฉูุฏ:

```csharp
XElement e = new XElement("now", DateTime.Now);
DateTime dt = (DateTime)e;

XAttribute a = new XAttribute("resolution", 1.234);
double res = (double)a;
```

* ุนูุงุตุฑ ุง ุตูุงุช ุจูโุทูุฑ ุจูู **DateTime** ุง ุงุนุฏุงุฏ ุฑุง ุฐุฎุฑู ููโฺฉููุฏุ ููุดู ุจูโุตูุฑุช ูุชู ุฐุฎุฑู ู ุฏุฑ ุตูุฑุช ูุงุฒ ุชุฌุฒู ูโุดููุฏ.
* ููุน ุงุตู ุฐุฎุฑู ุดุฏู ยซุจู ุงุฏ ููโูุงูุฏยปุ ุจูุงุจุฑุงู ุจุงุฏ **cast** ุฑุง ุจูโุฏุฑุณุช ุงูุฌุงู ุฏูุฏ ุชุง ุงุฒ ุฎุทุง ุฒูุงู ุงุฌุฑุง ุฌููฺฏุฑ ุดูุฏ.
* ุจุฑุง ุงุฌุงุฏ ฺฉุฏ ููุงููุ ูโุชูุงูุฏ **cast** ุฑุง ุฏุฑ ุจููฺฉ **try/catch** ูุฑุงุฑ ุฏูุฏ ู **FormatException** ุฑุง ูุฏุฑุช ฺฉูุฏ.

---

### ุงููุงุน ูพุดุชุจุงู ุดุฏู ุจุฑุง cast ุตุฑุญ

**XElement** ู **XAttribute** ูโุชูุงููุฏ ุจู ุงููุงุน ุฒุฑ cast ุดููุฏ:

* ุชูุงู ุงููุงุน ุนุฏุฏ ุงุณุชุงูุฏุงุฑุฏ

* **string**ุ **bool**ุ **DateTime**ุ **DateTimeOffset**ุ **TimeSpan**ุ ู **Guid**

* ูุณุฎูโูุง **Nullable<>** ุงุฒ ุงููุงุน ุจุงูุง

* ุงุณุชูุงุฏู ุงุฒ **nullable** ููุฏ ุงุณุช ููฺฏุงู ุงุณุชูุงุฏู ุงุฒ ูุชุฏูุง **Element** ู **Attribute**ุ ุฒุฑุง ุงฺฏุฑ ูุงู ููุฑุฏ ูุธุฑ ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ cast ูููุฒ ฺฉุงุฑ ูโฺฉูุฏ:

```csharp
int timeout = (int)x.Element("timeout");      // ุฎุทุง
int? timeout = (int?)x.Element("timeout");    // ุฏุฑุณุชุ timeout = null
```

* ูโุชูุงูุฏ ููุฏุงุฑ ูพุดโูุฑุถ ุฑุง ุจุง ุนููฺฏุฑ **??** ูุดุฎุต ฺฉูุฏ:

```csharp
double resolution = (double?)x.Attribute("resolution") ?? 1.0;
```

> ุชูุฌู: cast ุจู nullable ุดูุง ุฑุง ุงุฒ ุฎุทุง ุฏุฑ ุตูุฑุช ฺฉู ููุฏุงุฑ ุนูุตุฑ ุง ุตูุช ุฎุงู ุง ุจุง ูุฑูุช ูุงุฏุฑุณุช ุจุงุดุฏุ ูุฌุงุช ููโุฏูุฏ. ุฏุฑ ุงู ููุงุฑุฏ ุจุงุฏ **FormatException** ุฑุง ูุฏุฑุช ฺฉูุฏ.

---

### ุงุณุชูุงุฏู ุงุฒ cast ุฏุฑ ฺฉูุฆุฑโูุง LINQ

ูุซุงู: ุจุงุฒฺฏุฑุฏุงูุฏู ูุงู ูุดุชุฑุงู ฺฉู ุงุนุชุจุงุฑ ุจุงูุง 100 ุฏุงุฑูุฏ:

```csharp
var data = XElement.Parse(
@"<data>
      <customer id='1' name='Mary' credit='100' />
      <customer id='2' name='John' credit='150' />
      <customer id='3' name='Anne' />
</data>");

IEnumerable<string> query = from cust in data.Elements()
                            where (int?)cust.Attribute("credit") > 100
                            select cust.Attribute("name").Value;
```

* ุงุณุชูุงุฏู ุงุฒ **nullable int** ุงุฒ ุจุฑูุฒ **NullReferenceException** ุจุฑุง ูุดุชุฑโุง ูุซู Anne ฺฉู ุตูุช credit ูุฏุงุฑุฏ ุฌููฺฏุฑ ูโฺฉูุฏ.
* ุงุตูู ูุดุงุจู ุจุฑุง ูพุฑุณโูุฌู ุฑู ููุงุฏุฑ ุนูุงุตุฑ ูุฒ ุงุนูุงู ูโุดูุฏ.

---

### ููุงุฏุฑ ู ููุฏูุง ูุญุชูุง ุชุฑฺฉุจ (Values and Mixed Content Nodes)

ุฒูุงู ฺฉู ูุญุชูุง **ูุฎุชูุท** ุงุณุชุ ููฺฉู ุงุณุช ูุงุฒ ุจุงุดุฏ ูุณุชููุงู ุจุง **XText** ฺฉุงุฑ ฺฉูุฏ:

```xml
<summary>An XAttribute is <bold>not</bold> an XNode</summary>
```

* ุนูุตุฑ **summary** ุณู ูุฑุฒูุฏ ุฏุงุฑุฏ: **XText**ุ ุณูพุณ **XElement**ุ ุณูพุณ ุฏูุจุงุฑู **XText**.

ุณุงุฎุช ุขู:

```csharp
XElement summary = new XElement("summary",
                      new XText("An XAttribute is "),
                      new XElement("bold", "not"),
                      new XText(" an XNode"));
```

* ุฌุงูุจ ุงูุฌุงุณุช ฺฉู ูโุชูุงูู ูููุฒ **summary.Value** ุฑุง ฺฉูุฆุฑ ฺฉูู ุจุฏูู ุงุฌุงุฏ ุงุณุชุซูุงุ ุญุงุตู **ุชุฑฺฉุจ ููุงุฏุฑ ููู ูุฑุฒูุฏุงู** ุงุณุช:

```
An XAttribute is not an XNode
```

* ูโุชูุงู ููุฏุงุฑ **Value** ุฑุง ุฏูุจุงุฑู ุงุฎุชุตุงุต ุฏุงุฏุ ุงูุง ููู ูุฑุฒูุฏุงู ูุจู ุจุง ฺฉ ููุฏ **XText** ุฌุฏุฏ ุฌุงฺฏุฒู ูโุดููุฏ.

---

### ุชุฑฺฉุจ ุฎูุฏฺฉุงุฑ XText

* ููุช ูุญุชูุง ุณุงุฏูโุง ุจู ฺฉ **XElement** ุงุถุงูู ูโฺฉูุฏุ **X-DOM** ุจู ุฌุง ุงุฌุงุฏ ููุฏ ุฌุฏุฏุ ุจู **XText** ููุฌูุฏ ุงุถุงูู ูโฺฉูุฏ.

ูุซุงูโูุง:

```csharp
var e1 = new XElement("test", "Hello"); e1.Add("World");
var e2 = new XElement("test", "Hello", "World");
```

* ูุฑ ุฏู **e1** ู **e2** ููุท ฺฉ ูุฑุฒูุฏ **XText** ุฏุงุฑูุฏ ุจุง ููุฏุงุฑ `"HelloWorld"`.

* ุงฺฏุฑ ุตุฑุญุงู ฺูุฏ ููุฏ **XText** ุจุณุงุฒุฏุ ฺูุฏ ูุฑุฒูุฏ ุฎูุงูุฏ ุฏุงุดุช:

```csharp
var e = new XElement("test", new XText("Hello"), new XText("World"));
Console.WriteLine(e.Value);           // HelloWorld
Console.WriteLine(e.Nodes().Count()); // 2
```

* **XElement** ููุฏูุง **XText** ุฑุง ุจู ูู ูุชุตู ููโฺฉูุฏุ ุจูุงุจุฑุงู **ููุช ุงุดุงุก ููุฏูุง ุญูุธ ูโุดูุฏ**.

### ุงุณูุงุฏ ู ุงุนูุงูโูุง (Documents and Declarations)

#### XDocument

ููุงูุทูุฑ ฺฉู ูุจูุงู ฺฏูุชูุ **XDocument** ฺฉ ุนูุตุฑ ุฑุดู **XElement** ุฑุง ุจุณุชูโุจูุฏ ูโฺฉูุฏ ู ุงูฺฉุงู ุงุถุงูู ฺฉุฑุฏู ููุงุฑุฏ ุฒุฑ ุฑุง ูุฑุงูู ูโฺฉูุฏ:

* **XDeclaration** (ุงุนูุงู XML)
* ุฏุณุชูุฑุงุช ูพุฑุฏุงุฒุด (**Processing Instructions**)
* ููุน ุณูุฏ (**XDocumentType**)
* ูุธุฑุงุช ุฏุฑ ุณุทุญ ุฑุดู (**XComment**)

> **ูฺฉุชู ููู:** ูุฌูุฏ **XDocument** ุงุฎุชุงุฑ ุงุณุช ู ูโุชูุงู ุขู ุฑุง ูุงุฏุฏู ฺฏุฑูุช ุง ุญุฐู ฺฉุฑุฏ. ุจุฑุฎูุงู **W3C DOM**ุ XDocument ุจูโุนููุงู ยซฺุณุจยป ุจุฑุง ูฺฏู ุฏุงุดุชู ููู ฺุฒ ฺฉูุงุฑ ูู ุนูู ููโฺฉูุฏ.

---

#### ูุญุชูุงุช ูุฌุงุฒ XDocument

XDocument ูโุชูุงูุฏ ููุท ุงููุงุน ูุญุฏูุฏ ุงุฒ ูุญุชูุง ุฑุง ุจูพุฐุฑุฏ:

* ฺฉ **XElement** (ุนูุตุฑ ุฑุดู) โ ุงุฌุจุงุฑ ุจุฑุง ุฏุงุดุชู XDocument ูุนุชุจุฑ
* ฺฉ **XDeclaration** โ ุงุฎุชุงุฑุ ุงฺฏุฑ ุญุฐู ุดูุฏุ ููุงุฏุฑ ูพุดโูุฑุถ ููฺฏุงู ุณุฑุงูโุณุงุฒ ุงุนูุงู ูโุดููุฏ
* ฺฉ **XDocumentType** (ุจุฑุง ุงุฑุฌุงุน ุจู DTD)
* ูุฑ ุชุนุฏุงุฏ **XProcessingInstruction**
* ูุฑ ุชุนุฏุงุฏ **XComment**

---

#### ููููู ุณุงุฏู ุงุฒ XDocument ูุนุชุจุฑ

```csharp
var doc = new XDocument(
    new XElement("test", "data")
);
```

* ุฏุฑ ูุซุงู ุจุงูุง **XDeclaration** ูุงุฑุฏ ูุดุฏู ุงุณุชุ ุงูุง ููฺฏุงู ูุฑุงุฎูุงู **doc.Save**ุ ฺฉ ุงุนูุงู XML ุจูโุตูุฑุช ูพุดโูุฑุถ ุชููุฏ ูโุดูุฏ.

---

#### ููููู ุงุฌุงุฏ ฺฉ ูุงู XHTML

```csharp
var styleInstruction = new XProcessingInstruction(
    "xml-stylesheet", "href='styles.css' type='text/css'"
);
var docType = new XDocumentType(
    "html",
    "-//W3C//DTD XHTML 1.0 Strict//EN",
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd",
    null
);

XNamespace ns = "http://www.w3.org/1999/xhtml";

var root = new XElement(ns + "html",
    new XElement(ns + "head",
        new XElement(ns + "title", "An XHTML page")
    ),
    new XElement(ns + "body",
        new XElement(ns + "p", "This is the content")
    )
);

var doc = new XDocument(
    new XDeclaration("1.0", "utf-8", "no"),
    new XComment("Reference a stylesheet"),
    styleInstruction,
    docType,
    root
);

doc.Save("test.html");
```

* ูุญุชูุง **test.html** ุชููุฏ ุดุฏู:

```xml
<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!--Reference a stylesheet-->
<?xml-stylesheet href='styles.css' type='text/css'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>An XHTML page</title>
  </head>
  <body>
    <p>This is the content</p>
  </body>
</html>
```

---

#### ุฏุณุชุฑุณ ุจู ุฑุดู ู ุงุฑุชุจุงุทุงุช

* ุฎุตูุตุช **Root** ุฏุฑ **XDocument** ฺฉ ูุงูโุจุฑ ุจุฑุง ุฏุณุชุฑุณ ุจู ุนูุตุฑ ุฑุดู ุงุณุช.
* ููฺฉ ูุนฺฉูุณ ุงุฒ ูุฑ ุดุก ุฏุฑ ุฏุฑุฎุช ุจุง ุฎุตูุตุช **Document** ุงุฒ **XObject** ุงุฑุงุฆู ูโุดูุฏ:

```csharp
Console.WriteLine(doc.Root.Name.LocalName);          // html
XElement bodyNode = doc.Root.Element(ns + "body");
Console.WriteLine(bodyNode.Document == doc);         // True
```

* ูุฑุฒูุฏุงู ฺฉ ุณูุฏ ูฺ ูุงูุฏ (Parent) ูุฏุงุฑูุฏ:

```csharp
Console.WriteLine(doc.Root.Parent == null);          // True
foreach (XNode node in doc.Nodes())
    Console.Write(node.Parent == null);              // TrueTrueTrueTrue
```

> ุชูุฌู: **XDeclaration** ฺฉ **XNode** ูุณุช ู ุฏุฑ ูุฌููุนู **Nodes** ุณูุฏ ุธุงูุฑ ููโุดูุฏ. ููุท ุจู ุฎุตูุตุช **Declaration** ุงุฎุชุตุงุต ุฏุงุฏู ูโุดูุฏ. ุจู ููู ุฏูู ุฏุฑ ูุซุงู ุจุงูุงุ ููุฏุงุฑ "True" ฺูุงุฑ ุจุงุฑ ุชฺฉุฑุงุฑ ุดุฏ ู ูู ูพูุฌ ุจุงุฑ.
>
### ุงุนูุงูโูุง XML (XML Declarations)

ฺฉ ูุงู XML ุงุณุชุงูุฏุงุฑุฏ ุจุง ฺฉ ุงุนูุงู ุดุฑูุน ูโุดูุฏุ ูุงููุฏ:

```xml
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
```

* ุงุนูุงู XML ุชุถูู ูโฺฉูุฏ ฺฉู ูุงู ุจู ุฏุฑุณุช ุชูุณุท ุฎูุงููุฏู (Reader) ูพุฑุฏุงุฒุด ู ุฏุฑฺฉ ุดูุฏ.

#### ุฑูุชุงุฑ XElement ู XDocument ููฺฏุงู ุชููุฏ ุงุนูุงู XML

* **Save ุจุง ูุงู ูุงู** โ ููุดู ฺฉ ุงุนูุงู ูโููุณุฏ.
* **Save ุจุง XmlWriter** โ ุงุนูุงู ูโููุณุฏ ูฺฏุฑ ุงูฺฉู XmlWriter ุจู ูุญู ุชูุธู ุดูุฏ ฺฉู ุงุนูุงู ุชููุฏ ูฺฉูุฏ.
* **ToString** โ ูฺโฺฏุงู ุงุนูุงู XML ุชููุฏ ููโฺฉูุฏ.

> ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชููุฏ ุงุนูุงูุ ูโุชูุงู **OmitXmlDeclaration** ู **ConformanceLevel** ุฑุง ุฏุฑ **XmlWriterSettings** ููฺฏุงู ุณุงุฎุช XmlWriter ุชูุธู ฺฉุฑุฏ.

---

#### ููุด XDeclaration

ูุฌูุฏ ุง ุนุฏู ูุฌูุฏ **XDeclaration** ุจุฑ ููุดุชู ุงุนูุงู ุชุฃุซุฑ ูุฏุงุฑุฏ. ูุฏู ุงุตู XDeclaration ุงู ุงุณุช ฺฉู ุจู ุณุฑุงูโุณุงุฒ XML ุฑุงูููุง ฺฉูุฏ:

* ฺู **ฺฉุฏฺฏุฐุงุฑ ูุชู** (encoding) ุงุณุชูุงุฏู ุดูุฏ
* ฺู ููุงุฏุฑ ุฏุฑ **ูฺฺฏโูุง encoding ู standalone** ุงุนูุงู XML ููุดุชู ุดููุฏ

#### ููููู ุงุฌุงุฏ XDeclaration ู XDocument ุจุง UTF-16

```csharp
var doc = new XDocument(
    new XDeclaration("1.0", "utf-16", "yes"),
    new XElement("test", "data")
);
doc.Save("test.xml");
```

* ุชูุฌู: ูุณุฎู (version) ููุดู ุจู "1.0" ููุดุชู ูโุดูุฏ.
* encoding ุจุงุฏ ฺฉ ฺฉุฏ IETF ูุงููุฏ `"utf-16"` ุจุงุดุฏ.

---

#### ููุดุชู ุงุนูุงู ุจู ุฑุดุชู (String)

* **ToString** ุงุนูุงู ุชููุฏ ููโฺฉูุฏุ ุจูุงุจุฑุงู ุจุงุฏ ุงุฒ **XmlWriter** ุงุณุชูุงุฏู ฺฉุฑุฏ:

```csharp
var doc = new XDocument(
    new XDeclaration("1.0", "utf-8", "yes"),
    new XElement("test", "data")
);

var output = new StringBuilder();
var settings = new XmlWriterSettings { Indent = true };

using (XmlWriter xw = XmlWriter.Create(output, settings))
    doc.Save(xw);

Console.WriteLine(output.ToString());
```

* ุฎุฑูุฌ:

```xml
<?xml version="1.0" encoding="utf-16" standalone="yes"?>
<test>data</test>
```

> ุฏูู UTF-16: ุฑุดุชูโูุง ุฏุฑ ุญุงูุธู ุฏุงุฎู ุจู ุตูุฑุช UTF-16 ุฐุฎุฑู ูโุดููุฏุ ุจูุงุจุฑุงู XmlWriter ุจูโุฏุฑุณุช "utf-16" ูโููุณุฏ ุชุง ุงุทูุงุนุงุช ูุงุฏุฑุณุช ุชููุฏ ูุดูุฏ.

---

#### ูฺฉุชู ููู ุฏุฑุจุงุฑู ToString

ุงฺฏุฑ ุจุฌุง Saveุ ุงุฒ ฺฉุฏ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```csharp
File.WriteAllText("data.xml", doc.ToString());
```

* ูุงู **data.xml** ุจุฏูู ุงุนูุงู XML ุฐุฎุฑู ูโุดูุฏ.
* ุงฺฏุฑ ToString ุงุนูุงู ุชููุฏ ูโฺฉุฑุฏุ encoding ูุงุฏุฑุณุช (UTF-16) ุฏุฑุฌ ูโุดุฏ ฺฉู ููฺฉู ุจูุฏ ุจุงุนุซ ุนุฏู ุฎูุงูุฏู ุดุฏู ูุงู ุดูุฏ.

---

### ูุงูโูุง ู ูุถุง ูุงูโูุง (Names and Namespaces)

* ููุงูโุทูุฑ ฺฉู ููุนโูุง ุฏุฑ .NET ูโุชูุงููุฏ namespace ุฏุงุดุชู ุจุงุดูุฏุ ุนูุงุตุฑ ู attributes ุฏุฑ XML ูุฒ ูโุชูุงููุฏ namespace ุฏุงุดุชู ุจุงุดูุฏ.
* **ฺฉุงุฑุจุฑุฏ namespace ุฏุฑ XML:**

  1. ุฌููฺฏุฑ ุงุฒ ุจุฑุฎูุฑุฏ ูุงูโูุง ููฺฏุงู ุชุฑฺฉุจ ุฏุงุฏูโูุง ุงุฒ ูุงูโูุง ูุฎุชูู
  2. ุฏุงุฏู ูุนูุง ุฏูู ุจู ฺฉ ูุงู

#### ููููู ุชุนุฑู namespace ูพุดโูุฑุถ

```xml
<customer xmlns="OReilly.Nutshell.CSharp"/>
```

* `xmlns` ูุงูุนุชุจุฑ ุงุณุช ู ุฏู ฺฉุงุฑ ุงูุฌุงู ูโุฏูุฏ:

  1. namespace ุนูุตุฑ ุฌุงุฑ ุฑุง ูุดุฎุต ูโฺฉูุฏ
  2. namespace ูพุดโูุฑุถ ุจุฑุง ุชูุงู ุนูุงุตุฑ ูุฑุฒูุฏ ุชุนู ูโฺฉูุฏ

ูุซุงู ุจุง ุนูุงุตุฑ ูุฑุฒูุฏ:

```xml
<customer xmlns="OReilly.Nutshell.CSharp">
  <address>
    <postcode>02138</postcode>
  </address>
</customer>
```

* ุนูุงุตุฑ `address` ู `postcode` ุจู ุทูุฑ ูพุดโูุฑุถ ุฏุฑ namespace `OReilly.Nutshell.CSharp` ูุฑุงุฑ ุฏุงุฑูุฏ.

#### ุญุฐู namespace ุจุฑุง ุนูุงุตุฑ ูุฑุฒูุฏ

```xml
<customer xmlns="OReilly.Nutshell.CSharp">
  <address xmlns="">
    <postcode>02138</postcode>  <!-- ุงฺฉููู postcode ุฏุฑ namespace ุฎุงู ุงุณุช -->
  </address>
</customer>
```

### ูพุดููุฏูุง (Prefixes)

ฺฉ ุฏฺฏุฑ ุงุฒ ุฑูุดโูุง ุชุนู namespace ุงุณุชูุงุฏู ุงุฒ **ูพุดููุฏ (prefix)** ุงุณุช.

* **ูพุดููุฏ** ฺฉ ูุงู ูุณุชุนุงุฑ ุจุฑุง namespace ุงุณุช ฺฉู ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ฺฉูุชุฑ ุชุงูพ ฺฉูุฏ.
* ุฏู ูุฑุญูู ุฏุงุฑุฏ: ุชุนุฑู ูพุดููุฏ ู ุงุณุชูุงุฏู ุงุฒ ุขู.

#### ุชุนุฑู ู ุงุณุชูุงุฏู ููุฒูุงู ุงุฒ ูพุดููุฏ

```xml
<nut:customer xmlns:nut="OReilly.Nutshell.CSharp"/>
```

* ุณูุช ุฑุงุณุช: `xmlns:nut="..."` โ ูพุดููุฏ `nut` ุฑุง ุชุนุฑู ูโฺฉูุฏ.
* ุณูุช ฺูพ: `nut:customer` โ ูพุดููุฏ ุชุนุฑู ุดุฏู ุฑุง ุจู ุนูุตุฑ `customer` ูุณุจุช ูโุฏูุฏ.

---

#### ูฺฉุชูโูุง ุฏุฑุจุงุฑู ูพุดููุฏูุง

* **ุนูุตุฑ ุฏุงุฑุง ูพุดููุฏุ ูุถุง ูุงู ูพุดโูุฑุถ ุจุฑุง ูุฑุฒูุฏุงู ุงุฌุงุฏ ููโฺฉูุฏ.**
* ุจุฑุง ุงูฺฉู ูุฑุฒูุฏ ูู ููุงู ูพุดููุฏ ุฑุง ุฏุงุดุชู ุจุงุดุฏุ ุจุงุฏ ุตุฑุงุญุชุงู ุงุฒ ุขู ุงุณุชูุงุฏู ฺฉูุฏ:

```xml
<nut:customer xmlns:nut="OReilly.Nutshell.CSharp">
  <nut:firstname>Joe</nut:firstname>
</nut:customer>
```

* ูโุชูุงูุฏ ูพุดููุฏ ุชุนุฑู ฺฉูุฏ ุจุฏูู ุงูฺฉู ุขู ุฑุง ุจู ุนูุตุฑ ุฌุงุฑ ุงุฎุชุตุงุต ุฏูุฏุ ุจุฑุง ุฑุงุญุช ูุฑุฒูุฏุงู:

```xml
<customer xmlns:i="http://www.w3.org/2001/XMLSchema-instance"
          xmlns:z="http://schemas.microsoft.com/2003/10/Serialization/">
  ...
</customer>
```

* ูพุดููุฏูุง ูุฎุตูุตุงู ุฒูุงู ููุฏ ูุณุชูุฏ ฺฉู ุนูุงุตุฑ ุงุฒ ฺูุฏ namespace ุงุณุชูุงุฏู ฺฉููุฏ.
* **ููุดู ุงุฒ URIูุง ูุนุชุจุฑ ุจุฑุง namespace ุงุณุชูุงุฏู ฺฉูุฏ** ุชุง ฺฉุชุง ุจุงุดูุฏ:

```xml
<customer xmlns="http://oreilly.com/schemas/nutshell/csharp"/>
<nut:customer xmlns:nut="http://oreilly.com/schemas/nutshell/csharp"/>
```

---

### namespace ุจุฑุง Attributes

* ฺฉ Attribute ููุดู ุจุฑุง ุฏุงุดุชู namespace ูุงุฒ ุจู **ูพุดููุฏ** ุฏุงุฑุฏ:

```xml
<customer xmlns:nut="OReilly.Nutshell.CSharp" nut:id="123" />
```

* Attribute ุจุฏูู ูพุดููุฏ ููุดู ุฏุฑ **namespace ุฎุงู** ุงุณุช ู ูุถุง ูุงู ูุงูุฏ ุฑุง ุจู ุงุฑุซ ููโุจุฑุฏ.
* ูุนูููุงู Attributes ูุงุฒ ุจู namespace ูุฏุงุฑูุฏ ูฺฏุฑ ุจุฑุง metadata ุง ฺฉุงุฑุจุฑุฏ ุนููู:

```xml
<customer xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <firstname>Joe</firstname>
  <lastname xsi:nil="true"/>
</customer>
```

---

### ุชุนู namespace ุฏุฑ X-DOM

* ุชุง ุจู ุญุงู ุงุฒ **ุฑุดุชู ุณุงุฏู** ุจุฑุง ูุงู XElement ู XAttribute ุงุณุชูุงุฏู ฺฉุฑุฏู ฺฉู ูุนุงุฏู **namespace ุฎุงู** ุงุณุช.
* ุจุฑุง ุชุนู namespaceุ ุฏู ุฑูุด ุฏุงุฑู:

1. **ุงุณุชูุงุฏู ุงุฒ ุขฺฉููุงุฏ ุฏุฑ ูุงู ุฑุดุชูโุง:**

```csharp
var e = new XElement("{http://domain.com/xmlspace}customer", "Bloggs");
Console.WriteLine(e.ToString());
```

ุฎุฑูุฌ:

```xml
<customer xmlns="http://domain.com/xmlspace">Bloggs</customer>
```

2. **ุงุณุชูุงุฏู ุงุฒ XNamespace ู XName (ุฑูุด ุจูููโุชุฑ):**

```csharp
XNamespace ns = "http://domain.com/xmlspace";
XName fullName = ns + "customer";

var data = new XElement(ns + "data",
              new XAttribute(ns + "id", 123)
           );
```

* **XNamespace** ู **XName** ฺฉูุงุณโูุง ูุณุชูุฏ ฺฉู namespace ู ูุงู ูุญู (local name) ุฑุง ูุฏุฑุช ูโฺฉููุฏ.

* ููู ูุชุฏูุง ู ุณุงุฒูุฏูโูุง X-DOMุ XName ูโูพุฐุฑูุฏุ ูู ูโุชูุงู ุฑุดุชู ุณุงุฏู ูุฒ ุงุณุชูุงุฏู ฺฉุฑุฏ ุจู ุฏูู **ุชุจุฏู ุถูู (implicit cast)**.

* ูุชุฌู ุงุณุชูุงุฏู ุงุฒ namespace ุฏุฑ ุนูุงุตุฑ ู attributes ฺฉุณุงู ุงุณุช ู ุชููุง ุจุง ุงุณุชูุงุฏู ุงุฒ `+` ุง ุขฺฉููุงุฏ ูุดุฎุต ูโุดูุฏ.

### X-DOM ู ูุถุง ูุงู ูพุดโูุฑุถ (Default Namespaces)

ุฏุฑ **X-DOM**ุ ููููู **ูุถุง ูุงู ูพุดโูุฑุถ** ุชุง ุฒูุงู **ุชุจุฏู ุจู XML ูุงูุน** ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ.

* ุนู ููุช ฺฉ ุนูุตุฑ ูุฑุฒูุฏ (XElement) ูโุณุงุฒุฏุ **ูุถุง ูุงู ูุงูุฏ ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุจู ุขู ููุชูู ููโุดูุฏ**.
* ุดูุง ุจุงุฏ **explicit** namespace ุฑุง ูุดุฎุต ฺฉูุฏ:

```csharp
XNamespace ns = "http://domain.com/xmlspace";
var data = new XElement(ns + "data",
            new XElement(ns + "customer", "Bloggs"),
            new XElement(ns + "purchase", "Bicycle")
          );
Console.WriteLine(data.ToString());
```

**ุฎุฑูุฌ:**

```xml
<data xmlns="http://domain.com/xmlspace">
  <customer>Bloggs</customer>
  <purchase>Bicycle</purchase>
</data>
```

* ุงฺฏุฑ ูุฑุฒูุฏุงู ุจุฏูู namespace ุณุงุฎุชู ุดููุฏุ ูุถุง ูุงู ุฎุงู (`xmlns=""`) ุจู ุขูโูุง ุงุนูุงู ูโุดูุฏ:

```csharp
var data2 = new XElement(ns + "data",
            new XElement("customer", "Bloggs"),
            new XElement("purchase", "Bicycle")
          );
Console.WriteLine(data2.ToString());
```

ุฎุฑูุฌ:

```xml
<data xmlns="http://domain.com/xmlspace">
  <customer xmlns="">Bloggs</customer>
  <purchase xmlns="">Bicycle</purchase>
</data>
```

---

### ูุดุฏุงุฑ ุฏุฑ ูุงูุจุฑ X-DOM

* ููฺฏุงู ุงุณุชูุงุฏู ุงุฒ `Element()` ุง ุณุงุฑ ูุชุฏูุง ุฌุณุชุฌูุ **ูุฑุงููุด ฺฉุฑุฏู namespace ุจุงุนุซ ุจุงุฒฺฏุดุช null ูโุดูุฏ**:

```csharp
XNamespace ns = "http://domain.com/xmlspace";
var data = new XElement(ns + "data",
            new XElement(ns + "customer", "Bloggs")
          );

XElement x = data.Element(ns + "customer"); // ุฏุฑุณุช
XElement y = data.Element("customer");      // null
```

* ุงฺฏุฑ X-DOM ุจุฏูู namespace ุณุงุฎุชู ุดุฏุ ูโุชูุงูุฏ ุจุนุฏุงู ููู ุนูุงุตุฑ ุฑุง ุจู ฺฉ namespace ูุงุญุฏ ุงุฎุชุตุงุต ุฏูุฏ:

```csharp
foreach (XElement e in data.DescendantsAndSelf())
  if (e.Name.Namespace == "")
    e.Name = ns + e.Name.LocalName;
```

---

### ูพุดููุฏูุง (Prefixes) ุฏุฑ X-DOM

* X-DOM ูพุดููุฏูุง ุฑุง ููุท ุจุฑุง **serialization** ุงุณุชูุงุฏู ูโฺฉูุฏ.
* ุฏุฑ ุนููุงุช ุณุงุฎุชุ ุฌุณุชุฌู ู ุจุฑูุฒุฑุณุงู X-DOM **ูโุชูุงู ูพุดููุฏูุง ุฑุง ูุงุฏุฏู ฺฏุฑูุช**.

ูุซุงู:

```csharp
XNamespace ns1 = "http://domain.com/space1";
XNamespace ns2 = "http://domain.com/space2";
var mix = new XElement(ns1 + "data",
            new XElement(ns2 + "element", "value"),
            new XElement(ns2 + "element", "value"),
            new XElement(ns2 + "element", "value")
          );
Console.WriteLine(mix.ToString());
```

ุฎุฑูุฌ ุจุฏูู ูพุดููุฏ:

```xml
<data xmlns="http://domain.com/space1">
  <element xmlns="http://domain.com/space2">value</element>
  <element xmlns="http://domain.com/space2">value</element>
  <element xmlns="http://domain.com/space2">value</element>
</data>
```

* ุจุฑุง ฺฉุงูุด ุชฺฉุฑุงุฑุ ูโุชูุงู ูพุดููุฏูุง ุฑุง ุจู root ุงุถุงูู ฺฉุฑุฏ:

```csharp
mix.SetAttributeValue(XNamespace.Xmlns + "ns1", ns1);
mix.SetAttributeValue(XNamespace.Xmlns + "ns2", ns2);
```

ุฎุฑูุฌ ุจููู:

```xml
<ns1:data xmlns:ns1="http://domain.com/space1"
          xmlns:ns2="http://domain.com/space2">
  <ns2:element>value</ns2:element>
  <ns2:element>value</ns2:element>
  <ns2:element>value</ns2:element>
</ns1:data>
```

---

### ูพุดููุฏูุง ุจุฑุง Attributes

* ูพุดููุฏูุง ุฏุฑ ุฒูุงู **serializing attributes** ูู ุงุนูุงู ูโุดููุฏ.
* ูุซุงู ุงุณุชูุงุฏู ุงุฒ namespace ุงุณุชุงูุฏุงุฑุฏ W3C ุจุฑุง ูุดุงู ุฏุงุฏู nil:

```csharp
XNamespace xsi = "http://www.w3.org/2001/XMLSchema-instance";
var nil = new XAttribute(xsi + "nil", true);

var cust = new XElement("customers",
              new XAttribute(XNamespace.Xmlns + "xsi", xsi),
              new XElement("customer",
                new XElement("lastname", "Bloggs"),
                new XElement("dob", nil),
                new XElement("credit", nil)
              )
            );
```

ุฎุฑูุฌ:

```xml
<customers xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <customer>
    <lastname>Bloggs</lastname>
    <dob xsi:nil="true" />
    <credit xsi:nil="true" />
  </customer>
</customers>
```

* ฺฉ attribute ูโุชูุงูุฏ ฺูุฏ ุจุงุฑ ุฏุฑ X-DOM ุงุณุชูุงุฏู ุดูุฏุ X-DOM ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุขู ุฑุง duplicate ูโฺฉูุฏ.

### Annotations ุฏุฑ LINQ to XML

ุฏุฑ **LINQ to XML** ูโุชูุงูุฏ ุฏุงุฏูโูุง ุฏูุฎูุงู ุฎูุฏ ุฑุง ุจู ูุฑ **XObject** (ูุซู `XElement` ุง `XAttribute`) ุจฺุณุจุงูุฏ. ุงู ุฏุงุฏูโูุง ุจู ุนููุงู **Annotations** ุดูุงุฎุชู ูโุดููุฏ ู X-DOM ุขูโูุง ุฑุง **ุจู ุตูุฑุช ฺฉ ุฌุนุจู ุณุงู (black box)** ูุฏุฑุช ูโฺฉูุฏ.

* ููููู ูุดุงุจู `Tag` ุฏุฑ Windows Forms ุง WPFุ ุจุง ุงู ุชูุงูุช ฺฉู **ฺูุฏู annotation** ูโุชูุงูุฏ ุงุถุงูู ฺฉูุฏ ู ูุฑ ฺฉุฏุงู ูโุชูุงููุฏ **ุฎุตูุต ู ุบุฑูุงุจู ูุดุงูุฏู ุชูุณุท ุฏฺฏุฑุงู** ุจุงุดูุฏ.

---

#### ุงุถุงูู ฺฉุฑุฏู ู ุญุฐู Annotations

```csharp
public void AddAnnotation(object annotation)
public void RemoveAnnotations<T>() where T : class
```

#### ุจุงุฒุงุจ Annotations

```csharp
public T Annotation<T>() where T : class
public IEnumerable<T> Annotations<T>() where T : class
```

* ฺฉูุฏ ูุฑ annotation ููุน ุฏุงุฏูโุง ุขู ุงุณุช ู ุจุงุฏ **Reference Type** ุจุงุดุฏ.

**ูุซุงู ุณุงุฏู ุจุง string:**

```csharp
XElement e = new XElement("test");
e.AddAnnotation("Hello");
Console.WriteLine(e.Annotation<string>());   // Hello
```

* ูโุชูุงูุฏ ฺูุฏ annotation ุงุฒ ฺฉ ููุน ุงุถุงูู ฺฉูุฏ ู ุจุง `Annotations<T>()` ููู ุฑุง ุฏุฑุงูุช ฺฉูุฏ.

---

#### ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณ ุฎุตูุต ุจุฑุง ุงูู

ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชุฏุงุฎู ุฏฺฏุฑ ฺฉุฏูุง:

```csharp
class X
{
    class CustomData { internal string Message; }   // Private nested type

    static void Test()
    {
        XElement e = new XElement("test");
        e.AddAnnotation(new CustomData { Message = "Hello" });
        Console.WriteLine(e.Annotations<CustomData>().First().Message);  // Hello
    }
}
```

* ุจุฑุง ุญุฐู annotationุ ุจุงุฏ ุจู ููุน ุขู ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ:

```csharp
e.RemoveAnnotations<CustomData>();
```

---

### Projection ุจู X-DOM ุจุง LINQ

* ุนูุงูู ุจุฑ **ุงุณุชุฎุฑุงุฌ ุฏุงุฏู**ุ ูโุชูุงูุฏ ุจุง LINQ **ุฏุงุฏูโูุง ุฑุง ุจู X-DOM ุชุจุฏู ฺฉูุฏ**.
* ููุงุจุน (sources) ูโุชูุงููุฏ:

  * EF Core entities
  * ฺฉ Collection ูุญู
  * ุง ุญุช ฺฉ X-DOM ุฏฺฏุฑ ุจุงุดูุฏ

#### ูุซุงู: ุณุงุฎุช XML ุงุฒ ูพุงฺฏุงู ุฏุงุฏู

```csharp
var customers =
  new XElement("customers",
    from c in dbContext.Customers.AsEnumerable()  // ุชูุฌู ุจู AsEnumerable ุจู ุฏูู bug ุฏุฑ EF Core
    select new XElement("customer", new XAttribute("id", c.ID),
        new XElement("name", c.Name),
        new XElement("buys", c.Purchases.Count)
    )
  );
```

**ุฎุฑูุฌ ููููู:**

```xml
<customers>
  <customer id="1">
    <name>Tom</name>
    <buys>3</buys>
  </customer>
  <customer id="2">
    <name>Harry</name>
    <buys>2</buys>
  </customer>
</customers>
```

#### ุชูุถุญ ุฏู ูุฑุญููโุง

1. ุงุจุชุฏุง projection ุจู `XElement`:

```csharp
IEnumerable<XElement> sqlQuery =
  from c in dbContext.Customers.AsEnumerable()
  select new XElement("customer", new XAttribute("id", c.ID),
      new XElement("name", c.Name),
      new XElement("buys", c.Purchases.Count)
  );
```

2. ุณูพุณ ุฑุดู ุฑุง ูโุณุงุฒู:

```csharp
var customers = new XElement("customers", sqlQuery);
```

* `sqlQuery` ฺฉ `IEnumerable<XElement>` ุงุณุชุ ุจูุงุจุฑุงู ูุฑ ุนูุตุฑ ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุจู ุนููุงู child ุงุถุงูู ูโุดูุฏ.

---

ุงู ูุงุจูุช ุจุงุนุซ ูโุดูุฏ ฺฉู **LINQ ุจู X-DOM** ูู **ุฎูุงูุฏู** ู ูู **ุณุงุฎุชู XML** ุจู ุตูุฑุช ฺฉุงููุงู ุชุงุจุน ู ุงูุนุทุงูโูพุฐุฑ ุงูฺฉุงูโูพุฐุฑ ุจุงุดุฏ.

### ุญุฐู ุนูุงุตุฑ ุฎุงู ู ุงุณุชูุงุฏู ุงุฒ XStreamingElement ุฏุฑ LINQ to XML

#### 1๏ธโฃ ุญุฐู ุนูุงุตุฑ ุฎุงู

ฺฏุงู ุฏุฑ **ูพุฑูฺู ฺฉุฑุฏู ุฏุงุฏูโูุง ุจู X-DOM**ุ ูโุฎูุงูู **ุนูุงุตุฑ ฺฉู ููุฏุงุฑ ูุฏุงุฑูุฏ** ุง ุฏุงุฏูโุง ุจุฑุง ุขูโูุง ููุฌูุฏ ูุณุชุ ุชููุฏ ูุดููุฏ.

ูุซุงู: ุงุถุงูู ฺฉุฑุฏู ุขุฎุฑู ุฎุฑุฏ ุจุง ุงุฑุฒุด ุจุงูุง ุจุฑุง ูุฑ ูุดุชุฑ

```csharp
var customers =
  new XElement("customers",
    from c in dbContext.Customers.AsEnumerable()
    let lastBigBuy = (from p in c.Purchases
                      where p.Price > 1000
                      orderby p.Date descending
                      select p).FirstOrDefault()
    select new XElement("customer", new XAttribute("id", c.ID),
        new XElement("name", c.Name),
        new XElement("buys", c.Purchases.Count),
        lastBigBuy == null ? null :                     // โ ุดุฑุท ุญุฐู ุนูุตุฑ ุฎุงู
        new XElement("lastBigBuy",
            new XElement("description", lastBigBuy.Description),
            new XElement("price", lastBigBuy.Price)
        )
    )
  );
```

* ุงฺฏุฑ ูุดุชุฑ **ุฎุฑุฏ ุจุง ุงุฑุฒุด ุจุงูุง ูุฏุงุดุชู ุจุงุดุฏ**ุ ุจู ุฌุง ุชููุฏ ฺฉ `XElement` ุฎุงูุ **null** ูุฑุงุฑ ุฏุงุฏู ูโุดูุฏ.
* X-DOM ููฺฏุงู ุณุงุฎุชู XMLุ ูุญุชูุง **null ุฑุง ูุงุฏุฏู ูโฺฏุฑุฏ** ู ุนูุตุฑ ุชููุฏ ููโุดูุฏ. โ

---

#### 2๏ธโฃ ุงูุฒุงุด ฺฉุงุฑุง ุจุง XStreamingElement

* ุงฺฏุฑ ูุฏู ููุท **ุฐุฎุฑู ุง ููุงุด XML** ุจุงุดุฏุ ูโุชูุงู ุงุฒ **XStreamingElement** ุงุณุชูุงุฏู ฺฉุฑุฏ ุชุง ุญุงูุธู ุจูุชุฑ ูุฏุฑุช ุดูุฏ.
* **XStreamingElement** ุดุจู XElement ุงุณุช ุงูุง:

  * ูุญุชูุง child ุฑุง **ุชูุจู (deferred)** ุจุงุฑฺฏุฐุงุฑ ูโฺฉูุฏ.
  * ุฑูุดโูุง traversal ูุซู `Elements()` ุง `Attributes()` ูุฏุงุฑุฏ.
  * ููุท ูโุชูุงู `Save`, `ToString`, `WriteTo` ุง `Add` ุฑุง ุฑู ุขู ุงุณุชูุงุฏู ฺฉุฑุฏ.

ูุซุงู:

```csharp
var customers =
  new XStreamingElement("customers",
    from c in dbContext.Customers
    select new XStreamingElement("customer", new XAttribute("id", c.ID),
        new XElement("name", c.Name),
        new XElement("buys", c.Purchases.Count)
    )
  );

customers.Save("data.xml");
```

* ูพุฑุณโูุฌููุง **ุชุง ุฒูุงู ูุฑุงุฎูุงู Save ุง ToString** ุงุฑุฒุงุจ ููโุดููุฏุ ุจูุงุจุฑุงู ฺฉู X-DOM ุจู ุญุงูุธู ุจุงุฑฺฏุฐุงุฑ ููโุดูุฏ.
* ุชูุฌู: XStreamingElement ูุงุจูุช ูพูุงุด ูุฏุงุฑุฏ ู ููุท ุจุฑุง **ุชููุฏ ุฎุฑูุฌ XML** ููุงุณุจ ุงุณุช.
