---
layout: layout.njk
title: ุดุจฺฉูโุณุงุฒ
---
# ูุตู ุดุงูุฒุฏูู: ุดุจฺฉูโุณุงุฒ

.NET ูุฌููุนูโุง ุงุฒ ฺฉูุงุณโูุง ุฑุง ุฏุฑ ูุถุง ูุงู **System.Net.\*** ุจุฑุง ุจุฑูุฑุงุฑ ุงุฑุชุจุงุท ุงุฒ ุทุฑู ูพุฑูุชฺฉูโูุง ุงุณุชุงูุฏุงุฑุฏ ุดุจฺฉู ูุซู **HTTP** ู **TCP/IP** ุงุฑุงุฆู ูโุฏูุฏ. ุฏุฑ ุงูุฌุง ุฎูุงุตูโุง ุงุฒ ุงุฌุฒุง ฺฉูุฏ ุขูุฑุฏู ุดุฏู ุงุณุช:

* **HttpClient** ุจุฑุง ูุตุฑู APIูุง ูุจ ูุจุชู ุจุฑ HTTP ู ุณุฑูุณโูุง **RESTful**
* **HttpListener** ุจุฑุง ููุดุชู ฺฉ ุณุฑูุฑ **HTTP**
* **SmtpClient** ุจุฑุง ุณุงุฎุช ู ุงุฑุณุงู ูพุงูโูุง ุงูู ุงุฒ ุทุฑู **SMTP**
* **Dns** ุจุฑุง ุชุจุฏู ุจู ูุงู ุฏุงููู ู ุขุฏุฑุณโูุง
* ฺฉูุงุณโูุง **TcpClient**ุ **UdpClient**ุ **TcpListener** ู **Socket** ุจุฑุง ุฏุณุชุฑุณ ูุณุชูู ุจู ูุงูโูุง ุงูุชูุงู ู ุดุจฺฉู

ุงููุงุน (Types) ููุฌูุฏ ุฏุฑ ุงู ูุตู ุงุฒ .NET ุฏุฑ ูุถุง ูุงูโูุง **System.Net.\*** ู **System.IO** ูุฑุงุฑ ุฏุงุฑูุฏ.

.NET ููฺูู ูพุดุชุจุงู ุณูุช ฺฉูุงูุช ุงุฒ **FTP** ุฑุง ูุฑุงูู ูโฺฉูุฏุ ุงูุง ููุท ุงุฒ ุทุฑู ฺฉูุงุณโูุง ฺฉู ุงุฒ ูุณุฎูโ .NET 6 ุจูโุจุนุฏ ุจูโุนููุงู **obsolete** (ููุณูุฎ) ุนูุงูุชโฺฏุฐุงุฑ ุดุฏูโุงูุฏ. ุงฺฏุฑ ูุงุฒู ุจุงุดุฏ ุงุฒ **FTP** ุงุณุชูุงุฏู ฺฉูุฏุ ุจูุชุฑู ฺฏุฒูู ุงุณุชูุงุฏู ุงุฒ ฺฉ ฺฉุชุงุจุฎุงููโ **NuGet** ูุซู **FluentFTP** ุงุณุช.

---

### ูุนูุงุฑ ุดุจฺฉู ๐๏ธ

ุดฺฉู ฑถ-ฑ ุงููุงุน ุดุจฺฉูโุง .NET ู ูุงูโูุง ุงุฑุชุจุงุท ฺฉู ุฏุฑ ุขูโูุง ูุฑุงุฑ ุฏุงุฑูุฏ ุฑุง ูุดุงู ูโุฏูุฏ. ุจุดุชุฑ ุงููุงุน ุฏุฑ **ูุงูโ ุงูุชูุงู (Transport layer)** ุง **ูุงูโ ฺฉุงุฑุจุฑุฏ (Application layer)** ูุฑุงุฑ ุฏุงุฑูุฏ.

* ูุงูโ ุงูุชูุงู ูพุฑูุชฺฉูโูุง ูพุงูโุง ุจุฑุง ุงุฑุณุงู ู ุฏุฑุงูุช ุจุงุชโูุง ุฑุง ุชุนุฑู ูโฺฉูุฏ (**TCP** ู **UDP**).
* ูุงูโ ฺฉุงุฑุจุฑุฏ ูพุฑูุชฺฉูโูุง ุณุทุญ ุจุงูุงุชุฑ ุฑุง ุชุนุฑู ูโฺฉูุฏ ฺฉู ุจุฑุง ุจุฑูุงููโูุง ุฎุงุต ุทุฑุงุญ ุดุฏูโุงูุฏุ ูุซู:

  * ุจุงุฒุงุจ ุตูุญุงุช ูุจ (**HTTP**)
  * ุงุฑุณุงู ุงูู (**SMTP**)
  * ุชุจุฏู ุจู ูุงู ุฏุงููู ู ุขุฏุฑุณโูุง **IP** (**DNS**)

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/16/Table-16-1.jpeg)
</div>

ูุนูููุงู ุจุฑูุงููโููุณ ุฏุฑ **ูุงูโ ฺฉุงุฑุจุฑุฏ (Application layer)** ุฑุงุญุชโุชุฑ ุงุณุชุ ุจุงุงูโุญุงูุ ุฏูุงู ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ููฺฉู ุงุณุช ุจุฎูุงูุฏ ูุณุชููุงู ุฏุฑ **ูุงูโ ุงูุชูุงู (Transport layer)** ฺฉุงุฑ ฺฉูุฏ.

* ฺฉ ุงุฒ ุฏูุงู ุงู ุงุณุช ฺฉู ุจู ฺฉ ูพุฑูุชฺฉู ฺฉุงุฑุจุฑุฏ ูุงุฒ ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุฏุฑ .NET ุงุฑุงุฆู ูุดุฏู ุงุณุชุ ูุซู **POP3** ุจุฑุง ุฏุฑุงูุช ุงูู.
* ุฏูู ุฏฺฏุฑ ุงู ุงุณุช ฺฉู ุจุฎูุงูุฏ ฺฉ ูพุฑูุชฺฉู ุณูุงุฑุด ุจุฑุง ฺฉ ุจุฑูุงููโ ุฎุงุต ุทุฑุงุญ ฺฉูุฏุ ูุซู ฺฉ **ฺฉูุงูุช ููุชุง ุจู ููุชุง (peer-to-peer client)**.

---

### ูพุฑูุชฺฉู HTTP ู ุงููุช ุขู ๐

ุฏุฑ ุจู ูพุฑูุชฺฉูโูุง ฺฉุงุฑุจุฑุฏุ **HTTP** ุจู ุฏูู ฺฉุงุฑุจุฑุฏ ุนูููโุงุด ุงููุช ูฺูโุง ุฏุงุฑุฏ. ุญุงูุช ูพุงูโุง ุนููฺฉุฑุฏ ุขูโยซุงู ุตูุญูโ ูุจ ุจุง ุงู URL ุฑุง ุจู ูู ุจุฏูยปโุจูโุฎูุจ ุจุง ุงูฺฏููุง ุฏฺฏุฑ ูุซู ยซูุชุฌูโ ูุฑุงุฎูุงู ุงู endpoint ุจุง ุงู ุขุฑฺฏููุงูโูุง ุฑุง ุจู ูู ุจุฏูยป ุณุงุฒฺฏุงุฑ ูโุดูุฏ.

ุนูุงูู ุจุฑ ูุนู **get**ุ ุงูุนุงู ุฏฺฏุฑ ูุซู **put**ุ **post** ู **delete** ูู ูุฌูุฏ ุฏุงุฑูุฏ ฺฉู ุงูฺฉุงู ุณุงุฎุช ุณุฑูุณโูุง ูุจุชู ุจุฑ **REST** ุฑุง ูุฑุงูู ูโฺฉููุฏ.

**HTTP** ููฺูู ูุฌููุนูโ ฺฏุณุชุฑุฏูโุง ุงุฒ ูุงุจูุชโูุง ุฏุงุฑุฏ ฺฉู ุฏุฑ ุจุฑูุงููโูุง ุชุฌุงุฑ ฺูุฏูุงู ู ูุนูุงุฑโูุง ุณุฑูุณโูุญูุฑ ููุฏ ูุณุชูุฏุ ูุซู:

* ูพุฑูุชฺฉูโูุง ุจุฑุง **ุงุญุฑุงุฒ ููุช (authentication)** ู **ุฑูุฒูฺฏุงุฑ (encryption)**
* **ูุทุนูโุจูุฏ ูพุงูโูุง (message chunking)**
* **ูุฏุฑูุง ู ฺฉูฺฉโูุง ูุงุจูโฺฏุณุชุฑุด (extensible headers and cookies)**
* ุงูฺฉุงู ุงูฺฉู ฺูุฏู ุจุฑูุงููโ ุณุฑูุฑ ฺฉ **ูพูุฑุช** ู ฺฉ **ุขุฏุฑุณ IP** ูุดุชุฑฺฉ ุฏุงุดุชู ุจุงุดูุฏ

ุจู ููู ุฏูุงูุ **HTTP** ุฏุฑ .NET ุจูโุฎูุจ ูพุดุชุจุงู ูโุดูุฏโูู ุจูโุตูุฑุช ูุณุชูู (ููุงูโุทูุฑ ฺฉู ุฏุฑ ุงู ูุตู ุชูุถุญ ุฏุงุฏู ูโุดูุฏ) ู ูู ุฏุฑ ุณุทูุญ ุจุงูุงุชุฑุ ุงุฒ ุทุฑู ููุงูุฑโูุง ูุซู **Web API** ู **ASP.NET Core**.

---

ููุงูโุทูุฑ ฺฉู ุงุฒ ุจุญุซโูุง ุจุงูุง ูุดุฎุต ุงุณุชุ ุญูุฒูโ ุดุจฺฉูโุณุงุฒ ูพุฑ ุงุฒ **ุงุฎุชุตุงุฑููุณโูุง (acronyms)** ุงุณุช. ูุชุฏุงููโุชุฑู ุขูโูุง ุฏุฑ **ุฌุฏูู ฑถ-ฑ** ููุฑุณุช ุดุฏูโุงูุฏ. ๐
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/16/Table-16-2.jpeg)
</div>

### ุขุฏุฑุณโูุง ู ูพูุฑุชโูุง

ุจุฑุง ุงูฺฉู ุงุฑุชุจุงุท ุจุฑูุฑุงุฑ ุดูุฏุ ฺฉ ฺฉุงููพูุชุฑ ุง ุฏุณุชฺฏุงู ูุงุฒ ุจู ฺฉ **ุขุฏุฑุณ** ุฏุงุฑุฏ. ุงูุชุฑูุช ุงุฒ ุฏู ุณุณุชู ุขุฏุฑุณโุฏู ุงุณุชูุงุฏู ูโฺฉูุฏ:

* **IPv4**
  ุฏุฑ ุญุงู ุญุงุถุฑ ุณุณุชู ุบุงูุจ ุขุฏุฑุณโุฏู ุงุณุช. ุขุฏุฑุณโูุง **IPv4** ุฏุงุฑุง ุนุฑุถ ณฒ ุจุช ูุณุชูุฏ. ููุช ุจูโุตูุฑุช ุฑุดุชู (string) ูุงูุจโุจูุฏ ูโุดููุฏุ ุจู ุดฺฉู ฺูุงุฑ ุนุฏุฏ ุงุนุดุงุฑ ุจุง ุฌุฏุงฺฉููุฏูโ ููุทู ููุดุชู ูโุดููุฏ (ุจุฑุง ูุซุงู: `101.102.103.104`). ฺฉ ุขุฏุฑุณ ูโุชูุงูุฏ ุฏุฑ ฺฉู ุฏูุง ููุญุตุฑุจูโูุฑุฏ ุจุงุดุฏ ุง ููุท ุฏุฑ ฺฉ **ุฒุฑุดุจฺฉู (subnet)** ุฎุงุต (ูุซู ฺฉ ุดุจฺฉูโ ุดุฑฺฉุช).

* **IPv6**
  ุณุณุชู ุขุฏุฑุณโุฏู ุฌุฏุฏุชุฑ ุงุณุช ฺฉู ุนุฑุถ ุขู **ฑฒธ ุจุช** ูโุจุงุดุฏ. ุขุฏุฑุณโูุง ุฏุฑ ูุงูุจ ุฑุดุชูโุง ุจู ุดฺฉู **ูฺฏุฒุงุฏุณูุงู** ููุดุชู ูโุดููุฏ ู ุจุง **ฺฉูููู (:)** ุงุฒ ูู ุฌุฏุง ูโุดููุฏ (ุจุฑุง ูุซุงู:
  `[3EA0:FFFF:198A:E4A3:4FF2:54fA:41BC:8D31]`).
  ุฏุฑ .NET ุจุงุฏ ุจุฑุงฺฉุชโูุง ูุฑุจุน (\[]) ุฑุง ุฏูุฑ ุขุฏุฑุณ ุงุถุงูู ฺฉูุฏ.

---

ฺฉูุงุณ **IPAddress** ุฏุฑ ูุถุง ูุงู **System.Net** ฺฉ ุขุฏุฑุณ ุฑุง ุฏุฑ ูุฑ ฺฉ ุงุฒ ุงู ุฏู ูพุฑูุชฺฉู ููุงุด ูโุฏูุฏ. ุงู ฺฉูุงุณ ฺฉ **ุณุงุฒูุฏู (constructor)** ุฏุงุฑุฏ ฺฉู ฺฉ ุขุฑุงูโ ุจุงุช ูโฺฏุฑุฏ ู ฺฉ ูุชุฏ ุงุณุชุงุชฺฉ ุจู ูุงู **Parse** ฺฉู ฺฉ ุฑุดุชูโ ูุงูุจโุจูุฏโุดุฏูโ ุตุญุญ ุฑุง ูโฺฏุฑุฏ:

```csharp
IPAddress a1 = new IPAddress (new byte[] { 101, 102, 103, 104 });
IPAddress a2 = IPAddress.Parse ("101.102.103.104");
Console.WriteLine (a1.Equals (a2));       // True

Console.WriteLine (a1.AddressFamily);     // InterNetwork

IPAddress a3 = IPAddress.Parse("[3EA0:FFFF:198A:E4A3:4FF2:54fA:41BC:8D31]");
Console.WriteLine (a3.AddressFamily);     // InterNetworkV6
```

---

### ูพูุฑุชโูุง ๐

ูพุฑูุชฺฉูโูุง **TCP** ู **UDP** ูุฑ ุขุฏุฑุณ IP ุฑุง ุจู **ถตูฌตณต ูพูุฑุช** ุชูุณู ูโฺฉููุฏ. ุงู ฺฉุงุฑ ุจู ฺฉ ฺฉุงููพูุชุฑ ุฏุฑ ฺฉ ุขุฏุฑุณ ูุงุญุฏ ุงุฌุงุฒู ูโุฏูุฏ ฺูุฏู ุจุฑูุงูู ุฑุง ุงุฌุฑุง ฺฉูุฏุ ูุฑฺฉุฏุงู ุฑู ูพูุฑุช ุฎูุฏุด.

ุจุณุงุฑ ุงุฒ ุจุฑูุงููโูุง ูพูุฑุชโูุง ูพุดโูุฑุถ ุงุณุชุงูุฏุงุฑุฏ ุฏุงุฑูุฏุ ุจุฑุง ูุซุงู:

* **HTTP** ุงุฒ ูพูุฑุช ธฐ ุงุณุชูุงุฏู ูโฺฉูุฏ.
* **SMTP** ุงุฒ ูพูุฑุช ฒต ุงุณุชูุงุฏู ูโฺฉูุฏ.

ูพูุฑุชโูุง **TCP** ู **UDP** ุงุฒ **ดนฑตฒ ุชุง ถตตณต** ุจูโุทูุฑ ุฑุณู ุจุฏูู ุชุฎุตุต ูุณุชูุฏุ ุจูุงุจุฑุงู ฺฏุฒููโ ุฎูุจ ุจุฑุง **ุขุฒูุงุด** ู **ุงุณุชูุฑุงุฑูุง ฺฉูฺฺฉ** ูุณุชูุฏ.

ุชุฑฺฉุจ ฺฉ ุขุฏุฑุณ IP ู ฺฉ ูพูุฑุช ุฏุฑ .NET ุชูุณุท ฺฉูุงุณ **IPEndPoint** ููุงุด ุฏุงุฏู ูโุดูุฏ:

```csharp
IPAddress a = IPAddress.Parse ("101.102.103.104");
IPEndPoint ep = new IPEndPoint (a, 222);      // Port 222
Console.WriteLine (ep.ToString());            // 101.102.103.104:222
```

---

### URI ๐

**ูุงุฑูุงูโูุง (Firewalls)** ูพูุฑุชโูุง ุฑุง ูุณุฏูุฏ ูโฺฉููุฏ. ุฏุฑ ุจุณุงุฑ ุงุฒ ูุญุทโูุง ุดุฑฺฉุชุ ููุท ุชุนุฏุงุฏ ฺฉู ุงุฒ ูพูุฑุชโูุง ุจุงุฒ ูุณุชูุฏโูุนูููุงู:

* ูพูุฑุช ธฐ (ุจุฑุง **HTTP** ุฑูุฒฺฏุฐุงุฑโูุดุฏู)
* ูพูุฑุช ดดณ (ุจุฑุง **HTTP** ุงูู ุง HTTPS)

**URI** ฺฉ ุฑุดุชูโ ูุงูุจโุจูุฏโุดุฏูโ ุฎุงุต ุงุณุช ฺฉู ฺฉ ููุจุน (resource) ุฏุฑ ุงูุชุฑูุช ุง ฺฉ LAN ุฑุง ุชูุตู ูโฺฉูุฏุ ูุซู ฺฉ ุตูุญูโ ูุจุ ูุงู ุง ุขุฏุฑุณ ุงูู.

ูููููโูุง:

* `http://www.ietf.org`
* `ftp://myisp/doc.txt`
* `mailto:joe@bloggs.com`

ูุงูุจ ุฏูู URI ุชูุณุท **IETF (Internet Engineering Task Force)** ุชุนุฑู ุดุฏู ุงุณุช.

ฺฉ **URI** ุฑุง ูโุชูุงู ุจู ูุฌููุนูโุง ุงุฒ ุนูุงุตุฑ ุชูุณู ฺฉุฑุฏโูุนูููุงู ุดุงูู **scheme**ุ **authority** ู **path**.

ฺฉูุงุณ **Uri** ุฏุฑ ูุถุง ูุงู **System** ุฏููุงู ููู ุชูุณูโุจูุฏ ุฑุง ุงูุฌุงู ูโุฏูุฏ ู ฺฉ property ุจุฑุง ูุฑ ุนูุตุฑ ุฏุฑ ุงุฎุชุงุฑ ูโฺฏุฐุงุฑุฏ (ููุงูโุทูุฑ ฺฉู ุฏุฑ ุดฺฉู ฑถ-ฒ ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช).
<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/16/Table-16-3.jpeg)
</div>

### ฺฉูุงุณ Uri ๐งญ

ฺฉูุงุณ **Uri** ุฒูุงู ููุฏ ุงุณุช ฺฉู ูุงุฒ ุฏุงุดุชู ุจุงุดุฏ ูุงูุจ ฺฉ ุฑุดุชูโ **URI** ุฑุง ุงุนุชุจุงุฑุณูุฌ ฺฉูุฏ ุง ฺฉ URI ุฑุง ุจู ุจุฎุดโูุง ุชุดฺฉูโุฏููุฏูโุงุด ุชูุณู ฺฉูุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ูโุชูุงูุฏ URI ุฑุง ุตุฑูุงู ูุซู ฺฉ ุฑุดุชู ุฏุฑ ูุธุฑ ุจฺฏุฑุฏโุจุดุชุฑ ูุชุฏูุง ุดุจฺฉูโุง ูู **overload** ุดุฏูโุงูุฏ ุชุง ูู ฺฉ ุดุก **Uri** ู ูู ฺฉ ุฑุดุชู ุฑุง ุจูพุฐุฑูุฏ.

ูโุชูุงูุฏ ฺฉ ุดุก **Uri** ุฑุง ุจุง ุนุจูุฑ ุฏุงุฏู ูุฑฺฉุฏุงู ุงุฒ ุฑุดุชูโูุง ุฒุฑ ุจู ุณุงุฒูุฏูโุงุด ุงุฌุงุฏ ฺฉูุฏ:

* ฺฉ ุฑุดุชูโ **URI**ุ ูุซู:
  `http://www.ebay.com` ุง `file://janespc/sharedpics/dolphin.jpg`
* ฺฉ ูุณุฑ ูุทูู ุจู ฺฉ ูุงู ุฑู ูุงุฑุฏ ุฏุณฺฉุ ูุซู:
  `c:\myfiles\data.xlsx` (ุฑู ููุฏูุฒ) ุง `/tmp/myfiles/data.xlsx` (ุฑู ููฺฉุณ)
* ฺฉ ูุณุฑ **UNC** ุจู ฺฉ ูุงู ุฏุฑ ุดุจฺฉู LANุ ูุซู:
  `\\janespc\sharedpics\dolphin.jpg`

ูุณุฑูุง ูุงู ู UNC ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ุจู URI ุชุจุฏู ูโุดููุฏ: ูพุฑูุชฺฉู `"file:"` ุงุถุงูู ูโุดูุฏ ู **ุจฺฉโุงุณูุดโูุง** (`\`) ุจู **ููุฑูุงุฑุฏ ุงุณูุดโูุง** (`/`) ุชุจุฏู ูโุดููุฏ. ุณุงุฒูุฏูโูุง **Uri** ููฺูู ูุจู ุงุฒ ุณุงุฎุช ุดุกุ ุฑุดุชูโ ุดูุง ุฑุง ฺฉู ูพุงฺฉโุณุงุฒ ูโฺฉููุฏุ ุดุงูู:

* ุชุจุฏู **scheme** ู **hostname** ุจู ุญุฑูู ฺฉูฺฺฉ
* ุญุฐู ูพูุฑุชโูุง ุฎุงู ุง ูพุดโูุฑุถ

ุงฺฏุฑ ุฑุดุชูโ URI ุฑุง ุจุฏูู scheme (ูุซู `www.test.com`) ุจุฏูุฏุ ฺฉ **UriFormatException** ูพุฑุชุงุจ ูโุดูุฏ.

---

ฺฉูุงุณ **Uri** ุฏุงุฑุง propertyูุง ุฒุฑ ุงุณุช:

* **IsLoopback** โ ูุดุฎุต ูโฺฉูุฏ ฺฉู ุขุง URI ุจู ูุฒุจุงู ูุญู (**127.0.0.1**) ุงุดุงุฑู ูโฺฉูุฏ ุง ูู.
* **IsFile** โ ูุดุฎุต ูโฺฉูุฏ ฺฉู ุขุง URI ุจู ฺฉ ูุณุฑ ูุญู ุง UNC ุงุดุงุฑู ุฏุงุฑุฏ ุง ูู (ุจุง **IsUnc**).

ุงฺฏุฑ **IsFile** ููุฏุงุฑ true ุจุฑฺฏุฑุฏุงูุฏุ property ุจู ูุงู **LocalPath** ูุณุฎูโุง ุงุฒ **AbsolutePath** ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ ฺฉู ุจุง ุณุณุชูโุนุงูู ูุญู ุณุงุฒฺฏุงุฑ ุงุณุช (ุจุง ุงุณูุดโูุง ุง ุจฺฉโุงุณูุดโูุง ููุงุณุจ)ุ ู ูโุชูุงูุฏ ุฑู ุขู ูุชุฏูุง ูุซู **File.Open** ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ.

ูููููโูุง **Uri** ููุท propertyูุง **read-only** ุฏุงุฑูุฏ. ุจุฑุง ุชุบุฑ ฺฉ URI ููุฌูุฏุ ุจุงุฏ ฺฉ ุดุก **UriBuilder** ุงุฌุงุฏ ฺฉูุฏโุงู ฺฉูุงุณ propertyูุง ูุงุจูโููุดุชู ุฏุงุฑุฏ ู ูโุชูุงูุฏ ุฏูุจุงุฑู ุจู ฺฉ Uri ุงุฒ ุทุฑู property ุฎูุฏุด ุจู ูุงู **Uri** ุชุจุฏู ุดูุฏ.

---

### ูุชุฏูุง ู ูุซุงูโูุง ๐

ฺฉูุงุณ **Uri** ูุชุฏูุง ุจุฑุง ููุงุณู ู ุชูุฑู ูุณุฑูุง ูุฑุงูู ูโฺฉูุฏ:

```csharp
Uri info = new Uri ("http://www.domain.com:80/info/");
Uri page = new Uri ("http://www.domain.com/info/page.html");

Console.WriteLine (info.Host);     // www.domain.com
Console.WriteLine (info.Port);     // 80
Console.WriteLine (page.Port);     // 80  (Uri ูพูุฑุช ูพุดโูุฑุถ HTTP ุฑุง ูโุดูุงุณุฏ)
Console.WriteLine (info.IsBaseOf (page));   // True

Uri relative = info.MakeRelativeUri (page);
Console.WriteLine (relative.IsAbsoluteUri); // False
Console.WriteLine (relative.ToString());    // page.html
```

ฺฉ **URI ูุณุจ (relative URI)** ูุซู `page.html` ุฏุฑ ุงู ูุซุงูุ ุงฺฏุฑ ุชูุฑุจุงู ูุฑ property ุง ูุชุฏ ุจูโุฌุฒ **IsAbsoluteUri** ู **ToString** ุฑุง ูุฑุงุฎูุงู ฺฉูุฏุ ฺฉ exception ูพุฑุชุงุจ ูโฺฉูุฏ. ูโุชูุงูุฏ ูุณุชููุงู ฺฉ URI ูุณุจ ุจุณุงุฒุฏ:

```csharp
Uri u = new Uri ("page.html", UriKind.Relative);
```

---

### ุงููุช ุงุณูุด ุงูุชูุง `/` โ๏ธ

ุงุณูุด ุงูุชูุง ุฏุฑ ฺฉ URI ููู ุงุณุช ู ุฑู ูพุฑุฏุงุฒุด ุฏุฑุฎูุงุณุช ุชูุณุท ุณุฑูุฑ ุชุฃุซุฑ ูโฺฏุฐุงุฑุฏ.

ุจุฑุง ูุซุงูุ ุฏุฑ ฺฉ ุณุฑูุฑ ูุจ ุณูุช:

* URI ุจู ุดฺฉู `http://www.albahari.com/nutshell/` โ ุณุฑูุฑ ุฏุฑ ูพูุดูโ `nutshell` ุฌุณุชโูุฌู ูโฺฉูุฏ ู ูุงู ูพุดโูุฑุถ (ูุนูููุงู `index.html`) ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ.
* URI ุจุฏูู ุงุณูุด ุงูุชูุง `http://www.albahari.com/nutshell` โ ุณุฑูุฑ ุจู ุฏูุจุงู ูุงู ุจู ูุงู `nutshell` (ุจุฏูู ูพุณููุฏ) ุฏุฑ ูพูุดูโ ุฑุดู ูโฺฏุฑุฏุฏ. ุงฺฏุฑ ฺูู ูุงู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ุงุบูุจ ฺฉ ุฎุทุง **301 Permanent Redirect** ุจุฑูโฺฏุฑุฏุงูุฏ ู ูพุดููุงุฏ ูโฺฉูุฏ ฺฉู ฺฉูุงูุช ุฏูุจุงุฑู ุจุง ุงุณูุด ุงูุชูุง ุฏุฑุฎูุงุณุช ุจูุฑุณุชุฏ.

ฺฉูุงูุชโูุง HTTP ุฏุฑ .NET ุจูโุทูุฑ ูพุดโูุฑุถ ููุงููุฏ ูุฑูุฑฺฏุฑูุง ุนูู ูโฺฉููุฏ ู ุจูโุทูุฑ ุดูุงู ุฏุฑุฎูุงุณุช ุฑุง ุจุง URI ูพุดููุงุฏ ุฏูุจุงุฑู ุงุฑุณุงู ูโฺฉููุฏ. ุงู ุนู ุงฺฏุฑ ุงุณูุด ุงูุชูุง ุฑุง ูุฑุงููุด ฺฉูุฏุ ุฏุฑุฎูุงุณุช ููฺูุงู ฺฉุงุฑ ุฎูุงูุฏ ฺฉุฑุฏโุงูุง ฺฉ **ุฑูุชโูโุจุฑฺฏุดุช ุงุถุงููโ ุบุฑุถุฑูุฑ** ุงุฌุงุฏ ูโุดูุฏ.

---

### ูุชุฏูุง ุงุณุชุงุชฺฉ ููุฏ ๐

ฺฉูุงุณ **Uri** ูุชุฏูุง ฺฉูฺฉ ุงุณุชุงุชฺฉ ูุฒ ุฏุงุฑุฏุ ูุซู:

* **EscapeUriString()** โ ฺฉ ุฑุดุชู ุฑุง ุจู ฺฉ URL ูุนุชุจุฑ ุชุจุฏู ูโฺฉูุฏ (ฺฉุงุฑุงฺฉุชุฑูุง ุจุง ููุฏุงุฑ ASCII ุจุดุชุฑ ุงุฒ ฑฒท ุฑุง ุจู ููุงุด ูฺฏุฒุงุฏุณูุงู ุชุบุฑ ูโุฏูุฏ).
* **CheckHostName()** ู **CheckSchemeName()** โ ุจุฑุฑุณ ูโฺฉููุฏ ฺฉู ุขุง ฺฉ ุฑุดุชู ุงุฒ ูุธุฑ ูุญู ุจุฑุง property ูุฑุจูุทู ูุนุชุจุฑ ุงุณุช ุง ูู (ุงูุง ูุฌูุฏ ูุฒุจุงู ุง URI ุฑุง ุจุฑุฑุณ ููโฺฉููุฏ).

---

## HttpClient ๐

ฺฉูุงุณ **HttpClient** ฺฉ API ูุฏุฑู ุจุฑุง ุนููุงุช ฺฉูุงูุช HTTP ุงุฑุงุฆู ูโุฏูุฏ ู ุฌุงฺฏุฒู **WebClient** ู **WebRequest/WebResponse** (ฺฉู ุงฺฉููู **obsolete** ุดุฏูโุงูุฏ) ุงุณุช.

ุงู ฺฉูุงุณ ุฏุฑ ูุงฺฉูุด ุจู ุฑุดุฏ **APIูุง ูุจ ูุจุชู ุจุฑ HTTP** ู **ุณุฑูุณโูุง REST** ุทุฑุงุญ ุดุฏ ู ุชุฌุฑุจูโ ุจูุชุฑ ุจุฑุง ูพุฑูุชฺฉูโูุง ูพฺุฏูโุชุฑ ุงุฒ ููุท ุฏุฑุงูุช ฺฉ ุตูุญูโ ูุจ ุงุฑุงุฆู ูโุฏูุฏ.

### ูุงุจูุชโูุง ฺฉูุฏ HttpClient โ

* ฺฉ ูููููโ **HttpClient** ูโุชูุงูุฏ ุฏุฑุฎูุงุณุชโูุง ููโุฒูุงู ุฑุง ูุฏุฑุช ฺฉูุฏ ู ุจูโุฎูุจ ุจุง ูุงุจูุชโูุง ูุซู **ูุฏุฑูุง ุณูุงุฑุดุ ฺฉูฺฉโูุง ู ุฑูุดโูุง ุงุญุฑุงุฒ ููุช** ฺฉุงุฑ ฺฉูุฏ.
* ุงุฌุงุฒู ูโุฏูุฏ **Message Handler**ูุง ุณูุงุฑุด ุจููุณุฏ ู ุงุถุงูู ฺฉูุฏ โ ุจุฑุง **mocking** ุฏุฑ ุชุณุชโูุง ูุงุญุฏ ู ุงุฌุงุฏ **pipelineูุง ุณูุงุฑุด** (ูุซู ูุงฺฏโุจุฑุฏุงุฑุ ูุดุฑุฏูโุณุงุฒุ ุฑูุฒูฺฏุงุฑ ู โฆ).
* ฺฉ ุณุณุชู ููุน (type system) ุบู ู ูุงุจูโฺฏุณุชุฑุด ุจุฑุง **Headers** ู **Content** ุฏุงุฑุฏ.

โ๏ธ **HttpClient ุงุฒ ฺฏุฒุงุฑุด ูพุดุฑูุช (progress reporting) ูพุดุชุจุงู ููโฺฉูุฏ**. ุจุฑุง ุฑุงูโุญูุ ูโุชูุงูุฏ ุจู ูููููโ `HttpClient with Progress.linq` ุฏุฑ ุณุงุช ููุณูุฏู ุง ฺฏุงูุฑ ูููููโูุง LINQPad ูุฑุงุฌุนู ฺฉูุฏ.

---

### ุงุณุชูุงุฏูโ ุณุงุฏู ุงุฒ HttpClient ๐

ุณุงุฏูโุชุฑู ุฑูุด: ูููููโุณุงุฒ ู ุงุณุชูุงุฏู ุงุฒ ูุชุฏูุง **Get\***:

```csharp
string html = await new HttpClient().GetStringAsync ("http://linqpad.net");
```

ููฺูู ูุชุฏูุง **GetByteArrayAsync** ู **GetStreamAsync** ูุฌูุฏ ุฏุงุฑูุฏ. ุชูุงู ูุชุฏูุง I/O ุฏุฑ **HttpClient** ุจูโุตูุฑุช **asynchronous** ูุณุชูุฏ.

๐ก ุจุฑุฎูุงู WebRequest/WebResponseุ ุจุฑุง ุจูุชุฑู ฺฉุงุฑุง ุจุงุฏ ุงุฒ **ฺฉ ูููููโ HttpClient** ุงุณุชูุงุฏูโ ูุฌุฏุฏ ฺฉูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ุนููุงุชโูุง ูุซู **DNS resolution** ุฏูุจุงุฑู ู ุฏูุจุงุฑู ุงูุฌุงู ูโุดููุฏ ู **ุณุงฺฉุชโูุง** (sockets) ุจุดุชุฑ ุงุฒ ุญุฏ ูุงุฒู ุจุงุฒ ูโูุงููุฏ.

ููููู:

```csharp
var client = new HttpClient();
var task1 = client.GetStringAsync ("http://www.linqpad.net");
var task2 = client.GetStringAsync ("http://www.albahari.com");

Console.WriteLine (await task1);
Console.WriteLine (await task2);
```

---

### ูฺฺฏโูุง ู ูพฺฉุฑุจูุฏ โ๏ธ

* **Timeout** โ ุชุนู ูโฺฉูุฏ ฺฉ ุฏุฑุฎูุงุณุช ฺูุฏุฑ ูโุชูุงูุฏ ุทูู ุจฺฉุดุฏ.
* **BaseAddress** โ ฺฉ URI ูพุงู ุจู ูููโ ุฏุฑุฎูุงุณุชโูุง ุงุถุงูู ูโฺฉูุฏ.

ุจุดุชุฑ propertyูุง ุฏฺฏุฑ ุฏุฑ ฺฉูุงุณ **HttpClientHandler** ุชุนุฑู ุดุฏูโุงูุฏ. ุจุฑุง ุฏุณุชุฑุณ ุจู ุขู:

```csharp
var handler = new HttpClientHandler { UseProxy = false };
var client = new HttpClient (handler);
```

ุฏุฑ ุงู ูุซุงูุ **ูพุดุชุจุงู ุงุฒ Proxy** ุบุฑูุนุงู ุดุฏ ุชุง ูุฒููโ ุดูุงุณุง ุฎูุฏฺฉุงุฑ Proxy ุญุฐู ุดูุฏ ู ฺฉุงุฑุง ุงูุฒุงุด ุงุจุฏ.

ฺฉูุงุณ **HttpClientHandler** ููฺูู propertyูุง ุจุฑุง ฺฉูุชุฑู **ฺฉูฺฉโูุงุ ุฑุฏุงุฑฺฉุช ุฎูุฏฺฉุงุฑุ ุงุญุฑุงุฒ ููุช** ู โฆ ุฏุงุฑุฏ.

---

### GetAsync ู Response Messages ๐ฉ

ูุชุฏูุง **GetStringAsync**ุ **GetByteArrayAsync** ู **GetStreamAsync** ูุงูุจุฑูุง ุจุฑุง ูุชุฏ ุนูููโุชุฑ **GetAsync** ูุณุชูุฏ ฺฉู ฺฉ **HttpResponseMessage** ุจุฑูโฺฏุฑุฏุงูุฏ:

```csharp
var client = new HttpClient();
// GetAsync ููฺูู ฺฉ CancellationToken ูโูพุฐุฑุฏ
HttpResponseMessage response = await client.GetAsync ("http://...");

response.EnsureSuccessStatusCode();
string html = await response.Content.ReadAsStringAsync();
```

* **HttpResponseMessage** โ ุฏุณุชุฑุณ ุจู **Headers** ู **StatusCode**.
* ุงฺฏุฑ **status code ูุงูููู** ูุซู ดฐด ุจุฑฺฏุฑุฏุฏุ exception ูพุฑุชุงุจ ููโุดูุฏ ูฺฏุฑ ุงูฺฉู **EnsureSuccessStatusCode** ุฑุง ุตุฑุญุงู ูุฑุงุฎูุงู ฺฉูุฏ.
* ุฎุทุงูุง ุงุฑุชุจุงุท ุง DNS โ ููุดู exception ูพุฑุชุงุจ ูโฺฉููุฏ.

ููฺููุ **HttpContent** ูุชุฏ ุจู ูุงู **CopyToAsync** ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ุฎุฑูุฌ ุฑุง ุจู ฺฉ **Stream ุฏฺฏุฑ** ุจููุณุฏ:

```csharp
using (var fileStream = File.Create ("linqpad.html"))
  await response.Content.CopyToAsync (fileStream);
```

ูุชุฏ **GetAsync** ฺฉ ุงุฒ ฺูุงุฑ ูุชุฏ ูุชูุงุธุฑ ุจุง ุงูุนุงู HTTP ุงุณุช (ุจูู: **PostAsyncุ PutAsyncุ DeleteAsync**).

---

### SendAsync ู Request Messages ๐จ

ูุชุฏูุง **GetAsyncุ PostAsyncุ PutAsync ู DeleteAsync** ููฺฏ ูุงูุจุฑูุง ุจุฑุง **SendAsync** ูุณุชูุฏุ ูุชุฏ ุณุทุญโูพุงู ฺฉู ููู ฺุฒ ุจู ุขู ุฎุชู ูโุดูุฏ.

ุจุฑุง ุงุณุชูุงุฏู:

```csharp
var client = new HttpClient();
var request = new HttpRequestMessage (HttpMethod.Get, "http://...");
HttpResponseMessage response = await client.SendAsync (request);

response.EnsureSuccessStatusCode();
```

ุงุฌุงุฏ ฺฉ **HttpRequestMessage** ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ propertyูุง ุฏุฑุฎูุงุณุช ูุซู **Headers** ู **Content** ุฑุง ุดุฎุตโุณุงุฒ ฺฉูุฏุ ฺฉู ุดุงูู ุขูพููุฏ ุฏุงุฏูโูุง ูุฒ ูโุดูุฏ.

### ๐ค ุขูพููุฏ ุฏุงุฏูโูุง ู HttpContent

ุจุนุฏ ุงุฒ ูููููโุณุงุฒ ฺฉ ุดุก ุงุฒ ููุน `HttpRequestMessage`ุ ูโุชูุงูุฏ ุจุง ููุฏุงุฑุฏู ุจู ูฺฺฏ **Content** ุฏุงุฏูโุง ุจุฑุง ุขูพููุฏ ูุดุฎุต ฺฉูุฏ. ููุน ุงู ูฺฺฏ ฺฉ ฺฉูุงุณ ุงูุชุฒุงุน ุจู ูุงู `HttpContent` ุงุณุช. .NET ฺูุฏู ุฒุฑฺฉูุงุณ ูุดุฎุต ุจุฑุง ุงููุงุน ูุฎุชูู ุฏุงุฏู ูุฑุงูู ฺฉุฑุฏู ุงุณุช (ู ุงูุจุชู ูโุชูุงูุฏ ฺฉูุงุณ ุงุฎุชุตุงุต ุฎูุฏุชุงู ุฑุง ูู ุจููุณุฏ):

* `ByteArrayContent`
* `StringContent`
* `FormUrlEncodedContent` (ุจุฎุด **Uploading Form Data** ุฏุฑ ุตูุญู 754 ุฑุง ุจุจูุฏ)
* `StreamContent`

๐น ูุซุงู:

```csharp
var client = new HttpClient (new HttpClientHandler { UseProxy = false });
var request = new HttpRequestMessage (
 HttpMethod.Post, "http://www.albahari.com/EchoPost.aspx");
request.Content = new StringContent ("This is a test");
HttpResponseMessage response = await client.SendAsync (request);
response.EnsureSuccessStatusCode();
Console.WriteLine (await response.Content.ReadAsStringAsync());
```

---

### โ๏ธ HttpMessageHandler

ูุจูุงู ฺฏูุชู ฺฉู ุจุดุชุฑ ูฺฺฏโูุง ุณูุงุฑุดโุณุงุฒ ุฏุฑุฎูุงุณุชโูุง ูู ุฏุฑ `HttpClient` ุจูฺฉู ุฏุฑ `HttpClientHandler` ุชุนุฑู ุดุฏูโุงูุฏ. ุฏุฑ ูุงูุนุ `HttpClientHandler` ุฒุฑฺฉูุงุณ ุงุฒ ฺฉูุงุณ ุงูุชุฒุงุน `HttpMessageHandler` ุงุณุช ฺฉู ุจู ุดฺฉู ุฒุฑ ุชุนุฑู ูโุดูุฏ:

```csharp
public abstract class HttpMessageHandler : IDisposable
{
  protected internal abstract Task<HttpResponseMessage> SendAsync
    (HttpRequestMessage request, CancellationToken cancellationToken);
  public void Dispose();
  protected virtual void Dispose (bool disposing);
}
```

ูุชุฏ `SendAsync` ุฏุฑูู ูุชุฏ `SendAsync` ฺฉูุงุณ `HttpClient` ูุฑุงุฎูุงู ูโุดูุฏ.
`HttpMessageHandler` ุจู ุงูุฏุงุฒูโุง ุณุงุฏู ุงุณุช ฺฉู ุจุชูุงู ุจูโุฑุงุญุช ุขู ุฑุง ุฒุฑฺฉูุงุณ ฺฉุฑุฏ ู ุฏุฑ ูุชุฌูุ ฺฉ ููุทูโ ุชูุณุนูโูพุฐุฑ ุจุฑุง `HttpClient` ูุฑุงูู ูโฺฉูุฏ.

---

### ๐งช Unit Testing ู Mocking

ูโุชูุงูู `HttpMessageHandler` ุฑุง ุฒุฑฺฉูุงุณ ฺฉูู ุชุง ฺฉ **Mocking Handler** ุจุฑุง ฺฉูฺฉ ุจู ุชุณุช ูุงุญุฏ ุจุณุงุฒู:

```csharp
class MockHandler : HttpMessageHandler
{
  Func <HttpRequestMessage, HttpResponseMessage> _responseGenerator;
  public MockHandler
    (Func <HttpRequestMessage, HttpResponseMessage> responseGenerator)
  {
    _responseGenerator = responseGenerator;
  }
  protected override Task <HttpResponseMessage> SendAsync
    (HttpRequestMessage request, CancellationToken cancellationToken)
  {
    cancellationToken.ThrowIfCancellationRequested();
    var response = _responseGenerator (request);
    response.RequestMessage = request;
    return Task.FromResult (response);
  }
}
```

๐น ุณุงุฒูุฏูโ ุงู ฺฉูุงุณ ฺฉ ุชุงุจุน ุฏุฑุงูุช ูโฺฉูุฏ ฺฉู ูุดุฎุต ูโฺฉูุฏ ูพุงุณุฎ ุงุฒ ุฑู ุฏุฑุฎูุงุณุช ฺฺฏููู ุณุงุฎุชู ุดูุฏ. ุงู ุฑูฺฉุฑุฏ ุจุณุงุฑ ุงูุนุทุงูโูพุฐุฑ ุงุณุช ุฒุฑุง ููุงู ููุฏูุฑ ูโุชูุงูุฏ ฺูุฏู ุฏุฑุฎูุงุณุช ูุฎุชูู ุฑุง ุชุณุช ฺฉูุฏ.

ูุชุฏ `SendAsync` ุฏุฑ ุงูุฌุง ุจูโุตูุฑุช **ููฺฏุงู** ุนูู ูโฺฉูุฏ ฺูู ุงุฒ `Task.FromResult` ุงุณุชูุงุฏู ฺฉุฑุฏูโุงู. ุงูุจุชู ูโุชูุงูุณุชู ุจุง ุจุฑฺฏุฑุฏุงูุฏู `Task<HttpResponseMessage>` ุงุฒ ุชุงุจุน ูพุงุณุฎโุณุงุฒุ ุญุงูุช **ุบุฑููฺฏุงู** ุฑุง ูู ุญูุธ ฺฉููุ ุงูุง ุงุฒ ุขูุฌุง ฺฉู ุชุงุจุน Mock ูุนูููุงู ฺฉูุชุงู ู ุณุฑุน ุงุณุชุ ุถุฑูุฑุช ูุฏุงุฑุฏ.

๐น ูุญููโ ุงุณุชูุงุฏู:

```csharp
var mocker = new MockHandler (request => 
  new HttpResponseMessage (HttpStatusCode.OK)
  {
    Content = new StringContent ("You asked for " + request.RequestUri)
  });
var client = new HttpClient (mocker);    
var response = await client.GetAsync ("http://www.linqpad.net");
string result = await response.Content.ReadAsStringAsync();
Assert.AreEqual ("You asked for http://www.linqpad.net/", result);
```

(`Assert.AreEqual` ูุชุฏ ุงุณุช ฺฉู ูุนูููุงู ุฏุฑ ูุฑูโูุฑฺฉโูุง ุชุณุช ูุงุญุฏ ูุซู NUnit ุงุณุชูุงุฏู ูโุดูุฏ.)

---

### ๐ ุฒูุฌุฑูโุณุงุฒ ููุฏูุฑูุง ุจุง DelegatingHandler

ูโุชูุงูุฏ ฺฉ Message Handler ุจุณุงุฒุฏ ฺฉู ฺฉ ููุฏูุฑ ุฏฺฏุฑ ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ (ู ุฏุฑ ูุชุฌู ุฒูุฌุฑูโุง ุงุฒ ููุฏูุฑูุง ุงุฌุงุฏ ุดูุฏ). ุงู ฺฉุงุฑ ุงุฒ ุทุฑู ุฒุฑฺฉูุงุณ ฺฉุฑุฏู `DelegatingHandler` ุงูุฌุงู ูโุดูุฏ. ุจุง ุงู ุฑูุด ูโุชูุงูุฏ ูพุฑูุชฺฉูโูุง ุณูุงุฑุด ูุงููุฏ **ุงุญุฑุงุฒ ููุชุ ูุดุฑุฏูโุณุงุฒ ู ุฑูุฒฺฏุฐุงุฑ** ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ.

๐น ูููููโ ฺฉ ููุฏูุฑ ูุงฺฏ ุณุงุฏู:

```csharp
class LoggingHandler : DelegatingHandler 
{
  public LoggingHandler (HttpMessageHandler nextHandler)
  {
     InnerHandler = nextHandler;
  }
  protected async override Task <HttpResponseMessage> SendAsync
    (HttpRequestMessage request, CancellationToken cancellationToken)
  {
    Console.WriteLine ("Requesting: " + request.RequestUri);
    var response = await base.SendAsync (request, cancellationToken);
    Console.WriteLine ("Got response: " + response.StatusCode);
    return response;
  }
}
```

โ ุฏุฑ ุงูุฌุง ูุง **ุบุฑููุฒูุงู** ุฑุง ุฏุฑ Override ฺฉุฑุฏู `SendAsync` ุญูุธ ฺฉุฑุฏูโุงู. ุงุณุชูุงุฏู ุงุฒ `async` ุฏุฑ ูุชุฏูุง ฺฉู ุฎุฑูุฌ Task ุฏุงุฑูุฏ ูู ูุงููู ุงุณุช ู ูู ุฏุฑ ุงูุฌุง ูุทููุจ.

---

### ๐ ูพุฑูฺฉุณ (Proxy)

ฺฉ **Proxy Server** ูุงุณุทูโุง ุงุณุช ฺฉู ุฏุฑุฎูุงุณุชโูุง HTTP ุงุฒ ุทุฑู ุขู ูุณุฑุฏู ูโุดููุฏ. ุณุงุฒูุงูโูุง ูุนูููุงู ุจุฑุง ุฏุณุชุฑุณ ฺฉุงุฑฺฉูุงู ุจู ุงูุชุฑูุช ุงุฒ ุทุฑู ฺฉ ูพุฑูฺฉุณ ุงุณุชูุงุฏู ูโฺฉููุฏ ฺูู ูุฏุฑุช ุงููุช ุฑุง ุณุงุฏูโุชุฑ ูโฺฉูุฏ. ูพุฑูฺฉุณ ุขุฏุฑุณ ุฎูุฏุด ุฑุง ุฏุงุฑุฏ ู ูโุชูุงูุฏ ุงุญุฑุงุฒ ููุช ุจุฎูุงูุฏ ุชุง ููุท ฺฉุงุฑุจุฑุงู ุงูุชุฎุงุจโุดุฏู ุฏุฑ LAN ุจู ุงูุชุฑูุช ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏ.

ุจุฑุง ุงุณุชูุงุฏู ุงุฒ Proxy ุฏุฑ `HttpClient`:

```csharp
WebProxy p = new WebProxy ("192.178.10.49", 808);
p.Credentials = new NetworkCredential ("username", "password", "domain");
var handler = new HttpClientHandler { Proxy = p };
var client = new HttpClient (handler);
...
```

ูฺฺฏ `UseProxy` ุฏุฑ `HttpClientHandler` ุฑุง ูโุชูุงู ุฑู `false` ุชูุธู ฺฉุฑุฏ ุชุง ุจู ุฌุง null ฺฉุฑุฏู `Proxy`ุ ุชุดุฎุต ุฎูุฏฺฉุงุฑ ุบุฑูุนุงู ุดูุฏ.

ุงฺฏุฑ ููฺฏุงู ุณุงุฎุชู `NetworkCredential` ฺฉ **ุฏุงููู** ูุดุฎุต ฺฉูุฏุ ูพุฑูุชฺฉูโูุง ุงุญุฑุงุฒ ููุช ูุจุชู ุจุฑ ููุฏูุฒ (NTLM ุง Kerberos) ุงุณุชูุงุฏู ูโุดููุฏ. ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ฺฉุงุฑุจุฑ ูุนู ููุฏูุฒุ ููุฏุงุฑ `CredentialCache.DefaultNetworkCredentials` ุฑุง ุจู ูฺฺฏ `Credentials` ูพุฑูฺฉุณ ุงุฎุชุตุงุต ุฏูุฏ.

ููฺูู ุจูโุฌุง ุชูุธู Proxy ุฏุฑ ูุฑ ุจุงุฑ ุงุณุชูุงุฏูุ ูโุชูุงูุฏ ููุฏุงุฑ ูพุดโูุฑุถ ุณุฑุงุณุฑ ุฑุง ูุดุฎุต ฺฉูุฏ:

```csharp
HttpClient.DefaultWebProxy = myWebProxy;
```

---

### ๐ ุงุญุฑุงุฒ ููุช (Authentication)

ูโุชูุงูุฏ ูุงู ฺฉุงุฑุจุฑ ู ุฑูุฒ ุนุจูุฑ ุฑุง ุจู ุงู ุตูุฑุช ุจู `HttpClient` ุจุฏูุฏ:

```csharp
string username = "myuser";
string password = "mypassword";
var handler = new HttpClientHandler();
handler.Credentials = new NetworkCredential (username, password);
var client = new HttpClient (handler);
...
```

ุงู ุฑูุด ุจุง ูพุฑูุชฺฉูโูุง ูุจุชู ุจุฑ ุฏุงููฺฏ ูุซู **Basic** ู **Digest** ฺฉุงุฑ ูโฺฉูุฏ ู ุงุฒ ุทุฑู ฺฉูุงุณ `AuthenticationManager` ูุฒ ูุงุจู ฺฏุณุชุฑุด ุงุณุช. ููฺูู ุงุฒ **Windows NTLM** ู **Kerberos** ูู ูพุดุชุจุงู ูโฺฉูุฏ (ุงฺฏุฑ ููฺฏุงู ุณุงุฎุชู `NetworkCredential` ุฏุงููู ูุงุฑุฏ ฺฉุฑุฏู ุจุงุดุฏ). ุงฺฏุฑ ุจุฎูุงูุฏ ุงุฒ ฺฉุงุฑุจุฑ ูุนู ููุฏูุฒ ุงุณุชูุงุฏู ฺฉูุฏุ ฺฉุงู ุงุณุช ูฺฺฏ `Credentials` ุฑุง ููุฏุงุฑุฏู ูฺฉูุฏ ู ุจูโุฌุง ุขู `UseDefaultCredentials = true` ุชูุธู ฺฉูุฏ.

ููุช ุงุทูุงุนุงุช ูุฑูุฏ (Credentials) ุฑุง ูุดุฎุต ูโฺฉูุฏุ `HttpClient` ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ูพุฑูุชฺฉู ููุงุณุจ ุฑุง ูุฐุงฺฉุฑู ูโฺฉูุฏ. ุฏุฑ ุจุฑุฎ ููุงุฑุฏ ฺฏุฒููโูุง ูุฎุชูู ูุฌูุฏ ุฏุงุฑุฏุ ุจุฑุง ูุซุงูุ ูพุงุณุฎ ุงูููโ ฺฉ ุณุฑูุฑ Microsoft Exchange Web Mail ููฺฉู ุงุณุช ุดุงูู ูุฏุฑูุง ุฒุฑ ุจุงุดุฏ:

```
HTTP/1.1 401 Unauthorized
Content-Length: 83
Content-Type: text/html
Server: Microsoft-IIS/6.0
WWW-Authenticate: Negotiate
WWW-Authenticate: NTLM
WWW-Authenticate: Basic realm="exchange.somedomain.com"
X-Powered-By: ASP.NET
Date: Sat, 05 Aug 2006 12:37:23 GMT
```

ฺฉุฏ **401** ุจู ูุนูุง ูุงุฒ ุจู ุงุญุฑุงุฒ ููุช ุงุณุชุ ูุฏุฑูุง `WWW-Authenticate` ูู ูุดุงู ูโุฏููุฏ ฺู ูพุฑูุชฺฉูโูุง ูพุดุชุจุงู ูโุดููุฏ.

ุงฺฏุฑ `HttpClientHandler` ุฑุง ุจุง ูุงู ฺฉุงุฑุจุฑ ู ุฑูุฒ ุฏุฑุณุช ูพฺฉุฑุจูุฏ ฺฉูุฏุ ุงู ูพุงู ุฑุง ูุฎูุงูุฏ ุฏุฏ ฺูู ุฒูุงู ุงุฌุฑุง ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ฺฉ ูพุฑูุชฺฉู ุณุงุฒฺฏุงุฑ ุงูุชุฎุงุจ ูโฺฉูุฏุ ุฏุฑุฎูุงุณุช ุงุตู ุฑุง ุฏูุจุงุฑู ุงุฑุณุงู ูโฺฉูุฏ ู ฺฉ ูุฏุฑ ุงุถุงู ุงุถุงูู ูโฺฉูุฏ.

ูุซุงู:

```
Authorization: Negotiate TlRMTVNTUAAABAAAt5II2gjACDArAAACAwACACgAAAAQ
ATmKAAAAD0lVDRdPUksHUq9VUA==
```

ุงู ูฺฉุงูุฒู ุดูุงู ุงุณุชุ ุงูุง ุจุงุนุซ ูโุดูุฏ ูุฑ ุฏุฑุฎูุงุณุช ฺฉ ุฑูุชโูุจุฑฺฏุดุช ุงุถุงู ุงุฌุงุฏ ฺฉูุฏ. ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงู ููุถูุน ุฏุฑ ุฏุฑุฎูุงุณุชโูุง ุจุนุฏ ุจู ููุงู URIุ ูโุชูุงูุฏ ูฺฺฏ `PreAuthenticate` ุฏุฑ `HttpClientHandler` ุฑุง ุฑู true ูุฑุงุฑ ุฏูุฏ.

### ๐ CredentialCache

ูโุชูุงูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุดุก `CredentialCache` ฺฉ **ูพุฑูุชฺฉู ุงุญุฑุงุฒ ููุช ุฎุงุต** ุฑุง ูุฌุจูุฑ ฺฉูุฏ.
ฺฉ Credential Cache ุดุงูู ฺฉ ุง ฺูุฏ ุดุก `NetworkCredential` ุงุณุช ฺฉู ูุฑฺฉุฏุงู ุจู ฺฉ ูพุฑูุชฺฉู ู ฺฉ **URI prefix** ุฎุงุต ูุชุตู ูุณุชูุฏ.

ุจูโุนููุงู ูุซุงูุ ููฺฉู ุงุณุช ุจุฎูุงูุฏ ุฏุฑ ููฺฏุงู ูุฑูุฏ ุจู **Exchange Server** ุงุฒ ูพุฑูุชฺฉู Basic ุงุณุชูุงุฏู ูฺฉูุฏ (ฺูู ุฑูุฒูุง ุฑุง ุจู ุตูุฑุช **ูุชู ุณุงุฏู** ุงุฑุณุงู ูโฺฉูุฏ):

```csharp
CredentialCache cache = new CredentialCache();
Uri prefix = new Uri ("http://exchange.somedomain.com");
cache.Add (prefix, "Digest",  new NetworkCredential ("joe", "passwd"));
cache.Add (prefix, "Negotiate", new NetworkCredential ("joe", "passwd"));
var handler = new HttpClientHandler();
handler.Credentials = cache;
...
```

ูพุฑูุชฺฉู ุงุญุฑุงุฒ ููุช ุจู ุตูุฑุช ุฑุดุชูโุง ูุดุฎุต ูโุดูุฏ. ููุงุฏุฑ ูุนุชุจุฑ ุดุงูู ููุงุฑุฏ ุฒุฑ ูุณุชูุฏ:
`Basic`, `Digest`, `NTLM`, `Kerberos`, `Negotiate`

๐น ุฏุฑ ุงู ูุซุงูุ ูพุฑูุชฺฉู **Negotiate** ุงูุชุฎุงุจ ูโุดูุฏ ฺูู ุณุฑูุฑ ุฏุฑ ูุฏุฑูุง ุงุญุฑุงุฒ ููุช ุฎูุฏ ูพุดุชุจุงู ุงุฒ Digest ุฑุง ุงุนูุงู ูฺฉุฑุฏู ุงุณุช.
Negotiate ฺฉ ูพุฑูุชฺฉู ููุฏูุฒ ุงุณุช ฺฉู ุฏุฑ ุนูู ุจู **Kerberos** ุง **NTLM** ุชุฑุฌูู ูโุดูุฏุ ุจุณุชู ุจู ุงูฺฉู ุณุฑูุฑ ฺู ูุงุจูุช ุฏุงุดุชู ุจุงุดุฏ. ุงู ูฺฉุงูุฒู ุจุงุนุซ ูโุดูุฏ ุงูพูฺฉุดู ุดูุง ุฏุฑ ุจุฑุงุจุฑ ุงุณุชุงูุฏุงุฑุฏูุง ุงููุช ุขูุฏู ูู **ุณุงุฒฺฏุงุฑ** ุจุงู ุจูุงูุฏ.

ุจุฑุง ุงูุฒูุฏู ฺฉุงุฑุจุฑ ูุนู ููุฏูุฒ ุจู Credential Cache ุจุฏูู ูุงุฒ ุจู ุฑูุฒ ุนุจูุฑุ ูโุชูุงูุฏ ุงุฒ ูฺฺฏ ุงุณุชุง `CredentialCache.DefaultNetworkCredentials` ุงุณุชูุงุฏู ฺฉูุฏ:

```csharp
cache.Add (prefix, "Negotiate", CredentialCache.DefaultNetworkCredentials);
```

---

### ๐จ ุงุญุฑุงุฒ ููุช ุงุฒ ุทุฑู Header

ุฑุงู ุฏฺฏุฑ ุงุญุฑุงุฒ ููุชุ ุชูุธู ูุณุชูู **ูุฏุฑ ุงุญุฑุงุฒ ููุช** ุงุณุช:

```csharp
var client = new HttpClient();
client.DefaultRequestHeaders.Authorization = 
  new AuthenticationHeaderValue ("Basic",
    Convert.ToBase64String (Encoding.UTF8.GetBytes ("username:password")));
...
```

ุงู ุงุณุชุฑุงุชฺ ุจุง ุณุณุชูโูุง ุงุญุฑุงุฒ ููุช ุณูุงุฑุด ูุซู **OAuth** ูู ฺฉุงุฑ ูโฺฉูุฏ.

---

### ๐ ูุฏุฑูุง (Headers)

`HttpClient` ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ฺฉู ุจู ฺฉ ุฏุฑุฎูุงุณุชุ ูุฏุฑูุง HTTP ุณูุงุฑุด ุงุถุงูู ฺฉูุฏ ุง ูุฏุฑูุง ูพุงุณุฎ ุฑุง ูุฑูุฑ ฺฉูุฏ.
ฺฉ ูุฏุฑ ุฏุฑ ุงุตู ฺฉ ุฌูุช **ฺฉูุฏ/ููุฏุงุฑ** ุงุณุช ฺฉู ุดุงูู **ูุชุงุฏุชุง** ูโุดูุฏ (ูุซู ููุน ูุญุชูุง ูพุงู ุง ูุฑูโุงูุฒุงุฑ ุณุฑูุฑ).

* ูฺฺฏ `DefaultRequestHeaders` ุจุฑุง ูุฏุฑูุง ุงุณุช ฺฉู ุฑู **ูููโ ุฏุฑุฎูุงุณุชโูุง** ุงุนูุงู ูโุดููุฏ:

```csharp
var client = new HttpClient (handler);
client.DefaultRequestHeaders.UserAgent.Add (
  new ProductInfoHeaderValue ("VisualStudio", "2022"));
client.DefaultRequestHeaders.Add ("CustomHeader", "VisualStudio/2022");
```

* ูฺฺฏ `Headers` ุฏุฑ ฺฉูุงุณ `HttpRequestMessage` ูุฎุตูุต ูุฏุฑูุง ุฎุงุต ููุงู ุฏุฑุฎูุงุณุช ุงุณุช.

---

### โ Query Strings

**Query String** ุฑุดุชูโุง ุงุณุช ฺฉู ุจู URI ุงุถุงูู ูโุดูุฏ (ุจุนุฏ ุงุฒ ุนูุงูุช ุณุคุงู) ู ุจุฑุง ุงุฑุณุงู ุฏุงุฏูโูุง ุณุงุฏู ุจู ุณุฑูุฑ ุงุณุชูุงุฏู ูโุดูุฏ.

๐น ุณุงุฎุชุงุฑ ฺฉู:

```
?key1=value1&key2=value2&key3=value3...
```

ูุซุงู:

```csharp
string requestURI = "http://www.google.com/search?q=HttpClient&hl=fr";
```

ุงฺฏุฑ ุงุญุชูุงู ุฏุงุฑุฏ Query ุดุงูู **ฺฉุงุฑุงฺฉุชุฑูุง ุฎุงุต ุง ูุงุตูู** ุจุงุดุฏุ ูโุชูุงูุฏ ุงุฒ ูุชุฏ `EscapeDataString` ุฏุฑ ฺฉูุงุณ `Uri` ุงุณุชูุงุฏู ฺฉูุฏ ุชุง URI ูุนุชุจุฑ ุชููุฏ ุดูุฏ:

```csharp
string search = Uri.EscapeDataString ("(HttpClient or HttpRequestMessage)");
string language = Uri.EscapeDataString ("fr");
string requestURI = "http://www.google.com/search?q=" + search +
                   "&hl=" + language;
```

๐น ูุชุฌู:

```
http://www.google.com/search?q=(HttpClient%20OR%20HttpRequestMessage)&hl=fr
```

(ูุชุฏ `EscapeDataString` ุดุจู `EscapeUriString` ุงุณุชุ ุจุง ุงู ุชูุงูุช ฺฉู ฺฉุงุฑุงฺฉุชุฑูุง ูุซู `&` ู `=` ุฑุง ูู ฺฉุฏฺฏุฐุงุฑ ูโฺฉูุฏุ ฺูู ุฏุฑ ุบุฑ ุงู ุตูุฑุช Query String ุฑุง ุจูโูู ูโุฑุฒุฏ.)

---

### ๐ค ุขูพููุฏ ุฏุงุฏูโูุง ูุฑู (Uploading Form Data)

ุจุฑุง ุขูพููุฏ ุฏุงุฏูโูุง ูุฑู HTMLุ ฺฉ ุดุก ุงุฒ ููุน `FormUrlEncodedContent` ุจุณุงุฒุฏ ู ููุงุฏุฑ ุฑุง ุฏุฑ ุขู ูุฑุงุฑ ุฏูุฏ. ุณูพุณ ูโุชูุงูุฏ ุขู ุฑุง ุจู ูุชุฏ `PostAsync` ุจุฏูุฏ ุง ุจู ูฺฺฏ `Content` ฺฉ ุฏุฑุฎูุงุณุช ุงุฎุชุตุงุต ุฏูุฏ:

```csharp
string uri = "http://www.albahari.com/EchoPost.aspx";
var client = new HttpClient();
var dict = new Dictionary<string,string> 
{
    { "Name", "Joe Albahari" },
    { "Company", "O'Reilly" }
};
var values = new FormUrlEncodedContent (dict);
var response = await client.PostAsync (uri, values);
response.EnsureSuccessStatusCode();
Console.WriteLine (await response.Content.ReadAsStringAsync());
```

---

### ๐ช ฺฉูฺฉโูุง (Cookies)

ฺฉ **Cookie** ุฌูุช ุฑุดุชู **ูุงู/ููุฏุงุฑ** ุงุณุช ฺฉู ฺฉ ุณุฑูุฑ HTTP ุฏุฑ ูุฏุฑ ูพุงุณุฎ ุจุฑุง ฺฉูุงูุช ุงุฑุณุงู ูโฺฉูุฏ. ูุฑูุฑฺฏุฑูุง ูุนูููุงู ฺฉูฺฉโูุง ุฑุง ุฐุฎุฑู ูโฺฉููุฏ ู ุฏุฑ ูุฑ ุฏุฑุฎูุงุณุช ุจุนุฏ (ุจู ููุงู ุขุฏุฑุณ) ุฏูุจุงุฑู ุจู ุณุฑูุฑ ูโูุฑุณุชูุฏ ุชุง ุฒูุงู ุงููุถุง.

๐น ูุฏู ฺฉูฺฉ: ุณุฑูุฑ ุจุชูุงูุฏ ุจูููุฏ ุขุง ููฺูุงู ุจุง ููุงู ฺฉูุงูุช ูุจู ุฏุฑ ุงุฑุชุจุงุท ุงุณุช ุง ุฎุฑ (ุจุฏูู ูุงุฒ ุจู Query Stringโูุง ุงุถุงู).

ุจูโุทูุฑ ูพุดโูุฑุถุ `HttpClient` ฺฉูฺฉโูุง ุฏุฑุงูุช ุฑุง **ูุงุฏุฏู ูโฺฏุฑุฏ**. ุจุฑุง ูพุฐุฑุด ฺฉูฺฉโูุง ุจุงุฏ ฺฉ `CookieContainer` ุจุณุงุฒุฏ ู ุขู ุฑุง ุจู `HttpClientHandler` ุงุฎุชุตุงุต ุฏูุฏ:

```csharp
var cc = new CookieContainer();
var handler = new HttpClientHandler();
handler.CookieContainer = cc;
var client = new HttpClient (handler);
...
```

ุจุฑุง ุงุณุชูุงุฏู ูุฌุฏุฏ ุงุฒ ฺฉูฺฉโูุง ุฏุฑ ุฏุฑุฎูุงุณุชโูุง ุจุนุฏุ ฺฉุงู ุงุณุช ุงุฒ ููุงู `CookieContainer` ุฏูุจุงุฑู ุงุณุชูุงุฏู ฺฉูุฏ.
ููฺูู ูโุชูุงูุฏ ฺฉ `CookieContainer` ุชุงุฒู ุจุณุงุฒุฏ ู ฺฉูฺฉโูุง ุฑุง ุจูโุตูุฑุช ุฏุณุช ุงุถุงูู ฺฉูุฏ:

```csharp
Cookie c = new Cookie ("PREF",
                       "ID=6b10df1da493a9c4:TM=1179...",
                       "/",
                       ".google.com");
freshCookieContainer.Add (c);
```

ุขุฑฺฏููุงู ุณูู ู ฺูุงุฑู ุจู ุชุฑุชุจ **ูุณุฑ (Path)** ู **ุฏุงููู (Domain)** ุตุงุฏุฑฺฉููุฏู ุฑุง ูุดุฎุต ูโฺฉููุฏ.

ฺฉ `CookieContainer` ุฏุฑ ุณูุช ฺฉูุงูุช ูโุชูุงูุฏ ฺฉูฺฉโูุง ุงุฒ ฺูุฏู ูุจุฏุง ูุฎุชูู ุฑุง ุฏุฑ ุฎูุฏ ุฌุง ุฏูุฏุ `HttpClient` ููุท ฺฉูฺฉโูุง ุฑุง ูโูุฑุณุชุฏ ฺฉู ูุณุฑ ู ุฏุงูููโุดุงู ุจุง ุณุฑูุฑ ุฏุฑุฎูุงุณุชโุดุฏู ูุทุงุจูุช ุฏุงุดุชู ุจุงุดูุฏ.

### ๐ฅ๏ธ ููุดุชู ฺฉ HTTP Server

ุงฺฏุฑ ูุงุฒ ุจู ููุดุชู ฺฉ **HTTP server** ุฏุงุดุชู ุจุงุดุฏุ ฺฉ ุฑูฺฉุฑุฏ ุณุทุญ ุจุงูุงุชุฑ (ุงุฒ .NET 6 ุจู ุจุนุฏ) ุงุณุชูุงุฏู ุงุฒ **ASP.NET Minimal API** ุงุณุช. ุจุฑุง ุดุฑูุน ููุท ฺฉุงู ุงุณุช:

```csharp
var app = WebApplication.CreateBuilder().Build();
app.MapGet ("/", () => "Hello, world!");
app.Run();
```

ููฺูู ูโุชูุงูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณ **HttpListener**ุ ุณุฑูุฑ HTTP ุงุฎุชุตุงุต ุฎูุฏุชุงู ุฑุง ุจุณุงุฒุฏ. ูููููโ ุฒุฑ ฺฉ ุณุฑูุฑ ุณุงุฏู ุงุณุช ฺฉู ุฑู ูพูุฑุช 51111 ฺฏูุด ูโุฏูุฏุ ููุชุธุฑ ฺฉ ุฏุฑุฎูุงุณุช ุงุฒ ฺฉูุงูุช ูโุดูุฏ ู ุณูพุณ ฺฉ ูพุงุณุฎ ฺฉโุฎุท ุจุฑูโฺฏุฑุฏุงูุฏ:

```csharp
using var server = new SimpleHttpServer();
// ุงุฑุณุงู ฺฉ ุฏุฑุฎูุงุณุช ุงุฒ ฺฉูุงูุช:
Console.WriteLine (await new HttpClient().GetStringAsync
  ("http://localhost:51111/MyApp/Request.txt"));

class SimpleHttpServer : IDisposable
{
  readonly HttpListener listener = new HttpListener();
  public SimpleHttpServer() => ListenAsync();  

  async void ListenAsync()
  {
    listener.Prefixes.Add ("http://localhost:51111/MyApp/");  // ฺฏูุด ุฏุงุฏู ุฑู ูพูุฑุช 51111
    listener.Start();

    // ููุชุธุฑ ฺฉ ุฏุฑุฎูุงุณุช ฺฉูุงูุช:
    HttpListenerContext context = await listener.GetContextAsync();

    // ูพุงุณุฎ ุจู ุฏุฑุฎูุงุณุช:
    string msg = "You asked for: " + context.Request.RawUrl;
    context.Response.ContentLength64 = Encoding.UTF8.GetByteCount (msg);
    context.Response.StatusCode = (int)HttpStatusCode.OK;
    using (Stream s = context.Response.OutputStream)
    using (StreamWriter writer = new StreamWriter (s))
      await writer.WriteAsync (msg);
  }

  public void Dispose() => listener.Close();
}
```

๐ค **ุฎุฑูุฌ:**

```
You asked for: /MyApp/Request.txt
```

ุฑู ููุฏูุฒุ `HttpListener` ุจู ุตูุฑุช ุฏุงุฎู ุงุฒ **.NET Socket** ุงุณุชูุงุฏู ููโฺฉูุฏุ ุจูฺฉู ุงุฒ **Windows HTTP Server API** ฺฉูฺฉ ูโฺฏุฑุฏ. ุงู ููุถูุน ุจุงุนุซ ูโุดูุฏ ฺูุฏู ุจุฑูุงูู ุฑู ฺฉ IP ู ูพูุฑุช ฺฉุณุงู ฺฏูุด ุจุฏููุฏุ ุจู ุดุฑุท ฺฉู ูุฑ ฺฉุฏุงู ูพุดููุฏูุง ูุชูุงูุช ุซุจุช ฺฉููุฏ (ูุซูุงู `/myapp` ุง `/anotherapp`).

ูฺฺฏโูุง ุงุตู:

* ุฏุฑุฎูุงุณุชโูุง ฺฉูุงูุช ุงุฒ ุทุฑู ูุชุฏ `GetContext` ฺฏุฑูุชู ูโุดูุฏ.
* ุดูุง ูโุชูุงูุฏ ูุฏุฑูุงุ ฺฉูฺฉโูุง ู ูุถุนุช ูพุงุณุฎ ุฑุง ุชูุธู ฺฉูุฏ.
* ุญุฏุงูู ุจุงุฏ **ContentLength** ู **StatusCode** ุฑุง ูุดุฎุต ฺฉูุฏ.

ูุซุงู ฺฉ **ูุจโุณุฑูุฑ ุณุงุฏู ู ูุงููุฒูุงู** ุจุฑุง ุงุฑุงุฆูโ ูุงูโูุง:

```csharp
class WebServer
{
  HttpListener _listener;
  string _baseFolder;  // ูพูุดูโ ูุจโูพุฌโูุง
  public WebServer (string uriPrefix, string baseFolder)
  {
    _listener = new HttpListener();
    _listener.Prefixes.Add (uriPrefix);
    _baseFolder = baseFolder;
  }

  public async void Start()
  {
    _listener.Start();
    while (true)
      try 
      {
        var context = await _listener.GetContextAsync();
        Task.Run (() => ProcessRequestAsync (context));
      }
      catch (HttpListenerException)     { break; }
      catch (InvalidOperationException) { break; }
  }

  public void Stop() => _listener.Stop();

  async void ProcessRequestAsync (HttpListenerContext context)
  {
    try
    {
      string filename = Path.GetFileName (context.Request.RawUrl);
      string path = Path.Combine (_baseFolder, filename);
      byte[] msg;

      if (!File.Exists (path))
      {
        Console.WriteLine ("Resource not found: " + path);
        context.Response.StatusCode = (int) HttpStatusCode.NotFound;
        msg = Encoding.UTF8.GetBytes ("Sorry, that page does not exist");
      }
      else
      {
        context.Response.StatusCode = (int) HttpStatusCode.OK;
        msg = File.ReadAllBytes (path);
      }

      context.Response.ContentLength64 = msg.Length;
      using (Stream s = context.Response.OutputStream)
        await s.WriteAsync (msg, 0, msg.Length);
    }
    catch (Exception ex) { Console.WriteLine ("Request error: " + ex); }
  }
}
```

๐ ุฑุงูโุงูุฏุงุฒ:

```csharp
var server = new WebServer ("http://localhost:51111/", @"d:\webroot");
try
{
  server.Start();
  Console.WriteLine ("Server running... press Enter to stop");
  Console.ReadLine();
}
finally { server.Stop(); }
```

ุญุงูุง ูโุชูุงูุฏ ุจุง ูุฑ ูุฑูุฑฺฏุฑ ุงู ุณุฑูุฑ ุฑุง ุชุณุช ฺฉูุฏ.

---

### ๐ ุงุณุชูุงุฏู ุงุฒ DNS

ฺฉูุงุณ ุงุณุชุงุชฺฉ **Dns** ุนููุงุช **Domain Name System** ุฑุง ฺฉูพุณููู ูโฺฉูุฏ.

๐น ุชุจุฏู ูุงู ุฏุงููู ุจู IP:

```csharp
foreach (IPAddress a in Dns.GetHostAddresses ("albahari.com"))
  Console.WriteLine (a.ToString());  // 205.210.42.167
```

๐น ุชุจุฏู IP ุจู ูุงู ุฏุงููู:

```csharp
IPHostEntry entry = Dns.GetHostEntry ("205.210.42.167");
Console.WriteLine (entry.HostName);  // albahari.com
```

๐น ุฑูุด ูุงููุฒูุงู:

```csharp
foreach (IPAddress a in await Dns.GetHostAddressesAsync ("albahari.com"))
  Console.WriteLine (a.ToString());
```

---

### ๐ง ุงุฑุณุงู ุงูู ุจุง SmtpClient

ฺฉูุงุณ **SmtpClient** ุฏุฑ ูุถุง ูุงู `System.Net.Mail` ุจุฑุง ุงุฑุณุงู ุงูู ุจุง ูพุฑูุชฺฉู **SMTP** ุงุณุชูุงุฏู ูโุดูุฏ.

ูุซุงู ุณุงุฏู:

```csharp
SmtpClient client = new SmtpClient();
client.Host = "mail.myserver.com";
client.Send ("from@adomain.com", "to@adomain.com", "subject", "body");
```

๐ ุงูุฒูุฏู ูพูุณุชโูุง:

```csharp
SmtpClient client = new SmtpClient();
client.Host = "mail.myisp.net";
MailMessage mm = new MailMessage();
mm.Sender = new MailAddress ("kay@domain.com", "Kay");
mm.From   = new MailAddress ("kay@domain.com", "Kay");
mm.To.Add  (new MailAddress ("bob@domain.com", "Bob"));
mm.CC.Add  (new MailAddress ("dan@domain.com", "Dan"));
mm.Subject = "Hello!";
mm.Body = "Hi there. Here's the photo!";
mm.IsBodyHtml = false;
mm.Priority = MailPriority.High;
Attachment a = new Attachment ("photo.jpg",
                               System.Net.Mime.MediaTypeNames.Image.Jpeg);
mm.Attachments.Add (a);
client.Send (mm);
```

๐ ุจุดุชุฑ ุณุฑูุฑูุง SMTP ููุท ุงุฑุชุจุงุทโูุง **ุงุญุฑุงุฒ ููุชโุดุฏู ู ุงูู (SSL/TLS)** ุฑุง ูุจูู ูโฺฉููุฏ:

```csharp
var client = new SmtpClient ("smtp.myisp.com", 587)
{
  Credentials = new NetworkCredential ("me@myisp.com", "MySecurePass"),
  EnableSsl = true
};
client.Send ("me@myisp.com", "someone@somewhere.com", "Subject", "Body");
Console.WriteLine ("Sent");
```

๐ ุฏุฑ ุฒูุงู ุชูุณุนูุ ูโุชูุงูุฏ ุงููโูุง ุฑุง ุจู ุฌุง ุงุฑุณุงูุ ุฏุฑ ฺฉ ูพูุดู ุฐุฎุฑู ฺฉูุฏ:

```csharp
SmtpClient client = new SmtpClient();
client.DeliveryMethod = SmtpDeliveryMethod.SpecifiedPickupDirectory;
client.PickupDirectoryLocation = @"c:\mail";
```

---

โจ ุฏุฑ ุงู ุจุฎุด ุงุฏ ฺฏุฑูุชู ฺุทูุฑ ุฏุฑ .NET ฺฉ **HTTP server** ุณุงุฏู ุจููุณูุ ุจุง **DNS** ฺฉุงุฑ ฺฉูู ู ุจุง ุงุณุชูุงุฏู ุงุฒ **SMTP** ุงูู ุงุฑุณุงู ฺฉูู.

## ุงุณุชูุงุฏู ุงุฒ TCP ๐

TCP ู UDP ูพุฑูุชฺฉูโูุง ูุงูโ **Transport** ูุณุชูุฏ ฺฉู ุจุดุชุฑ ุณุฑูุณโูุง ุงูุชุฑูุช ู ุดุจฺฉูโูุง ูุญู (LAN) ุจุฑ ูพุงูโ ุขูโูุง ุณุงุฎุชู ุดุฏูโุงูุฏ. ุจูโุนููุงู ููููู:

* ูพุฑูุชฺฉูโูุง HTTP (ูุณุฎูโ ฒ ู ูพุงูโุชุฑ)ุ FTP ู SMTP ุงุฒ **TCP** ุงุณุชูุงุฏู ูโฺฉููุฏ.
* ูพุฑูุชฺฉูโูุง DNS ู HTTP ูุณุฎูโ ณ ุงุฒ **UDP** ุงุณุชูุงุฏู ูโฺฉููุฏ.

TCP ฺฉ ูพุฑูุชฺฉู **Connection-Oriented** ุงุณุช ู ูฺฉุงูุฒูโูุง ุงุทููุงู (Reliability) ุฏุงุฑุฏุ ุฏุฑ ุญุงู ฺฉู UDP **Connectionless** ุจูุฏูุ ุณุฑุจุงุฑ (Overhead) ฺฉูุชุฑ ุฏุงุฑุฏ ู ุงุฒ **Broadcasting** ูพุดุชุจุงู ูโฺฉูุฏ. ุจุฑุง ูููููุ **BitTorrent** ู **Voice over IP (VoIP)** ุงุฒ UDP ุจูุฑู ูโุจุฑูุฏ. โก

ูุงูโ Transport ูุณุจุช ุจู ูุงูโูุง ุจุงูุงุชุฑ ุงูุนุทุงูโูพุฐุฑ ุจุดุชุฑ ูุฑุงูู ูโฺฉูุฏ ู ูโุชูุงูุฏ ฺฉุงุฑุง ุจูุชุฑ ูู ุฏุงุดุชู ุจุงุดุฏุ ุงูุง ุจุงุฏ ฺฉุงุฑูุง ูุซู **Authentication** ู **Encryption** ุฑุง ุฎูุฏุชุงู ูุฏุฑุช ฺฉูุฏ.

---

### TCP ุฏุฑ .NET

ุฏุฑ .NET ุฏู ุงูุชุฎุงุจ ุงุตู ูุฌูุฏ ุฏุงุฑุฏ:

1. ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณโูุง ุณุงุฏูโุชุฑ **TcpClient** ู **TcpListener**
2. ุง ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณ ูพุดุฑูุชูโุชุฑ ู ูพุฑุงูฺฉุงูุงุชโุชุฑ **Socket**

ุฏุฑ ูุงูุน ูโุชูุงู ุงู ุฏู ุฑุง ุจุง ูู ุชุฑฺฉุจ ฺฉุฑุฏุ ุฒุฑุง **TcpClient** ุงุฒ ุทุฑู ูฺฺฏ **Client**ุ ุดุก ุงุตู **Socket** ุฑุง ุฏุฑ ุงุฎุชุงุฑ ูโฺฏุฐุงุฑุฏ. ฺฉูุงุณ **Socket** ุชูุธูุงุช ุจุดุชุฑ ุฑุง ุจุฑุง ุฏุณุชุฑุณ ูุณุชูู ุจู ูุงูโ ุดุจฺฉู (IP) ู ุญุช ูพุฑูุชฺฉูโูุง ุบุฑุงูุชุฑูุช ูุซู **Novell SPX/IPX** ูุฑุงูู ูโฺฉูุฏ.

ูุซู ุณุงุฑ ูพุฑูุชฺฉูโูุงุ TCP ูู ุจู **Client** ู **Server** ุชูุงูุช ูุงุฆู ูโุดูุฏ:

* Client ุฏุฑุฎูุงุณุช ุฑุง ุขุบุงุฒ ูโฺฉูุฏ.
* Server ููุชุธุฑ ุฏุฑุงูุช ุฏุฑุฎูุงุณุช ูโูุงูุฏ.

ูููููโ ฺฉ **Client ููฺฏุงู (Synchronous TCP Client)**:

```csharp
using (TcpClient client = new TcpClient())
{
    client.Connect("address", port);
    using (NetworkStream n = client.GetStream())
    {
        // Read and write to the network stream...
    }
}
```

* ูุชุฏ **Connect** ุฏุฑ TcpClient ุจููฺฉู ูโุดูุฏ ุชุง ุงุชุตุงู ุจุฑูุฑุงุฑ ฺฏุฑุฏุฏ (ูุณุฎูโ ุบุฑููฺฏุงู ุขู **ConnectAsync** ุงุณุช).
* ูพุณ ุงุฒ ุขูุ **NetworkStream** ุงูฺฉุงู ุงุฑุชุจุงุท ุฏูุทุฑูู (ุงุฑุณุงู ู ุฏุฑุงูุช ุฏุงุฏูโูุง ุจุงูุฑ) ุจุง ุณุฑูุฑ ุฑุง ูุฑุงูู ูโฺฉูุฏ.

---

### ฺฉ ุณุฑูุฑ ุณุงุฏูโ TCP

```csharp
TcpListener listener = new TcpListener(<ip address>, port);
listener.Start();
while (keepProcessingRequests)
    using (TcpClient c = listener.AcceptTcpClient())
    using (NetworkStream n = c.GetStream())
    {
        // Read and write to the network stream...
    }
listener.Stop();
```

* ุจุฑุง **TcpListener** ุจุงุฏ ุขุฏุฑุณ IP ูุญู ุชุนู ุดูุฏ (ฺฉ ฺฉุงููพูุชุฑ ุจุง ุฏู ฺฉุงุฑุช ุดุจฺฉู ูโุชูุงูุฏ ุฏู ุขุฏุฑุณ ุฏุงุดุชู ุจุงุดุฏ).
* ูโุชูุงู ุงุฒ **IPAddress.Any** ุงุณุชูุงุฏู ฺฉุฑุฏ ุชุง ุฑู ุชูุงู ุขุฏุฑุณโูุง IP ูุญู ฺฏูุด ุฏูุฏ.
* ูุชุฏ **AcceptTcpClient** ุชุง ุฏุฑุงูุช ุฏุฑุฎูุงุณุช ุงุฒ ฺฉ Client ุจููฺฉู ูโูุงูุฏ (ูุณุฎูโ ุบุฑููฺฏุงู ุขู ูุฒ ูุฌูุฏ ุฏุงุฑุฏ).
* ูพุณ ุงุฒ ุฏุฑุงูุช ุงุชุตุงูุ ูุดุงุจู Clientุ ุงุฒ **GetStream** ุจุฑุง ุงุฑุชุจุงุท ุงุณุชูุงุฏู ูโฺฉูู.

โ๏ธ ููฺฏุงู ฺฉุงุฑ ุฏุฑ ูุงูโ Transport ุจุงุฏ ฺฉ **ูพุฑูุชฺฉู ูฺฉุงููู** ุชุนุฑู ฺฉูุฏ (ฺู ฺฉุณ ฺู ุฒูุงู ุตุญุจุช ฺฉูุฏ ู ฺู ุฒูุงู ฺฏูุด ุฏูุฏ). ุงฺฏุฑ ูุฑ ุฏู ุทุฑู ููโุฒูุงู ุตุญุจุช ุง ููโุฒูุงู ฺฏูุด ฺฉููุฏุ ุงุฑุชุจุงุท ุงุฒ ฺฉุงุฑ ูโุงูุชุฏโูุซู ูุงฺฉโุชุงฺฉ! ๐๏ธ

---

### ููููู ูพุฑูุชฺฉู ุณุงุฏู (Hello โ Hello right back!)

```csharp
using System;
using System.IO;
using System.Net;
using System.Net.Sockets;
using System.Threading;

new Thread(Server).Start();   // ุงุฌุฑุง ูุชุฏ ุณุฑูุฑ ุจูโุทูุฑ ููุงุฒ
Thread.Sleep(500);            // ฺฉู ูฺฉุซ ุจุฑุง ุฑุงูโุงูุฏุงุฒ ุณุฑูุฑ
Client();

void Client()
{
    using (TcpClient client = new TcpClient("localhost", 51111))
    using (NetworkStream n = client.GetStream())
    {
        BinaryWriter w = new BinaryWriter(n);
        w.Write("Hello");
        w.Flush();
        Console.WriteLine(new BinaryReader(n).ReadString());
    }
}

void Server()   // ููุท ฺฉ ุฏุฑุฎูุงุณุช ุฑุง ูพุฑุฏุงุฒุด ูโฺฉูุฏ
{
    TcpListener listener = new TcpListener(IPAddress.Any, 51111);
    listener.Start();
    using (TcpClient c = listener.AcceptTcpClient())
    using (NetworkStream n = c.GetStream())
    {
        string msg = new BinaryReader(n).ReadString();
        BinaryWriter w = new BinaryWriter(n);
        w.Write(msg + " right back!");
        w.Flush();   // ุญุชูุง ุจุงุฏ Flush ุดูุฏ ฺูู Writer ุขุฒุงุฏ ููโุดูุฏ
    }
    listener.Stop();
}

// OUTPUT: Hello right back!
```

* ุฏุฑ ุงู ูุซุงู ุงุฒ **localhost loopback** ุงุณุชูุงุฏู ุดุฏู ุชุง Client ู Server ุฑู ููุงู ุณุณุชู ุงุฌุฑุง ุดููุฏ.
* ูพูุฑุช ุฏุฑ ุจุงุฒูโ ุขุฒุงุฏ (ุจุงูุงุชุฑ ุงุฒ ดนฑตฒ) ุงูุชุฎุงุจ ุดุฏู ุงุณุช.
* ุจุฑุง ุงุฑุณุงู ู ุฏุฑุงูุช ูุชูโูุง ุงุฒ **BinaryWriter** ู **BinaryReader** ุงุณุชูุงุฏู ฺฉุฑุฏูโุงู.
* ุงู ุงุจุฒุงุฑูุง ุจุฑุฎูุงู **StreamReader/StreamWriter** ุฑุดุชูโูุง ุฑุง ุจุง ฺฉ ุนุฏุฏ ุทูู (Length Prefix) ุฐุฎุฑู ูโฺฉููุฏุ ุจูุงุจุฑุงู **BinaryReader** ุฏููุงู ูโุฏุงูุฏ ฺูุฏ ุจุงุช ุจุงุฏ ุจุฎูุงูุฏ.

ุงฺฏุฑ ุงุฒ **StreamReader.ReadToEnd** ุงุณุชูุงุฏู ฺฉูุฏุ ููฺฉู ุงุณุช ุงุชุตุงู ูฺโููุช ุชูุงู ูุดูุฏ ู ุนููุงุช ุฎูุงูุฏู ุจุฑุง ููุดู ุจููฺฉู ุดูุฏุ ฺูู **NetworkStream** ุงูุชูุง ูุดุฎุต ูุฏุงุฑุฏ. โ๏ธ
ููฺูู **StreamReader** ุจู ุฏูู ุฏุงุดุชู **Read-Ahead Buffer**ุ ููฺฉู ุงุณุช ุจุด ุงุฒ ุญุฏ ูุงุฒ ุจุฎูุงูุฏ ู ุจุงุนุซ ุจููฺฉู ุดุฏู ุดูุฏ. ุงูุง **FileStream** ฺูู ูุดฺฉู ูุฏุงุฑุฏ ฺูู ุงูุชูุง ูุดุฎุต ุฏุงุฑุฏ ู ูุชุฏ **Read** ุฏุฑ ูพุงุงู ููุฏุงุฑ `0` ุจุงุฒูโฺฏุฑุฏุงูุฏ.

---

### ููโุฒูุงู (Concurrency) ุจุง TCP โก

ฺฉูุงุณโูุง **TcpClient** ู **TcpListener** ูุชุฏูุง **Asynchronous** ุฏุงุฑูุฏ ฺฉู ุจุฑุง ููุงุณโูพุฐุฑ ุจูุชุฑ ุงุณุชูุงุฏู ูโุดููุฏ. ฺฉุงู ุงุณุช ูุชุฏูุง ุจููฺฉูโุดููุฏู ุฑุง ุจุง ูุณุฎูโ Async ุฌุงฺฏุฒู ฺฉุฑุฏู ู ูุชุฌู ุฑุง **await** ฺฉูุฏ.

ูููููโ ฺฉ ุณุฑูุฑ **Async**:

```csharp
async void RunServerAsync()
{
    var listener = new TcpListener(IPAddress.Any, 51111);
    listener.Start();
    try
    {
        while (true)
            Accept(await listener.AcceptTcpClientAsync());
    }
    finally { listener.Stop(); }
}

async Task Accept(TcpClient client)
{
    await Task.Yield();
    try
    {
        using (client)
        using (NetworkStream n = client.GetStream())
        {
            byte[] data = new byte[5000];
            int bytesRead = 0; int chunkSize = 1;
            while (bytesRead < data.Length && chunkSize > 0)
                bytesRead += chunkSize =
                    await n.ReadAsync(data, bytesRead, data.Length - bytesRead);
            Array.Reverse(data);   // ูุนฺฉูุณ ฺฉุฑุฏู ุขุฑุงูโ ุจุงุชโูุง
            await n.WriteAsync(data, 0, data.Length);
        }
    }
    catch (Exception ex) { Console.WriteLine(ex.Message); }
}
```

ุงู ุจุฑูุงูู **Scalable** ุงุณุช ฺูู ุจุฑุง ฺฉู ูุฏุช ุฏุฑุฎูุงุณุช ฺฉ Thread ุงุดุบุงู ููโฺฉูุฏ.
ูุซูุงู ุงฺฏุฑ ฑฐฐฐ Client ููโุฒูุงู ูุชุตู ุดููุฏ ู ูุฑฺฉุฏุงู ฺูุฏ ุซุงูู ุทูู ุจฺฉุดุฏุ ุงู ุฑุงูฺฉุงุฑ ูุงุฒ ุจู ฑฐฐฐ Thread ูุฏุงุฑุฏ. ููุท ุฏุฑ ุจุงุฒูโูุง ฺฉูุชุงู ูุจู ู ุจุนุฏ ุงุฒ ุนุจุงุฑุชโูุง `await` ุงุฒ Thread ุงุณุชูุงุฏู ูโฺฉูุฏ. โ

---

### ุฏุฑุงูุช ุงูู POP3 ุจุง TCP ๐ง

ุฏุฑ .NET ูพุดุชุจุงู ุฏุฑ ุณุทุญ **Application Layer** ุจุฑุง ูพุฑูุชฺฉู **POP3** ูุฌูุฏ ูุฏุงุฑุฏ. ุจูุงุจุฑุงู ุจุงุฏ ุฏุฑ **TCP Layer** ฺฉุฏููุณ ฺฉูุฏ. ุฎูุดุจุฎุชุงููุ ูพุฑูุชฺฉู POP3 ุณุงุฏู ุงุณุช ู ฺฏูุชฺฏู ุขู ุจูโุตูุฑุช ุฒุฑ ูพุด ูโุฑูุฏ:

<div align="center">

![Conventions-UsedThis-Book](../../../assets/image/16/Table-16-4.jpeg)
</div>

## ุฏุฑุงูุช ุงูู POP3 ุจุง TCP ๐ง

ูุฑ ุฏุณุชูุฑ ู ูพุงุณุฎ ุฏุฑ ูพุฑูุชฺฉู **POP3** ุจุง ฺฉ ุฎุท ุฌุฏุฏ (**CR + LF**) ูพุงุงู ูโุงุจุฏุ ุจูโุฌุฒ ุฏุณุชูุฑุงุช ฺูุฏุฎุท ูุซู **LIST** ู **RETR** ฺฉู ุจุง ฺฉ ููุทู (`.`) ุฏุฑ ฺฉ ุฎุท ุฌุฏุงฺฏุงูู ุชูุงู ูโุดููุฏ.
ุงุฒ ุขูโุฌุง ฺฉู ููโุชูุงูู ุงุฒ **StreamReader** ุจุง **NetworkStream** ุงุณุชูุงุฏู ฺฉููุ ุงุจุชุฏุง ฺฉ ูุชุฏ ฺฉูฺฉ ุจุฑุง ุฎูุงูุฏู ฺฉ ุฎุท ูุชู ุจูโุตูุฑุช **ุจุฏูู ุจุงูุฑ (Nonbuffered)** ูโููุณู:

```csharp
string ReadLine (Stream s)
{
    List<byte> lineBuffer = new List<byte>();
    while (true)
    {
        int b = s.ReadByte();
        if (b == 10 || b < 0) break;
        if (b != 13) lineBuffer.Add((byte)b);
    }
    return Encoding.UTF8.GetString(lineBuffer.ToArray());
}
```

---

### ูุชุฏ ฺฉูฺฉ ุจุฑุง ุงุฑุณุงู ุฏุณุชูุฑ โ๏ธ

ููฺูู ฺฉ ูุชุฏ ฺฉูฺฉ ุจุฑุง ุงุฑุณุงู ุฏุณุชูุฑ ูุงุฒ ุฏุงุฑู. ฺูู ููุดู ุงูุชุธุงุฑ ุฏุงุฑู ูพุงุณุฎ ุจุง **+OK** ุดุฑูุน ุดูุฏุ ูโุชูุงูู ูพุงุณุฎ ุฑุง ุฏุฑ ููุงู ูุญุธู ุจุฎูุงูู ู ุงุนุชุจุงุฑุณูุฌ ฺฉูู:

```csharp
void SendCommand (Stream stream, string line)
{
    byte[] data = Encoding.UTF8.GetBytes(line + "\r\n");
    stream.Write(data, 0, data.Length);
    string response = ReadLine(stream);
    if (!response.StartsWith("+OK"))
        throw new Exception("POP Error: " + response);
}
```

---

### ุฏุฑุงูุช ุงููโูุง ุงุฒ ุณุฑูุฑ ๐ฌ

ุจุง ุฏุงุดุชู ุงู ูุชุฏูุงุ ฺฉุงุฑ ุฏุฑุงูุช ุงูู ุณุงุฏู ูโุดูุฏ. ฺฉุงู ุงุณุช ฺฉ ุงุชุตุงู TCP ุฑู ูพูุฑุช **ฑฑฐ** (ูพูุฑุช ูพุดโูุฑุถ POP3) ุจุฑูุฑุงุฑ ฺฉูู ู ุจุง ุณุฑูุฑ ฺฏูุชฺฏู ุฑุง ุขุบุงุฒ ฺฉูู. ุฏุฑ ุงู ูุซุงูุ ูุฑ ูพุงู ุงูู ุฏุฑ ฺฉ ูุงู ุชุตุงุฏู ุจุง ูพุณููุฏ **.eml** ุฐุฎุฑู ูโุดูุฏ ู ุณูพุณ ุงุฒ ุฑู ุณุฑูุฑ ุญุฐู ูโฺฏุฑุฏุฏ:

```csharp
using (TcpClient client = new TcpClient("mail.isp.com", 110))
using (NetworkStream n = client.GetStream())
{
    ReadLine(n);                           // ุฎูุงูุฏู ูพุงู ุฎูุดโุขูุฏฺฏู
    SendCommand(n, "USER username");
    SendCommand(n, "PASS password");
    SendCommand(n, "LIST");                // ุฏุฑุงูุช ุดูุงุณูโูุง ูพุงูโูุง

    List<int> messageIDs = new List<int>();
    while (true)
    {
        string line = ReadLine(n);         // ูุซูุง: "1 1876"
        if (line == ".") break;
        messageIDs.Add(int.Parse(line.Split(' ')[0]));   // ุดูุงุณู ูพุงู
    }

    foreach (int id in messageIDs)         // ุฏุฑุงูุช ูุฑ ูพุงู
    {
        SendCommand(n, "RETR " + id);
        string randomFile = Guid.NewGuid().ToString() + ".eml";
        using (StreamWriter writer = File.CreateText(randomFile))
            while (true)
            {
                string line = ReadLine(n); // ุฎูุงูุฏู ุฎุท ุจุนุฏ ูพุงู
                if (line == ".") break;    // ููุทู = ูพุงุงู ูพุงู
                if (line == "..") line = "."; // ุฌุงฺฏุฒู ููุทูโ ุฏูุชุง
                writer.WriteLine(line);    // ููุดุชู ุฏุฑ ูุงู ุฎุฑูุฌ
            }
        SendCommand(n, "DELE " + id);      // ุญุฐู ูพุงู ุงุฒ ุณุฑูุฑ
    }

    SendCommand(n, "QUIT");
}
```

---

### ูฺฉุชู ๐ก

ุฏุฑ **NuGet** ฺฉุชุงุจุฎุงููโูุง ูุชูโุจุงุฒ (**Open Source**) ุจุฑุง POP3 ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ูุงุจูุชโูุง ูุซู:

* ูพุดุชุจุงู ุงุฒ **Authentication**
* ุจุฑูุฑุงุฑ ุงุฑุชุจุงุท ุงูู **TLS/SSL**
* ู ูพุฑุฏุงุฒุด ูพุงูโูุง ุจุง **MIME Parsing**

ุฑุง ุฏุฑ ุงุฎุชุงุฑ ุดูุง ูุฑุงุฑ ูโุฏููุฏ. โ
